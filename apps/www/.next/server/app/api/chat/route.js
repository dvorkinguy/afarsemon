(()=>{var a={};a.id=276,a.ids=[276],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:a=>{"use strict";a.exports=require("node:buffer")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16744:()=>{},21820:a=>{"use strict";a.exports=require("os")},27910:a=>{"use strict";a.exports=require("stream")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:a=>{"use strict";a.exports=require("tls")},37067:a=>{"use strict";a.exports=require("node:http")},38595:(a,b,c)=>{"use strict";let d;c.r(b),c.d(b,{handler:()=>fj,patchFetch:()=>fi,routeModule:()=>fe,serverHooks:()=>fh,workAsyncStorage:()=>ff,workUnitAsyncStorage:()=>fg});var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O={};c.r(O),c.d(O,{POST:()=>fd});var P=c(18868),Q=c(81961),R=c(36512),S=c(98082),T=c(93408),U=c(261),V=c(44142),W=c(20068),X=c(5212),Y=c(27487),Z=c(53097),$=c(11),_=c(5781),aa=c(6498),ab=c(86439),ac=c(47568),ad="vercel.ai.error",ae=Symbol.for(ad),af=class a extends Error{constructor({name:a,message:b,cause:c}){super(b),this[e]=!0,this.name=a,this.cause=c}static isInstance(b){return a.hasMarker(b,ad)}static hasMarker(a,b){let c=Symbol.for(b);return null!=a&&"object"==typeof a&&c in a&&"boolean"==typeof a[c]&&!0===a[c]}};e=ae;var ag=af,ah="AI_APICallError",ai=`vercel.ai.error.${ah}`,aj=Symbol.for(ai),ak=class extends ag{constructor({message:a,url:b,requestBodyValues:c,statusCode:d,responseHeaders:e,responseBody:g,cause:h,isRetryable:i=null!=d&&(408===d||409===d||429===d||d>=500),data:j}){super({name:ah,message:a,cause:h}),this[f]=!0,this.url=b,this.requestBodyValues=c,this.statusCode=d,this.responseHeaders=e,this.responseBody=g,this.isRetryable=i,this.data=j}static isInstance(a){return ag.hasMarker(a,ai)}};f=aj;var al="AI_EmptyResponseBodyError",am=`vercel.ai.error.${al}`,an=Symbol.for(am),ao=class extends ag{constructor({message:a="Empty response body"}={}){super({name:al,message:a}),this[g]=!0}static isInstance(a){return ag.hasMarker(a,am)}};function ap(a){return null==a?"unknown error":"string"==typeof a?a:a instanceof Error?a.message:JSON.stringify(a)}g=an;var aq="AI_InvalidArgumentError",ar=`vercel.ai.error.${aq}`,as=Symbol.for(ar),at=class extends ag{constructor({message:a,cause:b,argument:c}){super({name:aq,message:a,cause:b}),this[h]=!0,this.argument=c}static isInstance(a){return ag.hasMarker(a,ar)}};h=as;var au="AI_InvalidPromptError",av=`vercel.ai.error.${au}`,aw=Symbol.for(av),ax=class extends ag{constructor({prompt:a,message:b,cause:c}){super({name:au,message:`Invalid prompt: ${b}`,cause:c}),this[i]=!0,this.prompt=a}static isInstance(a){return ag.hasMarker(a,av)}};i=aw,Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var ay="AI_JSONParseError",az=`vercel.ai.error.${ay}`,aA=Symbol.for(az),aB=class extends ag{constructor({text:a,cause:b}){super({name:ay,message:`JSON parsing failed: Text: ${a}.
Error message: ${ap(b)}`,cause:b}),this[j]=!0,this.text=a}static isInstance(a){return ag.hasMarker(a,az)}};j=aA;var aC="AI_LoadAPIKeyError",aD=`vercel.ai.error.${aC}`,aE=Symbol.for(aD),aF=class extends ag{constructor({message:a}){super({name:aC,message:a}),this[k]=!0}static isInstance(a){return ag.hasMarker(a,aD)}};k=aE,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var aG="AI_NoSuchModelError",aH=`vercel.ai.error.${aG}`,aI=Symbol.for(aH),aJ=class extends ag{constructor({errorName:a=aG,modelId:b,modelType:c,message:d=`No such ${c}: ${b}`}){super({name:a,message:d}),this[l]=!0,this.modelId=b,this.modelType=c}static isInstance(a){return ag.hasMarker(a,aH)}};l=aI;var aK="AI_TooManyEmbeddingValuesForCallError",aL=`vercel.ai.error.${aK}`,aM=Symbol.for(aL),aN=class extends ag{constructor(a){super({name:aK,message:`Too many values for a single embedding call. The ${a.provider} model "${a.modelId}" can only embed up to ${a.maxEmbeddingsPerCall} values per call, but ${a.values.length} values were provided.`}),this[m]=!0,this.provider=a.provider,this.modelId=a.modelId,this.maxEmbeddingsPerCall=a.maxEmbeddingsPerCall,this.values=a.values}static isInstance(a){return ag.hasMarker(a,aL)}};m=aM;var aO="AI_TypeValidationError",aP=`vercel.ai.error.${aO}`,aQ=Symbol.for(aP),aR=class a extends ag{constructor({value:a,cause:b}){super({name:aO,message:`Type validation failed: Value: ${JSON.stringify(a)}.
Error message: ${ap(b)}`,cause:b}),this[n]=!0,this.value=a}static isInstance(a){return ag.hasMarker(a,aP)}static wrap({value:b,cause:c}){return a.isInstance(c)&&c.value===b?c:new a({value:b,cause:c})}};n=aQ;var aS="AI_UnsupportedFunctionalityError",aT=`vercel.ai.error.${aS}`,aU=Symbol.for(aT),aV=class extends ag{constructor({functionality:a,message:b=`'${a}' functionality not supported.`}){super({name:aS,message:b}),this[o]=!0,this.functionality=a}static isInstance(a){return ag.hasMarker(a,aT)}};o=aU;class aW extends Error{constructor(a,b){super(a),this.name="ParseError",this.type=b.type,this.field=b.field,this.value=b.value,this.line=b.line}}function aX(a){}class aY extends TransformStream{constructor({onError:a,onRetry:b,onComment:c}={}){let d;super({start(e){d=function(a){if("function"==typeof a)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:b=aX,onError:c=aX,onRetry:d=aX,onComment:e}=a,f="",g=!0,h,i="",j="";function k(a){if(""===a)return void(i.length>0&&b({id:h,event:j||void 0,data:i.endsWith(`
`)?i.slice(0,-1):i}),h=void 0,i="",j="");if(a.startsWith(":")){e&&e(a.slice(a.startsWith(": ")?2:1));return}let c=a.indexOf(":");if(-1!==c){let b=a.slice(0,c),d=" "===a[c+1]?2:1;l(b,a.slice(c+d),a);return}l(a,"",a)}function l(a,b,e){switch(a){case"event":j=b;break;case"data":i=`${i}${b}
`;break;case"id":h=b.includes("\0")?void 0:b;break;case"retry":/^\d+$/.test(b)?d(parseInt(b,10)):c(new aW(`Invalid \`retry\` value: "${b}"`,{type:"invalid-retry",value:b,line:e}));break;default:c(new aW(`Unknown field "${a.length>20?`${a.slice(0,20)}\u2026`:a}"`,{type:"unknown-field",field:a,value:b,line:e}))}}return{feed:function(a){let b=g?a.replace(/^\xEF\xBB\xBF/,""):a,[c,d]=function(a){let b=[],c="",d=0;for(;d<a.length;){let e=a.indexOf("\r",d),f=a.indexOf(`
`,d),g=-1;if(-1!==e&&-1!==f?g=Math.min(e,f):-1!==e?g=e===a.length-1?-1:e:-1!==f&&(g=f),-1===g){c=a.slice(d);break}{let c=a.slice(d,g);b.push(c),"\r"===a[(d=g+1)-1]&&a[d]===`
`&&d++}}return[b,c]}(`${f}${b}`);for(let a of c)k(a);f=d,g=!1},reset:function(a={}){f&&a.consume&&k(f),g=!0,h=void 0,i="",j="",f=""}}}({onEvent:a=>{e.enqueue(a)},onError(b){"terminate"===a?e.error(b):"function"==typeof a&&a(b)},onRetry:b,onComment:c})},transform(a){d.feed(a)}})}}function aZ(...a){return a.reduce((a,b)=>({...a,...null!=b?b:{}}),{})}function a$(a){return Object.fromEntries([...a.headers])}var a_=(({prefix:a,size:b=16,alphabet:c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:d="-"}={})=>{let e=()=>{let a=c.length,d=Array(b);for(let e=0;e<b;e++)d[e]=c[Math.random()*a|0];return d.join("")};if(null==a)return e;if(c.includes(d))throw new at({argument:"separator",message:`The separator "${d}" must not be part of the alphabet "${c}".`});return()=>`${a}${d}${e()}`})();function a0(a){return(a instanceof Error||a instanceof DOMException)&&("AbortError"===a.name||"ResponseAborted"===a.name||"TimeoutError"===a.name)}var a1=["fetch failed","failed to fetch"],a2=/"__proto__"\s*:/,a3=/"constructor"\s*:/;function a4(a){let{stackTraceLimit:b}=Error;Error.stackTraceLimit=0;try{let b=JSON.parse(a);return null===b||"object"!=typeof b||!1===a2.test(a)&&!1===a3.test(a)?b:function(a){let b=[a];for(;b.length;){let a=b;for(let c of(b=[],a)){if(Object.prototype.hasOwnProperty.call(c,"__proto__")||Object.prototype.hasOwnProperty.call(c,"constructor")&&Object.prototype.hasOwnProperty.call(c.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let a in c){let d=c[a];d&&"object"==typeof d&&b.push(d)}}}return a}(b)}finally{Error.stackTraceLimit=b}}var a5=Symbol.for("vercel.ai.validator");async function a6({value:a,schema:b}){let c=await a7({value:a,schema:b});if(!c.success)throw aR.wrap({value:a,cause:c.error});return c.value}async function a7({value:a,schema:b}){var c;let d="object"==typeof b&&null!==b&&a5 in b&&!0===b[a5]&&"validate"in b?b:(c=b,{[a5]:!0,validate:async a=>{let b=await c["~standard"].validate(a);return null==b.issues?{success:!0,value:b.value}:{success:!1,error:new aR({value:a,cause:b.issues})}}});try{if(null==d.validate)return{success:!0,value:a,rawValue:a};let b=await d.validate(a);if(b.success)return{success:!0,value:b.value,rawValue:a};return{success:!1,error:aR.wrap({value:a,cause:b.error}),rawValue:a}}catch(b){return{success:!1,error:aR.wrap({value:a,cause:b}),rawValue:a}}}async function a8({text:a,schema:b}){try{let c=a4(a);if(null==b)return c;return a6({value:c,schema:b})}catch(b){if(aB.isInstance(b)||aR.isInstance(b))throw b;throw new aB({text:a,cause:b})}}async function a9({text:a,schema:b}){try{let c=a4(a);if(null==b)return{success:!0,value:c,rawValue:c};return await a7({value:c,schema:b})}catch(b){return{success:!1,error:aB.isInstance(b)?b:new aB({text:a,cause:b}),rawValue:void 0}}}async function ba({provider:a,providerOptions:b,schema:c}){if((null==b?void 0:b[a])==null)return;let d=await a7({value:b[a],schema:c});if(!d.success)throw new at({argument:"providerOptions",message:`invalid ${a} provider options`,cause:d.error});return d.value}var bb=()=>globalThis.fetch,bc=async({url:a,headers:b,body:c,failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g})=>bd({url:a,headers:{"Content-Type":"application/json",...b},body:{content:JSON.stringify(c),values:c},failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g}),bd=async({url:a,headers:b={},body:c,successfulResponseHandler:d,failedResponseHandler:e,abortSignal:f,fetch:g=bb()})=>{try{let h=await g(a,{method:"POST",headers:Object.fromEntries(Object.entries(b).filter(([a,b])=>null!=b)),body:c.content,signal:f}),i=a$(h);if(!h.ok){let b;try{b=await e({response:h,url:a,requestBodyValues:c.values})}catch(b){if(a0(b)||ak.isInstance(b))throw b;throw new ak({message:"Failed to process error response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}throw b.value}try{return await d({response:h,url:a,requestBodyValues:c.values})}catch(b){if(b instanceof Error&&(a0(b)||ak.isInstance(b)))throw b;throw new ak({message:"Failed to process successful response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}}catch(b){throw function({error:a,url:b,requestBodyValues:c}){if(a0(a))return a;if(a instanceof TypeError&&a1.includes(a.message.toLowerCase())){let d=a.cause;if(null!=d)return new ak({message:`Cannot connect to API: ${d.message}`,cause:d,url:b,requestBodyValues:c,isRetryable:!0})}return a}({error:b,url:a,requestBodyValues:c.values})}};function be({id:a,name:b,inputSchema:c}){return({execute:d,outputSchema:e,toModelOutput:f,onInputStart:g,onInputDelta:h,onInputAvailable:i,...j})=>({type:"provider-defined",id:a,name:b,args:j,inputSchema:c,outputSchema:e,execute:d,toModelOutput:f,onInputStart:g,onInputDelta:h,onInputAvailable:i})}async function bf(a){return"function"==typeof a&&(a=a()),Promise.resolve(a)}var bg=a=>async({response:b,url:c,requestBodyValues:d})=>{let e=await b.text(),f=await a9({text:e,schema:a}),g=a$(b);if(!f.success)throw new ak({message:"Invalid JSON response",cause:f.error,statusCode:b.status,responseHeaders:g,responseBody:e,url:c,requestBodyValues:d});return{responseHeaders:g,value:f.value,rawValue:f.rawValue}},bh=Symbol("Let zodToJsonSchema decide on which parser to use");Symbol.for("vercel.ai.schema");var{btoa:bi,atob:bj}=globalThis;function bk(a){return a instanceof Uint8Array?function(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCodePoint(a[c]);return bi(b)}(a):a}var bl=c(42261),bm=(({errorSchema:a,errorToMessage:b,isRetryable:c})=>async({response:d,url:e,requestBodyValues:f})=>{let g=await d.text(),h=a$(d);if(""===g.trim())return{responseHeaders:h,value:new ak({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})};try{let i=await a8({text:g,schema:a});return{responseHeaders:h,value:new ak({message:b(i),url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,data:i,isRetryable:null==c?void 0:c(d,i)})}}catch(a){return{responseHeaders:h,value:new ak({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})}}})({errorSchema:bl.Ik({error:bl.Ik({code:bl.ai().nullable(),message:bl.Yj(),status:bl.Yj()})}),errorToMessage:a=>a.error.message}),bn=bl.Ik({outputDimensionality:bl.ai().optional(),taskType:bl.k5(["SEMANTIC_SIMILARITY","CLASSIFICATION","CLUSTERING","RETRIEVAL_DOCUMENT","RETRIEVAL_QUERY","QUESTION_ANSWERING","FACT_VERIFICATION","CODE_RETRIEVAL_QUERY"]).optional()}),bo=class{constructor(a,b){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=a,this.config=b}get provider(){return this.config.provider}async doEmbed({values:a,headers:b,abortSignal:c,providerOptions:d}){let e=await ba({provider:"google",providerOptions:d,schema:bn});if(a.length>this.maxEmbeddingsPerCall)throw new aN({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:a});let f=aZ(await bf(this.config.headers),b);if(1===a.length){let{responseHeaders:b,value:d,rawValue:g}=await bc({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:f,body:{model:`models/${this.modelId}`,content:{parts:[{text:a[0]}]},outputDimensionality:null==e?void 0:e.outputDimensionality,taskType:null==e?void 0:e.taskType},failedResponseHandler:bm,successfulResponseHandler:bg(bq),abortSignal:c,fetch:this.config.fetch});return{embeddings:[d.embedding.values],usage:void 0,response:{headers:b,body:g}}}let{responseHeaders:g,value:h,rawValue:i}=await bc({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:f,body:{requests:a.map(a=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:a}]},outputDimensionality:null==e?void 0:e.outputDimensionality,taskType:null==e?void 0:e.taskType}))},failedResponseHandler:bm,successfulResponseHandler:bg(bp),abortSignal:c,fetch:this.config.fetch});return{embeddings:h.embeddings.map(a=>a.values),usage:void 0,response:{headers:g,body:i}}}},bp=bl.Ik({embeddings:bl.YO(bl.Ik({values:bl.YO(bl.ai())}))}),bq=bl.Ik({embedding:bl.Ik({values:bl.YO(bl.ai())})});function br(a){var b;if(null==a||null!=(b=a)&&"object"==typeof b&&"object"===b.type&&(null==b.properties||0===Object.keys(b.properties).length)&&!b.additionalProperties)return;if("boolean"==typeof a)return{type:"boolean",properties:{}};let{type:c,description:d,required:e,properties:f,items:g,allOf:h,anyOf:i,oneOf:j,format:k,const:l,minLength:m,enum:n}=a,o={};if(d&&(o.description=d),e&&(o.required=e),k&&(o.format=k),void 0!==l&&(o.enum=[l]),c&&(Array.isArray(c)?c.includes("null")?(o.type=c.filter(a=>"null"!==a)[0],o.nullable=!0):o.type=c:"null"===c?o.type="null":o.type=c),void 0!==n&&(o.enum=n),null!=f&&(o.properties=Object.entries(f).reduce((a,[b,c])=>(a[b]=br(c),a),{})),g&&(o.items=Array.isArray(g)?g.map(br):br(g)),h&&(o.allOf=h.map(br)),i)if(i.some(a=>"object"==typeof a&&(null==a?void 0:a.type)==="null")){let a=i.filter(a=>"object"!=typeof a||(null==a?void 0:a.type)!=="null");if(1===a.length){let b=br(a[0]);"object"==typeof b&&(o.nullable=!0,Object.assign(o,b))}else o.anyOf=a.map(br),o.nullable=!0}else o.anyOf=i.map(br);return j&&(o.oneOf=j.map(br)),void 0!==m&&(o.minLength=m),o}function bs(a){return a.includes("/")?a:`models/${a}`}var bt=bl.Ik({responseModalities:bl.YO(bl.k5(["TEXT","IMAGE"])).optional(),thinkingConfig:bl.Ik({thinkingBudget:bl.ai().optional(),includeThoughts:bl.zM().optional()}).optional(),cachedContent:bl.Yj().optional(),structuredOutputs:bl.zM().optional(),safetySettings:bl.YO(bl.Ik({category:bl.k5(["HARM_CATEGORY_UNSPECIFIED","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_CIVIC_INTEGRITY"]),threshold:bl.k5(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"])})).optional(),threshold:bl.k5(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"]).optional(),audioTimestamp:bl.zM().optional(),labels:bl.g1(bl.Yj(),bl.Yj()).optional()});function bu({finishReason:a,hasToolCalls:b}){switch(a){case"STOP":return b?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";case"MALFORMED_FUNCTION_CALL":return"error";default:return"unknown"}}var bv=bl.Ik({web:bl.Ik({uri:bl.Yj(),title:bl.Yj()}).nullish(),retrievedContext:bl.Ik({uri:bl.Yj(),title:bl.Yj()}).nullish()}),bw=bl.Ik({webSearchQueries:bl.YO(bl.Yj()).nullish(),retrievalQueries:bl.YO(bl.Yj()).nullish(),searchEntryPoint:bl.Ik({renderedContent:bl.Yj()}).nullish(),groundingChunks:bl.YO(bv).nullish(),groundingSupports:bl.YO(bl.Ik({segment:bl.Ik({startIndex:bl.ai().nullish(),endIndex:bl.ai().nullish(),text:bl.Yj().nullish()}),segment_text:bl.Yj().nullish(),groundingChunkIndices:bl.YO(bl.ai()).nullish(),supportChunkIndices:bl.YO(bl.ai()).nullish(),confidenceScores:bl.YO(bl.ai()).nullish(),confidenceScore:bl.YO(bl.ai()).nullish()})).nullish(),retrievalMetadata:bl.KC([bl.Ik({webDynamicRetrievalScore:bl.ai()}),bl.Ik({})]).nullish()}),bx=be({id:"google.google_search",name:"google_search",inputSchema:bl.Ik({mode:bl.k5(["MODE_DYNAMIC","MODE_UNSPECIFIED"]).default("MODE_UNSPECIFIED"),dynamicThreshold:bl.ai().default(1)})}),by=bl.Ik({retrievedUrl:bl.Yj(),urlRetrievalStatus:bl.Yj()}),bz=bl.Ik({urlMetadata:bl.YO(by)}),bA=be({id:"google.url_context",name:"url_context",inputSchema:bl.Ik({})}),bB=class{constructor(a,b){var c;this.specificationVersion="v2",this.modelId=a,this.config=b,this.generateId=null!=(c=b.generateId)?c:a_}get provider(){return this.config.provider}get supportedUrls(){var a,b,c;return null!=(c=null==(b=(a=this.config).supportedUrls)?void 0:b.call(a))?c:{}}async getArgs({prompt:a,maxOutputTokens:b,temperature:c,topP:d,topK:e,frequencyPenalty:f,presencePenalty:g,stopSequences:h,responseFormat:i,seed:j,tools:k,toolChoice:l,providerOptions:m}){var n,o;let p=[],q=await ba({provider:"google",providerOptions:m,schema:bt});(null==(n=null==q?void 0:q.thinkingConfig)?void 0:n.includeThoughts)!==!0||this.config.provider.startsWith("google.vertex.")||p.push({type:"other",message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let r=this.modelId.toLowerCase().startsWith("gemma-"),{contents:s,systemInstruction:t}=function(a,b){var c;let d=[],e=[],f=!0,g=null!=(c=null==b?void 0:b.isGemmaModel)&&c;for(let{role:b,content:c}of a)switch(b){case"system":if(!f)throw new aV({functionality:"system messages are only supported at the beginning of the conversation"});d.push({text:c});break;case"user":{f=!1;let a=[];for(let b of c)switch(b.type){case"text":a.push({text:b.text});break;case"file":{let c="image/*"===b.mediaType?"image/jpeg":b.mediaType;a.push(b.data instanceof URL?{fileData:{mimeType:c,fileUri:b.data.toString()}}:{inlineData:{mimeType:c,data:bk(b.data)}})}}e.push({role:"user",parts:a});break}case"assistant":f=!1,e.push({role:"model",parts:c.map(a=>{var b,c,d,e,f,g;switch(a.type){case"text":return 0===a.text.length?void 0:{text:a.text,thoughtSignature:null==(c=null==(b=a.providerOptions)?void 0:b.google)?void 0:c.thoughtSignature};case"reasoning":return 0===a.text.length?void 0:{text:a.text,thought:!0,thoughtSignature:null==(e=null==(d=a.providerOptions)?void 0:d.google)?void 0:e.thoughtSignature};case"file":if("image/png"!==a.mediaType)throw new aV({functionality:"Only PNG images are supported in assistant messages"});if(a.data instanceof URL)throw new aV({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:a.mediaType,data:bk(a.data)}};case"tool-call":return{functionCall:{name:a.toolName,args:a.input},thoughtSignature:null==(g=null==(f=a.providerOptions)?void 0:f.google)?void 0:g.thoughtSignature}}}).filter(a=>void 0!==a)});break;case"tool":f=!1,e.push({role:"user",parts:c.map(a=>({functionResponse:{name:a.toolName,response:{name:a.toolName,content:a.output.value}}}))})}if(g&&d.length>0&&e.length>0&&"user"===e[0].role){let a=d.map(a=>a.text).join("\n\n");e[0].parts.unshift({text:a+"\n\n"})}return{systemInstruction:d.length>0&&!g?{parts:d}:void 0,contents:e}}(a,{isGemmaModel:r}),{tools:u,toolConfig:v,toolWarnings:w}=function({tools:a,toolChoice:b,modelId:c}){var d;a=(null==a?void 0:a.length)?a:void 0;let e=[],f=c.includes("gemini-2"),g=c.includes("gemini-1.5-flash")&&!c.includes("-8b");if(null==a)return{tools:void 0,toolConfig:void 0,toolWarnings:e};let h=a.some(a=>"function"===a.type),i=a.some(a=>"provider-defined"===a.type);if(h&&i&&e.push({type:"unsupported-tool",tool:a.find(a=>"function"===a.type),details:"Cannot mix function tools with provider-defined tools in the same request. Please use either function tools or provider-defined tools, but not both."}),i){let b={};return a.filter(a=>"provider-defined"===a.type).forEach(a=>{switch(a.id){case"google.google_search":f?b.googleSearch={}:g?b.googleSearchRetrieval={dynamicRetrievalConfig:{mode:a.args.mode,dynamicThreshold:a.args.dynamicThreshold}}:b.googleSearchRetrieval={};break;case"google.url_context":f?b.urlContext={}:e.push({type:"unsupported-tool",tool:a,details:"The URL context tool is not supported with other Gemini models than Gemini 2."});break;case"google.code_execution":f?b.codeExecution={}:e.push({type:"unsupported-tool",tool:a,details:"The code execution tools is not supported with other Gemini models than Gemini 2."});break;default:e.push({type:"unsupported-tool",tool:a})}}),{tools:Object.keys(b).length>0?b:void 0,toolConfig:void 0,toolWarnings:e}}let j=[];for(let b of a)"function"===b.type?j.push({name:b.name,description:null!=(d=b.description)?d:"",parameters:br(b.inputSchema)}):e.push({type:"unsupported-tool",tool:b});if(null==b)return{tools:{functionDeclarations:j},toolConfig:void 0,toolWarnings:e};let k=b.type;switch(k){case"auto":return{tools:{functionDeclarations:j},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:e};case"none":return{tools:{functionDeclarations:j},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:e};case"required":return{tools:{functionDeclarations:j},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:e};case"tool":return{tools:{functionDeclarations:j},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[b.toolName]}},toolWarnings:e};default:throw new aV({functionality:`tool choice type: ${k}`})}}({tools:k,toolChoice:l,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:b,temperature:c,topK:e,topP:d,frequencyPenalty:f,presencePenalty:g,stopSequences:h,seed:j,responseMimeType:(null==i?void 0:i.type)==="json"?"application/json":void 0,responseSchema:(null==i?void 0:i.type)==="json"&&null!=i.schema&&(null==(o=null==q?void 0:q.structuredOutputs)||o)?br(i.schema):void 0,...(null==q?void 0:q.audioTimestamp)&&{audioTimestamp:q.audioTimestamp},responseModalities:null==q?void 0:q.responseModalities,thinkingConfig:null==q?void 0:q.thinkingConfig},contents:s,systemInstruction:r?void 0:t,safetySettings:null==q?void 0:q.safetySettings,tools:u,toolConfig:v,cachedContent:null==q?void 0:q.cachedContent,labels:null==q?void 0:q.labels},warnings:[...p,...w]}}async doGenerate(a){var b,c,d,e,f,g,h,i,j,k,l,m;let n,{args:o,warnings:p}=await this.getArgs(a),q=JSON.stringify(o),r=aZ(await bf(this.config.headers),a.headers),{responseHeaders:s,value:t,rawValue:u}=await bc({url:`${this.config.baseURL}/${bs(this.modelId)}:generateContent`,headers:r,body:o,failedResponseHandler:bm,successfulResponseHandler:bg(bG),abortSignal:a.abortSignal,fetch:this.config.fetch}),v=t.candidates[0],w=[],x=null!=(c=null==(b=v.content)?void 0:b.parts)?c:[],y=t.usageMetadata;for(let a of x)if("executableCode"in a&&(null==(d=a.executableCode)?void 0:d.code)){let b=this.config.generateId();n=b,w.push({type:"tool-call",toolCallId:b,toolName:"code_execution",input:JSON.stringify(a.executableCode),providerExecuted:!0})}else"codeExecutionResult"in a&&a.codeExecutionResult?(w.push({type:"tool-result",toolCallId:n,toolName:"code_execution",result:{outcome:a.codeExecutionResult.outcome,output:a.codeExecutionResult.output},providerExecuted:!0}),n=void 0):"text"in a&&null!=a.text&&a.text.length>0?w.push({type:!0===a.thought?"reasoning":"text",text:a.text,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0}):"functionCall"in a?w.push({type:"tool-call",toolCallId:this.config.generateId(),toolName:a.functionCall.name,input:JSON.stringify(a.functionCall.args),providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0}):"inlineData"in a&&w.push({type:"file",data:a.inlineData.data,mediaType:a.inlineData.mimeType});for(let a of null!=(e=bC({groundingMetadata:v.groundingMetadata,generateId:this.config.generateId}))?e:[])w.push(a);return{content:w,finishReason:bu({finishReason:v.finishReason,hasToolCalls:w.some(a=>"tool-call"===a.type)}),usage:{inputTokens:null!=(f=null==y?void 0:y.promptTokenCount)?f:void 0,outputTokens:null!=(g=null==y?void 0:y.candidatesTokenCount)?g:void 0,totalTokens:null!=(h=null==y?void 0:y.totalTokenCount)?h:void 0,reasoningTokens:null!=(i=null==y?void 0:y.thoughtsTokenCount)?i:void 0,cachedInputTokens:null!=(j=null==y?void 0:y.cachedContentTokenCount)?j:void 0},warnings:p,providerMetadata:{google:{groundingMetadata:null!=(k=v.groundingMetadata)?k:null,urlContextMetadata:null!=(l=v.urlContextMetadata)?l:null,safetyRatings:null!=(m=v.safetyRatings)?m:null,usageMetadata:null!=y?y:null}},request:{body:q},response:{headers:s,body:u}}}async doStream(a){let b,c,{args:d,warnings:e}=await this.getArgs(a),f=JSON.stringify(d),g=aZ(await bf(this.config.headers),a.headers),{responseHeaders:h,value:i}=await bc({url:`${this.config.baseURL}/${bs(this.modelId)}:streamGenerateContent?alt=sse`,headers:g,body:d,failedResponseHandler:bm,successfulResponseHandler:async({response:a})=>{let b=a$(a);if(null==a.body)throw new ao({});return{responseHeaders:b,value:function({stream:a,schema:b}){return a.pipeThrough(new TextDecoderStream).pipeThrough(new aY).pipeThrough(new TransformStream({async transform({data:a},c){"[DONE]"!==a&&c.enqueue(await a9({text:a,schema:b}))}}))}({stream:a.body,schema:bH})}},abortSignal:a.abortSignal,fetch:this.config.fetch}),j="unknown",k={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=this.config.generateId,m=!1,n=null,o=null,p=0,q=new Set;return{stream:i.pipeThrough(new TransformStream({start(a){a.enqueue({type:"stream-start",warnings:e})},transform(d,e){var f,g,h,i,r,s,t,u,v,w,x,y;if(a.includeRawChunks&&e.enqueue({type:"raw",rawValue:d.rawValue}),!d.success)return void e.enqueue({type:"error",error:d.error});let z=d.value,A=z.usageMetadata;null!=A&&(k.inputTokens=null!=(f=A.promptTokenCount)?f:void 0,k.outputTokens=null!=(g=A.candidatesTokenCount)?g:void 0,k.totalTokens=null!=(h=A.totalTokenCount)?h:void 0,k.reasoningTokens=null!=(i=A.thoughtsTokenCount)?i:void 0,k.cachedInputTokens=null!=(r=A.cachedContentTokenCount)?r:void 0);let B=null==(s=z.candidates)?void 0:s[0];if(null==B)return;let C=B.content,D=bC({groundingMetadata:B.groundingMetadata,generateId:l});if(null!=D)for(let a of D)"url"!==a.sourceType||q.has(a.url)||(q.add(a.url),e.enqueue(a));if(null!=C){for(let a of null!=(t=C.parts)?t:[])if("executableCode"in a&&(null==(u=a.executableCode)?void 0:u.code)){let c=l();b=c,e.enqueue({type:"tool-call",toolCallId:c,toolName:"code_execution",input:JSON.stringify(a.executableCode),providerExecuted:!0}),m=!0}else if("codeExecutionResult"in a&&a.codeExecutionResult){let c=b;c&&(e.enqueue({type:"tool-result",toolCallId:c,toolName:"code_execution",result:{outcome:a.codeExecutionResult.outcome,output:a.codeExecutionResult.output},providerExecuted:!0}),b=void 0)}else"text"in a&&null!=a.text&&a.text.length>0&&(!0===a.thought?(null!==n&&(e.enqueue({type:"text-end",id:n}),n=null),null===o&&(o=String(p++),e.enqueue({type:"reasoning-start",id:o,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})),e.enqueue({type:"reasoning-delta",id:o,delta:a.text,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})):(null!==o&&(e.enqueue({type:"reasoning-end",id:o}),o=null),null===n&&(n=String(p++),e.enqueue({type:"text-start",id:n,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})),e.enqueue({type:"text-delta",id:n,delta:a.text,providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0})));let a=null==(y=C.parts)?void 0:y.filter(a=>"inlineData"in a);if(null!=a)for(let b of a)e.enqueue({type:"file",mediaType:b.inlineData.mimeType,data:b.inlineData.data});let c=function({parts:a,generateId:b}){let c=null==a?void 0:a.filter(a=>"functionCall"in a);return null==c||0===c.length?void 0:c.map(a=>({type:"tool-call",toolCallId:b(),toolName:a.functionCall.name,args:JSON.stringify(a.functionCall.args),providerMetadata:a.thoughtSignature?{google:{thoughtSignature:a.thoughtSignature}}:void 0}))}({parts:C.parts,generateId:l});if(null!=c)for(let a of c)e.enqueue({type:"tool-input-start",id:a.toolCallId,toolName:a.toolName,providerMetadata:a.providerMetadata}),e.enqueue({type:"tool-input-delta",id:a.toolCallId,delta:a.args,providerMetadata:a.providerMetadata}),e.enqueue({type:"tool-input-end",id:a.toolCallId,providerMetadata:a.providerMetadata}),e.enqueue({type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.args,providerMetadata:a.providerMetadata}),m=!0}null!=B.finishReason&&(j=bu({finishReason:B.finishReason,hasToolCalls:m}),c={google:{groundingMetadata:null!=(v=B.groundingMetadata)?v:null,urlContextMetadata:null!=(w=B.urlContextMetadata)?w:null,safetyRatings:null!=(x=B.safetyRatings)?x:null}},null!=A&&(c.google.usageMetadata=A))},flush(a){null!==n&&a.enqueue({type:"text-end",id:n}),null!==o&&a.enqueue({type:"reasoning-end",id:o}),a.enqueue({type:"finish",finishReason:j,usage:k,providerMetadata:c})}})),response:{headers:h},request:{body:f}}}};function bC({groundingMetadata:a,generateId:b}){var c;return null==(c=null==a?void 0:a.groundingChunks)?void 0:c.filter(a=>null!=a.web).map(a=>({type:"source",sourceType:"url",id:b(),url:a.web.uri,title:a.web.title}))}var bD=bl.Ik({parts:bl.YO(bl.KC([bl.Ik({functionCall:bl.Ik({name:bl.Yj(),args:bl.L5()}),thoughtSignature:bl.Yj().nullish()}),bl.Ik({inlineData:bl.Ik({mimeType:bl.Yj(),data:bl.Yj()})}),bl.Ik({executableCode:bl.Ik({language:bl.Yj(),code:bl.Yj()}).nullish(),codeExecutionResult:bl.Ik({outcome:bl.Yj(),output:bl.Yj()}).nullish(),text:bl.Yj().nullish(),thought:bl.zM().nullish(),thoughtSignature:bl.Yj().nullish()})])).nullish()}),bE=bl.Ik({category:bl.Yj().nullish(),probability:bl.Yj().nullish(),probabilityScore:bl.ai().nullish(),severity:bl.Yj().nullish(),severityScore:bl.ai().nullish(),blocked:bl.zM().nullish()}),bF=bl.Ik({cachedContentTokenCount:bl.ai().nullish(),thoughtsTokenCount:bl.ai().nullish(),promptTokenCount:bl.ai().nullish(),candidatesTokenCount:bl.ai().nullish(),totalTokenCount:bl.ai().nullish()}),bG=bl.Ik({candidates:bl.YO(bl.Ik({content:bD.nullish().or(bl.Ik({}).strict()),finishReason:bl.Yj().nullish(),safetyRatings:bl.YO(bE).nullish(),groundingMetadata:bw.nullish(),urlContextMetadata:bz.nullish()})),usageMetadata:bF.nullish()}),bH=bl.Ik({candidates:bl.YO(bl.Ik({content:bD.nullish(),finishReason:bl.Yj().nullish(),safetyRatings:bl.YO(bE).nullish(),groundingMetadata:bw.nullish(),urlContextMetadata:bz.nullish()})).nullish(),usageMetadata:bF.nullish()}),bI={googleSearch:bx,urlContext:bA,codeExecution:function({id:a,name:b,inputSchema:c,outputSchema:d}){return({execute:e,toModelOutput:f,onInputStart:g,onInputDelta:h,onInputAvailable:i,...j})=>({type:"provider-defined",id:a,name:b,args:j,inputSchema:c,outputSchema:d,execute:e,toModelOutput:f,onInputStart:g,onInputDelta:h,onInputAvailable:i})}({id:"google.code_execution",name:"code_execution",inputSchema:bl.Ik({language:bl.Yj().describe("The programming language of the code."),code:bl.Yj().describe("The code to be executed.")}),outputSchema:bl.Ik({outcome:bl.Yj().describe('The outcome of the execution (e.g., "OUTCOME_OK").'),output:bl.Yj().describe("The output from the code execution.")})})},bJ=class{constructor(a,b,c){this.modelId=a,this.settings=b,this.config=c,this.specificationVersion="v2"}get maxImagesPerCall(){var a;return null!=(a=this.settings.maxImagesPerCall)?a:4}get provider(){return this.config.provider}async doGenerate(a){var b,c,d;let{prompt:e,n:f=1,size:g="1024x1024",aspectRatio:h="1:1",seed:i,providerOptions:j,headers:k,abortSignal:l}=a,m=[];null!=g&&m.push({type:"unsupported-setting",setting:"size",details:"This model does not support the `size` option. Use `aspectRatio` instead."}),null!=i&&m.push({type:"unsupported-setting",setting:"seed",details:"This model does not support the `seed` option through this provider."});let n=await ba({provider:"google",providerOptions:j,schema:bL}),o=null!=(d=null==(c=null==(b=this.config._internal)?void 0:b.currentDate)?void 0:c.call(b))?d:new Date,p={sampleCount:f};null!=h&&(p.aspectRatio=h),n&&Object.assign(p,n);let{responseHeaders:q,value:r}=await bc({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:aZ(await bf(this.config.headers),k),body:{instances:[{prompt:e}],parameters:p},failedResponseHandler:bm,successfulResponseHandler:bg(bK),abortSignal:l,fetch:this.config.fetch});return{images:r.predictions.map(a=>a.bytesBase64Encoded),warnings:null!=m?m:[],providerMetadata:{google:{images:r.predictions.map(a=>({}))}},response:{timestamp:o,modelId:this.modelId,headers:q}}}},bK=bl.Ik({predictions:bl.YO(bl.Ik({bytesBase64Encoded:bl.Yj()})).default([])}),bL=bl.Ik({personGeneration:bl.k5(["dont_allow","allow_adult","allow_all"]).nullish(),aspectRatio:bl.k5(["1:1","3:4","4:3","9:16","16:9"]).nullish()}),bM=function(a={}){var b,c;let d=null!=(b=null==(c=a.baseURL)?void 0:c.replace(/\/$/,""))?b:"https://generativelanguage.googleapis.com/v1beta",e=()=>({"x-goog-api-key":function({apiKey:a,environmentVariableName:b,apiKeyParameterName:c="apiKey",description:d}){if("string"==typeof a)return a;if(null!=a)throw new aF({message:`${d} API key must be a string.`});if("undefined"==typeof process)throw new aF({message:`${d} API key is missing. Pass it using the '${c}' parameter. Environment variables is not supported in this environment.`});if(null==(a=process.env[b]))throw new aF({message:`${d} API key is missing. Pass it using the '${c}' parameter or the ${b} environment variable.`});if("string"!=typeof a)throw new aF({message:`${d} API key must be a string. The value of the ${b} environment variable is not a string.`});return a}({apiKey:a.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...a.headers}),f=b=>{var c;return new bB(b,{provider:"google.generative-ai",baseURL:d,headers:e,generateId:null!=(c=a.generateId)?c:a_,supportedUrls:()=>({"*":[RegExp(`^${d}/files/.*$`),RegExp("^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$"),RegExp("^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$")]}),fetch:a.fetch})},g=b=>new bo(b,{provider:"google.generative-ai",baseURL:d,headers:e,fetch:a.fetch}),h=(b,c={})=>new bJ(b,c,{provider:"google.generative-ai",baseURL:d,headers:e,fetch:a.fetch}),i=function(a){if(new.target)throw Error("The Google Generative AI model function cannot be called with the new keyword.");return f(a)};return i.languageModel=f,i.chat=f,i.generativeAI=f,i.embedding=g,i.textEmbedding=g,i.textEmbeddingModel=g,i.image=h,i.imageModel=h,i.tools=bI,i}(),bN=c(63345),bO=c(58054);class bP{constructor(a){this.counter=0,this.metadataRegistry=a?.metadata??bN.fd,this.target=a?.target??"draft-2020-12",this.unrepresentable=a?.unrepresentable??"throw",this.override=a?.override??(()=>{}),this.io=a?.io??"output",this.seen=new Map}process(a,b={path:[],schemaPath:[]}){var c;let d=a._zod.def,e=this.seen.get(a);if(e)return e.count++,b.schemaPath.includes(a)&&(e.cycle=b.path),e.schema;let f={schema:{},count:1,cycle:void 0,path:b.path};this.seen.set(a,f);let g=a._zod.toJSONSchema?.();if(g)f.schema=g;else{let c={...b,schemaPath:[...b.schemaPath,a],path:b.path},e=a._zod.parent;if(e)f.ref=e,this.process(e,c),this.seen.get(e).isParent=!0;else{let b=f.schema;switch(d.type){case"string":{b.type="string";let{minimum:c,maximum:d,format:e,patterns:g,contentEncoding:h}=a._zod.bag;if("number"==typeof c&&(b.minLength=c),"number"==typeof d&&(b.maxLength=d),e&&(b.format=({guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""})[e]??e,""===b.format&&delete b.format),h&&(b.contentEncoding=h),g&&g.size>0){let a=[...g];1===a.length?b.pattern=a[0].source:a.length>1&&(f.schema.allOf=[...a.map(a=>({..."draft-7"===this.target||"draft-4"===this.target?{type:"string"}:{},pattern:a.source}))])}break}case"number":{let{minimum:c,maximum:d,format:e,multipleOf:f,exclusiveMaximum:g,exclusiveMinimum:h}=a._zod.bag;"string"==typeof e&&e.includes("int")?b.type="integer":b.type="number","number"==typeof h&&("draft-4"===this.target?(b.minimum=h,b.exclusiveMinimum=!0):b.exclusiveMinimum=h),"number"==typeof c&&(b.minimum=c,"number"==typeof h&&"draft-4"!==this.target&&(h>=c?delete b.minimum:delete b.exclusiveMinimum)),"number"==typeof g&&("draft-4"===this.target?(b.maximum=g,b.exclusiveMaximum=!0):b.exclusiveMaximum=g),"number"==typeof d&&(b.maximum=d,"number"==typeof g&&"draft-4"!==this.target&&(g<=d?delete b.maximum:delete b.exclusiveMaximum)),"number"==typeof f&&(b.multipleOf=f);break}case"boolean":case"success":b.type="boolean";break;case"bigint":if("throw"===this.unrepresentable)throw Error("BigInt cannot be represented in JSON Schema");break;case"symbol":if("throw"===this.unrepresentable)throw Error("Symbols cannot be represented in JSON Schema");break;case"null":b.type="null";break;case"any":case"unknown":break;case"undefined":if("throw"===this.unrepresentable)throw Error("Undefined cannot be represented in JSON Schema");break;case"void":if("throw"===this.unrepresentable)throw Error("Void cannot be represented in JSON Schema");break;case"never":b.not={};break;case"date":if("throw"===this.unrepresentable)throw Error("Date cannot be represented in JSON Schema");break;case"array":{let{minimum:e,maximum:f}=a._zod.bag;"number"==typeof e&&(b.minItems=e),"number"==typeof f&&(b.maxItems=f),b.type="array",b.items=this.process(d.element,{...c,path:[...c.path,"items"]});break}case"object":{b.type="object",b.properties={};let a=d.shape;for(let d in a)b.properties[d]=this.process(a[d],{...c,path:[...c.path,"properties",d]});let e=new Set([...new Set(Object.keys(a))].filter(a=>{let b=d.shape[a]._zod;return"input"===this.io?void 0===b.optin:void 0===b.optout}));e.size>0&&(b.required=Array.from(e)),d.catchall?._zod.def.type==="never"?b.additionalProperties=!1:d.catchall?d.catchall&&(b.additionalProperties=this.process(d.catchall,{...c,path:[...c.path,"additionalProperties"]})):"output"===this.io&&(b.additionalProperties=!1);break}case"union":b.anyOf=d.options.map((a,b)=>this.process(a,{...c,path:[...c.path,"anyOf",b]}));break;case"intersection":{let a=this.process(d.left,{...c,path:[...c.path,"allOf",0]}),e=this.process(d.right,{...c,path:[...c.path,"allOf",1]}),f=a=>"allOf"in a&&1===Object.keys(a).length;b.allOf=[...f(a)?a.allOf:[a],...f(e)?e.allOf:[e]];break}case"tuple":{b.type="array";let e=d.items.map((a,b)=>this.process(a,{...c,path:[...c.path,"prefixItems",b]}));if("draft-2020-12"===this.target?b.prefixItems=e:b.items=e,d.rest){let a=this.process(d.rest,{...c,path:[...c.path,"items"]});"draft-2020-12"===this.target?b.items=a:b.additionalItems=a}d.rest&&(b.items=this.process(d.rest,{...c,path:[...c.path,"items"]}));let{minimum:f,maximum:g}=a._zod.bag;"number"==typeof f&&(b.minItems=f),"number"==typeof g&&(b.maxItems=g);break}case"record":b.type="object","draft-4"!==this.target&&(b.propertyNames=this.process(d.keyType,{...c,path:[...c.path,"propertyNames"]})),b.additionalProperties=this.process(d.valueType,{...c,path:[...c.path,"additionalProperties"]});break;case"map":if("throw"===this.unrepresentable)throw Error("Map cannot be represented in JSON Schema");break;case"set":if("throw"===this.unrepresentable)throw Error("Set cannot be represented in JSON Schema");break;case"enum":{let a=(0,bO.w5)(d.entries);a.every(a=>"number"==typeof a)&&(b.type="number"),a.every(a=>"string"==typeof a)&&(b.type="string"),b.enum=a;break}case"literal":{let a=[];for(let b of d.values)if(void 0===b){if("throw"===this.unrepresentable)throw Error("Literal `undefined` cannot be represented in JSON Schema")}else if("bigint"==typeof b)if("throw"===this.unrepresentable)throw Error("BigInt literals cannot be represented in JSON Schema");else a.push(Number(b));else a.push(b);if(0===a.length);else if(1===a.length){let c=a[0];b.type=null===c?"null":typeof c,"draft-4"===this.target?b.enum=[c]:b.const=c}else a.every(a=>"number"==typeof a)&&(b.type="number"),a.every(a=>"string"==typeof a)&&(b.type="string"),a.every(a=>"boolean"==typeof a)&&(b.type="string"),a.every(a=>null===a)&&(b.type="null"),b.enum=a;break}case"file":{let c={type:"string",format:"binary",contentEncoding:"binary"},{minimum:d,maximum:e,mime:f}=a._zod.bag;void 0!==d&&(c.minLength=d),void 0!==e&&(c.maxLength=e),f?1===f.length?(c.contentMediaType=f[0],Object.assign(b,c)):b.anyOf=f.map(a=>({...c,contentMediaType:a})):Object.assign(b,c);break}case"transform":if("throw"===this.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema");break;case"nullable":b.anyOf=[this.process(d.innerType,c),{type:"null"}];break;case"nonoptional":case"promise":case"optional":this.process(d.innerType,c),f.ref=d.innerType;break;case"default":this.process(d.innerType,c),f.ref=d.innerType,b.default=JSON.parse(JSON.stringify(d.defaultValue));break;case"prefault":this.process(d.innerType,c),f.ref=d.innerType,"input"===this.io&&(b._prefault=JSON.parse(JSON.stringify(d.defaultValue)));break;case"catch":{let a;this.process(d.innerType,c),f.ref=d.innerType;try{a=d.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}b.default=a;break}case"nan":if("throw"===this.unrepresentable)throw Error("NaN cannot be represented in JSON Schema");break;case"template_literal":{let c=a._zod.pattern;if(!c)throw Error("Pattern not found in template literal");b.type="string",b.pattern=c.source;break}case"pipe":{let a="input"===this.io?"transform"===d.in._zod.def.type?d.out:d.in:d.out;this.process(a,c),f.ref=a;break}case"readonly":this.process(d.innerType,c),f.ref=d.innerType,b.readOnly=!0;break;case"lazy":{let b=a._zod.innerType;this.process(b,c),f.ref=b;break}case"custom":if("throw"===this.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")}}}let h=this.metadataRegistry.get(a);return h&&Object.assign(f.schema,h),"input"===this.io&&function a(b,c){let d=c??{seen:new Set};if(d.seen.has(b))return!1;d.seen.add(b);let e=b._zod.def;switch(e.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":case"custom":case"success":case"catch":return!1;case"array":return a(e.element,d);case"object":for(let b in e.shape)if(a(e.shape[b],d))return!0;return!1;case"union":for(let b of e.options)if(a(b,d))return!0;return!1;case"intersection":return a(e.left,d)||a(e.right,d);case"tuple":for(let b of e.items)if(a(b,d))return!0;if(e.rest&&a(e.rest,d))return!0;return!1;case"record":case"map":return a(e.keyType,d)||a(e.valueType,d);case"set":return a(e.valueType,d);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":case"default":case"prefault":return a(e.innerType,d);case"lazy":return a(e.getter(),d);case"transform":return!0;case"pipe":return a(e.in,d)||a(e.out,d)}throw Error(`Unknown schema type: ${e.type}`)}(a)&&(delete f.schema.examples,delete f.schema.default),"input"===this.io&&f.schema._prefault&&((c=f.schema).default??(c.default=f.schema._prefault)),delete f.schema._prefault,this.seen.get(a).schema}emit(a,b){let c={cycles:b?.cycles??"ref",reused:b?.reused??"inline",external:b?.external??void 0},d=this.seen.get(a);if(!d)throw Error("Unprocessed schema. This is a bug in Zod.");let e=a=>{let b="draft-2020-12"===this.target?"$defs":"definitions";if(c.external){let d=c.external.registry.get(a[0])?.id,e=c.external.uri??(a=>a);if(d)return{ref:e(d)};let f=a[1].defId??a[1].schema.id??`schema${this.counter++}`;return a[1].defId=f,{defId:f,ref:`${e("__shared")}#/${b}/${f}`}}if(a[1]===d)return{ref:"#"};let e=`#/${b}/`,f=a[1].schema.id??`__schema${this.counter++}`;return{defId:f,ref:e+f}},f=a=>{if(a[1].schema.$ref)return;let b=a[1],{ref:c,defId:d}=e(a);b.def={...b.schema},d&&(b.defId=d);let f=b.schema;for(let a in f)delete f[a];f.$ref=c};if("throw"===c.cycles)for(let a of this.seen.entries()){let b=a[1];if(b.cycle)throw Error(`Cycle detected: #/${b.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let b of this.seen.entries()){let d=b[1];if(a===b[0]){f(b);continue}if(c.external){let d=c.external.registry.get(b[0])?.id;if(a!==b[0]&&d){f(b);continue}}if(this.metadataRegistry.get(b[0])?.id||d.cycle||d.count>1&&"ref"===c.reused){f(b);continue}}let g=(a,b)=>{let c=this.seen.get(a),d=c.def??c.schema,e={...d};if(null===c.ref)return;let f=c.ref;if(c.ref=null,f){g(f,b);let a=this.seen.get(f).schema;a.$ref&&("draft-7"===b.target||"draft-4"===b.target)?(d.allOf=d.allOf??[],d.allOf.push(a)):(Object.assign(d,a),Object.assign(d,e))}c.isParent||this.override({zodSchema:a,jsonSchema:d,path:c.path??[]})};for(let a of[...this.seen.entries()].reverse())g(a[0],{target:this.target});let h={};if("draft-2020-12"===this.target?h.$schema="https://json-schema.org/draft/2020-12/schema":"draft-7"===this.target?h.$schema="http://json-schema.org/draft-07/schema#":"draft-4"===this.target?h.$schema="http://json-schema.org/draft-04/schema#":console.warn(`Invalid target: ${this.target}`),c.external?.uri){let b=c.external.registry.get(a)?.id;if(!b)throw Error("Schema is missing an `id` property");h.$id=c.external.uri(b)}Object.assign(h,d.def);let i=c.external?.defs??{};for(let a of this.seen.entries()){let b=a[1];b.def&&b.defId&&(i[b.defId]=b.def)}c.external||Object.keys(i).length>0&&("draft-2020-12"===this.target?h.$defs=i:h.definitions=i);try{return JSON.parse(JSON.stringify(h))}catch(a){throw Error("Error converting schema to JSON.")}}}var bQ=c(4806);let bR=Symbol("Let zodToJsonSchema decide on which parser to use"),bS={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"};p||(p={});let bT=(a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")};function bU(a){if("openAi"!==a.target)return{};let b=[...a.basePath,a.definitionPath,a.openAiAnyTypeName];return a.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===a.$refStrategy?bT(b,a.currentPath):b.join("/")}}function bV(a,b,c,d){d?.errorMessages&&c&&(a.errorMessage={...a.errorMessage,[b]:c})}function bW(a,b,c,d,e){a[b]=c,bV(a,b,d,e)}function bX(a,b){return b6(a.type._def,b)}let bY={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===d&&(d=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),d),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function bZ(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":bW(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b);break;case"max":bW(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"email":switch(b.emailStrategy){case"format:email":b0(c,"email",d.message,b);break;case"format:idn-email":b0(c,"idn-email",d.message,b);break;case"pattern:zod":b1(c,bY.email,d.message,b)}break;case"url":b0(c,"uri",d.message,b);break;case"uuid":b0(c,"uuid",d.message,b);break;case"regex":b1(c,d.regex,d.message,b);break;case"cuid":b1(c,bY.cuid,d.message,b);break;case"cuid2":b1(c,bY.cuid2,d.message,b);break;case"startsWith":b1(c,RegExp(`^${b$(d.value,b)}`),d.message,b);break;case"endsWith":b1(c,RegExp(`${b$(d.value,b)}$`),d.message,b);break;case"datetime":b0(c,"date-time",d.message,b);break;case"date":b0(c,"date",d.message,b);break;case"time":b0(c,"time",d.message,b);break;case"duration":b0(c,"duration",d.message,b);break;case"length":bW(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b),bW(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"includes":b1(c,RegExp(b$(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&b0(c,"ipv4",d.message,b),"v4"!==d.version&&b0(c,"ipv6",d.message,b);break;case"base64url":b1(c,bY.base64url,d.message,b);break;case"jwt":b1(c,bY.jwt,d.message,b);break;case"cidr":"v6"!==d.version&&b1(c,bY.ipv4Cidr,d.message,b),"v4"!==d.version&&b1(c,bY.ipv6Cidr,d.message,b);break;case"emoji":b1(c,bY.emoji(),d.message,b);break;case"ulid":b1(c,bY.ulid,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":b0(c,"binary",d.message,b);break;case"contentEncoding:base64":bW(c,"contentEncoding","base64",d.message,b);break;case"pattern:zod":b1(c,bY.base64,d.message,b)}break;case"nanoid":b1(c,bY.nanoid,d.message,b)}return c}function b$(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)b_.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}let b_=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function b0(a,b,c,d){a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&d.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):bW(a,"format",b,c,d)}function b1(a,b,c,d){a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&d.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:b2(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):bW(a,"pattern",b2(b,d),c,d)}function b2(a,b){if(!b.applyRegexFlags||!a.flags)return a.source;let c={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},d=c.i?a.source.toLowerCase():a.source,e="",f=!1,g=!1,h=!1;for(let a=0;a<d.length;a++){if(f){e+=d[a],f=!1;continue}if(c.i){if(g){if(d[a].match(/[a-z]/)){h?(e+=d[a],e+=`${d[a-2]}-${d[a]}`.toUpperCase(),h=!1):"-"===d[a+1]&&d[a+2]?.match(/[a-z]/)?(e+=d[a],h=!0):e+=`${d[a]}${d[a].toUpperCase()}`;continue}}else if(d[a].match(/[a-z]/)){e+=`[${d[a]}${d[a].toUpperCase()}]`;continue}}if(c.m){if("^"===d[a]){e+=`(^|(?<=[\r
]))`;continue}else if("$"===d[a]){e+=`($|(?=[\r
]))`;continue}}if(c.s&&"."===d[a]){e+=g?`${d[a]}\r
`:`[${d[a]}\r
]`;continue}e+=d[a],"\\"===d[a]?f=!0:g&&"]"===d[a]?g=!1:g||"["!==d[a]||(g=!0)}try{new RegExp(e)}catch{return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return e}function b3(a,b){if("openAi"===b.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===b.target&&a.keyType?._def.typeName===p.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((c,d)=>({...c,[d]:b6(a.valueType._def,{...b,currentPath:[...b.currentPath,"properties",d]})??bU(b)}),{}),additionalProperties:b.rejectedAdditionalProperties};let c={type:"object",additionalProperties:b6(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]})??b.allowedAdditionalProperties};if("openApi3"===b.target)return c;if(a.keyType?._def.typeName===p.ZodString&&a.keyType._def.checks?.length){let{type:d,...e}=bZ(a.keyType._def,b);return{...c,propertyNames:e}}if(a.keyType?._def.typeName===p.ZodEnum)return{...c,propertyNames:{enum:a.keyType._def.values}};if(a.keyType?._def.typeName===p.ZodBranded&&a.keyType._def.type._def.typeName===p.ZodString&&a.keyType._def.type._def.checks?.length){let{type:d,...e}=bX(a.keyType._def,b);return{...c,propertyNames:e}}return c}let b4={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},b5=(a,b)=>{let c=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,c)=>b6(a._def,{...b,currentPath:[...b.currentPath,"anyOf",`${c}`]})).filter(a=>!!a&&(!b.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return c.length?{anyOf:c}:void 0};function b6(a,b,c=!1){let d=b.seen.get(a);if(b.override){let e=b.override?.(a,b,d,c);if(e!==bR)return e}if(d&&!c){let a=b7(d,b);if(void 0!==a)return a}let e={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,e);let f=((a,b,c)=>{switch(b){case p.ZodString:return bZ(a,c);case p.ZodNumber:var d,e,f,g,h,i,j,k,l,m=a,n=c;let o={type:"number"};if(!m.checks)return o;for(let a of m.checks)switch(a.kind){case"int":o.type="integer",bV(o,"type",a.message,n);break;case"min":"jsonSchema7"===n.target?a.inclusive?bW(o,"minimum",a.value,a.message,n):bW(o,"exclusiveMinimum",a.value,a.message,n):(a.inclusive||(o.exclusiveMinimum=!0),bW(o,"minimum",a.value,a.message,n));break;case"max":"jsonSchema7"===n.target?a.inclusive?bW(o,"maximum",a.value,a.message,n):bW(o,"exclusiveMaximum",a.value,a.message,n):(a.inclusive||(o.exclusiveMaximum=!0),bW(o,"maximum",a.value,a.message,n));break;case"multipleOf":bW(o,"multipleOf",a.value,a.message,n)}return o;case p.ZodObject:return function(a,b){let c="openAi"===b.target,d={type:"object",properties:{}},e=[],f=a.shape();for(let a in f){let g=f[a];if(void 0===g||void 0===g._def)continue;let h=function(a){try{return a.isOptional()}catch{return!0}}(g);h&&c&&("ZodOptional"===g._def.typeName&&(g=g._def.innerType),g.isNullable()||(g=g.nullable()),h=!1);let i=b6(g._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==i&&(d.properties[a]=i,h||e.push(a))}e.length&&(d.required=e);let g=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return b6(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==g&&(d.additionalProperties=g),d}(a,c);case p.ZodBigInt:var q=a,r=c;let s={type:"integer",format:"int64"};if(!q.checks)return s;for(let a of q.checks)switch(a.kind){case"min":"jsonSchema7"===r.target?a.inclusive?bW(s,"minimum",a.value,a.message,r):bW(s,"exclusiveMinimum",a.value,a.message,r):(a.inclusive||(s.exclusiveMinimum=!0),bW(s,"minimum",a.value,a.message,r));break;case"max":"jsonSchema7"===r.target?a.inclusive?bW(s,"maximum",a.value,a.message,r):bW(s,"exclusiveMaximum",a.value,a.message,r):(a.inclusive||(s.exclusiveMaximum=!0),bW(s,"maximum",a.value,a.message,r));break;case"multipleOf":bW(s,"multipleOf",a.value,a.message,r)}return s;case p.ZodBoolean:return{type:"boolean"};case p.ZodDate:return function a(b,c,d){let e=d??c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b,g=c;let h={type:"integer",format:"unix-time"};if("openApi3"===g.target)return h;for(let a of f.checks)switch(a.kind){case"min":bW(h,"minimum",a.value,a.message,g);break;case"max":bW(h,"maximum",a.value,a.message,g)}return h}}(a,c);case p.ZodUndefined:return{not:bU(c)};case p.ZodNull:return"openApi3"===c.target?{enum:["null"],nullable:!0}:{type:"null"};case p.ZodArray:var t=a,u=c;let v={type:"array"};return t.type?._def&&t.type?._def?.typeName!==p.ZodAny&&(v.items=b6(t.type._def,{...u,currentPath:[...u.currentPath,"items"]})),t.minLength&&bW(v,"minItems",t.minLength.value,t.minLength.message,u),t.maxLength&&bW(v,"maxItems",t.maxLength.value,t.maxLength.message,u),t.exactLength&&(bW(v,"minItems",t.exactLength.value,t.exactLength.message,u),bW(v,"maxItems",t.exactLength.value,t.exactLength.message,u)),v;case p.ZodUnion:case p.ZodDiscriminatedUnion:var w=a,x=c;if("openApi3"===x.target)return b5(w,x);let y=w.options instanceof Map?Array.from(w.options.values()):w.options;if(y.every(a=>a._def.typeName in b4&&(!a._def.checks||!a._def.checks.length))){let a=y.reduce((a,b)=>{let c=b4[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(y.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=y.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===y.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:y.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(y.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:y.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};return b5(w,x);case p.ZodIntersection:var z=a,A=c;let B=[b6(z.left._def,{...A,currentPath:[...A.currentPath,"allOf","0"]}),b6(z.right._def,{...A,currentPath:[...A.currentPath,"allOf","1"]})].filter(a=>!!a),C="jsonSchema2019-09"===A.target?{unevaluatedProperties:!1}:void 0,D=[];return B.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)D.push(...a.allOf),void 0===a.unevaluatedProperties&&(C=void 0);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}else C=void 0;D.push(b)}}),D.length?{allOf:D,...C}:void 0;case p.ZodTuple:return d=a,e=c,d.rest?{type:"array",minItems:d.items.length,items:d.items.map((a,b)=>b6(a._def,{...e,currentPath:[...e.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:b6(d.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:d.items.length,maxItems:d.items.length,items:d.items.map((a,b)=>b6(a._def,{...e,currentPath:[...e.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case p.ZodRecord:return b3(a,c);case p.ZodLiteral:var E=a,F=c;let G=typeof E.value;return"bigint"!==G&&"number"!==G&&"boolean"!==G&&"string"!==G?{type:Array.isArray(E.value)?"array":"object"}:"openApi3"===F.target?{type:"bigint"===G?"integer":G,enum:[E.value]}:{type:"bigint"===G?"integer":G,const:E.value};case p.ZodEnum:return{type:"string",enum:Array.from(a.values)};case p.ZodNativeEnum:var H=a;let I=H.values,J=Object.keys(H.values).filter(a=>"number"!=typeof I[I[a]]).map(a=>I[a]),K=Array.from(new Set(J.map(a=>typeof a)));return{type:1===K.length?"string"===K[0]?"string":"number":["string","number"],enum:J};case p.ZodNullable:var L=a,M=c;if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(L.innerType._def.typeName)&&(!L.innerType._def.checks||!L.innerType._def.checks.length))return"openApi3"===M.target?{type:b4[L.innerType._def.typeName],nullable:!0}:{type:[b4[L.innerType._def.typeName],"null"]};if("openApi3"===M.target){let a=b6(L.innerType._def,{...M,currentPath:[...M.currentPath]});return a&&"$ref"in a?{allOf:[a],nullable:!0}:a&&{...a,nullable:!0}}let N=b6(L.innerType._def,{...M,currentPath:[...M.currentPath,"anyOf","0"]});return N&&{anyOf:[N,{type:"null"}]};case p.ZodOptional:var O=a,P=c;if(P.currentPath.toString()===P.propertyPath?.toString())return b6(O.innerType._def,P);let Q=b6(O.innerType._def,{...P,currentPath:[...P.currentPath,"anyOf","1"]});return Q?{anyOf:[{not:bU(P)},Q]}:bU(P);case p.ZodMap:return f=a,"record"===(g=c).mapStrategy?b3(f,g):{type:"array",maxItems:125,items:{type:"array",items:[b6(f.keyType._def,{...g,currentPath:[...g.currentPath,"items","items","0"]})||bU(g),b6(f.valueType._def,{...g,currentPath:[...g.currentPath,"items","items","1"]})||bU(g)],minItems:2,maxItems:2}};case p.ZodSet:var R=a,S=c;let T={type:"array",uniqueItems:!0,items:b6(R.valueType._def,{...S,currentPath:[...S.currentPath,"items"]})};return R.minSize&&bW(T,"minItems",R.minSize.value,R.minSize.message,S),R.maxSize&&bW(T,"maxItems",R.maxSize.value,R.maxSize.message,S),T;case p.ZodLazy:return()=>a.getter()._def;case p.ZodPromise:return b6(a.type._def,c);case p.ZodNaN:case p.ZodNever:return"openAi"===(h=c).target?void 0:{not:bU({...h,currentPath:[...h.currentPath,"not"]})};case p.ZodEffects:return i=a,"input"===(j=c).effectStrategy?b6(i.schema._def,j):bU(j);case p.ZodAny:case p.ZodUnknown:return bU(c);case p.ZodDefault:return k=a,l=c,{...b6(k.innerType._def,l),default:k.defaultValue()};case p.ZodBranded:return bX(a,c);case p.ZodReadonly:case p.ZodCatch:return b6(a.innerType._def,c);case p.ZodPipeline:var U=a,V=c;if("input"===V.pipeStrategy)return b6(U.in._def,V);if("output"===V.pipeStrategy)return b6(U.out._def,V);let W=b6(U.in._def,{...V,currentPath:[...V.currentPath,"allOf","0"]}),X=b6(U.out._def,{...V,currentPath:[...V.currentPath,"allOf",W?"1":"0"]});return{allOf:[W,X].filter(a=>void 0!==a)};case p.ZodFunction:case p.ZodVoid:case p.ZodSymbol:default:return}})(a,a.typeName,b),g="function"==typeof f?b6(f(),b):f;if(g&&b8(a,b,g),b.postProcess){let c=b.postProcess(g,a,b);return e.jsonSchema=g,c}return e.jsonSchema=g,g}let b7=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:bT(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),bU(b);return"seen"===b.$refStrategy?bU(b):void 0}},b8=(a,b,c)=>(a.description&&(c.description=a.description,b.markdownDescription&&(c.markdownDescription=a.description)),c);function b9(...a){return a.reduce((a,b)=>({...a,...null!=b?b:{}}),{})}async function ca(a,b){if(null==a)return Promise.resolve();let c=null==b?void 0:b.abortSignal;return new Promise((b,d)=>{if(null==c?void 0:c.aborted)return void d(cb());let e=setTimeout(()=>{f(),b()},a),f=()=>{clearTimeout(e),null==c||c.removeEventListener("abort",g)},g=()=>{f(),d(cb())};null==c||c.addEventListener("abort",g)})}function cb(){return new DOMException("Delay was aborted","AbortError")}function cc(a){return Object.fromEntries([...a.headers])}var cd=({prefix:a,size:b=16,alphabet:c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:d="-"}={})=>{let e=()=>{let a=c.length,d=Array(b);for(let e=0;e<b;e++)d[e]=c[Math.random()*a|0];return d.join("")};if(null==a)return e;if(c.includes(d))throw new at({argument:"separator",message:`The separator "${d}" must not be part of the alphabet "${c}".`});return()=>`${a}${d}${e()}`},ce=cd();function cf(a){return null==a?"unknown error":"string"==typeof a?a:a instanceof Error?a.message:JSON.stringify(a)}function cg(a){return(a instanceof Error||a instanceof DOMException)&&("AbortError"===a.name||"ResponseAborted"===a.name||"TimeoutError"===a.name)}var ch=["fetch failed","failed to fetch"];function ci({error:a,url:b,requestBodyValues:c}){if(cg(a))return a;if(a instanceof TypeError&&ch.includes(a.message.toLowerCase())){let d=a.cause;if(null!=d)return new ak({message:`Cannot connect to API: ${d.message}`,cause:d,url:b,requestBodyValues:c,isRetryable:!0})}return a}function cj(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>null!=b))}var ck=()=>globalThis.fetch,cl=async({url:a,headers:b={},successfulResponseHandler:c,failedResponseHandler:d,abortSignal:e,fetch:f=ck()})=>{try{let g=await f(a,{method:"GET",headers:cj(b),signal:e}),h=cc(g);if(!g.ok){let b;try{b=await d({response:g,url:a,requestBodyValues:{}})}catch(b){if(cg(b)||ak.isInstance(b))throw b;throw new ak({message:"Failed to process error response",cause:b,statusCode:g.status,url:a,responseHeaders:h,requestBodyValues:{}})}throw b.value}try{return await c({response:g,url:a,requestBodyValues:{}})}catch(b){if(b instanceof Error&&(cg(b)||ak.isInstance(b)))throw b;throw new ak({message:"Failed to process successful response",cause:b,statusCode:g.status,url:a,responseHeaders:h,requestBodyValues:{}})}}catch(b){throw ci({error:b,url:a,requestBodyValues:{}})}};function cm({settingValue:a,environmentVariableName:b}){return"string"==typeof a?a:null!=a||"undefined"==typeof process?void 0:null!=(a=process.env[b])&&"string"==typeof a?a:void 0}var cn=/"__proto__"\s*:/,co=/"constructor"\s*:/;function cp(a){let{stackTraceLimit:b}=Error;Error.stackTraceLimit=0;try{let b=JSON.parse(a);return null===b||"object"!=typeof b||!1===cn.test(a)&&!1===co.test(a)?b:function(a){let b=[a];for(;b.length;){let a=b;for(let c of(b=[],a)){if(Object.prototype.hasOwnProperty.call(c,"__proto__")||Object.prototype.hasOwnProperty.call(c,"constructor")&&Object.prototype.hasOwnProperty.call(c.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let a in c){let d=c[a];d&&"object"==typeof d&&b.push(d)}}}return a}(b)}finally{Error.stackTraceLimit=b}}var cq=Symbol.for("vercel.ai.validator");async function cr({value:a,schema:b}){let c=await cs({value:a,schema:b});if(!c.success)throw aR.wrap({value:a,cause:c.error});return c.value}async function cs({value:a,schema:b}){var c;let d="object"==typeof b&&null!==b&&cq in b&&!0===b[cq]&&"validate"in b?b:(c=b,{[cq]:!0,validate:async a=>{let b=await c["~standard"].validate(a);return null==b.issues?{success:!0,value:b.value}:{success:!1,error:new aR({value:a,cause:b.issues})}}});try{if(null==d.validate)return{success:!0,value:a,rawValue:a};let b=await d.validate(a);if(b.success)return{success:!0,value:b.value,rawValue:a};return{success:!1,error:aR.wrap({value:a,cause:b.error}),rawValue:a}}catch(b){return{success:!1,error:aR.wrap({value:a,cause:b}),rawValue:a}}}async function ct({text:a,schema:b}){try{let c=cp(a);if(null==b)return c;return cr({value:c,schema:b})}catch(b){if(aB.isInstance(b)||aR.isInstance(b))throw b;throw new aB({text:a,cause:b})}}async function cu({text:a,schema:b}){try{let c=cp(a);if(null==b)return{success:!0,value:c,rawValue:c};return await cs({value:c,schema:b})}catch(b){return{success:!1,error:aB.isInstance(b)?b:new aB({text:a,cause:b}),rawValue:void 0}}}var cv=()=>globalThis.fetch,cw=async({url:a,headers:b,body:c,failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g})=>cx({url:a,headers:{"Content-Type":"application/json",...b},body:{content:JSON.stringify(c),values:c},failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g}),cx=async({url:a,headers:b={},body:c,successfulResponseHandler:d,failedResponseHandler:e,abortSignal:f,fetch:g=cv()})=>{try{let h=await g(a,{method:"POST",headers:cj(b),body:c.content,signal:f}),i=cc(h);if(!h.ok){let b;try{b=await e({response:h,url:a,requestBodyValues:c.values})}catch(b){if(cg(b)||ak.isInstance(b))throw b;throw new ak({message:"Failed to process error response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}throw b.value}try{return await d({response:h,url:a,requestBodyValues:c.values})}catch(b){if(b instanceof Error&&(cg(b)||ak.isInstance(b)))throw b;throw new ak({message:"Failed to process successful response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}}catch(b){throw ci({error:b,url:a,requestBodyValues:c.values})}};async function cy(a){return"function"==typeof a&&(a=a()),Promise.resolve(a)}var cz=({errorSchema:a,errorToMessage:b,isRetryable:c})=>async({response:d,url:e,requestBodyValues:f})=>{let g=await d.text(),h=cc(d);if(""===g.trim())return{responseHeaders:h,value:new ak({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})};try{let i=await ct({text:g,schema:a});return{responseHeaders:h,value:new ak({message:b(i),url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,data:i,isRetryable:null==c?void 0:c(d,i)})}}catch(a){return{responseHeaders:h,value:new ak({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})}}},cA=a=>async({response:b,url:c,requestBodyValues:d})=>{let e=await b.text(),f=await cu({text:e,schema:a}),g=cc(b);if(!f.success)throw new ak({message:"Invalid JSON response",cause:f.error,statusCode:b.status,responseHeaders:g,responseBody:e,url:c,requestBodyValues:d});return{responseHeaders:g,value:f.value,rawValue:f.rawValue}},cB=Symbol.for("vercel.ai.schema");function cC(a,{validate:b}={}){return{[cB]:!0,_type:void 0,[cq]:!0,jsonSchema:a,validate:b}}function cD(a){return null==a?cC({properties:{},additionalProperties:!1}):"object"==typeof a&&null!==a&&cB in a&&!0===a[cB]&&"jsonSchema"in a&&"validate"in a?a:function(a,b){var c;return"_zod"in a?cC(function(a,b){if(a instanceof bN.rs){let c=new bP(b),d={};for(let b of a._idmap.entries()){let[a,d]=b;c.process(d)}let e={},f={registry:a,uri:b?.uri,defs:d};for(let d of a._idmap.entries()){let[a,g]=d;e[a]=c.emit(g,{...b,external:f})}return Object.keys(d).length>0&&(e.__shared={["draft-2020-12"===c.target?"$defs":"definitions"]:d}),{schemas:e}}let c=new bP(b);return c.process(a),c.emit(a,b)}(a,{target:"draft-7",io:"output",reused:"inline"}),{validate:async b=>{let c=await bQ.bp(a,b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}}):cC(((a,b)=>{let c=(a=>{let b,c="string"==typeof(b=a)?{...bS,name:b}:{...bS,...b},d=void 0!==c.name?[...c.basePath,c.definitionPath,c.name]:c.basePath;return{...c,flags:{hasReferencedOpenAiAnyType:!1},currentPath:d,propertyPath:void 0,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[b._def,{def:b._def,path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}})(b),d="object"==typeof b&&b.definitions?Object.entries(b.definitions).reduce((a,[b,d])=>({...a,[b]:b6(d._def,{...c,currentPath:[...c.basePath,c.definitionPath,b]},!0)??bU(c)}),{}):void 0,e="string"==typeof b?b:b?.nameStrategy==="title"?void 0:b?.name,f=b6(a._def,void 0===e?c:{...c,currentPath:[...c.basePath,c.definitionPath,e]},!1)??bU(c),g="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==g&&(f.title=g),c.flags.hasReferencedOpenAiAnyType&&(d||(d={}),d[c.openAiAnyTypeName]||(d[c.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===c.$refStrategy?"1":[...c.basePath,c.definitionPath,c.openAiAnyTypeName].join("/")}}));let h=void 0===e?d?{...f,[c.definitionPath]:d}:f:{$ref:[..."relative"===c.$refStrategy?[]:c.basePath,c.definitionPath,e].join("/"),[c.definitionPath]:{...d,[e]:f}};return"jsonSchema7"===c.target?h.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===c.target||"openAi"===c.target)&&(h.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===c.target&&("anyOf"in h||"oneOf"in h||"allOf"in h||"type"in h&&Array.isArray(h.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),h})(a,{$refStrategy:(c=void 0,"none"),target:"jsonSchema7"}),{validate:async b=>{let c=await a.safeParseAsync(b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}})}(a)}var{btoa:cE,atob:cF}=globalThis;function cG(a){let b=cF(a.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(b,a=>a.codePointAt(0))}function cH(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCodePoint(a[c]);return cE(b)}var cI=Symbol.for("vercel.ai.gateway.error"),cJ=class a extends(r=Error,q=cI,r){constructor({message:a,statusCode:b=500,cause:c}){super(a),this[q]=!0,this.statusCode=b,this.cause=c}static isInstance(b){return a.hasMarker(b)}static hasMarker(a){return"object"==typeof a&&null!==a&&cI in a&&!0===a[cI]}},cK="GatewayAuthenticationError",cL=Symbol.for(`vercel.ai.gateway.error.${cK}`),cM=class a extends(t=cJ,s=cL,t){constructor({message:a="Authentication failed",statusCode:b=401,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[s]=!0,this.name=cK,this.type="authentication_error"}static isInstance(a){return cJ.hasMarker(a)&&cL in a}static createContextualError({apiKeyProvided:b,oidcTokenProvided:c,message:d="Authentication failed",statusCode:e=401,cause:f}){return new a({message:b?`AI Gateway authentication failed: Invalid API key provided.

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:c?`AI Gateway authentication failed: Invalid OIDC token provided.

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed

Alternative: Provide an API key via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:`AI Gateway authentication failed: No authentication provided.

Provide either an API key or OIDC token.

API key instructions:

The token is expected to be provided via the 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

OIDC token instructions:

The token is expected to be provided via the 'VERCEL_OIDC_TOKEN' environment variable. It expires every 12 hours.
- make sure your Vercel project settings have OIDC enabled
- if running locally with 'vercel dev', the token is automatically obtained and refreshed
- if running locally with your own dev server, run 'vercel env pull' to fetch the token
- in production/preview, the token is automatically obtained and refreshed`,statusCode:e,cause:f})}},cN="GatewayInvalidRequestError",cO=Symbol.for(`vercel.ai.gateway.error.${cN}`),cP=class extends(v=cJ,u=cO,v){constructor({message:a="Invalid request",statusCode:b=400,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[u]=!0,this.name=cN,this.type="invalid_request_error"}static isInstance(a){return cJ.hasMarker(a)&&cO in a}},cQ="GatewayRateLimitError",cR=Symbol.for(`vercel.ai.gateway.error.${cQ}`),cS=class extends(x=cJ,w=cR,x){constructor({message:a="Rate limit exceeded",statusCode:b=429,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[w]=!0,this.name=cQ,this.type="rate_limit_exceeded"}static isInstance(a){return cJ.hasMarker(a)&&cR in a}},cT="GatewayModelNotFoundError",cU=Symbol.for(`vercel.ai.gateway.error.${cT}`),cV=bl.Ik({modelId:bl.Yj()}),cW=class extends(z=cJ,y=cU,z){constructor({message:a="Model not found",statusCode:b=404,modelId:c,cause:d}={}){super({message:a,statusCode:b,cause:d}),this[y]=!0,this.name=cT,this.type="model_not_found",this.modelId=c}static isInstance(a){return cJ.hasMarker(a)&&cU in a}},cX="GatewayInternalServerError",cY=Symbol.for(`vercel.ai.gateway.error.${cX}`),cZ=class extends(B=cJ,A=cY,B){constructor({message:a="Internal server error",statusCode:b=500,cause:c}={}){super({message:a,statusCode:b,cause:c}),this[A]=!0,this.name=cX,this.type="internal_server_error"}static isInstance(a){return cJ.hasMarker(a)&&cY in a}},c$="GatewayResponseError",c_=Symbol.for(`vercel.ai.gateway.error.${c$}`),c0=class extends(D=cJ,C=c_,D){constructor({message:a="Invalid response from Gateway",statusCode:b=502,response:c,validationError:d,cause:e}={}){super({message:a,statusCode:b,cause:e}),this[C]=!0,this.name=c$,this.type="response_error",this.response=c,this.validationError=d}static isInstance(a){return cJ.hasMarker(a)&&c_ in a}};function c1({response:a,statusCode:b,defaultMessage:c="Gateway request failed",cause:d,authMethod:e}){let f=c2.safeParse(a);if(!f.success)return new c0({message:`Invalid error response format: ${c}`,statusCode:b,response:a,validationError:f.error,cause:d});let g=f.data,h=g.error.type,i=g.error.message;switch(h){case"authentication_error":return cM.createContextualError({apiKeyProvided:"api-key"===e,oidcTokenProvided:"oidc"===e,statusCode:b,cause:d});case"invalid_request_error":return new cP({message:i,statusCode:b,cause:d});case"rate_limit_exceeded":return new cS({message:i,statusCode:b,cause:d});case"model_not_found":{let a=cV.safeParse(g.error.param);return new cW({message:i,statusCode:b,modelId:a.success?a.data.modelId:void 0,cause:d})}default:return new cZ({message:i,statusCode:b,cause:d})}}var c2=bl.Ik({error:bl.Ik({message:bl.Yj(),type:bl.Yj().nullish(),param:bl.L5().nullish(),code:bl.KC([bl.Yj(),bl.ai()]).nullish()})});function c3(a,b){var c;return cJ.isInstance(a)?a:ak.isInstance(a)?c1({response:function(a){if(void 0!==a.data)return a.data;if(null!=a.responseBody)try{return JSON.parse(a.responseBody)}catch(b){return a.responseBody}return{}}(a),statusCode:null!=(c=a.statusCode)?c:500,defaultMessage:"Gateway request failed",cause:a,authMethod:b}):c1({response:{},statusCode:500,defaultMessage:a instanceof Error?`Gateway request failed: ${a.message}`:"Unknown Gateway error",cause:a,authMethod:b})}var c4="ai-gateway-auth-method";function c5(a){let b=c6.safeParse(a[c4]);return b.success?b.data:void 0}var c6=bl.KC([bl.eu("api-key"),bl.eu("oidc")]),c7=class{constructor(a){this.config=a}async getAvailableModels(){try{let{value:a}=await cl({url:`${this.config.baseURL}/config`,headers:await cy(this.config.headers()),successfulResponseHandler:cA(db),failedResponseHandler:cz({errorSchema:bl.bz(),errorToMessage:a=>a}),fetch:this.config.fetch});return a}catch(a){throw c3(a)}}},c8=bl.Ik({specificationVersion:bl.eu("v2"),provider:bl.Yj(),modelId:bl.Yj()}),c9=bl.Ik({input:bl.Yj(),output:bl.Yj()}),da=bl.Ik({id:bl.Yj(),name:bl.Yj(),description:bl.Yj().nullish(),pricing:c9.nullish(),specification:c8}),db=bl.Ik({models:bl.YO(da)}),dc=class{constructor(a,b){this.modelId=a,this.config=b,this.specificationVersion="v2",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(a){let{abortSignal:b,...c}=a;return{args:this.maybeEncodeFileParts(c),warnings:[]}}async doGenerate(a){let{args:b,warnings:c}=await this.getArgs(a),{abortSignal:d}=a,e=await cy(this.config.headers());try{let{responseHeaders:f,value:g,rawValue:h}=await cw({url:this.getUrl(),headers:b9(e,a.headers,this.getModelConfigHeaders(this.modelId,!1),await cy(this.config.o11yHeaders)),body:b,successfulResponseHandler:cA(bl.bz()),failedResponseHandler:cz({errorSchema:bl.bz(),errorToMessage:a=>a}),...d&&{abortSignal:d},fetch:this.config.fetch});return{...g,request:{body:b},response:{headers:f,body:h},warnings:c}}catch(a){throw c3(a,c5(e))}}async doStream(a){let{args:b,warnings:c}=await this.getArgs(a),{abortSignal:d}=a,e=await cy(this.config.headers());try{let f,{value:g,responseHeaders:h}=await cw({url:this.getUrl(),headers:b9(e,a.headers,this.getModelConfigHeaders(this.modelId,!0),await cy(this.config.o11yHeaders)),body:b,successfulResponseHandler:(f=bl.bz(),async({response:a})=>{let b=cc(a);if(null==a.body)throw new ao({});return{responseHeaders:b,value:function({stream:a,schema:b}){return a.pipeThrough(new TextDecoderStream).pipeThrough(new aY).pipeThrough(new TransformStream({async transform({data:a},c){"[DONE]"!==a&&c.enqueue(await cu({text:a,schema:b}))}}))}({stream:a.body,schema:f})}}),failedResponseHandler:cz({errorSchema:bl.bz(),errorToMessage:a=>a}),...d&&{abortSignal:d},fetch:this.config.fetch});return{stream:g.pipeThrough(new TransformStream({start(a){c.length>0&&a.enqueue({type:"stream-start",warnings:c})},transform(b,c){if(b.success){let d=b.value;("raw"!==d.type||a.includeRawChunks)&&("response-metadata"===d.type&&d.timestamp&&"string"==typeof d.timestamp&&(d.timestamp=new Date(d.timestamp)),c.enqueue(d))}else c.error(b.error)}})),request:{body:b},response:{headers:h}}}catch(a){throw c3(a,c5(e))}}isFilePart(a){return a&&"object"==typeof a&&"type"in a&&"file"===a.type}maybeEncodeFileParts(a){for(let b of a.prompt)for(let a of b.content)if(this.isFilePart(a)&&a.data instanceof Uint8Array){let b=Uint8Array.from(a.data),c=Buffer.from(b).toString("base64");a.data=new URL(`data:${a.mediaType||"application/octet-stream"};base64,${c}`)}return a}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(a,b){return{"ai-language-model-specification-version":"2","ai-language-model-id":a,"ai-language-model-streaming":String(b)}}},dd=class{constructor(a,b){this.modelId=a,this.config=b,this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:a,headers:b,abortSignal:c,providerOptions:d}){var e;let f=await cy(this.config.headers());try{let{responseHeaders:g,value:h,rawValue:i}=await cw({url:this.getUrl(),headers:b9(f,null!=b?b:{},this.getModelConfigHeaders(),await cy(this.config.o11yHeaders)),body:{input:1===a.length?a[0]:a,...null!=d?d:{}},successfulResponseHandler:cA(de),failedResponseHandler:cz({errorSchema:bl.bz(),errorToMessage:a=>a}),...c&&{abortSignal:c},fetch:this.config.fetch});return{embeddings:h.embeddings,usage:null!=(e=h.usage)?e:void 0,providerMetadata:h.providerMetadata,response:{headers:g,body:i}}}catch(a){throw c3(a,c5(f))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},de=bl.Ik({embeddings:bl.YO(bl.YO(bl.ai())),usage:bl.Ik({tokens:bl.ai()}).nullish(),providerMetadata:bl.g1(bl.Yj(),bl.g1(bl.Yj(),bl.L5())).optional()});async function df(){var a,b;let c=null!=(b=null==(a=di().headers)?void 0:a["x-vercel-oidc-token"])?b:process.env.VERCEL_OIDC_TOKEN;if(!c)throw new cM({message:"OIDC token not available",statusCode:401});return c}async function dg(){var a;return null==(a=di().headers)?void 0:a["x-vercel-id"]}var dh=Symbol.for("@vercel/request-context");function di(){var a,b,c;return null!=(c=null==(b=null==(a=globalThis[dh])?void 0:a.get)?void 0:b.call(a))?c:{}}var dj=function(a={}){var b,c,d;let e=null,f=null,g=null!=(b=a.metadataCacheRefreshMillis)?b:3e5,h=0,i=null!=(c=null==(d=a.baseURL)?void 0:d.replace(/\/$/,""))?c:"https://ai-gateway.vercel.sh/v1/ai",j=async()=>{let b=await dk(a);if(b)return{Authorization:`Bearer ${b.token}`,"ai-gateway-protocol-version":"0.0.1",[c4]:b.authMethod,...a.headers};throw cM.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},k=()=>{let a=cm({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),b=cm({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),c=cm({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{let d=await dg();return{...a&&{"ai-o11y-deployment-id":a},...b&&{"ai-o11y-environment":b},...c&&{"ai-o11y-region":c},...d&&{"ai-o11y-request-id":d}}}},l=b=>new dc(b,{provider:"gateway",baseURL:i,headers:j,fetch:a.fetch,o11yHeaders:k()}),m=function(a){if(new.target)throw Error("The Gateway Provider model function cannot be called with the new keyword.");return l(a)};return m.getAvailableModels=async()=>{var b,c,d;let k=null!=(d=null==(c=null==(b=a._internal)?void 0:b.currentDate)?void 0:c.call(b).getTime())?d:Date.now();return(!e||k-h>g)&&(h=k,e=new c7({baseURL:i,headers:j,fetch:a.fetch}).getAvailableModels().then(a=>(f=a,a)).catch(async a=>{throw c3(a,c5(await j()))})),f?Promise.resolve(f):e},m.imageModel=a=>{throw new aJ({modelId:a,modelType:"imageModel"})},m.languageModel=l,m.textEmbeddingModel=b=>new dd(b,{provider:"gateway",baseURL:i,headers:j,fetch:a.fetch,o11yHeaders:k()}),m}();async function dk(a){let b=cm({settingValue:a.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(b)return{token:b,authMethod:"api-key"};try{return{token:await df(),authMethod:"oidc"}}catch(a){return null}}var dl=c(14031),dm=c(45030),dn=Object.defineProperty,dp="AI_NoOutputSpecifiedError",dq=`vercel.ai.error.${dp}`,dr=Symbol.for(dq),ds=class extends ag{constructor({message:a="No output specified."}={}){super({name:dp,message:a}),this[E]=!0}static isInstance(a){return ag.hasMarker(a,dq)}};E=dr;var dt="AI_InvalidArgumentError",du=`vercel.ai.error.${dt}`,dv=Symbol.for(du),dw=class extends ag{constructor({parameter:a,value:b,message:c}){super({name:dt,message:`Invalid argument for parameter ${a}: ${c}`}),this[F]=!0,this.parameter=a,this.value=b}static isInstance(a){return ag.hasMarker(a,du)}};F=dv,Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");var dx="AI_InvalidToolInputError",dy=`vercel.ai.error.${dx}`,dz=Symbol.for(dy),dA=class extends ag{constructor({toolInput:a,toolName:b,cause:c,message:d=`Invalid input for tool ${b}: ${ap(c)}`}){super({name:dx,message:d,cause:c}),this[G]=!0,this.toolInput=a,this.toolName=b}static isInstance(a){return ag.hasMarker(a,dy)}};G=dz,Symbol.for("vercel.ai.error.AI_MCPClientError"),Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var dB="AI_NoObjectGeneratedError",dC=`vercel.ai.error.${dB}`,dD=Symbol.for(dC),dE=class extends ag{constructor({message:a="No object generated.",cause:b,text:c,response:d,usage:e,finishReason:f}){super({name:dB,message:a,cause:b}),this[H]=!0,this.text=c,this.response=d,this.usage=e,this.finishReason=f}static isInstance(a){return ag.hasMarker(a,dC)}};H=dD;var dF="AI_NoSuchToolError",dG=`vercel.ai.error.${dF}`,dH=Symbol.for(dG),dI=class extends ag{constructor({toolName:a,availableTools:b,message:c=`Model tried to call unavailable tool '${a}'. ${void 0===b?"No tools are available.":`Available tools: ${b.join(", ")}.`}`}){super({name:dF,message:c}),this[I]=!0,this.toolName=a,this.availableTools=b}static isInstance(a){return ag.hasMarker(a,dG)}};I=dH;var dJ="AI_ToolCallRepairError",dK=`vercel.ai.error.${dJ}`,dL=Symbol.for(dK),dM=class extends ag{constructor({cause:a,originalError:b,message:c=`Error repairing tool call: ${ap(a)}`}){super({name:dJ,message:c,cause:a}),this[J]=!0,this.originalError=b}static isInstance(a){return ag.hasMarker(a,dK)}};J=dL;var dN=class extends ag{constructor(a){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${a.version} for provider "${a.provider}" and model "${a.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=a.version,this.provider=a.provider,this.modelId=a.modelId}},dO=(Symbol.for("vercel.ai.error.AI_InvalidDataContentError"),"AI_InvalidMessageRoleError"),dP=`vercel.ai.error.${dO}`,dQ=Symbol.for(dP),dR=class extends ag{constructor({role:a,message:b=`Invalid message role: '${a}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:dO,message:b}),this[K]=!0,this.role=a}static isInstance(a){return ag.hasMarker(a,dP)}};K=dQ;var dS="AI_MessageConversionError",dT=`vercel.ai.error.${dS}`,dU=Symbol.for(dT),dV=class extends ag{constructor({originalMessage:a,message:b}){super({name:dS,message:b}),this[L]=!0,this.originalMessage=a}static isInstance(a){return ag.hasMarker(a,dT)}};L=dU;var dW="AI_DownloadError",dX=`vercel.ai.error.${dW}`,dY=Symbol.for(dX),dZ=class extends ag{constructor({url:a,statusCode:b,statusText:c,cause:d,message:e=null==d?`Failed to download ${a}: ${b} ${c}`:`Failed to download ${a}: ${d}`}){super({name:dW,message:e,cause:d}),this[M]=!0,this.url=a,this.statusCode=b,this.statusText=c}static isInstance(a){return ag.hasMarker(a,dX)}};M=dY;var d$="AI_RetryError",d_=`vercel.ai.error.${d$}`,d0=Symbol.for(d_),d1=class extends ag{constructor({message:a,reason:b,errors:c}){super({name:d$,message:a}),this[N]=!0,this.reason=b,this.errors=c,this.lastError=c[c.length-1]}static isInstance(a){return ag.hasMarker(a,d_)}};function d2(a){var b;if("string"!=typeof a){if("v2"!==a.specificationVersion)throw new dN({version:a.specificationVersion,provider:a.provider,modelId:a.modelId});return a}return(null!=(b=globalThis.AI_SDK_DEFAULT_PROVIDER)?b:dj).languageModel(a)}N=d0;var d3=[{mediaType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mediaType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mediaType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mediaType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mediaType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}];async function d4({url:a}){var b;let c=a.toString();try{let a=await fetch(c);if(!a.ok)throw new dZ({url:c,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mediaType:null!=(b=a.headers.get("content-type"))?b:void 0}}catch(a){if(dZ.isInstance(a))throw a;throw new dZ({url:c,cause:a})}}var d5=bl.KC([bl.Yj(),bl.Nl(Uint8Array),bl.Nl(ArrayBuffer),bl.Ie(a=>{var b,c;return null!=(c=null==(b=globalThis.Buffer)?void 0:b.isBuffer(a))&&c},{message:"Must be a Buffer"})]);function d6(a){if(a instanceof Uint8Array)return{data:a,mediaType:void 0};if(a instanceof ArrayBuffer)return{data:new Uint8Array(a),mediaType:void 0};if("string"==typeof a)try{a=new URL(a)}catch(a){}if(a instanceof URL&&"data:"===a.protocol){let{mediaType:b,base64Content:c}=function(a){try{let[b,c]=a.split(",");return{mediaType:b.split(";")[0].split(":")[1],base64Content:c}}catch(a){return{mediaType:void 0,base64Content:void 0}}}(a.toString());if(null==b||null==c)throw new ag({name:"InvalidDataContentError",message:`Invalid data URL format in content ${a.toString()}`});return{data:c,mediaType:b}}return{data:a,mediaType:void 0}}async function d7({prompt:a,supportedUrls:b,downloadImplementation:c=d4}){let d=await d8(a.messages,c,b);return[...null!=a.system?[{role:"system",content:a.system}]:[],...a.messages.map(a=>(function({message:a,downloadedAssets:b}){let c=a.role;switch(c){case"system":return{role:"system",content:a.content,providerOptions:a.providerOptions};case"user":if("string"==typeof a.content)return{role:"user",content:[{type:"text",text:a.content}],providerOptions:a.providerOptions};return{role:"user",content:a.content.map(a=>(function(a,b){var c;let d;if("text"===a.type)return{type:"text",text:a.text,providerOptions:a.providerOptions};let e=a.type;switch(e){case"image":d=a.image;break;case"file":d=a.data;break;default:throw Error(`Unsupported part type: ${e}`)}let{data:f,mediaType:g}=d6(d),h=null!=g?g:a.mediaType,i=f;if(i instanceof URL){let a=b[i.toString()];a&&(i=a.data,null!=h||(h=a.mediaType))}switch(e){case"image":return(i instanceof Uint8Array||"string"==typeof i)&&(h=null!=(c=function({data:a,signatures:b}){let c="string"==typeof a&&a.startsWith("SUQz")||"string"!=typeof a&&a.length>10&&73===a[0]&&68===a[1]&&51===a[2]?(a=>{let b="string"==typeof a?cG(a):a,c=(127&b[6])<<21|(127&b[7])<<14|(127&b[8])<<7|127&b[9];return b.slice(c+10)})(a):a;for(let a of b)if("string"==typeof c?c.startsWith(a.base64Prefix):c.length>=a.bytesPrefix.length&&a.bytesPrefix.every((a,b)=>c[b]===a))return a.mediaType}({data:i,signatures:d3}))?c:h),{type:"file",mediaType:null!=h?h:"image/*",filename:void 0,data:i,providerOptions:a.providerOptions};case"file":if(null==h)throw Error("Media type is missing for file part");return{type:"file",mediaType:h,filename:a.filename,data:i,providerOptions:a.providerOptions}}})(a,b)).filter(a=>"text"!==a.type||""!==a.text),providerOptions:a.providerOptions};case"assistant":if("string"==typeof a.content)return{role:"assistant",content:[{type:"text",text:a.content}],providerOptions:a.providerOptions};return{role:"assistant",content:a.content.filter(a=>"text"!==a.type||""!==a.text).map(a=>{let b=a.providerOptions;switch(a.type){case"file":{let{data:c,mediaType:d}=d6(a.data);return{type:"file",data:c,filename:a.filename,mediaType:null!=d?d:a.mediaType,providerOptions:b}}case"reasoning":return{type:"reasoning",text:a.text,providerOptions:b};case"text":return{type:"text",text:a.text,providerOptions:b};case"tool-call":return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:b};case"tool-result":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:a.output,providerOptions:b}}}),providerOptions:a.providerOptions};case"tool":return{role:"tool",content:a.content.map(a=>({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:a.output,providerOptions:a.providerOptions})),providerOptions:a.providerOptions};default:throw new dR({role:c})}})({message:a,downloadedAssets:d}))]}async function d8(a,b,c){let d=a.filter(a=>"user"===a.role).map(a=>a.content).filter(a=>Array.isArray(a)).flat().filter(a=>"image"===a.type||"file"===a.type).map(a=>{var b;let c=null!=(b=a.mediaType)?b:"image"===a.type?"image/*":void 0,d="image"===a.type?a.image:a.data;if("string"==typeof d)try{d=new URL(d)}catch(a){}return{mediaType:c,data:d}}).filter(a=>a.data instanceof URL&&null!=a.mediaType&&!function({mediaType:a,url:b,supportedUrls:c}){return b=b.toLowerCase(),a=a.toLowerCase(),Object.entries(c).map(([a,b])=>{let c=a.toLowerCase();return"*"===c||"*/*"===c?{mediaTypePrefix:"",regexes:b}:{mediaTypePrefix:c.replace(/\*/,""),regexes:b}}).filter(({mediaTypePrefix:b})=>a.startsWith(b)).flatMap(({regexes:a})=>a).some(a=>a.test(b))}({url:a.data.toString(),mediaType:a.mediaType,supportedUrls:c})).map(a=>a.data);return Object.fromEntries((await Promise.all(d.map(async a=>({url:a,data:await b({url:a})})))).map(({url:a,data:b})=>[a.toString(),b]))}var d9=bl.RZ(()=>bl.KC([bl.ch(),bl.Yj(),bl.ai(),bl.zM(),bl.g1(bl.Yj(),d9),bl.YO(d9)])),ea=bl.g1(bl.Yj(),bl.g1(bl.Yj(),d9)),eb=bl.Ik({type:bl.eu("text"),text:bl.Yj(),providerOptions:ea.optional()}),ec=bl.Ik({type:bl.eu("image"),image:bl.KC([d5,bl.Nl(URL)]),mediaType:bl.Yj().optional(),providerOptions:ea.optional()}),ed=bl.Ik({type:bl.eu("file"),data:bl.KC([d5,bl.Nl(URL)]),filename:bl.Yj().optional(),mediaType:bl.Yj(),providerOptions:ea.optional()}),ee=bl.Ik({type:bl.eu("reasoning"),text:bl.Yj(),providerOptions:ea.optional()}),ef=bl.Ik({type:bl.eu("tool-call"),toolCallId:bl.Yj(),toolName:bl.Yj(),input:bl.L5(),providerOptions:ea.optional(),providerExecuted:bl.zM().optional()}),eg=bl.gM("type",[bl.Ik({type:bl.eu("text"),value:bl.Yj()}),bl.Ik({type:bl.eu("json"),value:d9}),bl.Ik({type:bl.eu("error-text"),value:bl.Yj()}),bl.Ik({type:bl.eu("error-json"),value:d9}),bl.Ik({type:bl.eu("content"),value:bl.YO(bl.KC([bl.Ik({type:bl.eu("text"),text:bl.Yj()}),bl.Ik({type:bl.eu("media"),data:bl.Yj(),mediaType:bl.Yj()})]))})]),eh=bl.Ik({type:bl.eu("tool-result"),toolCallId:bl.Yj(),toolName:bl.Yj(),output:eg,providerOptions:ea.optional()}),ei=bl.Ik({role:bl.eu("system"),content:bl.Yj(),providerOptions:ea.optional()}),ej=bl.Ik({role:bl.eu("user"),content:bl.KC([bl.Yj(),bl.YO(bl.KC([eb,ec,ed]))]),providerOptions:ea.optional()}),ek=bl.Ik({role:bl.eu("assistant"),content:bl.KC([bl.Yj(),bl.YO(bl.KC([eb,ed,ee,ef,eh]))]),providerOptions:ea.optional()}),el=bl.Ik({role:bl.eu("tool"),content:bl.YO(eh),providerOptions:ea.optional()}),em=bl.KC([ei,ej,ek,el]);async function en(a){let b;if(null==a.prompt&&null==a.messages)throw new ax({prompt:a,message:"prompt or messages must be defined"});if(null!=a.prompt&&null!=a.messages)throw new ax({prompt:a,message:"prompt and messages cannot be defined at the same time"});if(null!=a.system&&"string"!=typeof a.system)throw new ax({prompt:a,message:"system must be a string"});if(null!=a.prompt&&"string"==typeof a.prompt)b=[{role:"user",content:a.prompt}];else if(null!=a.prompt&&Array.isArray(a.prompt))b=a.prompt;else if(null!=a.messages)b=a.messages;else throw new ax({prompt:a,message:"prompt or messages must be defined"});if(0===b.length)throw new ax({prompt:a,message:"messages must not be empty"});let c=await cs({value:b,schema:bl.YO(em)});if(!c.success)throw new ax({prompt:a,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:c.error});return{messages:b,system:a.system}}function eo({operationId:a,telemetry:b}){return{"operation.name":`${a}${(null==b?void 0:b.functionId)!=null?` ${b.functionId}`:""}`,"resource.name":null==b?void 0:b.functionId,"ai.operationId":a,"ai.telemetry.functionId":null==b?void 0:b.functionId}}var ep={startSpan:()=>eq,startActiveSpan:(a,b,c,d)=>"function"==typeof b?b(eq):"function"==typeof c?c(eq):"function"==typeof d?d(eq):void 0},eq={spanContext:()=>er,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},er={traceId:"",spanId:"",traceFlags:0};function es({name:a,tracer:b,attributes:c,fn:d,endWhenDone:e=!0}){return b.startActiveSpan(a,{attributes:c},async a=>{try{let b=await d(a);return e&&a.end(),b}catch(b){try{et(a,b)}finally{a.end()}throw b}})}function et(a,b){b instanceof Error?(a.recordException({name:b.name,message:b.message,stack:b.stack}),a.setStatus({code:dm.s.ERROR,message:b.message})):a.setStatus({code:dm.s.ERROR})}function eu({telemetry:a,attributes:b}){return(null==a?void 0:a.isEnabled)!==!0?{}:Object.entries(b).reduce((b,[c,d])=>{if(null==d)return b;if("object"==typeof d&&"input"in d&&"function"==typeof d.input){if((null==a?void 0:a.recordInputs)===!1)return b;let e=d.input();return null==e?b:{...b,[c]:e}}if("object"==typeof d&&"output"in d&&"function"==typeof d.output){if((null==a?void 0:a.recordOutputs)===!1)return b;let e=d.output();return null==e?b:{...b,[c]:e}}return{...b,[c]:d}},{})}function ev(a,b){return null==a&&null==b?void 0:(null!=a?a:0)+(null!=b?b:0)}function ew(a){return void 0===a?[]:Array.isArray(a)?a:[a]}async function ex(a,{maxRetries:b,delayInMs:c,backoffFactor:d,abortSignal:e},f=[]){try{return await a()}catch(j){if(cg(j)||0===b)throw j;let g=cf(j),h=[...f,j],i=h.length;if(i>b)throw new d1({message:`Failed after ${i} attempts. Last error: ${g}`,reason:"maxRetriesExceeded",errors:h});if(j instanceof Error&&ak.isInstance(j)&&!0===j.isRetryable&&i<=b)return await ca(function({error:a,exponentialBackoffDelay:b}){let c,d=a.responseHeaders;if(!d)return b;let e=d["retry-after-ms"];if(e){let a=parseFloat(e);Number.isNaN(a)||(c=a)}let f=d["retry-after"];if(f&&void 0===c){let a=parseFloat(f);c=Number.isNaN(a)?Date.parse(f)-Date.now():1e3*a}return null!=c&&!Number.isNaN(c)&&0<=c&&(c<6e4||c<b)?c:b}({error:j,exponentialBackoffDelay:c}),{abortSignal:e}),ex(a,{maxRetries:b,delayInMs:d*c,backoffFactor:d,abortSignal:e},h);if(1===i)throw j;throw new d1({message:`Failed after ${i} attempts with non-retryable error: '${g}'`,reason:"errorNotRetryable",errors:h})}}var ey=class{constructor({data:a,mediaType:b}){let c=a instanceof Uint8Array;this.base64Data=c?void 0:a,this.uint8ArrayData=c?a:void 0,this.mediaType=b}get base64(){return null==this.base64Data&&(this.base64Data=cH(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=cG(this.base64Data)),this.uint8ArrayData}},ez=class extends ey{constructor(a){super(a),this.type="file"}};async function eA({toolCall:a,tools:b,repairToolCall:c,system:d,messages:e}){try{if(null==b)throw new dI({toolName:a.toolName});try{return await eB({toolCall:a,tools:b})}catch(g){if(null==c||!(dI.isInstance(g)||dA.isInstance(g)))throw g;let f=null;try{f=await c({toolCall:a,tools:b,inputSchema:({toolName:a})=>{let{inputSchema:c}=b[a];return cD(c).jsonSchema},system:d,messages:e,error:g})}catch(a){throw new dM({cause:a,originalError:g})}if(null==f)throw g;return await eB({toolCall:f,tools:b})}}catch(b){return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,dynamic:!0,invalid:!0,error:b}}}async function eB({toolCall:a,tools:b}){let c=a.toolName,d=b[c];if(null==d)throw new dI({toolName:a.toolName,availableTools:Object.keys(b)});let e=cD(d.inputSchema),f=""===a.input.trim()?await cs({value:{},schema:e}):await cu({text:a.input,schema:e});if(!1===f.success)throw new dA({toolName:c,toolInput:a.input,cause:f.error});return"dynamic"===d.type?{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:f.value,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:a.toolCallId,toolName:c,input:f.value,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}}var eC=class{constructor({content:a,finishReason:b,usage:c,warnings:d,request:e,response:f,providerMetadata:g}){this.content=a,this.finishReason=b,this.usage=c,this.warnings=d,this.request=e,this.response=f,this.providerMetadata=g}get text(){return this.content.filter(a=>"text"===a.type).map(a=>a.text).join("")}get reasoning(){return this.content.filter(a=>"reasoning"===a.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(a=>a.text).join("")}get files(){return this.content.filter(a=>"file"===a.type).map(a=>a.file)}get sources(){return this.content.filter(a=>"source"===a.type)}get toolCalls(){return this.content.filter(a=>"tool-call"===a.type)}get staticToolCalls(){return this.toolCalls.filter(a=>!1===a.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(a=>!0===a.dynamic)}get toolResults(){return this.content.filter(a=>"tool-result"===a.type)}get staticToolResults(){return this.toolResults.filter(a=>!1===a.dynamic)}get dynamicToolResults(){return this.toolResults.filter(a=>!0===a.dynamic)}};async function eD({stopConditions:a,steps:b}){return(await Promise.all(a.map(a=>a({steps:b})))).some(a=>a)}function eE({output:a,tool:b,errorMode:c}){return"text"===c?{type:"error-text",value:ap(a)}:"json"===c?{type:"error-json",value:eF(a)}:(null==b?void 0:b.toModelOutput)?b.toModelOutput(a):"string"==typeof a?{type:"text",value:a}:{type:"json",value:eF(a)}}function eF(a){return void 0===a?null:a}function eG({content:a,tools:b}){let c=[],d=a.filter(a=>"source"!==a.type).filter(a=>("tool-result"!==a.type||a.providerExecuted)&&("tool-error"!==a.type||a.providerExecuted)).filter(a=>"text"!==a.type||a.text.length>0).map(a=>{switch(a.type){case"text":return{type:"text",text:a.text,providerOptions:a.providerMetadata};case"reasoning":return{type:"reasoning",text:a.text,providerOptions:a.providerMetadata};case"file":return{type:"file",data:a.file.base64,mediaType:a.file.mediaType,providerOptions:a.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:a.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:eE({tool:null==b?void 0:b[a.toolName],output:a.output,errorMode:"none"}),providerExecuted:!0,providerOptions:a.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:eE({tool:null==b?void 0:b[a.toolName],output:a.error,errorMode:"json"}),providerOptions:a.providerMetadata}}});d.length>0&&c.push({role:"assistant",content:d});let e=a.filter(a=>"tool-result"===a.type||"tool-error"===a.type).filter(a=>!a.providerExecuted).map(a=>({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:eE({tool:null==b?void 0:b[a.toolName],output:"tool-result"===a.type?a.output:a.error,errorMode:"tool-error"===a.type?"text":"none"})}));return e.length>0&&c.push({role:"tool",content:e}),c}function eH(a,b){let c=new Headers(null!=a?a:{});for(let[a,d]of Object.entries(b))c.has(a)||c.set(a,d);return c}function eI({response:a,status:b,statusText:c,headers:d,stream:e}){a.writeHead(null!=b?b:200,c,d);let f=e.getReader();(async()=>{try{for(;;){let{done:b,value:c}=await f.read();if(b)break;a.write(c)}}catch(a){throw a}finally{a.end()}})()}cd({prefix:"aitxt",size:24});var eJ=class extends TransformStream{constructor(){super({transform(a,b){b.enqueue(`data: ${JSON.stringify(a)}

`)},flush(a){a.enqueue("data: [DONE]\n\n")}})}},eK={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};async function eL(a){if(void 0===a)return{value:void 0,state:"undefined-input"};let b=await cu({text:a});return b.success?{value:b.value,state:"successful-parse"}:(b=await cu({text:function(a){let b=["ROOT"],c=-1,d=null;function e(a,e,f){switch(a){case'"':c=e,b.pop(),b.push(f),b.push("INSIDE_STRING");break;case"f":case"t":case"n":c=e,d=e,b.pop(),b.push(f),b.push("INSIDE_LITERAL");break;case"-":b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=e,b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"{":c=e,b.pop(),b.push(f),b.push("INSIDE_OBJECT_START");break;case"[":c=e,b.pop(),b.push(f),b.push("INSIDE_ARRAY_START")}}function f(a,d){switch(a){case",":b.pop(),b.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":c=d,b.pop()}}function g(a,d){switch(a){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=d,b.pop()}}for(let h=0;h<a.length;h++){let i=a[h];switch(b[b.length-1]){case"ROOT":e(i,h,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':b.pop(),b.push("INSIDE_OBJECT_KEY");break;case"}":c=h,b.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(b.pop(),b.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":e(i,h,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":f(i,h);break;case"INSIDE_STRING":switch(i){case'"':b.pop(),c=h;break;case"\\":b.push("INSIDE_STRING_ESCAPE");break;default:c=h}break;case"INSIDE_ARRAY_START":"]"===i?(c=h,b.pop()):(c=h,e(i,h,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=h,b.pop();break;default:c=h}break;case"INSIDE_ARRAY_AFTER_COMMA":e(i,h,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":b.pop(),c=h;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=h;break;case"e":case"E":case"-":case".":break;case",":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"}":b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"]":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h);break;default:b.pop()}break;case"INSIDE_LITERAL":{let e=a.substring(d,h+1);"false".startsWith(e)||"true".startsWith(e)||"null".startsWith(e)?c=h:(b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]?f(i,h):"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h))}}}let h=a.slice(0,c+1);for(let c=b.length-1;c>=0;c--)switch(b[c]){case"INSIDE_STRING":h+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":h+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":h+="]";break;case"INSIDE_LITERAL":{let b=a.substring(d,a.length);"true".startsWith(b)?h+="true".slice(b.length):"false".startsWith(b)?h+="false".slice(b.length):"null".startsWith(b)&&(h+="null".slice(b.length))}}return h}(a)})).success?{value:b.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function eM(a){return a.type.startsWith("tool-")}function eN(a){return a.type.split("-").slice(1).join("-")}function eO(a){let b=a.pipeThrough(new TransformStream);return b[Symbol.asyncIterator]=()=>{let a=b.getReader();return{async next(){let{done:b,value:c}=await a.read();return b?{done:!0,value:void 0}:{done:!1,value:c}}}},b}async function eP({stream:a,onError:b}){let c=a.getReader();try{for(;;){let{done:a}=await c.read();if(a)break}}catch(a){null==b||b(a)}finally{c.releaseLock()}}function eQ(){let a,b;return{promise:new Promise((c,d)=>{a=c,b=d}),resolve:a,reject:b}}bl.KC([bl.re({type:bl.eu("text-start"),id:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("text-delta"),id:bl.Yj(),delta:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("text-end"),id:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("error"),errorText:bl.Yj()}),bl.re({type:bl.eu("tool-input-start"),toolCallId:bl.Yj(),toolName:bl.Yj(),providerExecuted:bl.zM().optional(),dynamic:bl.zM().optional()}),bl.re({type:bl.eu("tool-input-delta"),toolCallId:bl.Yj(),inputTextDelta:bl.Yj()}),bl.re({type:bl.eu("tool-input-available"),toolCallId:bl.Yj(),toolName:bl.Yj(),input:bl.L5(),providerExecuted:bl.zM().optional(),providerMetadata:ea.optional(),dynamic:bl.zM().optional()}),bl.re({type:bl.eu("tool-input-error"),toolCallId:bl.Yj(),toolName:bl.Yj(),input:bl.L5(),providerExecuted:bl.zM().optional(),providerMetadata:ea.optional(),dynamic:bl.zM().optional(),errorText:bl.Yj()}),bl.re({type:bl.eu("tool-output-available"),toolCallId:bl.Yj(),output:bl.L5(),providerExecuted:bl.zM().optional(),dynamic:bl.zM().optional()}),bl.re({type:bl.eu("tool-output-error"),toolCallId:bl.Yj(),errorText:bl.Yj(),providerExecuted:bl.zM().optional(),dynamic:bl.zM().optional()}),bl.re({type:bl.eu("reasoning"),text:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("reasoning-start"),id:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("reasoning-delta"),id:bl.Yj(),delta:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("reasoning-end"),id:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("reasoning-part-finish")}),bl.re({type:bl.eu("source-url"),sourceId:bl.Yj(),url:bl.Yj(),title:bl.Yj().optional(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("source-document"),sourceId:bl.Yj(),mediaType:bl.Yj(),title:bl.Yj(),filename:bl.Yj().optional(),providerMetadata:ea.optional()}),bl.re({type:bl.eu("file"),url:bl.Yj(),mediaType:bl.Yj(),providerMetadata:ea.optional()}),bl.re({type:bl.Yj().startsWith("data-"),id:bl.Yj().optional(),data:bl.L5(),transient:bl.zM().optional()}),bl.re({type:bl.eu("start-step")}),bl.re({type:bl.eu("finish-step")}),bl.re({type:bl.eu("start"),messageId:bl.Yj().optional(),messageMetadata:bl.L5().optional()}),bl.re({type:bl.eu("finish"),messageMetadata:bl.L5().optional()}),bl.re({type:bl.eu("abort")}),bl.re({type:bl.eu("message-metadata"),messageMetadata:bl.L5()})]);var eR=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise||(this._promise=new Promise((a,b)=>{"resolved"===this.status.type?a(this.status.value):"rejected"===this.status.type&&b(this.status.error),this._resolve=a,this._reject=b})),this._promise}resolve(a){var b;this.status={type:"resolved",value:a},this._promise&&(null==(b=this._resolve)||b.call(this,a))}reject(a){var b;this.status={type:"rejected",error:a},this._promise&&(null==(b=this._reject)||b.call(this,a))}},eS=cd({prefix:"aitxt",size:24}),eT=class{constructor({model:a,telemetry:b,headers:c,settings:d,maxRetries:e,abortSignal:f,system:g,prompt:h,messages:i,tools:j,toolChoice:k,transforms:l,activeTools:m,repairToolCall:n,stopConditions:o,output:p,providerOptions:q,prepareStep:r,includeRawChunks:s,now:t,currentDate:u,generateId:v,onChunk:w,onError:x,onFinish:y,onAbort:z,onStepFinish:A,experimental_context:B}){let C,D,E,F;this._totalUsage=new eR,this._finishReason=new eR,this._steps=new eR,this.output=p,this.includeRawChunks=s,this.tools=j;let G=[],H=[],I={},J=[],K=[],L={},M={},N=new TransformStream({async transform(a,b){var c,d,e,f;b.enqueue(a);let{part:g}=a;if(("text-delta"===g.type||"reasoning-delta"===g.type||"source"===g.type||"tool-call"===g.type||"tool-result"===g.type||"tool-input-start"===g.type||"tool-input-delta"===g.type||"raw"===g.type)&&await (null==w?void 0:w({chunk:g})),"error"===g.type&&await x({error:(f=g.error,cM.isInstance(f)||cW.isInstance(f)?new ag({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:f}):f)}),"text-start"===g.type&&(L[g.id]={type:"text",text:"",providerMetadata:g.providerMetadata},G.push(L[g.id])),"text-delta"===g.type){let a=L[g.id];if(null==a)return void b.enqueue({part:{type:"error",error:`text part ${g.id} not found`},partialOutput:void 0});a.text+=g.text,a.providerMetadata=null!=(c=g.providerMetadata)?c:a.providerMetadata}if("text-end"===g.type&&delete L[g.id],"reasoning-start"===g.type&&(M[g.id]={type:"reasoning",text:"",providerMetadata:g.providerMetadata},G.push(M[g.id])),"reasoning-delta"===g.type){let a=M[g.id];if(null==a)return void b.enqueue({part:{type:"error",error:`reasoning part ${g.id} not found`},partialOutput:void 0});a.text+=g.text,a.providerMetadata=null!=(d=g.providerMetadata)?d:a.providerMetadata}if("reasoning-end"===g.type){let a=M[g.id];if(null==a)return void b.enqueue({part:{type:"error",error:`reasoning part ${g.id} not found`},partialOutput:void 0});a.providerMetadata=null!=(e=g.providerMetadata)?e:a.providerMetadata,delete M[g.id]}if("file"===g.type&&G.push({type:"file",file:g.file}),"source"===g.type&&G.push(g),"tool-call"===g.type&&G.push(g),"tool-result"===g.type&&G.push(g),"tool-error"===g.type&&G.push(g),"start-step"===g.type&&(I=g.request,J=g.warnings),"finish-step"===g.type){let a=eG({content:G,tools:j}),b=new eC({content:G,finishReason:g.finishReason,usage:g.usage,warnings:J,request:I,response:{...g.response,messages:[...H,...a]},providerMetadata:g.providerMetadata});await (null==A?void 0:A(b)),K.push(b),G=[],M={},L={},H.push(...a),C.resolve()}"finish"===g.type&&(F=g.totalUsage,E=g.finishReason)},async flush(a){try{if(0===K.length)return;let a=null!=E?E:"unknown",c=null!=F?F:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};V._finishReason.resolve(a),V._totalUsage.resolve(c),V._steps.resolve(K);let d=K[K.length-1];await (null==y?void 0:y({finishReason:a,totalUsage:c,usage:d.usage,content:d.content,text:d.text,reasoningText:d.reasoningText,reasoning:d.reasoning,files:d.files,sources:d.sources,toolCalls:d.toolCalls,staticToolCalls:d.staticToolCalls,dynamicToolCalls:d.dynamicToolCalls,toolResults:d.toolResults,staticToolResults:d.staticToolResults,dynamicToolResults:d.dynamicToolResults,request:d.request,response:d.response,warnings:d.warnings,providerMetadata:d.providerMetadata,steps:K})),D.setAttributes(eu({telemetry:b,attributes:{"ai.response.finishReason":a,"ai.response.text":{output:()=>d.text},"ai.response.toolCalls":{output:()=>{var a;return(null==(a=d.toolCalls)?void 0:a.length)?JSON.stringify(d.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(d.providerMetadata),"ai.usage.inputTokens":c.inputTokens,"ai.usage.outputTokens":c.outputTokens,"ai.usage.totalTokens":c.totalTokens,"ai.usage.reasoningTokens":c.reasoningTokens,"ai.usage.cachedInputTokens":c.cachedInputTokens}}))}catch(b){a.error(b)}finally{D.end()}}}),O=function(){let a=[],b=null,c=!1,d=eQ(),e=()=>{c=!0,d.resolve(),a.forEach(a=>a.cancel()),a=[],null==b||b.close()},f=async()=>{if(c&&0===a.length){null==b||b.close();return}if(0===a.length)return d=eQ(),await d.promise,f();try{let{value:d,done:e}=await a[0].read();e?(a.shift(),a.length>0?await f():c&&(null==b||b.close())):null==b||b.enqueue(d)}catch(c){null==b||b.error(c),a.shift(),e()}};return{stream:new ReadableStream({start(a){b=a},pull:f,async cancel(){for(let b of a)await b.cancel();a=[],c=!0}}),addStream:b=>{if(c)throw Error("Cannot add inner stream: outer stream is closed");a.push(b.getReader()),d.resolve()},close:()=>{c=!0,d.resolve(),0===a.length&&(null==b||b.close())},terminate:e}}();this.addStream=O.addStream,this.closeStream=O.close;let P=O.stream;for(let a of(P=(P=function(a,b){return new ReadableStream({async start(c){let d=a.getReader();try{for(;;){let{done:a,value:b}=await d.read();if(a){c.close();break}c.enqueue(b)}}catch(a){await b({error:a,controller:c})}},cancel:b=>a.cancel(b)})}(P,({error:a,controller:b})=>{cg(a)&&(null==f?void 0:f.aborted)?(null==z||z({steps:K}),b.enqueue({type:"abort"}),b.close()):b.error(a)})).pipeThrough(new TransformStream({start(a){a.enqueue({type:"start"})}})),l))P=P.pipeThrough(a({tools:j,stopStream(){O.terminate()}}));this.baseStream=P.pipeThrough(function(a){let b;if(!a)return new TransformStream({transform(a,b){b.enqueue({part:a,partialOutput:void 0})}});let c="",d="",e="";function f({controller:a,partialOutput:c}){a.enqueue({part:{type:"text-delta",id:b,text:d},partialOutput:c}),d=""}return new TransformStream({async transform(g,h){if("finish-step"===g.type&&d.length>0&&f({controller:h}),"text-delta"!==g.type&&"text-start"!==g.type&&"text-end"!==g.type)return void h.enqueue({part:g,partialOutput:void 0});if(null==b)b=g.id;else if(g.id!==b)return void h.enqueue({part:g,partialOutput:void 0});if("text-start"===g.type)return void h.enqueue({part:g,partialOutput:void 0});if("text-end"===g.type){d.length>0&&f({controller:h}),h.enqueue({part:g,partialOutput:void 0});return}c+=g.text,d+=g.text;let i=await a.parsePartial({text:c});if(null!=i){let a=JSON.stringify(i.partial);a!==e&&(f({controller:h,partialOutput:i.partial}),e=a)}}})}(p)).pipeThrough(N);let{maxRetries:Q,retry:R}=function({maxRetries:a,abortSignal:b}){if(null!=a){if(!Number.isInteger(a))throw new dw({parameter:"maxRetries",value:a,message:"maxRetries must be an integer"});if(a<0)throw new dw({parameter:"maxRetries",value:a,message:"maxRetries must be >= 0"})}let c=null!=a?a:2;return{maxRetries:c,retry:(({maxRetries:a=2,initialDelayInMs:b=2e3,backoffFactor:c=2,abortSignal:d}={})=>async e=>ex(e,{maxRetries:a,delayInMs:b,backoffFactor:c,abortSignal:d}))({maxRetries:c,abortSignal:b})}}({maxRetries:e,abortSignal:f}),S=function({isEnabled:a=!1,tracer:b}={}){return a?b||dl.u.getTracer("ai"):ep}(b),T=function({maxOutputTokens:a,temperature:b,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,seed:g,stopSequences:h}){if(null!=a){if(!Number.isInteger(a))throw new dw({parameter:"maxOutputTokens",value:a,message:"maxOutputTokens must be an integer"});if(a<1)throw new dw({parameter:"maxOutputTokens",value:a,message:"maxOutputTokens must be >= 1"})}if(null!=b&&"number"!=typeof b)throw new dw({parameter:"temperature",value:b,message:"temperature must be a number"});if(null!=c&&"number"!=typeof c)throw new dw({parameter:"topP",value:c,message:"topP must be a number"});if(null!=d&&"number"!=typeof d)throw new dw({parameter:"topK",value:d,message:"topK must be a number"});if(null!=e&&"number"!=typeof e)throw new dw({parameter:"presencePenalty",value:e,message:"presencePenalty must be a number"});if(null!=f&&"number"!=typeof f)throw new dw({parameter:"frequencyPenalty",value:f,message:"frequencyPenalty must be a number"});if(null!=g&&!Number.isInteger(g))throw new dw({parameter:"seed",value:g,message:"seed must be an integer"});return{maxOutputTokens:a,temperature:b,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,stopSequences:h,seed:g}}(d),U=function({model:a,settings:b,telemetry:c,headers:d}){var e;return{"ai.model.provider":a.provider,"ai.model.id":a.modelId,...Object.entries(b).reduce((a,[b,c])=>(a[`ai.settings.${b}`]=c,a),{}),...Object.entries(null!=(e=null==c?void 0:c.metadata)?e:{}).reduce((a,[b,c])=>(a[`ai.telemetry.metadata.${b}`]=c,a),{}),...Object.entries(null!=d?d:{}).reduce((a,[b,c])=>(void 0!==c&&(a[`ai.request.headers.${b}`]=c),a),{})}}({model:a,telemetry:b,headers:c,settings:{...T,maxRetries:Q}}),V=this;es({name:"ai.streamText",attributes:eu({telemetry:b,attributes:{...eo({operationId:"ai.streamText",telemetry:b}),...U,"ai.prompt":{input:()=>JSON.stringify({system:g,prompt:h,messages:i})}}}),tracer:S,endWhenDone:!1,fn:async d=>{async function e({currentStep:d,responseMessages:l,usage:s}){var w,x,y,z,A;let D,E,F=V.includeRawChunks;C=new eR;let G=await en({system:g,prompt:h,messages:i}),H=[...G.messages,...l],I=await (null==r?void 0:r({model:a,steps:K,stepNumber:K.length,messages:H})),J=await d7({prompt:{system:null!=(w=null==I?void 0:I.system)?w:G.system,messages:null!=(x=null==I?void 0:I.messages)?x:H},supportedUrls:await a.supportedUrls}),L=d2(null!=(y=null==I?void 0:I.model)?y:a),{toolChoice:M,tools:N}=function({tools:a,toolChoice:b,activeTools:c}){return null!=a&&Object.keys(a).length>0?{tools:(null!=c?Object.entries(a).filter(([a])=>c.includes(a)):Object.entries(a)).map(([a,b])=>{let c=b.type;switch(c){case void 0:case"dynamic":case"function":return{type:"function",name:a,description:b.description,inputSchema:cD(b.inputSchema).jsonSchema,providerOptions:b.providerOptions};case"provider-defined":return{type:"provider-defined",name:a,id:b.id,args:b.args};default:throw Error(`Unsupported tool type: ${c}`)}}),toolChoice:null==b?{type:"auto"}:"string"==typeof b?{type:b}:{type:"tool",toolName:b.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:j,toolChoice:null!=(z=null==I?void 0:I.toolChoice)?z:k,activeTools:null!=(A=null==I?void 0:I.activeTools)?A:m}),{result:{stream:O,response:P,request:Q},doStreamSpan:W,startTimestampMs:X}=await R(()=>es({name:"ai.streamText.doStream",attributes:eu({telemetry:b,attributes:{...eo({operationId:"ai.streamText.doStream",telemetry:b}),...U,"ai.model.provider":L.provider,"ai.model.id":L.modelId,"ai.prompt.messages":{input:()=>JSON.stringify(J.map(a=>({...a,content:"string"==typeof a.content?a.content:a.content.map(a=>{var b;return"file"===a.type?{...a,data:a.data instanceof Uint8Array?"string"==typeof(b=a.data)?b:b instanceof ArrayBuffer?cH(new Uint8Array(b)):cH(b):a.data}:a})})))},"ai.prompt.tools":{input:()=>null==N?void 0:N.map(a=>JSON.stringify(a))},"ai.prompt.toolChoice":{input:()=>null!=M?JSON.stringify(M):void 0},"gen_ai.system":L.provider,"gen_ai.request.model":L.modelId,"gen_ai.request.frequency_penalty":T.frequencyPenalty,"gen_ai.request.max_tokens":T.maxOutputTokens,"gen_ai.request.presence_penalty":T.presencePenalty,"gen_ai.request.stop_sequences":T.stopSequences,"gen_ai.request.temperature":T.temperature,"gen_ai.request.top_k":T.topK,"gen_ai.request.top_p":T.topP}}),tracer:S,endWhenDone:!1,fn:async a=>({startTimestampMs:t(),doStreamSpan:a,result:await L.doStream({...T,tools:N,toolChoice:M,responseFormat:null==p?void 0:p.responseFormat,prompt:J,providerOptions:q,abortSignal:f,headers:c,includeRawChunks:F})})})),Y=function({tools:a,generatorStream:b,tracer:c,telemetry:d,system:e,messages:f,abortSignal:g,repairToolCall:h,experimental_context:i}){let j,k=null,l=new ReadableStream({start(a){k=a}}),m=new Set,n=new Map,o=!1;function p(){o&&0===m.size&&(null!=j&&k.enqueue(j),k.close())}let q=new TransformStream({async transform(b,l){let o=b.type;switch(o){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":l.enqueue(b);break;case"file":l.enqueue({type:"file",file:new ez({data:b.data,mediaType:b.mediaType})});break;case"finish":j={type:"finish",finishReason:b.finishReason,usage:b.usage,providerMetadata:b.providerMetadata};break;case"tool-call":try{let j=await eA({toolCall:b,tools:a,repairToolCall:h,system:e,messages:f});if(l.enqueue(j),j.invalid){k.enqueue({type:"tool-error",toolCallId:j.toolCallId,toolName:j.toolName,input:j.input,error:cf(j.error),dynamic:!0});break}let o=a[j.toolName];if(n.set(j.toolCallId,j.input),null!=o.onInputAvailable&&await o.onInputAvailable({input:j.input,toolCallId:j.toolCallId,messages:f,abortSignal:g,experimental_context:i}),null!=o.execute&&!0!==j.providerExecuted){let a=ce();m.add(a),es({name:"ai.toolCall",attributes:eu({telemetry:d,attributes:{...eo({operationId:"ai.toolCall",telemetry:d}),"ai.toolCall.name":j.toolName,"ai.toolCall.id":j.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(j.input)}}}),tracer:c,fn:async b=>{let c;try{c=await o.execute(j.input,{toolCallId:j.toolCallId,messages:f,abortSignal:g,experimental_context:i})}catch(c){et(b,c),k.enqueue({...j,type:"tool-error",error:c}),m.delete(a),p();return}k.enqueue({...j,type:"tool-result",output:c}),m.delete(a),p();try{b.setAttributes(eu({telemetry:d,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(c)}}}))}catch(a){}}})}}catch(a){k.enqueue({type:"error",error:a})}break;case"tool-result":{let a=b.toolName;b.isError?k.enqueue({type:"tool-error",toolCallId:b.toolCallId,toolName:a,input:n.get(b.toolCallId),providerExecuted:b.providerExecuted,error:b.result}):l.enqueue({type:"tool-result",toolCallId:b.toolCallId,toolName:a,input:n.get(b.toolCallId),output:b.result,providerExecuted:b.providerExecuted});break}default:throw Error(`Unhandled chunk type: ${o}`)}},flush(){o=!0,p()}});return new ReadableStream({start:async a=>Promise.all([b.pipeThrough(q).pipeTo(new WritableStream({write(b){a.enqueue(b)},close(){}})),l.pipeTo(new WritableStream({write(b){a.enqueue(b)},close(){a.close()}}))])})}({tools:j,generatorStream:O,tracer:S,telemetry:b,system:g,messages:H,repairToolCall:n,abortSignal:f,experimental_context:B}),Z=null!=Q?Q:{},$=[],_=[],aa={},ab="unknown",ac={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},ad=!0,ae={id:v(),timestamp:u(),modelId:a.modelId},af="";V.addStream(Y.pipeThrough(new TransformStream({async transform(a,b){var c,d,e,g;if("stream-start"===a.type){D=a.warnings;return}if(ad){let a=t()-X;ad=!1,W.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":a}),W.setAttributes({"ai.response.msToFirstChunk":a}),b.enqueue({type:"start-step",request:Z,warnings:null!=D?D:[]})}let h=a.type;switch(h){case"text-start":case"text-end":case"reasoning-start":case"reasoning-end":case"file":case"source":b.enqueue(a);break;case"text-delta":a.delta.length>0&&(b.enqueue({type:"text-delta",id:a.id,text:a.delta,providerMetadata:a.providerMetadata}),af+=a.delta);break;case"reasoning-delta":b.enqueue({type:"reasoning-delta",id:a.id,text:a.delta,providerMetadata:a.providerMetadata});break;case"tool-call":b.enqueue(a),$.push(a);break;case"tool-result":case"tool-error":b.enqueue(a),_.push(a);break;case"response-metadata":ae={id:null!=(c=a.id)?c:ae.id,timestamp:null!=(d=a.timestamp)?d:ae.timestamp,modelId:null!=(e=a.modelId)?e:ae.modelId};break;case"finish":{ac=a.usage,ab=a.finishReason,E=a.providerMetadata;let b=t()-X;W.addEvent("ai.stream.finish"),W.setAttributes({"ai.response.msToFinish":b,"ai.response.avgOutputTokensPerSecond":1e3*(null!=(g=ac.outputTokens)?g:0)/b});break}case"tool-input-start":{aa[a.id]=a.toolName;let c=null==j?void 0:j[a.toolName];(null==c?void 0:c.onInputStart)!=null&&await c.onInputStart({toolCallId:a.id,messages:H,abortSignal:f,experimental_context:B}),b.enqueue({...a,dynamic:(null==c?void 0:c.type)==="dynamic"});break}case"tool-input-end":delete aa[a.id],b.enqueue(a);break;case"tool-input-delta":{let c=aa[a.id],d=null==j?void 0:j[c];(null==d?void 0:d.onInputDelta)!=null&&await d.onInputDelta({inputTextDelta:a.delta,toolCallId:a.id,messages:H,abortSignal:f,experimental_context:B}),b.enqueue(a);break}case"error":b.enqueue(a),ab="error";break;case"raw":F&&b.enqueue(a);break;default:throw Error(`Unknown chunk type: ${h}`)}},async flush(a){var c;let f=$.length>0?JSON.stringify($):void 0;try{W.setAttributes(eu({telemetry:b,attributes:{"ai.response.finishReason":ab,"ai.response.text":{output:()=>af},"ai.response.toolCalls":{output:()=>f},"ai.response.id":ae.id,"ai.response.model":ae.modelId,"ai.response.timestamp":ae.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(E),"ai.usage.inputTokens":ac.inputTokens,"ai.usage.outputTokens":ac.outputTokens,"ai.usage.totalTokens":ac.totalTokens,"ai.usage.reasoningTokens":ac.reasoningTokens,"ai.usage.cachedInputTokens":ac.cachedInputTokens,"gen_ai.response.finish_reasons":[ab],"gen_ai.response.id":ae.id,"gen_ai.response.model":ae.modelId,"gen_ai.usage.input_tokens":ac.inputTokens,"gen_ai.usage.output_tokens":ac.outputTokens}}))}catch(a){}finally{W.end()}a.enqueue({type:"finish-step",finishReason:ab,usage:ac,providerMetadata:E,response:{...ae,headers:null==P?void 0:P.headers}});let g=(c=ac,{inputTokens:ev(s.inputTokens,c.inputTokens),outputTokens:ev(s.outputTokens,c.outputTokens),totalTokens:ev(s.totalTokens,c.totalTokens),reasoningTokens:ev(s.reasoningTokens,c.reasoningTokens),cachedInputTokens:ev(s.cachedInputTokens,c.cachedInputTokens)});await C.promise;let h=$.filter(a=>!0!==a.providerExecuted),i=_.filter(a=>!0!==a.providerExecuted);if(h.length>0&&i.length===h.length&&!await eD({stopConditions:o,steps:K})){l.push(...eG({content:K[K.length-1].content,tools:j}));try{await e({currentStep:d+1,responseMessages:l,usage:g})}catch(b){a.enqueue({type:"error",error:b}),V.closeStream()}}else a.enqueue({type:"finish",finishReason:ab,totalUsage:g}),V.closeStream()}})))}D=d,await e({currentStep:0,responseMessages:[],usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(a=>{V.addStream(new ReadableStream({start(b){b.enqueue({type:"error",error:a}),b.close()}})),V.closeStream()})}get steps(){return this._steps.promise}get finalStep(){return this.steps.then(a=>a[a.length-1])}get content(){return this.finalStep.then(a=>a.content)}get warnings(){return this.finalStep.then(a=>a.warnings)}get providerMetadata(){return this.finalStep.then(a=>a.providerMetadata)}get text(){return this.finalStep.then(a=>a.text)}get reasoningText(){return this.finalStep.then(a=>a.reasoningText)}get reasoning(){return this.finalStep.then(a=>a.reasoning)}get sources(){return this.finalStep.then(a=>a.sources)}get files(){return this.finalStep.then(a=>a.files)}get toolCalls(){return this.finalStep.then(a=>a.toolCalls)}get staticToolCalls(){return this.finalStep.then(a=>a.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(a=>a.dynamicToolCalls)}get toolResults(){return this.finalStep.then(a=>a.toolResults)}get staticToolResults(){return this.finalStep.then(a=>a.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(a=>a.dynamicToolResults)}get usage(){return this.finalStep.then(a=>a.usage)}get request(){return this.finalStep.then(a=>a.request)}get response(){return this.finalStep.then(a=>a.response)}get totalUsage(){return this._totalUsage.promise}get finishReason(){return this._finishReason.promise}teeStream(){let[a,b]=this.baseStream.tee();return this.baseStream=b,a}get textStream(){return eO(this.teeStream().pipeThrough(new TransformStream({transform({part:a},b){"text-delta"===a.type&&b.enqueue(a.text)}})))}get fullStream(){return eO(this.teeStream().pipeThrough(new TransformStream({transform({part:a},b){b.enqueue(a)}})))}async consumeStream(a){var b;try{await eP({stream:this.fullStream,onError:null==a?void 0:a.onError})}catch(c){null==(b=null==a?void 0:a.onError)||b.call(a,c)}}get experimental_partialOutputStream(){if(null==this.output)throw new ds;return eO(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:a},b){null!=a&&b.enqueue(a)}})))}toUIMessageStream({originalMessages:a,generateMessageId:b,onFinish:c,messageMetadata:d,sendReasoning:e=!0,sendSources:f=!1,sendStart:g=!0,sendFinish:h=!0,onError:i=ap}={}){let j=null!=b?function({originalMessages:a,responseMessageId:b}){if(null==a)return;let c=a[a.length-1];return(null==c?void 0:c.role)==="assistant"?c.id:"function"==typeof b?b():b}({originalMessages:a,responseMessageId:b}):void 0,k={},l=a=>{var b,c;let d=k[a];return(null==(c=null==(b=this.tools)?void 0:b[d])?void 0:c.type)==="dynamic"||void 0};return eO(function({messageId:a,originalMessages:b=[],onFinish:c,onError:d,stream:e}){let f=null==b?void 0:b[b.length-1];(null==f?void 0:f.role)!=="assistant"?f=void 0:a=f.id;let g=!1,h=e.pipeThrough(new TransformStream({transform(b,c){"start"===b.type&&null==b.messageId&&null!=a&&(b.messageId=a),"abort"===b.type&&(g=!0),c.enqueue(b)}}));if(null==c)return h;let i=function({lastMessage:a,messageId:b}){return{message:(null==a?void 0:a.role)==="assistant"?a:{id:b,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:f?structuredClone(f):void 0,messageId:null!=a?a:""});return(function({stream:a,messageMetadataSchema:b,dataPartSchemas:c,runUpdateMessageJob:d,onError:e,onToolCall:f,onData:g}){return a.pipeThrough(new TransformStream({async transform(a,h){await d(async({state:d,write:i})=>{var j,k,l,m;function n(a){let b=d.message.parts.filter(eM).find(b=>b.toolCallId===a);if(null==b)throw Error("tool-output-error must be preceded by a tool-input-available");return b}function o(a){let b=d.message.parts.filter(a=>"dynamic-tool"===a.type).find(b=>b.toolCallId===a);if(null==b)throw Error("tool-output-error must be preceded by a tool-input-available");return b}function p(a){var b;let c=d.message.parts.find(b=>eM(b)&&b.toolCallId===a.toolCallId);null!=c?(c.state=a.state,c.input=a.input,c.output=a.output,c.errorText=a.errorText,c.rawInput=a.rawInput,c.providerExecuted=null!=(b=a.providerExecuted)?b:c.providerExecuted,null!=a.providerMetadata&&"input-available"===c.state&&(c.callProviderMetadata=a.providerMetadata)):d.message.parts.push({type:`tool-${a.toolName}`,toolCallId:a.toolCallId,state:a.state,input:a.input,output:a.output,rawInput:a.rawInput,errorText:a.errorText,providerExecuted:a.providerExecuted,...null!=a.providerMetadata?{callProviderMetadata:a.providerMetadata}:{}})}function q(a){var b;let c=d.message.parts.find(b=>"dynamic-tool"===b.type&&b.toolCallId===a.toolCallId);null!=c?(c.state=a.state,c.toolName=a.toolName,c.input=a.input,c.output=a.output,c.errorText=a.errorText,c.rawInput=null!=(b=a.rawInput)?b:c.rawInput,null!=a.providerMetadata&&"input-available"===c.state&&(c.callProviderMetadata=a.providerMetadata)):d.message.parts.push({type:"dynamic-tool",toolName:a.toolName,toolCallId:a.toolCallId,state:a.state,input:a.input,output:a.output,errorText:a.errorText,...null!=a.providerMetadata?{callProviderMetadata:a.providerMetadata}:{}})}async function r(a){if(null!=a){let c=null!=d.message.metadata?function a(b,c){if(void 0===b&&void 0===c)return;if(void 0===b)return c;if(void 0===c)return b;let d={...b};for(let e in c)if(Object.prototype.hasOwnProperty.call(c,e)){let f=c[e];if(void 0===f)continue;let g=e in b?b[e]:void 0,h=null!==f&&"object"==typeof f&&!Array.isArray(f)&&!(f instanceof Date)&&!(f instanceof RegExp),i=null!=g&&"object"==typeof g&&!Array.isArray(g)&&!(g instanceof Date)&&!(g instanceof RegExp);h&&i?d[e]=a(g,f):d[e]=f}return d}(d.message.metadata,a):a;null!=b&&await cr({value:c,schema:b}),d.message.metadata=c}}switch(a.type){case"text-start":{let b={type:"text",text:"",providerMetadata:a.providerMetadata,state:"streaming"};d.activeTextParts[a.id]=b,d.message.parts.push(b),i();break}case"text-delta":{let b=d.activeTextParts[a.id];b.text+=a.delta,b.providerMetadata=null!=(j=a.providerMetadata)?j:b.providerMetadata,i();break}case"text-end":{let b=d.activeTextParts[a.id];b.state="done",b.providerMetadata=null!=(k=a.providerMetadata)?k:b.providerMetadata,delete d.activeTextParts[a.id],i();break}case"reasoning-start":{let b={type:"reasoning",text:"",providerMetadata:a.providerMetadata,state:"streaming"};d.activeReasoningParts[a.id]=b,d.message.parts.push(b),i();break}case"reasoning-delta":{let b=d.activeReasoningParts[a.id];b.text+=a.delta,b.providerMetadata=null!=(l=a.providerMetadata)?l:b.providerMetadata,i();break}case"reasoning-end":{let b=d.activeReasoningParts[a.id];b.providerMetadata=null!=(m=a.providerMetadata)?m:b.providerMetadata,b.state="done",delete d.activeReasoningParts[a.id],i();break}case"file":d.message.parts.push({type:"file",mediaType:a.mediaType,url:a.url}),i();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:a.sourceId,url:a.url,title:a.title,providerMetadata:a.providerMetadata}),i();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:a.sourceId,mediaType:a.mediaType,title:a.title,filename:a.filename,providerMetadata:a.providerMetadata}),i();break;case"tool-input-start":{let b=d.message.parts.filter(eM);d.partialToolCalls[a.toolCallId]={text:"",toolName:a.toolName,index:b.length,dynamic:a.dynamic},a.dynamic?q({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-streaming",input:void 0}):p({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-streaming",input:void 0,providerExecuted:a.providerExecuted}),i();break}case"tool-input-delta":{let b=d.partialToolCalls[a.toolCallId];b.text+=a.inputTextDelta;let{value:c}=await eL(b.text);b.dynamic?q({toolCallId:a.toolCallId,toolName:b.toolName,state:"input-streaming",input:c}):p({toolCallId:a.toolCallId,toolName:b.toolName,state:"input-streaming",input:c}),i();break}case"tool-input-available":a.dynamic?q({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-available",input:a.input,providerMetadata:a.providerMetadata}):p({toolCallId:a.toolCallId,toolName:a.toolName,state:"input-available",input:a.input,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}),i(),f&&!a.providerExecuted&&await f({toolCall:a});break;case"tool-input-error":a.dynamic?q({toolCallId:a.toolCallId,toolName:a.toolName,state:"output-error",input:a.input,errorText:a.errorText,providerMetadata:a.providerMetadata}):p({toolCallId:a.toolCallId,toolName:a.toolName,state:"output-error",input:void 0,rawInput:a.input,errorText:a.errorText,providerExecuted:a.providerExecuted,providerMetadata:a.providerMetadata}),i();break;case"tool-output-available":if(a.dynamic){let b=o(a.toolCallId);q({toolCallId:a.toolCallId,toolName:b.toolName,state:"output-available",input:b.input,output:a.output})}else{let b=n(a.toolCallId);p({toolCallId:a.toolCallId,toolName:eN(b),state:"output-available",input:b.input,output:a.output,providerExecuted:a.providerExecuted})}i();break;case"tool-output-error":if(a.dynamic){let b=o(a.toolCallId);q({toolCallId:a.toolCallId,toolName:b.toolName,state:"output-error",input:b.input,errorText:a.errorText})}else{let b=n(a.toolCallId);p({toolCallId:a.toolCallId,toolName:eN(b),state:"output-error",input:b.input,rawInput:b.rawInput,errorText:a.errorText})}i();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":null!=a.messageId&&(d.message.id=a.messageId),await r(a.messageMetadata),(null!=a.messageId||null!=a.messageMetadata)&&i();break;case"finish":case"message-metadata":await r(a.messageMetadata),null!=a.messageMetadata&&i();break;case"error":null==e||e(Error(a.errorText));break;default:if(a.type.startsWith("data-")){if((null==c?void 0:c[a.type])!=null&&await cr({value:a.data,schema:c[a.type]}),a.transient){null==g||g(a);break}let b=null!=a.id?d.message.parts.find(b=>a.type===b.type&&a.id===b.id):void 0;null!=b?b.data=a.data:d.message.parts.push(a),null==g||g(a),i()}}h.enqueue(a)})}}))})({stream:h,runUpdateMessageJob:async a=>{await a({state:i,write:()=>{}})},onError:d}).pipeThrough(new TransformStream({transform(a,b){b.enqueue(a)},async flush(){let a=i.message.id===(null==f?void 0:f.id);await c({isAborted:g,isContinuation:a,responseMessage:i.message,messages:[...a?b.slice(0,-1):b,i.message]})}}))}({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(a,b)=>{let c=null==d?void 0:d({part:a}),m=a.type;switch(m){case"text-start":b.enqueue({type:"text-start",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"text-delta":b.enqueue({type:"text-delta",id:a.id,delta:a.text,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"text-end":b.enqueue({type:"text-end",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"reasoning-start":b.enqueue({type:"reasoning-start",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"reasoning-delta":e&&b.enqueue({type:"reasoning-delta",id:a.id,delta:a.text,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"reasoning-end":b.enqueue({type:"reasoning-end",id:a.id,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"file":b.enqueue({type:"file",mediaType:a.file.mediaType,url:`data:${a.file.mediaType};base64,${a.file.base64}`});break;case"source":f&&"url"===a.sourceType&&b.enqueue({type:"source-url",sourceId:a.id,url:a.url,title:a.title,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}}),f&&"document"===a.sourceType&&b.enqueue({type:"source-document",sourceId:a.id,mediaType:a.mediaType,title:a.title,filename:a.filename,...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"tool-input-start":{k[a.id]=a.toolName;let c=l(a.id);b.enqueue({type:"tool-input-start",toolCallId:a.id,toolName:a.toolName,...null!=a.providerExecuted?{providerExecuted:a.providerExecuted}:{},...null!=c?{dynamic:c}:{}});break}case"tool-input-delta":b.enqueue({type:"tool-input-delta",toolCallId:a.id,inputTextDelta:a.delta});break;case"tool-call":{k[a.toolCallId]=a.toolName;let c=l(a.toolCallId);a.invalid?b.enqueue({type:"tool-input-error",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,...null!=a.providerExecuted?{providerExecuted:a.providerExecuted}:{},...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{},...null!=c?{dynamic:c}:{},errorText:i(a.error)}):b.enqueue({type:"tool-input-available",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,...null!=a.providerExecuted?{providerExecuted:a.providerExecuted}:{},...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{},...null!=c?{dynamic:c}:{}});break}case"tool-result":{let c=l(a.toolCallId);b.enqueue({type:"tool-output-available",toolCallId:a.toolCallId,output:a.output,...null!=a.providerExecuted?{providerExecuted:a.providerExecuted}:{},...null!=c?{dynamic:c}:{}});break}case"tool-error":{let c=l(a.toolCallId);b.enqueue({type:"tool-output-error",toolCallId:a.toolCallId,errorText:i(a.error),...null!=a.providerExecuted?{providerExecuted:a.providerExecuted}:{},...null!=c?{dynamic:c}:{}});break}case"error":b.enqueue({type:"error",errorText:i(a.error)});break;case"start-step":b.enqueue({type:"start-step"});break;case"finish-step":b.enqueue({type:"finish-step"});break;case"start":g&&b.enqueue({type:"start",...null!=c?{messageMetadata:c}:{},...null!=j?{messageId:j}:{}});break;case"finish":h&&b.enqueue({type:"finish",...null!=c?{messageMetadata:c}:{}});break;case"abort":b.enqueue(a);break;case"tool-input-end":case"raw":break;default:throw Error(`Unknown chunk type: ${m}`)}null!=c&&"start"!==m&&"finish"!==m&&b.enqueue({type:"message-metadata",messageMetadata:c})}})),messageId:null!=j?j:null==b?void 0:b(),originalMessages:a,onFinish:c,onError:i}))}pipeUIMessageStreamToResponse(a,{originalMessages:b,generateMessageId:c,onFinish:d,messageMetadata:e,sendReasoning:f,sendSources:g,sendFinish:h,sendStart:i,onError:j,...k}={}){!function({response:a,status:b,statusText:c,headers:d,stream:e,consumeSseStream:f}){let g=e.pipeThrough(new eJ);if(f){let[a,b]=g.tee();g=a,f({stream:b})}eI({response:a,status:b,statusText:c,headers:Object.fromEntries(eH(d,eK).entries()),stream:g.pipeThrough(new TextEncoderStream)})}({response:a,stream:this.toUIMessageStream({originalMessages:b,generateMessageId:c,onFinish:d,messageMetadata:e,sendReasoning:f,sendSources:g,sendFinish:h,sendStart:i,onError:j}),...k})}pipeTextStreamToResponse(a,b){!function({response:a,status:b,statusText:c,headers:d,textStream:e}){eI({response:a,status:b,statusText:c,headers:Object.fromEntries(eH(d,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:e.pipeThrough(new TextEncoderStream)})}({response:a,textStream:this.textStream,...b})}toUIMessageStreamResponse({originalMessages:a,generateMessageId:b,onFinish:c,messageMetadata:d,sendReasoning:e,sendSources:f,sendFinish:g,sendStart:h,onError:i,...j}={}){return function({status:a,statusText:b,headers:c,stream:d,consumeSseStream:e}){let f=d.pipeThrough(new eJ);if(e){let[a,b]=f.tee();f=a,e({stream:b})}return new Response(f.pipeThrough(new TextEncoderStream),{status:a,statusText:b,headers:eH(c,eK)})}({stream:this.toUIMessageStream({originalMessages:a,generateMessageId:b,onFinish:c,messageMetadata:d,sendReasoning:e,sendSources:f,sendFinish:g,sendStart:h,onError:i}),...j})}toTextStreamResponse(a){return function({status:a,statusText:b,headers:c,textStream:d}){return new Response(d.pipeThrough(new TextEncoderStream),{status:null!=a?a:200,statusText:b,headers:eH(c,{"content-type":"text/plain; charset=utf-8"})})}({textStream:this.textStream,...a})}};cd({prefix:"aiobj",size:24}),cd({prefix:"aiobj",size:24}),((a,b)=>{for(var c in b)dn(a,c,{get:b[c],enumerable:!0})})({},{object:()=>eV,text:()=>eU});var eU=()=>({type:"text",responseFormat:{type:"text"},parsePartial:async({text:a})=>({partial:a}),parseOutput:async({text:a})=>a}),eV=({schema:a})=>{let b=cD(a);return{type:"object",responseFormat:{type:"json",schema:b.jsonSchema},async parsePartial({text:a}){let b=await eL(a);switch(b.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:b.value};default:{let a=b.state;throw Error(`Unsupported parse state: ${a}`)}}},async parseOutput({text:a},c){let d=await cu({text:a});if(!d.success)throw new dE({message:"No object generated: could not parse the response.",cause:d.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});let e=await cs({value:d.value,schema:b});if(!e.success)throw new dE({message:"No object generated: response did not match schema.",cause:e.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});return e.value}}},eW=(Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),bl._H({name:bl.Yj(),version:bl.Yj()})),eX=bl._H({_meta:bl.lq(bl.Ik({}).loose())}),eY=bl.Ik({method:bl.Yj(),params:bl.lq(eX)}),eZ=bl._H({experimental:bl.lq(bl.Ik({}).loose()),logging:bl.lq(bl.Ik({}).loose()),prompts:bl.lq(bl._H({listChanged:bl.lq(bl.zM())})),resources:bl.lq(bl._H({subscribe:bl.lq(bl.zM()),listChanged:bl.lq(bl.zM())})),tools:bl.lq(bl._H({listChanged:bl.lq(bl.zM())}))});eX.extend({protocolVersion:bl.Yj(),capabilities:eZ,serverInfo:eW,instructions:bl.lq(bl.Yj())});var e$=eX.extend({nextCursor:bl.lq(bl.Yj())}),e_=bl.Ik({name:bl.Yj(),description:bl.lq(bl.Yj()),inputSchema:bl.Ik({type:bl.eu("object"),properties:bl.lq(bl.Ik({}).loose())}).loose()}).loose();e$.extend({tools:bl.YO(e_)});var e0=bl.Ik({type:bl.eu("text"),text:bl.Yj()}).loose(),e1=bl.Ik({type:bl.eu("image"),data:bl.K3(),mimeType:bl.Yj()}).loose(),e2=bl.Ik({uri:bl.Yj(),mimeType:bl.lq(bl.Yj())}).loose(),e3=e2.extend({text:bl.Yj()}),e4=e2.extend({blob:bl.K3()}),e5=bl.Ik({type:bl.eu("resource"),resource:bl.KC([e3,e4])}).loose();eX.extend({content:bl.YO(bl.KC([e0,e1,e5])),isError:bl.zM().default(!1).optional()}).or(eX.extend({toolResult:bl.L5()}));var e6=bl.Ik({jsonrpc:bl.eu("2.0"),id:bl.KC([bl.Yj(),bl.ai().int()])}).merge(eY).strict(),e7=bl.Ik({jsonrpc:bl.eu("2.0"),id:bl.KC([bl.Yj(),bl.ai().int()]),result:eX}).strict(),e8=bl.Ik({jsonrpc:bl.eu("2.0"),id:bl.KC([bl.Yj(),bl.ai().int()]),error:bl.Ik({code:bl.ai().int(),message:bl.Yj(),data:bl.lq(bl.L5())})}).strict(),e9=bl.Ik({jsonrpc:bl.eu("2.0")}).merge(bl.Ik({method:bl.Yj(),params:bl.lq(eX)})).strict();bl.KC([e6,e9,e7,e8]);var fa=c(70377),fb=c(46057),fc=c(65389);async function fd(a){let b;if(!await fa.j.api.getSession({headers:await (0,fb.b3)()}))return fc.NextResponse.json({error:"Unauthorized: Authentication required"},{status:401});try{if(b=(await a.json()).messages,!Array.isArray(b))throw Error("Invalid messages format")}catch{return fc.NextResponse.json({error:"Bad Request: Invalid request body"},{status:400})}try{return(function({model:a,tools:b,toolChoice:c,system:d,prompt:e,messages:f,maxRetries:g,abortSignal:h,headers:i,stopWhen:j=function(a){return({steps:a})=>1===a.length}(0),experimental_output:k,experimental_telemetry:l,prepareStep:m,providerOptions:n,experimental_activeTools:o,activeTools:p=o,experimental_repairToolCall:q,experimental_transform:r,includeRawChunks:s=!1,onChunk:t,onError:u=({error:a})=>{console.error(a)},onFinish:v,onAbort:w,onStepFinish:x,experimental_context:y,_internal:{now:z=function(){var a,b;return null!=(b=null==(a=null==globalThis?void 0:globalThis.performance)?void 0:a.now())?b:Date.now()},generateId:A=eS,currentDate:B=()=>new Date}={},...C}){return new eT({model:d2(a),telemetry:l,headers:i,settings:C,maxRetries:g,abortSignal:h,system:d,prompt:e,messages:f,tools:b,toolChoice:c,transforms:ew(r),activeTools:p,repairToolCall:q,stopConditions:ew(j),output:k,providerOptions:n,prepareStep:m,includeRawChunks:s,onChunk:t,onError:u,onFinish:v,onAbort:w,onStepFinish:x,now:z,currentDate:B,generateId:A,experimental_context:y})})({model:bM(process.env.GEMINI_MODEL||"gemini-2.5-flash"),messages:function(a,b){let c=[];for(let d of a)switch(d.role){case"system":{let a=d.parts.filter(a=>"text"===a.type),b=a.reduce((a,b)=>null!=b.providerMetadata?{...a,...b.providerMetadata}:a,{});c.push({role:"system",content:a.map(a=>a.text).join(""),...Object.keys(b).length>0?{providerOptions:b}:{}});break}case"user":c.push({role:"user",content:d.parts.filter(a=>"text"===a.type||"file"===a.type).map(a=>{switch(a.type){case"text":return{type:"text",text:a.text};case"file":return{type:"file",mediaType:a.mediaType,filename:a.filename,data:a.url};default:return a}})});break;case"assistant":if(null!=d.parts){let a=function(){var a,f;if(0===e.length)return;let g=[];for(let b of e)if("text"===b.type)g.push({type:"text",text:b.text,...null!=b.providerMetadata?{providerOptions:b.providerMetadata}:{}});else if("file"===b.type)g.push({type:"file",mediaType:b.mediaType,filename:b.filename,data:b.url});else if("reasoning"===b.type)g.push({type:"reasoning",text:b.text,providerOptions:b.providerMetadata});else if("dynamic-tool"===b.type){let a=b.toolName;if("input-streaming"===b.state)throw new dV({originalMessage:d,message:`incomplete tool input is not supported: ${b.toolCallId}`});g.push({type:"tool-call",toolCallId:b.toolCallId,toolName:a,input:b.input,...null!=b.callProviderMetadata?{providerOptions:b.callProviderMetadata}:{}})}else if(eM(b)){let c=eN(b);if("input-streaming"===b.state)throw new dV({originalMessage:d,message:`incomplete tool input is not supported: ${b.toolCallId}`});g.push({type:"tool-call",toolCallId:b.toolCallId,toolName:c,input:"output-error"===b.state?null!=(a=b.input)?a:b.rawInput:b.input,providerExecuted:b.providerExecuted,...null!=b.callProviderMetadata?{providerOptions:b.callProviderMetadata}:{}}),!0===b.providerExecuted&&("output-available"===b.state||"output-error"===b.state)&&g.push({type:"tool-result",toolCallId:b.toolCallId,toolName:c,output:eE({output:"output-error"===b.state?b.errorText:b.output,tool:(f=void 0,void 0),errorMode:"output-error"===b.state?"json":"none"})})}else throw Error(`Unsupported part: ${b}`);c.push({role:"assistant",content:g});let h=e.filter(a=>eM(a)&&!0!==a.providerExecuted||"dynamic-tool"===a.type);h.length>0&&c.push({role:"tool",content:h.map(a=>{var c;switch(a.state){case"output-error":case"output-available":{let d="dynamic-tool"===a.type?a.toolName:eN(a);return{type:"tool-result",toolCallId:a.toolCallId,toolName:d,output:eE({output:"output-error"===a.state?a.errorText:a.output,tool:null==(c=null==b?void 0:b.tools)?void 0:c[d],errorMode:"output-error"===a.state?"text":"none"})}}default:throw new dV({originalMessage:d,message:`Unsupported tool part state: ${a.state}`})}})}),e=[]},e=[];for(let b of d.parts)"text"===b.type||"reasoning"===b.type||"file"===b.type||"dynamic-tool"===b.type||eM(b)?e.push(b):"step-start"===b.type&&a();a()}break;default:{let a=d.role;throw new dV({originalMessage:d,message:`Unsupported role: ${a}`})}}return c}(b)}).toUIMessageStreamResponse()}catch(a){return console.error("Chat API error:",a),fc.NextResponse.json({error:"Internal Server Error"},{status:500})}}let fe=new P.AppRouteRouteModule({definition:{kind:Q.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},distDir:".next",projectDir:"",resolvedPagePath:"/home/gi/Documents/1_Projects/afarsemon/afarsemon/apps/www/src/app/api/chat/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:ff,workUnitAsyncStorage:fg,serverHooks:fh}=fe;function fi(){return(0,R.patchFetch)({workAsyncStorage:ff,workUnitAsyncStorage:fg})}async function fj(a,b,c){var d;let e="/api/chat/route";"/index"===e&&(e="/");let f=await fe.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o}=f,p=(0,U.normalizeAppPath)(e),q=!!(k.dynamicRoutes[p]||k.routes[o]);if(q&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[p];if(b&&!1===b.fallback&&!a)throw new ab.NoFallbackError}let r=null;!q||fe.isDev||j||(r="/index"===(r=o)?"/":r);let s=!0===fe.isDev||!q,t=q&&!s,u=a.method||"GET",v=(0,T.getTracer)(),w=v.getActiveScopeSpan(),x={params:h,prerenderManifest:k,renderOpts:{experimental:{dynamicIO:!!i.experimental.dynamicIO,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:s,incrementalCache:(0,S.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:t,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>fe.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},y=new V.NodeNextRequest(a),z=new V.NodeNextResponse(b),A=W.NextRequestAdapter.fromNodeNextRequest(y,(0,W.signalFromNodeResponse)(b));try{let d=async c=>fe.handle(A,x).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=v.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==X.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${u} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${u} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,S.getRequestMeta)(a,"minimalMode")&&m&&n&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=x.renderOpts.fetchMetrics;let h=x.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=x.renderOpts.collectedTags;if(!q)return await (0,Z.I)(y,z,e,x.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,$.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[aa.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==x.renderOpts.collectedRevalidate&&!(x.renderOpts.collectedRevalidate>=aa.INFINITE_CACHE)&&x.renderOpts.collectedRevalidate,d=void 0===x.renderOpts.collectedExpire||x.renderOpts.collectedExpire>=aa.INFINITE_CACHE?void 0:x.renderOpts.collectedExpire;return{value:{kind:ac.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await fe.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,Y.c)({isRevalidate:t,isOnDemandRevalidate:m})},l),b}},p=await fe.handleResponse({req:a,nextConfig:i,cacheKey:r,routeKind:Q.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:o,waitUntil:c.waitUntil});if(!q)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==ac.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,S.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let s=(0,$.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,S.getRequestMeta)(a,"minimalMode")&&q||s.delete(aa.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||s.get("Cache-Control")||s.set("Cache-Control",(0,_.getCacheControlHeader)(p.cacheControl)),await (0,Z.I)(y,z,new Response(p.value.body,{headers:s,status:p.value.status||200})),null};w?await f(w):await v.withPropagatedContext(a.headers,()=>v.trace(X.BaseServerSpan.handleRequest,{spanName:`${u} ${a.url}`,kind:T.SpanKind.SERVER,attributes:{"http.method":u,"http.target":a.url}},f))}catch(b){if(w||b instanceof ab.NoFallbackError||await fe.onRequestError(a,b,{routerKind:"App Router",routePath:p,routeType:"route",revalidateReason:(0,Y.c)({isRevalidate:t,isOnDemandRevalidate:m})}),q)throw b;return await (0,Z.I)(y,z,new Response(null,{status:500})),null}}},44708:a=>{"use strict";a.exports=require("node:https")},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49249:(a,b,c)=>{"use strict";c.r(b),c.d(b,{db:()=>i});var d=c(6746),e=c(58586),f=c(77396);let g=(0,c(88810).Lk)(),h=(0,e.A)(g.POSTGRES_URL),i=(0,d.f)(h,{schema:f})},55511:a=>{"use strict";a.exports=require("crypto")},57975:a=>{"use strict";a.exports=require("node:util")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69544:()=>{},70377:(a,b,c)=>{"use strict";c.d(b,{j:()=>j});var d=c(94936),e=c(98238),f=c(36197),g=c(49249),h=c(77396);let i=(0,c(88810).Lk)(),j=(0,d.li)({database:(0,e.y)(g.db,{provider:"pg",schema:{...h}}),baseURL:i.BETTER_AUTH_URL||i.NEXT_PUBLIC_APP_URL||"http://localhost:3000",socialProviders:{google:{clientId:i.GOOGLE_CLIENT_ID,clientSecret:i.GOOGLE_CLIENT_SECRET}},emailAndPassword:{enabled:!0,requireEmailVerification:!1,minPasswordLength:6,maxPasswordLength:128,autoSignIn:!0,sendResetPassword:async({user:a,url:b})=>{console.log(`Password reset requested for ${a.email}. Reset URL: ${b}`)},resetPasswordTokenExpiresIn:3600},emailVerification:{sendVerificationEmail:async({user:a,url:b})=>{console.log(`Email verification requested for ${a.email}. Verification URL: ${b}`)},sendOnSignUp:!0,autoSignInAfterVerification:!0,expiresIn:3600},advanced:{useSecureCookies:!0,disableCSRFCheck:!1,cookiePrefix:"__Host-",defaultCookieAttributes:{httpOnly:!0,secure:!0,sameSite:"lax"},ipAddress:{disableIpTracking:!1}},session:{expiresIn:604800,updateAge:86400,cookieCache:{enabled:!0,maxAge:300}},trustedOrigins:i.NEXT_PUBLIC_APP_URL?[i.NEXT_PUBLIC_APP_URL]:["http://localhost:3000"],plugins:[(0,f.d)()]})},74998:a=>{"use strict";a.exports=require("perf_hooks")},77396:(a,b,c)=>{"use strict";c.r(b),c.d(b,{account:()=>j,session:()=>i,user:()=>h,verification:()=>k});var d=c(9633),e=c(35447),f=c(310),g=c(96406);let h=(0,d.cJ)("user",{id:(0,e.Qq)("id").primaryKey(),name:(0,e.Qq)("name").notNull(),email:(0,e.Qq)("email").notNull().unique(),emailVerified:(0,f.zM)("emailVerified"),image:(0,e.Qq)("image"),createdAt:(0,g.vE)("createdAt").notNull().defaultNow(),updatedAt:(0,g.vE)("updatedAt").notNull().defaultNow()}),i=(0,d.cJ)("session",{id:(0,e.Qq)("id").primaryKey(),expiresAt:(0,g.vE)("expiresAt").notNull(),token:(0,e.Qq)("token").notNull().unique(),createdAt:(0,g.vE)("createdAt").notNull().defaultNow(),updatedAt:(0,g.vE)("updatedAt").notNull().defaultNow(),ipAddress:(0,e.Qq)("ipAddress"),userAgent:(0,e.Qq)("userAgent"),userId:(0,e.Qq)("userId").notNull().references(()=>h.id,{onDelete:"cascade"})}),j=(0,d.cJ)("account",{id:(0,e.Qq)("id").primaryKey(),accountId:(0,e.Qq)("accountId").notNull(),providerId:(0,e.Qq)("providerId").notNull(),userId:(0,e.Qq)("userId").notNull().references(()=>h.id,{onDelete:"cascade"}),accessToken:(0,e.Qq)("accessToken"),refreshToken:(0,e.Qq)("refreshToken"),idToken:(0,e.Qq)("idToken"),accessTokenExpiresAt:(0,g.vE)("accessTokenExpiresAt"),refreshTokenExpiresAt:(0,g.vE)("refreshTokenExpiresAt"),scope:(0,e.Qq)("scope"),password:(0,e.Qq)("password"),createdAt:(0,g.vE)("createdAt").notNull().defaultNow(),updatedAt:(0,g.vE)("updatedAt").notNull().defaultNow()}),k=(0,d.cJ)("verification",{id:(0,e.Qq)("id").primaryKey(),identifier:(0,e.Qq)("identifier").notNull(),value:(0,e.Qq)("value").notNull(),expiresAt:(0,g.vE)("expiresAt").notNull(),createdAt:(0,g.vE)("createdAt").defaultNow(),updatedAt:(0,g.vE)("updatedAt").defaultNow()})},77598:a=>{"use strict";a.exports=require("node:crypto")},78474:a=>{"use strict";a.exports=require("node:events")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},88810:(a,b,c)=>{"use strict";let d;c.d(b,{Lk:()=>h});var e=c(42261),f=c(17174);let g=e.Ik({NEXT_PUBLIC_APP_URL:e.Yj().url().optional(),NEXT_PUBLIC_WWW_URL:e.Yj().url().optional(),NEXT_PUBLIC_DASHBOARD_URL:e.Yj().url().optional(),POSTGRES_URL:e.Yj().min(1,"Database URL is required"),DATABASE_URL:e.Yj().min(1).optional(),NEXT_PUBLIC_SUPABASE_URL:e.Yj().url("Invalid Supabase URL"),NEXT_PUBLIC_SUPABASE_ANON_KEY:e.Yj().min(1,"Supabase anon key is required"),NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY:e.Yj().min(1).optional(),SUPABASE_SERVICE_ROLE_KEY:e.Yj().min(1,"Supabase service role key is required"),BETTER_AUTH_SECRET:e.Yj().min(32,"Better Auth secret must be at least 32 characters"),BETTER_AUTH_URL:e.Yj().url().optional(),NEXT_PUBLIC_BETTER_AUTH_URL:e.Yj().url().optional(),GOOGLE_CLIENT_ID:e.Yj().min(1,"Google Client ID is required for authentication"),GOOGLE_CLIENT_SECRET:e.Yj().min(1,"Google Client Secret is required for authentication"),OPENAI_API_KEY:e.Yj().min(1).optional(),OPENAI_MODEL:e.Yj().default("gpt-4").optional(),GOOGLE_GENERATIVE_AI_API_KEY:e.Yj().min(1).optional(),GEMINI_API_KEY:e.Yj().min(1).optional(),GEMINI_MODEL:e.Yj().default("gemini-2.5-flash").optional(),GOOGLE_ANALYTICS_ID:e.Yj().optional(),FACEBOOK_PIXEL_ID:e.Yj().optional(),RESEND_API_KEY:e.Yj().optional(),WEBHOOK_SECRET_N8N:e.Yj().optional(),WEBHOOK_SECRET_MAKE:e.Yj().optional(),WEBHOOK_SECRET_ZAPIER:e.Yj().optional()});e.Ik({NEXT_PUBLIC_APP_URL:g.shape.NEXT_PUBLIC_APP_URL,NEXT_PUBLIC_WWW_URL:g.shape.NEXT_PUBLIC_WWW_URL,NEXT_PUBLIC_DASHBOARD_URL:g.shape.NEXT_PUBLIC_DASHBOARD_URL,NEXT_PUBLIC_SUPABASE_URL:g.shape.NEXT_PUBLIC_SUPABASE_URL,NEXT_PUBLIC_SUPABASE_ANON_KEY:g.shape.NEXT_PUBLIC_SUPABASE_ANON_KEY,NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY:g.shape.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_DEFAULT_KEY,NEXT_PUBLIC_BETTER_AUTH_URL:g.shape.NEXT_PUBLIC_BETTER_AUTH_URL});let h=()=>{if(!d)try{d=function(){try{return g.parse(process.env)}catch(a){if(a instanceof f.G){let b=a.issues.map(a=>`${a.path.join(".")}: ${a.message}`).join("\n");throw Error(`Environment validation failed:
${b}

Please check your .env.local file in the root directory.`)}throw a}}()}catch(a){throw console.error("❌ Server environment validation failed:",a),a}return d}},91645:a=>{"use strict";a.exports=require("net")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[863,819,438,389],()=>b(b.s=38595));module.exports=c})();