"use strict";exports.id=819,exports.ids=[819],exports.modules={5:(a,b,c)=>{c.d(b,{u:()=>g});var d=c(8575),e=c(98708),f=c(10289);class g extends f.pe{static [d.i]="PgDateColumnBaseBuilder";defaultNow(){return this.default((0,e.ll)`now()`)}}},221:(a,b,c)=>{c.d(b,{Xm:()=>h,we:()=>f,zX:()=>g});var d=c(59659);let e=["->","->>"],f=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from","+","-","*","/","%","^","&","|","#","<<",">>","&&","||",...e,"not","-","exists","not exists","between","between symmetric"],g=(0,d.CN)({is:a=>"OperatorNode"===a.kind,create:a=>(0,d.CN)({kind:"OperatorNode",operator:a})});function h(a){return(0,d.Kg)(a)&&e.includes(a)}},310:(a,b,c)=>{c.d(b,{zM:()=>h});var d=c(8575),e=c(10289);class f extends e.pe{static [d.i]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new g(a,this.config)}}class g extends e.Kl{static [d.i]="PgBoolean";getSQLType(){return"boolean"}}function h(a){return new f(a??"")}},506:(a,b,c)=>{c.d(b,{LG:()=>l,UD:()=>B,Ny:()=>A,aE:()=>bP,Zr:()=>o});var d=c(70192);let e=(()=>{let a=function(){};return a.prototype=Object.create(null),a})();function f(){return{root:{key:""},static:new e}}function g(a){return a.split("/").filter(Boolean)}function h(a,b){let c=new e;for(let[d,e]of b){let b=d<0?a.slice(-1*d).join("/"):a[d];if("string"==typeof e)c[e]=b;else{let a=b.match(e);if(a)for(let b in a.groups)c[b]=a.groups[b]}}return c}function i(a,b="",c,d){let f=g(c),h=a.root,j=0,k=[];for(let a=0;a<f.length;a++){let b=f[a];if(b.startsWith("**")){h.wildcard||(h.wildcard={key:"**"}),h=h.wildcard,k.push([-a,b.split(":")[1]||"_",2===b.length]);break}if("*"===b||b.includes(":")){h.param||(h.param={key:"*"}),h=h.param;let c="*"===b;k.push([a,c?`_${j++}`:function(a){if(!a.includes(":",1))return a.slice(1);let b=a.replace(/:(\w+)/g,(a,b)=>`(?<${b}>\\w+)`);return RegExp(`^${b}$`)}(b),c]);continue}let c=h.static?.[b];if(c)h=c;else{let a={key:b};h.static||(h.static=new e),h.static[b]=a,h=a}}let l=k.length>0;h.methods||(h.methods=new e),h.methods[b]||(h.methods[b]=[]),h.methods[b].push({data:d||null,paramsMap:l?k:void 0}),l||(a.static[c]=h)}var j=Object.defineProperty,k={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},l=class extends Error{constructor(a="INTERNAL_SERVER_ERROR",b,c={},d="number"==typeof a?a:k[a]){super(b?.message),this.status=a,this.body=b,this.headers=c,this.statusCode=d,this.name="APIError",this.status=a,this.headers=c,this.statusCode=d,this.body=b?{code:b?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...b}:void 0,this.stack=""}};async function m(a){let b=a.headers.get("content-type")||"";if(a.body){if(b.includes("application/json"))return await a.json();if(b.includes("application/x-www-form-urlencoded")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a.toString()}),c}if(b.includes("multipart/form-data")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a}),c}return b.includes("text/plain")?await a.text():b.includes("application/octet-stream")?await a.arrayBuffer():b.includes("application/pdf")||b.includes("image/")||b.includes("video/")?await a.blob():b.includes("application/stream")||a.body instanceof ReadableStream?a.body:await a.text()}}function n(a){return a instanceof l||a?.name==="APIError"}function o(a,b){if(a instanceof Response)return b?.headers instanceof Headers&&b.headers.forEach((b,c)=>{a.headers.set(c,b)}),a;if(a&&"object"==typeof a&&"_flag"in a&&"json"===a._flag){let c=a.body,d=a.routerResponse;if(d instanceof Response)return d;let e=new Headers({...d?.headers,...a.headers,...b?.headers,"Content-Type":"application/json"});return new Response(JSON.stringify(c),{...d,headers:e,status:a.status??b?.status??d?.status,statusText:b?.statusText??d?.statusText})}if(n(a))return o(a.body,{status:b?.status??a.statusCode,statusText:a.status.toString(),headers:b?.headers||a.headers});let c=a,d=new Headers(b?.headers);return a?"string"==typeof a?(c=a,d.set("Content-Type","text/plain")):a instanceof ArrayBuffer||ArrayBuffer.isView(a)?(c=a,d.set("Content-Type","application/octet-stream")):a instanceof Blob?(c=a,d.set("Content-Type",a.type||"application/octet-stream")):a instanceof FormData?c=a:a instanceof URLSearchParams?(c=a,d.set("Content-Type","application/x-www-form-urlencoded")):a instanceof ReadableStream?(c=a,d.set("Content-Type","application/octet-stream")):function(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}(a)&&(c=function(a,b,c){let d=0,e=new WeakMap;return JSON.stringify(a,(a,b)=>{if("bigint"==typeof b)return b.toString();if("object"==typeof b&&null!==b){if(e.has(b))return`[Circular ref-${e.get(b)}]`;e.set(b,d++)}return b},void 0)}(a),d.set("Content-Type","application/json")):(null===a&&(c=JSON.stringify(null)),d.set("content-type","application/json")),new Response(c,{...b,headers:d})}async function p(a,b={}){let c={body:b.body,query:b.query};if(a.body){let d=await a.body["~standard"].validate(b.body);if(d.issues)return{data:null,error:q(d.issues,"body")};c.body=d.value}if(a.query){let d=await a.query["~standard"].validate(b.query);if(d.issues)return{data:null,error:q(d.issues,"query")};c.query=d.value}return a.requireHeaders&&!b.headers?{data:null,error:{message:"Headers is required"}}:a.requireRequest&&!b.request?{data:null,error:{message:"Request is required"}}:{data:c,error:null}}function q(a,b){let c=[];for(let b of a){let a=b.message;c.push(a)}return{message:`Invalid ${b} parameters`}}var r={name:"HMAC",hash:"SHA-256"},s=async a=>{let b="string"==typeof a?new TextEncoder().encode(a):a;return await d.aK.importKey("raw",b,r,!1,["sign","verify"])},t=async(a,b,c)=>{try{let e=atob(a),f=new Uint8Array(e.length);for(let a=0,b=e.length;a<b;a++)f[a]=e.charCodeAt(a);return await d.aK.verify(r,c,f,new TextEncoder().encode(b))}catch(a){return!1}},u=async(a,b)=>{let c=await s(b);return btoa(String.fromCharCode(...new Uint8Array(await d.aK.sign(r.name,c,new TextEncoder().encode(a)))))},v=async(a,b)=>{let c=await u(a,b);return a=encodeURIComponent(a=`${a}.${c}`)},w=(a,b)=>{let c=a;if(b)if("secure"===b)c="__Secure-"+a;else{if("host"!==b)return;c="__Host-"+a}return c},x=(a,b,c={})=>{let d;if(d=c?.prefix==="secure"?`__Secure-${a}=${b}`:c?.prefix==="host"?`__Host-${a}=${b}`:`${a}=${b}`,a.startsWith("__Secure-")&&!c.secure&&(c.secure=!0),a.startsWith("__Host-")&&(c.secure||(c.secure=!0),"/"!==c.path&&(c.path="/"),c.domain&&(c.domain=void 0)),c&&"number"==typeof c.maxAge&&c.maxAge>=0){if(c.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");d+=`; Max-Age=${Math.floor(c.maxAge)}`}if(c.domain&&"host"!==c.prefix&&(d+=`; Domain=${c.domain}`),c.path&&(d+=`; Path=${c.path}`),c.expires){if(c.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");d+=`; Expires=${c.expires.toUTCString()}`}return c.httpOnly&&(d+="; HttpOnly"),c.secure&&(d+="; Secure"),c.sameSite&&(d+=`; SameSite=${c.sameSite.charAt(0).toUpperCase()+c.sameSite.slice(1)}`),c.partitioned&&(c.secure||(c.secure=!0),d+="; Partitioned"),d},y=async(a,b,c,d)=>x(a,b=await v(b,c),d),z=async(a,{options:b,path:c})=>{let d=new Headers,{data:e,error:f}=await p(b,a);if(f)throw new l(400,{message:f.message,code:"VALIDATION_ERROR"});let g="headers"in a?a.headers instanceof Headers?a.headers:new Headers(a.headers):"request"in a&&a.request instanceof Request?a.request.headers:null,h=g?.get("cookie"),i=h?function(a){if("string"!=typeof a)throw TypeError("argument str must be a string");let b=new Map,c=0;for(;c<a.length;){let d=a.indexOf("=",c);if(-1===d)break;let e=a.indexOf(";",c);if(-1===e)e=a.length;else if(e<d){c=a.lastIndexOf(";",d-1)+1;continue}let f=a.slice(c,d).trim();if(!b.has(f)){let c=a.slice(d+1,e).trim();34===c.codePointAt(0)&&(c=c.slice(1,-1)),b.set(f,function(a){try{return a.includes("%")?decodeURIComponent(a):a}catch{return a}}(c))}c=e+1}return b}(h):void 0,j={...a,body:e.body,query:e.query,path:a.path||c,context:"context"in a&&a.context?a.context:{},returned:void 0,headers:a?.headers,request:a?.request,params:"params"in a?a.params:void 0,method:a.method,setHeader:(a,b)=>{d.set(a,b)},getHeader:a=>g?g.get(a):null,getCookie:(a,b)=>{let c=w(a,b);return c&&i?.get(c)||null},getSignedCookie:async(a,b,c)=>{let d=w(a,c);if(!d)return null;let e=i?.get(d);if(!e)return null;let f=e.lastIndexOf(".");if(f<1)return null;let g=e.substring(0,f),h=e.substring(f+1);if(44!==h.length||!h.endsWith("="))return null;let j=await s(b);return!!await t(h,g,j)&&g},setCookie:(a,b,c)=>{let e=((a,b,c)=>x(a,b=encodeURIComponent(b),c))(a,b,c);return d.append("set-cookie",e),e},setSignedCookie:async(a,b,c,e)=>{let f=await y(a,b,c,e);return d.append("set-cookie",f),f},redirect:a=>(d.set("location",a),new l("FOUND",void 0,d)),error:(a,b,c)=>new l(a,b,c),json:(b,c)=>a.asResponse?{body:c?.body||b,routerResponse:c,_flag:"json"}:b,responseHeaders:d};for(let a of b.use||[]){let b=await a({...j,returnHeaders:!0,asResponse:!1});b.response&&Object.assign(j.context,b.response),b.headers&&b.headers.forEach((a,b)=>{j.responseHeaders.set(b,a)})}return j};function A(a,b){let c=async c=>{let d="function"==typeof a?a:b,e=await z(c,{options:"function"==typeof a?{}:a,path:"/"});if(!d)throw Error("handler must be defined");let f=await d(e),g=e.responseHeaders;return c.returnHeaders?{headers:g,response:f}:f};return c.options="function"==typeof a?{}:a,c}A.create=a=>function(b,c){if("function"==typeof b)return A({use:a?.use},b);if(!c)throw Error("Middleware handler is required");return A({...b,method:"*",use:[...a?.use||[],...b.use||[]]},c)};var B=(a,b,c)=>{let d=async(...d)=>{let e=d[0]||{},f=await z(e,{options:b,path:a}),g=await c(f).catch(async a=>{if(n(a)){let c=b.onAPIError;if(c&&await c(a),e.asResponse)return a}throw a}),h=f.responseHeaders;return e.asResponse?o(g,{headers:h}):e.returnHeaders?{headers:h,response:g}:g};return d.options=b,d.path=a,d};function C(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}B.create=a=>(b,c,d)=>B(b,{...c,use:[...c?.use||[],...a?.use||[]]},d),Object.freeze({status:"aborted"}),Symbol("zod_brand");var D=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},E={};function F(a){return a&&Object.assign(E,a),E}var G={};function H(a){return a}function I(a){return a}function J(a){}function K(a){throw Error()}function L(a){}function M(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}function N(a,b="|"){return a.map(a=>aj(a)).join(b)}function O(a,b){return"bigint"==typeof b?b.toString():b}function P(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function Q(a){return null==a}function R(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}function S(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}function T(a,b,c){Object.defineProperty(a,b,{get(){{let d=c();return a[b]=d,d}},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function U(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function V(a,b){return b?b.reduce((a,b)=>a?.[b],a):a}function W(a){let b=Object.keys(a);return Promise.all(b.map(b=>a[b])).then(a=>{let c={};for(let d=0;d<b.length;d++)c[b[d]]=a[d];return c})}function X(a=10){let b="abcdefghijklmnopqrstuvwxyz",c="";for(let d=0;d<a;d++)c+=b[Math.floor(Math.random()*b.length)];return c}function Y(a){return JSON.stringify(a)}((a,b)=>{for(var c in b)j(a,c,{get:b[c],enumerable:!0})})(G,{BIGINT_FORMAT_RANGES:()=>am,Class:()=>aB,NUMBER_FORMAT_RANGES:()=>al,aborted:()=>at,allowsEval:()=>_,assert:()=>L,assertEqual:()=>H,assertIs:()=>J,assertNever:()=>K,assertNotEqual:()=>I,assignProp:()=>U,cached:()=>P,captureStackTrace:()=>Z,cleanEnum:()=>aA,cleanRegex:()=>R,clone:()=>ag,createTransparentProxy:()=>ai,defineLazy:()=>T,esc:()=>Y,escapeRegex:()=>af,extend:()=>ap,finalizeIssue:()=>aw,floatSafeRemainder:()=>S,getElementAtPath:()=>V,getEnumValues:()=>M,getLengthableOrigin:()=>ay,getParsedType:()=>ac,getSizableOrigin:()=>ax,isObject:()=>$,isPlainObject:()=>aa,issue:()=>az,joinValues:()=>N,jsonStringifyReplacer:()=>O,merge:()=>aq,normalizeParams:()=>ah,nullish:()=>Q,numKeys:()=>ab,omit:()=>ao,optionalKeys:()=>ak,partial:()=>ar,pick:()=>an,prefixIssues:()=>au,primitiveTypes:()=>ae,promiseAllObject:()=>W,propertyKeyTypes:()=>ad,randomString:()=>X,required:()=>as,stringifyPrimitive:()=>aj,unwrapMessage:()=>av});var Z=Error.captureStackTrace?Error.captureStackTrace:(...a)=>{};function $(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}var _=P(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function aa(a){if(!1===$(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==$(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function ab(a){let b=0;for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b++;return b}var ac=a=>{let b=typeof a;switch(b){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(a)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(a))return"array";if(null===a)return"null";if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return"promise";if("undefined"!=typeof Map&&a instanceof Map)return"map";if("undefined"!=typeof Set&&a instanceof Set)return"set";if("undefined"!=typeof Date&&a instanceof Date)return"date";if("undefined"!=typeof File&&a instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${b}`)}},ad=new Set(["string","number","symbol"]),ae=new Set(["string","number","bigint","boolean","symbol","undefined"]);function af(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ag(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function ah(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function ai(a){let b;return new Proxy({},{get:(c,d,e)=>(b??(b=a()),Reflect.get(b,d,e)),set:(c,d,e,f)=>(b??(b=a()),Reflect.set(b,d,e,f)),has:(c,d)=>(b??(b=a()),Reflect.has(b,d)),deleteProperty:(c,d)=>(b??(b=a()),Reflect.deleteProperty(b,d)),ownKeys:c=>(b??(b=a()),Reflect.ownKeys(b)),getOwnPropertyDescriptor:(c,d)=>(b??(b=a()),Reflect.getOwnPropertyDescriptor(b,d)),defineProperty:(c,d,e)=>(b??(b=a()),Reflect.defineProperty(b,d,e))})}function aj(a){return"bigint"==typeof a?a.toString()+"n":"string"==typeof a?`"${a}"`:`${a}`}function ak(a){return Object.keys(a).filter(b=>"optional"===a[b]._zod.optin&&"optional"===a[b]._zod.optout)}var al={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},am={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function an(a,b){let c={},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&(c[a]=d.shape[a])}return ag(a,{...a._zod.def,shape:c,checks:[]})}function ao(a,b){let c={...a._zod.def.shape},d=a._zod.def;for(let a in b){if(!(a in d.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete c[a]}return ag(a,{...a._zod.def,shape:c,checks:[]})}function ap(a,b){if(!aa(b))throw Error("Invalid input to extend: expected a plain object");let c={...a._zod.def,get shape(){let c={...a._zod.def.shape,...b};return U(this,"shape",c),c},checks:[]};return ag(a,c)}function aq(a,b){return ag(a,{...a._zod.def,get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return U(this,"shape",c),c},catchall:b._zod.def.catchall,checks:[]})}function ar(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return ag(b,{...b._zod.def,shape:e,checks:[]})}function as(a,b,c){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return ag(b,{...b._zod.def,shape:e,checks:[]})}function at(a,b=0){for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function au(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function av(a){return"string"==typeof a?a:a?.message}function aw(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=av(a.inst?._zod.def?.error?.(a))??av(b?.error?.(a))??av(c.customError?.(a))??av(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function ax(a){return a instanceof Set?"set":a instanceof Map?"map":a instanceof File?"file":"unknown"}function ay(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function az(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}function aA(a){return Object.entries(a).filter(([a,b])=>Number.isNaN(Number.parseInt(a,10))).map(a=>a[1])}var aB=class{constructor(...a){}},aC=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),Object.defineProperty(a,"message",{get:()=>JSON.stringify(b,O,2),enumerable:!0}),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},aD=C("$ZodError",aC),aE=C("$ZodError",aC,{Parent:Error}),aF=a=>(b,c,d)=>{let e=d?{...d,async:!1}:{async:!1},f=b._zod.run({value:c,issues:[]},e);if(f instanceof Promise)throw new D;return f.issues.length?{success:!1,error:new(a??aD)(f.issues.map(a=>aw(a,e,F())))}:{success:!0,data:f.value}},aG=aF(aE),aH=a=>async(b,c,d)=>{let e=d?Object.assign(d,{async:!0}):{async:!0},f=b._zod.run({value:c,issues:[]},e);return f instanceof Promise&&(f=await f),f.issues.length?{success:!1,error:new a(f.issues.map(a=>aw(a,e,F())))}:{success:!0,data:f.value}},aI=aH(aE),aJ=C("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),aK=C("$ZodCheckMaxLength",(a,b)=>{var c;aJ.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!Q(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=ay(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),aL=C("$ZodCheckMinLength",(a,b)=>{var c;aJ.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!Q(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=ay(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),aM=C("$ZodCheckLengthEquals",(a,b)=>{var c;aJ.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!Q(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let f=ay(d),g=e>b.length;c.issues.push({origin:f,...g?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),aN=C("$ZodCheckOverwrite",(a,b)=>{aJ.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}}),aO=class{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}},aP={major:4,minor:0,patch:0},aQ=C("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=aP;let d=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&d.unshift(a),d))for(let c of b._zod.onattach)c(a);if(0===d.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let d,e=at(a);for(let f of b){if(f._zod.def.when){if(!f._zod.def.when(a))continue}else if(e)continue;let b=a.issues.length,g=f._zod.check(a);if(g instanceof Promise&&c?.async===!1)throw new D;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,a.issues.length!==b&&(e||(e=at(a,b)))});else{if(a.issues.length===b)continue;e||(e=at(a,b))}}return d?d.then(()=>a):a};a._zod.run=(c,e)=>{let f=a._zod.parse(c,e);if(f instanceof Promise){if(!1===e.async)throw new D;return f.then(a=>b(a,d,e))}return b(f,d,e)}}a["~standard"]={validate:b=>{try{let c=aG(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return aI(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),aR=C("$ZodUnknown",(a,b)=>{aQ.init(a,b),a._zod.parse=a=>a}),aS=C("$ZodNever",(a,b)=>{aQ.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)});function aT(a,b,c){a.issues.length&&b.issues.push(...au(c,a.issues)),b.value[c]=a.value}var aU=C("$ZodArray",(a,b)=>{aQ.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>aT(b,c,a))):aT(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function aV(a,b,c){a.issues.length&&b.issues.push(...au(c,a.issues)),b.value[c]=a.value}function aW(a,b,c,d){a.issues.length?void 0===d[c]?c in d?b.value[c]=void 0:b.value[c]=a.value:b.issues.push(...au(c,a.issues)):void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}var aX=C("$ZodObject",(a,b)=>{let c,d;aQ.init(a,b);let e=P(()=>{let a=Object.keys(b.shape);for(let c of a)if(!(b.shape[c]instanceof aQ))throw Error(`Invalid element at key "${c}": expected a Zod schema`);let c=ak(b.shape);return{shape:b.shape,keys:a,keySet:new Set(a),numKeys:a.length,optionalKeys:new Set(c)}});T(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let f=!E.jitless,g=f&&_.value,h=b.catchall;a._zod.parse=(i,j)=>{d??(d=e.value);let k=i.value;if(!$(k))return i.issues.push({expected:"object",code:"invalid_type",input:k,inst:a}),i;let l=[];if(f&&g&&j?.async===!1&&!0!==j.jitless)c||(c=(a=>{let b=new aO(["shape","payload","ctx"]),c=e.value,d=a=>{let b=Y(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let f=Object.create(null),g=0;for(let a of c.keys)f[a]=`key_${g++}`;for(let a of(b.write("const newResult = {}"),c.keys))if(c.optionalKeys.has(a)){let c=f[a];b.write(`const ${c} = ${d(a)};`);let e=Y(a);b.write(`
        if (${c}.issues.length) {
          if (input[${e}] === undefined) {
            if (${e} in input) {
              newResult[${e}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${c}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${e}, ...iss.path] : [${e}],
              }))
            );
          }
        } else if (${c}.value === undefined) {
          if (${e} in input) newResult[${e}] = undefined;
        } else {
          newResult[${e}] = ${c}.value;
        }
        `)}else{let c=f[a];b.write(`const ${c} = ${d(a)};`),b.write(`
          if (${c}.issues.length) payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${Y(a)}, ...iss.path] : [${Y(a)}]
          })));`),b.write(`newResult[${Y(a)}] = ${c}.value`)}b.write("payload.value = newResult;"),b.write("return payload;");let h=b.compile();return(b,c)=>h(a,b,c)})(b.shape)),i=c(i,j);else{i.value={};let a=d.shape;for(let b of d.keys){let c=a[b],d=c._zod.run({value:k[b],issues:[]},j),e="optional"===c._zod.optin&&"optional"===c._zod.optout;d instanceof Promise?l.push(d.then(a=>e?aW(a,i,b,k):aV(a,i,b))):e?aW(d,i,b,k):aV(d,i,b)}}if(!h)return l.length?Promise.all(l).then(()=>i):i;let m=[],n=d.keySet,o=h._zod,p=o.def.type;for(let a of Object.keys(k)){if(n.has(a))continue;if("never"===p){m.push(a);continue}let b=o.run({value:k[a],issues:[]},j);b instanceof Promise?l.push(b.then(b=>aV(b,i,a))):aV(b,i,a)}return(m.length&&i.issues.push({code:"unrecognized_keys",keys:m,input:k,inst:a}),l.length)?Promise.all(l).then(()=>i):i}});function aY(a,b,c,d){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;return b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>aw(a,d,F())))}),b}var aZ=C("$ZodUnion",(a,b)=>{aQ.init(a,b),T(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),T(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),T(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),T(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>R(a.source)).join("|")})$`)}}),a._zod.parse=(c,d)=>{let e=!1,f=[];for(let a of b.options){let b=a._zod.run({value:c.value,issues:[]},d);if(b instanceof Promise)f.push(b),e=!0;else{if(0===b.issues.length)return b;f.push(b)}}return e?Promise.all(f).then(b=>aY(b,c,a,d)):aY(f,c,a,d)}}),a$=C("$ZodIntersection",(a,b)=>{aQ.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>a_(a,b,c)):a_(a,e,f)}});function a_(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),at(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(aa(b)&&aa(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}var a0=C("$ZodEnum",(a,b)=>{aQ.init(a,b);let c=M(b.entries);a._zod.values=new Set(c),a._zod.pattern=RegExp(`^(${c.filter(a=>ad.has(typeof a)).map(a=>"string"==typeof a?af(a):a.toString()).join("|")})$`),a._zod.parse=(b,d)=>{let e=b.value;return a._zod.values.has(e)||b.issues.push({code:"invalid_value",values:c,input:e,inst:a}),b}}),a1=C("$ZodTransform",(a,b)=>{aQ.init(a,b),a._zod.parse=(a,c)=>{let d=b.transform(a.value,a);if(c.async)return(d instanceof Promise?d:Promise.resolve(d)).then(b=>(a.value=b,a));if(d instanceof Promise)throw new D;return a.value=d,a}}),a2=C("$ZodOptional",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",a._zod.optout="optional",T(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),T(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${R(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>"optional"===b.innerType._zod.optin?b.innerType._zod.run(a,c):void 0===a.value?a:b.innerType._zod.run(a,c)}),a3=C("$ZodNullable",(a,b)=>{aQ.init(a,b),T(a._zod,"optin",()=>b.innerType._zod.optin),T(a._zod,"optout",()=>b.innerType._zod.optout),T(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${R(a.source)}|null)$`):void 0}),T(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),a4=C("$ZodDefault",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",T(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>a5(a,b)):a5(d,b)}});function a5(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}var a6=C("$ZodPrefault",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",T(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>(void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),a7=C("$ZodNonOptional",(a,b)=>{aQ.init(a,b),T(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>a8(b,a)):a8(e,a)}});function a8(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}var a9=C("$ZodCatch",(a,b)=>{aQ.init(a,b),a._zod.optin="optional",T(a._zod,"optout",()=>b.innerType._zod.optout),T(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(d=>(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>aw(a,c,F()))},input:a.value}),a.issues=[]),a)):(a.value=d.value,d.issues.length&&(a.value=b.catchValue({...a,error:{issues:d.issues.map(a=>aw(a,c,F()))},input:a.value}),a.issues=[]),a)}}),ba=C("$ZodPipe",(a,b)=>{aQ.init(a,b),T(a._zod,"values",()=>b.in._zod.values),T(a._zod,"optin",()=>b.in._zod.optin),T(a._zod,"optout",()=>b.out._zod.optout),a._zod.parse=(a,c)=>{let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>bb(a,b,c)):bb(d,b,c)}});function bb(a,b,c){return at(a)?a:b.out._zod.run({value:a.value,issues:a.issues},c)}var bc=C("$ZodReadonly",(a,b)=>{aQ.init(a,b),T(a._zod,"propValues",()=>b.innerType._zod.propValues),T(a._zod,"values",()=>b.innerType._zod.values),T(a._zod,"optin",()=>b.innerType._zod.optin),T(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(bd):bd(d)}});function bd(a){return a.value=Object.freeze(a.value),a}var be=C("$ZodCustom",(a,b)=>{aJ.init(a,b),aQ.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>bf(b,c,d,a));bf(e,c,d,a)}});function bf(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(az(a))}}Symbol("ZodOutput"),Symbol("ZodInput");var bg=new class{constructor(){this._map=new Map,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};return delete c.id,{...c,...this._map.get(a)}}return this._map.get(a)}has(a){return this._map.has(a)}};function bh(a,b){return new aL({check:"min_length",...ah(b),minimum:a})}var bi=(a,b)=>{aD.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>(function(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d})(a,b)},flatten:{value:b=>(function(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}})(a,b)},addIssue:{value:b=>a.issues.push(b)},addIssues:{value:b=>a.issues.push(...b)},isEmpty:{get:()=>0===a.issues.length}})};C("ZodError",bi);var bj=C("ZodError",bi,{Parent:Error}),bk=(a,b,c,d)=>{let e=c?Object.assign(c,{async:!1}):{async:!1},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise)throw new D;if(f.issues.length){let a=new(d?.Err??bj)(f.issues.map(a=>aw(a,e,F())));throw Z(a,d?.callee),a}return f.value},bl=async(a,b,c,d)=>{let e=c?Object.assign(c,{async:!0}):{async:!0},f=a._zod.run({value:b,issues:[]},e);if(f instanceof Promise&&(f=await f),f.issues.length){let a=new(d?.Err??bj)(f.issues.map(a=>aw(a,e,F())));throw Z(a,d?.callee),a}return f.value},bm=aF(bj),bn=aH(bj),bo=C("ZodType",(a,b)=>(aQ.init(a,b),a.def=b,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone({...b,checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]}),a.clone=(b,c)=>ag(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>bk(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>bm(a,b,c),a.parseAsync=async(b,c)=>bl(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>bn(a,b,c),a.spa=a.safeParseAsync,a.refine=(b,c)=>a.check(function(a,b={}){return new bJ({type:"custom",check:"custom",fn:a,...ah(b)})}(b,c)),a.superRefine=b=>a.check(function(a){let b=function(a){let b=new aJ({check:"custom"});return b._zod.check=a,b}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(G.issue(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(G.issue(a)))},a(c.value,c)));return b}(b)),a.overwrite=b=>a.check(new aN({check:"overwrite",tx:b})),a.optional=()=>bz(a),a.nullable=()=>bB(a),a.nullish=()=>bz(bB(a)),a.nonoptional=b=>{var c,d;return c=a,d=b,new bE({type:"nonoptional",innerType:c,...G.normalizeParams(d)})},a.array=()=>(function(a,b){return new bs({type:"array",element:a,...ah(void 0)})})(a),a.or=b=>new bu({type:"union",options:[a,b],...G.normalizeParams(void 0)}),a.and=b=>{var c;return c=a,new bv({type:"intersection",left:c,right:b})},a.transform=b=>bH(a,new bx({type:"transform",transform:b})),a.default=b=>(function(a,b){return new bC({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.prefault=b=>(function(a,b){return new bD({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():b}})})(a,b),a.catch=b=>(function(a,b){return new bF({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>bH(a,b),a.readonly=()=>new bI({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return bg.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>bg.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return bg.get(a);let c=a.clone();return bg.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),bp=C("ZodUnknown",(a,b)=>{aR.init(a,b),bo.init(a,b)});function bq(){return new bp({type:"unknown"})}var br=C("ZodNever",(a,b)=>{aS.init(a,b),bo.init(a,b)}),bs=C("ZodArray",(a,b)=>{aU.init(a,b),bo.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(bh(b,c)),a.nonempty=b=>a.check(bh(1,b)),a.max=(b,c)=>a.check(new aK({check:"max_length",...ah(c),maximum:b})),a.length=(b,c)=>a.check(new aM({check:"length_equals",...ah(c),length:b})),a.unwrap=()=>a.element}),bt=C("ZodObject",(a,b)=>{aX.init(a,b),bo.init(a,b),G.defineLazy(a,"shape",()=>b.shape),a.keyof=()=>(function(a,b){return new bw({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...G.normalizeParams(void 0)})})(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:bq()}),a.loose=()=>a.clone({...a._zod.def,catchall:bq()}),a.strict=()=>a.clone({...a._zod.def,catchall:new br({type:"never",...ah(void 0)})}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>G.extend(a,b),a.merge=b=>G.merge(a,b),a.pick=b=>G.pick(a,b),a.omit=b=>G.omit(a,b),a.partial=(...b)=>G.partial(by,a,b[0]),a.required=(...b)=>G.required(bE,a,b[0])}),bu=C("ZodUnion",(a,b)=>{aZ.init(a,b),bo.init(a,b),a.options=b.options}),bv=C("ZodIntersection",(a,b)=>{a$.init(a,b),bo.init(a,b)}),bw=C("ZodEnum",(a,b)=>{a0.init(a,b),bo.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new bw({...b,checks:[],...G.normalizeParams(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new bw({...b,checks:[],...G.normalizeParams(d),entries:e})}}),bx=C("ZodTransform",(a,b)=>{a1.init(a,b),bo.init(a,b),a._zod.parse=(c,d)=>{c.addIssue=d=>{"string"==typeof d?c.issues.push(G.issue(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),d.continue??(d.continue=!0),c.issues.push(G.issue(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),by=C("ZodOptional",(a,b)=>{a2.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType});function bz(a){return new by({type:"optional",innerType:a})}var bA=C("ZodNullable",(a,b)=>{a3.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType});function bB(a){return new bA({type:"nullable",innerType:a})}var bC=C("ZodDefault",(a,b)=>{a4.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),bD=C("ZodPrefault",(a,b)=>{a6.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType}),bE=C("ZodNonOptional",(a,b)=>{a7.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType}),bF=C("ZodCatch",(a,b)=>{a9.init(a,b),bo.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),bG=C("ZodPipe",(a,b)=>{ba.init(a,b),bo.init(a,b),a.in=b.in,a.out=b.out});function bH(a,b){return new bG({type:"pipe",in:a,out:b})}var bI=C("ZodReadonly",(a,b)=>{bc.init(a,b),bo.init(a,b)}),bJ=C("ZodCustom",(a,b)=>{be.init(a,b),bo.init(a,b)}),bK={};function bL(a){switch(a.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function bM(a){let b=[];return a.metadata?.openapi?.parameters?b.push(...a.metadata.openapi.parameters):a.query instanceof bt&&Object.entries(a.query.shape).forEach(([a,c])=>{c instanceof bt&&b.push({name:a,in:"query",schema:{type:bL(c),..."minLength"in c&&c.minLength?{minLength:c.minLength}:{},description:c.description}})}),b}function bN(a){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...a}}async function bO(a,b){return Object.entries(a).forEach(([a,b])=>{let c=b.options;if(!c.metadata?.SERVER_ONLY&&("GET"===c.method&&(bK[b.path]={get:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:bM(c),responses:bN(c.metadata?.openapi?.responses)}}),"POST"===c.method)){let a=function(a){if(a.metadata?.openapi?.requestBody)return a.metadata.openapi.requestBody;if(a.body&&(a.body instanceof bt||a.body instanceof by)){let b=a.body.shape;if(!b)return;let c={},d=[];return Object.entries(b).forEach(([a,b])=>{b instanceof bt&&(c[a]={type:bL(b),description:b.description},b instanceof by||d.push(a))}),{required:!(a.body instanceof by)&&!!a.body,content:{"application/json":{schema:{type:"object",properties:c,required:d}}}}}}(c);bK[b.path]={post:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:bM(c),...a?{requestBody:a}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:bN(c.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:b?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:bK}}var bP=(a,b)=>{if(!b?.openapi?.disabled){let c={path:"/api/reference",...b?.openapi};a.openapi=B(c.path,{method:"GET"},async b=>new Response(((a,b)=>`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(a)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${b?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(b.logo)}`:void 0} ,
	   	theme: ${b?.theme||"saturn"},
        metaData: {
			title: ${b?.title||"Open API Reference"},
			description: ${b?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`)(await bO(a),c.scalar),{headers:{"Content-Type":"text/html"}}))}let c=f(),d=f();for(let b of Object.values(a))if(!(!b.options||b.options?.metadata?.SERVER_ONLY))for(let a of Array.isArray(b.options?.method)?b.options.method:[b.options?.method])i(c,a,b.path,b);if(b?.routerMiddleware?.length)for(let{path:a,middleware:c}of b.routerMiddleware)i(d,"*",a,c);let e=async a=>{let e=new URL(a.url),f=b?.basePath?e.pathname.split(b.basePath).reduce((a,c,d)=>(0!==d&&(d>1?a.push(`${b.basePath}${c}`):a.push(c)),a),[]).join(""):e.pathname;if(!f?.length)return new Response(null,{status:404,statusText:"Not Found"});let i=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=a.static[c];if(e&&e.methods){let a=e.methods[b]||e.methods[""];if(void 0!==a)return a[0]}let f=g(c),i=function a(b,c,d,e,f){if(f===e.length){if(c.methods){let a=c.methods[d]||c.methods[""];if(a)return a}if(c.param&&c.param.methods){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}return}let g=e[f];if(c.static){let h=c.static[g];if(h){let c=a(b,h,d,e,f+1);if(c)return c}}if(c.param){let g=a(b,c.param,d,e,f+1);if(g)return g}if(c.wildcard&&c.wildcard.methods)return c.wildcard.methods[d]||c.wildcard.methods[""]}(a,a.root,b,f,0)?.[0];if(void 0!==i)return{data:i.data,params:i.paramsMap?h(f,i.paramsMap):void 0}}(c,a.method,f);if(!i?.data)return new Response(null,{status:404,statusText:"Not Found"});let j={};e.searchParams.forEach((a,b)=>{b in j?Array.isArray(j[b])?j[b].push(a):j[b]=[j[b],a]:j[b]=a});let k=i.data,l={path:f,method:a.method,headers:a.headers,params:i.params?JSON.parse(JSON.stringify(i.params)):{},request:a,body:k.options.disableBody?void 0:await m(k.options.cloneRequest?a.clone():a),query:j,_flag:"router",asResponse:!0,context:b?.routerContext};try{let a=function(a,b="",c,d){"/"===c[c.length-1]&&(c=c.slice(0,-1));let e=g(c);return(function a(b,c,d,e,f,g=[]){let h=e[f];if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];a&&g.push(...a)}if(c.param&&(a(b,c.param,d,e,f+1,g),f===e.length&&c.param.methods)){let a=c.param.methods[d]||c.param.methods[""];a&&g.push(...a)}let i=c.static?.[h];if(i&&a(b,i,d,e,f+1,g),f===e.length&&c.methods){let a=c.methods[d]||c.methods[""];a&&g.push(...a)}return g})(a,a.root,b,e,0).map(a=>({data:a.data,params:a.paramsMap?h(e,a.paramsMap):void 0}))}(d,"*",f);if(a?.length)for(let{data:b,params:c}of a){let a=await b({...l,params:c,asResponse:!1});if(a instanceof Response)return a}return await k(l)}catch(a){if(n(a))return o(a);return console.error("# SERVER_ERROR: ",a),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async a=>{let c=await b?.onRequest?.(a);if(c instanceof Response)return c;let d=c instanceof Request?c:a,f=await e(d),g=await b?.onResponse?.(f);return g instanceof Response?g:f},endpoints:a}}},1346:(a,b,c)=>{c.d(b,{k:()=>e});var d=c(8575);class e{static [d.i]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}},2059:(a,b,c)=>{c.d(b,{H:()=>f});var d=c(59659),e=c(87197);let f=(0,d.CN)({is:a=>"TableNode"===a.kind,create:a=>(0,d.CN)({kind:"TableNode",table:e.y.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"TableNode",table:e.y.createWithSchema(a,b)})})},2175:(a,b,c)=>{c.d(b,{DG:()=>q,E6:()=>v,J:()=>u,J_:()=>j,Jk:()=>k,KH:()=>l,Kk:()=>n,NI:()=>r,QP:()=>g,RM:()=>o,Tt:()=>t,Yk:()=>m,kH:()=>s,ql:()=>p,sm:()=>i,v$:()=>w});var d=c(15017),e=c(24047),f=c(58054);let g=d.xI("$ZodCheck",(a,b)=>{var c;a._zod??(a._zod={}),a._zod.def=b,(c=a._zod).onattach??(c.onattach=[])}),h={number:"number",bigint:"bigint",object:"date"},i=d.xI("$ZodCheckLessThan",(a,b)=>{g.init(a,b);let c=h[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.maximum:c.exclusiveMaximum)??1/0;b.value<d&&(b.inclusive?c.maximum=b.value:c.exclusiveMaximum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value<=b.value:d.value<b.value)||d.issues.push({origin:c,code:"too_big",maximum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),j=d.xI("$ZodCheckGreaterThan",(a,b)=>{g.init(a,b);let c=h[typeof b.value];a._zod.onattach.push(a=>{let c=a._zod.bag,d=(b.inclusive?c.minimum:c.exclusiveMinimum)??-1/0;b.value>d&&(b.inclusive?c.minimum=b.value:c.exclusiveMinimum=b.value)}),a._zod.check=d=>{(b.inclusive?d.value>=b.value:d.value>b.value)||d.issues.push({origin:c,code:"too_small",minimum:b.value,input:d.value,inclusive:b.inclusive,inst:a,continue:!b.abort})}}),k=d.xI("$ZodCheckMultipleOf",(a,b)=>{g.init(a,b),a._zod.onattach.push(a=>{var c;(c=a._zod.bag).multipleOf??(c.multipleOf=b.value)}),a._zod.check=c=>{if(typeof c.value!=typeof b.value)throw Error("Cannot mix number and bigint in multiple_of check.");("bigint"==typeof c.value?c.value%b.value===BigInt(0):0===f.LG(c.value,b.value))||c.issues.push({origin:typeof c.value,code:"not_multiple_of",divisor:b.value,input:c.value,inst:a,continue:!b.abort})}}),l=d.xI("$ZodCheckNumberFormat",(a,b)=>{g.init(a,b),b.format=b.format||"float64";let c=b.format?.includes("int"),d=c?"int":"number",[h,i]=f.zH[b.format];a._zod.onattach.push(a=>{let d=a._zod.bag;d.format=b.format,d.minimum=h,d.maximum=i,c&&(d.pattern=e.nd)}),a._zod.check=e=>{let f=e.value;if(c){if(!Number.isInteger(f))return void e.issues.push({expected:d,format:b.format,code:"invalid_type",continue:!1,input:f,inst:a});if(!Number.isSafeInteger(f))return void(f>0?e.issues.push({input:f,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}):e.issues.push({input:f,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:a,origin:d,continue:!b.abort}))}f<h&&e.issues.push({origin:"number",input:f,code:"too_small",minimum:h,inclusive:!0,inst:a,continue:!b.abort}),f>i&&e.issues.push({origin:"number",input:f,code:"too_big",maximum:i,inst:a})}}),m=d.xI("$ZodCheckMaxLength",(a,b)=>{var c;g.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!f.cl(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.maximum??1/0;b.maximum<c&&(a._zod.bag.maximum=b.maximum)}),a._zod.check=c=>{let d=c.value;if(d.length<=b.maximum)return;let e=f.Rc(d);c.issues.push({origin:e,code:"too_big",maximum:b.maximum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),n=d.xI("$ZodCheckMinLength",(a,b)=>{var c;g.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!f.cl(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag.minimum??-1/0;b.minimum>c&&(a._zod.bag.minimum=b.minimum)}),a._zod.check=c=>{let d=c.value;if(d.length>=b.minimum)return;let e=f.Rc(d);c.issues.push({origin:e,code:"too_small",minimum:b.minimum,inclusive:!0,input:d,inst:a,continue:!b.abort})}}),o=d.xI("$ZodCheckLengthEquals",(a,b)=>{var c;g.init(a,b),(c=a._zod.def).when??(c.when=a=>{let b=a.value;return!f.cl(b)&&void 0!==b.length}),a._zod.onattach.push(a=>{let c=a._zod.bag;c.minimum=b.length,c.maximum=b.length,c.length=b.length}),a._zod.check=c=>{let d=c.value,e=d.length;if(e===b.length)return;let g=f.Rc(d),h=e>b.length;c.issues.push({origin:g,...h?{code:"too_big",maximum:b.length}:{code:"too_small",minimum:b.length},inclusive:!0,exact:!0,input:c.value,inst:a,continue:!b.abort})}}),p=d.xI("$ZodCheckStringFormat",(a,b)=>{var c,d;g.init(a,b),a._zod.onattach.push(a=>{let c=a._zod.bag;c.format=b.format,b.pattern&&(c.patterns??(c.patterns=new Set),c.patterns.add(b.pattern))}),b.pattern?(c=a._zod).check??(c.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:b.format,input:c.value,...b.pattern?{pattern:b.pattern.toString()}:{},inst:a,continue:!b.abort})}):(d=a._zod).check??(d.check=()=>{})}),q=d.xI("$ZodCheckRegex",(a,b)=>{p.init(a,b),a._zod.check=c=>{b.pattern.lastIndex=0,b.pattern.test(c.value)||c.issues.push({origin:"string",code:"invalid_format",format:"regex",input:c.value,pattern:b.pattern.toString(),inst:a,continue:!b.abort})}}),r=d.xI("$ZodCheckLowerCase",(a,b)=>{b.pattern??(b.pattern=e.AC),p.init(a,b)}),s=d.xI("$ZodCheckUpperCase",(a,b)=>{b.pattern??(b.pattern=e.Zv),p.init(a,b)}),t=d.xI("$ZodCheckIncludes",(a,b)=>{g.init(a,b);let c=f.$f(b.includes),d=new RegExp("number"==typeof b.position?`^.{${b.position}}${c}`:c);b.pattern=d,a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(d)}),a._zod.check=c=>{c.value.includes(b.includes,b.position)||c.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:b.includes,input:c.value,inst:a,continue:!b.abort})}}),u=d.xI("$ZodCheckStartsWith",(a,b)=>{g.init(a,b);let c=RegExp(`^${f.$f(b.prefix)}.*`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.startsWith(b.prefix)||c.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:b.prefix,input:c.value,inst:a,continue:!b.abort})}}),v=d.xI("$ZodCheckEndsWith",(a,b)=>{g.init(a,b);let c=RegExp(`.*${f.$f(b.suffix)}$`);b.pattern??(b.pattern=c),a._zod.onattach.push(a=>{let b=a._zod.bag;b.patterns??(b.patterns=new Set),b.patterns.add(c)}),a._zod.check=c=>{c.value.endsWith(b.suffix)||c.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:b.suffix,input:c.value,inst:a,continue:!b.abort})}}),w=d.xI("$ZodCheckOverwrite",(a,b)=>{g.init(a,b),a._zod.check=a=>{a.value=b.tx(a.value)}})},3047:(a,b,c)=>{c.d(b,{U:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"SelectAllNode"===a.kind,create:()=>(0,d.CN)({kind:"SelectAllNode"})})},4031:(a,b,c)=>{c.d(b,{f:()=>f});var d=c(59659);let e=(0,d.CN)({is:a=>"TopNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"TopNode",expression:a,modifiers:b})});function f(a,b){var c;if(!(0,d.Et)(a)&&!(0,d.sI)(a))throw Error(`Invalid top expression: ${a}`);if(!(0,d.b0)(b)&&"percent"!==(c=b)&&"with ties"!==c&&"percent with ties"!==c)throw Error(`Invalid top modifiers: ${b}`);return e.create(a,b)}},4457:(a,b,c)=>{c.d(b,{P:()=>f});var d=c(59659),e=c(84793);let f=(0,d.CN)({is:a=>"CaseNode"===a.kind,create:a=>(0,d.CN)({kind:"CaseNode",value:a}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,when:(0,d.CN)(a.when?[...a.when,b]:[b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,when:a.when?(0,d.CN)([...a.when.slice(0,-1),e.t.cloneWithResult(a.when[a.when.length-1],b)]):void 0}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},4806:(a,b,c)=>{c.d(b,{EJ:()=>g,bp:()=>i,qg:()=>f,xL:()=>h});var d=c(27895),e=c(17174);let f=d.Tj(e.g),g=d.Rb(e.g),h=d.Od(e.g),i=d.wG(e.g)},5596:(a,b,c)=>{c.d(b,{i:()=>d});function d(a,...b){return a(...b)}},6746:(a,b,c)=>{c.d(b,{f:()=>aq});var d=c(58586),e=c(8575),f=c(18712),g=c(13578),h=c(7762);function i(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function j(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function k(a){return a}class l{static [e.i]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?i:"camelCase"===a?j:k}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[h.XI.Symbol.Schema]??"public",c=a.table[h.XI.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[h.XI.Symbol.Schema]??"public",c=a[h.XI.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[h.XI.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}var m=c(98318),n=c(66555),o=c(10289),p=c(16406),q=c(84246),r=c(90593),s=c(97949),t=c(96406),u=c(96508),v=c(70659),w=c(9633),x=c(65141),y=c(98708),z=c(52723),A=c(72354),B=c(37103),C=c(16155);class D extends y.Ss{static [e.i]="PgViewBase"}class E{static [e.i]="PgDialect";casing;constructor(a){this.casing=new l(a?.casing)}async migrate(a,b,c){let d="string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e="string"==typeof c?"drizzle":c.migrationsSchema??"drizzle",f=(0,y.ll)`
			CREATE TABLE IF NOT EXISTS ${y.ll.identifier(e)}.${y.ll.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await b.execute((0,y.ll)`CREATE SCHEMA IF NOT EXISTS ${y.ll.identifier(e)}`),await b.execute(f);let g=(await b.all((0,y.ll)`select id, hash, created_at from ${y.ll.identifier(e)}.${y.ll.identifier(d)} order by created_at desc limit 1`))[0];await b.transaction(async b=>{for await(let c of a)if(!g||Number(g.created_at)<c.folderMillis){for(let a of c.sql)await b.execute(y.ll.raw(a));await b.execute((0,y.ll)`insert into ${y.ll.identifier(e)}.${y.ll.identifier(d)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(a){return`"${a}"`}escapeParam(a){return`$${a+1}`}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[(0,y.ll)`with `];for(let[c,d]of a.entries())b.push((0,y.ll)`${y.ll.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push((0,y.ll)`, `);return b.push((0,y.ll)` `),y.ll.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d}){let e=this.buildWithCTE(d),f=c?(0,y.ll)` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,g=b?(0,y.ll)` where ${b}`:void 0;return(0,y.ll)`${e}delete from ${a}${g}${f}`}buildUpdateSet(a,b){let c=a[h.XI.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),e=d.length;return y.ll.join(d.flatMap((a,d)=>{let f=c[a],g=b[a]??y.ll.param(f.onUpdateFn(),f),h=(0,y.ll)`${y.ll.identifier(this.casing.getColumnCasing(f))} = ${g}`;return d<e-1?[h,y.ll.raw(", ")]:[h]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,from:f,joins:g}){let h=this.buildWithCTE(e),i=a[w.mu.Symbol.Name],j=a[w.mu.Symbol.Schema],k=a[w.mu.Symbol.OriginalName],l=i===k?void 0:i,m=(0,y.ll)`${j?(0,y.ll)`${y.ll.identifier(j)}.`:void 0}${y.ll.identifier(k)}${l&&(0,y.ll)` ${y.ll.identifier(l)}`}`,n=this.buildUpdateSet(a,b),o=f&&y.ll.join([y.ll.raw(" from "),this.buildFromTable(f)]),p=this.buildJoins(g),q=d?(0,y.ll)` returning ${this.buildSelection(d,{isSingleTable:!f})}`:void 0,r=c?(0,y.ll)` where ${c}`:void 0;return(0,y.ll)`${h}update ${m} set ${n}${o}${p}${r}${q}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,d=a.flatMap(({field:a},d)=>{let f=[];if((0,e.is)(a,y.Xs.Aliased)&&a.isSelectionField)f.push(y.ll.identifier(a.fieldAlias));else if((0,e.is)(a,y.Xs.Aliased)||(0,e.is)(a,y.Xs)){let c=(0,e.is)(a,y.Xs.Aliased)?a.sql:a;b?f.push(new y.Xs(c.queryChunks.map(a=>(0,e.is)(a,o.Kl)?y.ll.identifier(this.casing.getColumnCasing(a)):a))):f.push(c),(0,e.is)(a,y.Xs.Aliased)&&f.push((0,y.ll)` as ${y.ll.identifier(a.fieldAlias)}`)}else(0,e.is)(a,m.V)&&(b?f.push(y.ll.identifier(this.casing.getColumnCasing(a))):f.push(a));return d<c-1&&f.push((0,y.ll)`, `),f});return y.ll.join(d)}buildJoins(a){if(!a||0===a.length)return;let b=[];for(let[c,d]of a.entries()){0===c&&b.push((0,y.ll)` `);let f=d.table,g=d.lateral?(0,y.ll)` lateral`:void 0,h=d.on?(0,y.ll)` on ${d.on}`:void 0;if((0,e.is)(f,w.mu)){let a=f[w.mu.Symbol.Name],c=f[w.mu.Symbol.Schema],e=f[w.mu.Symbol.OriginalName],i=a===e?void 0:d.alias;b.push((0,y.ll)`${y.ll.raw(d.joinType)} join${g} ${c?(0,y.ll)`${y.ll.identifier(c)}.`:void 0}${y.ll.identifier(e)}${i&&(0,y.ll)` ${y.ll.identifier(i)}`}${h}`)}else if((0,e.is)(f,y.Ss)){let a=f[C.n].name,c=f[C.n].schema,e=f[C.n].originalName,i=a===e?void 0:d.alias;b.push((0,y.ll)`${y.ll.raw(d.joinType)} join${g} ${c?(0,y.ll)`${y.ll.identifier(c)}.`:void 0}${y.ll.identifier(e)}${i&&(0,y.ll)` ${y.ll.identifier(i)}`}${h}`)}else b.push((0,y.ll)`${y.ll.raw(d.joinType)} join${g} ${f}${h}`);c<a.length-1&&b.push((0,y.ll)` `)}return y.ll.join(b)}buildFromTable(a){if((0,e.is)(a,h.XI)&&a[h.XI.Symbol.IsAlias]){let b=(0,y.ll)`${y.ll.identifier(a[h.XI.Symbol.OriginalName])}`;return a[h.XI.Symbol.Schema]&&(b=(0,y.ll)`${y.ll.identifier(a[h.XI.Symbol.Schema])}.${b}`),(0,y.ll)`${b} ${y.ll.identifier(a[h.XI.Symbol.Name])}`}return a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:d,having:f,table:g,joins:i,orderBy:j,groupBy:k,limit:l,offset:n,lockingClause:o,distinct:p,setOperators:q}){let r,s,t,u=c??(0,B.He)(b);for(let a of u){let b;if((0,e.is)(a.field,m.V)&&(0,h.Io)(a.field.table)!==((0,e.is)(g,A.n)?g._.alias:(0,e.is)(g,D)?g[C.n].name:(0,e.is)(g,y.Xs)?void 0:(0,h.Io)(g))&&(b=a.field.table,!i?.some(({alias:a})=>a===(b[h.XI.Symbol.IsAlias]?(0,h.Io)(b):b[h.XI.Symbol.BaseName])))){let b=(0,h.Io)(a.field.table);throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let v=!i||0===i.length,w=this.buildWithCTE(a);p&&(r=!0===p?(0,y.ll)` distinct`:(0,y.ll)` distinct on (${y.ll.join(p.on,(0,y.ll)`, `)})`);let x=this.buildSelection(u,{isSingleTable:v}),z=this.buildFromTable(g),E=this.buildJoins(i),F=d?(0,y.ll)` where ${d}`:void 0,G=f?(0,y.ll)` having ${f}`:void 0;j&&j.length>0&&(s=(0,y.ll)` order by ${y.ll.join(j,(0,y.ll)`, `)}`),k&&k.length>0&&(t=(0,y.ll)` group by ${y.ll.join(k,(0,y.ll)`, `)}`);let H="object"==typeof l||"number"==typeof l&&l>=0?(0,y.ll)` limit ${l}`:void 0,I=n?(0,y.ll)` offset ${n}`:void 0,J=y.ll.empty();if(o){let a=(0,y.ll)` for ${y.ll.raw(o.strength)}`;o.config.of&&a.append((0,y.ll)` of ${y.ll.join(Array.isArray(o.config.of)?o.config.of:[o.config.of],(0,y.ll)`, `)}`),o.config.noWait?a.append((0,y.ll)` nowait`):o.config.skipLocked&&a.append((0,y.ll)` skip locked`),J.append(a)}let K=(0,y.ll)`${w}select${r} ${x} from ${z}${E}${F}${t}${G}${s}${H}${I}${J}`;return q.length>0?this.buildSetOperations(K,q):K}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:d,limit:f,orderBy:g,offset:h}}){let i,j=(0,y.ll)`(${a.getSQL()}) `,k=(0,y.ll)`(${d.getSQL()})`;if(g&&g.length>0){let a=[];for(let b of g)if((0,e.is)(b,o.Kl))a.push(y.ll.identifier(b.name));else if((0,e.is)(b,y.Xs)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];(0,e.is)(c,o.Kl)&&(b.queryChunks[a]=y.ll.identifier(c.name))}a.push((0,y.ll)`${b}`)}else a.push((0,y.ll)`${b}`);i=(0,y.ll)` order by ${y.ll.join(a,(0,y.ll)`, `)} `}let l="object"==typeof f||"number"==typeof f&&f>=0?(0,y.ll)` limit ${f}`:void 0,m=y.ll.raw(`${b} ${c?"all ":""}`),n=h?(0,y.ll)` offset ${h}`:void 0;return(0,y.ll)`${j}${m}${k}${i}${l}${n}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:d,withList:f,select:g,overridingSystemValue_:i}){let j=[],k=Object.entries(a[h.XI.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),l=k.map(([,a])=>y.ll.identifier(this.casing.getColumnCasing(a)));if(g)(0,e.is)(b,y.Xs)?j.push(b):j.push(b.getSQL());else for(let[a,c]of(j.push(y.ll.raw("values ")),b.entries())){let d=[];for(let[a,b]of k){let f=c[a];if(void 0===f||(0,e.is)(f,y.Iw)&&void 0===f.value)if(void 0!==b.defaultFn){let a=b.defaultFn(),c=(0,e.is)(a,y.Xs)?a:y.ll.param(a,b);d.push(c)}else if(b.default||void 0===b.onUpdateFn)d.push((0,y.ll)`default`);else{let a=b.onUpdateFn(),c=(0,e.is)(a,y.Xs)?a:y.ll.param(a,b);d.push(c)}else d.push(f)}j.push(d),a<b.length-1&&j.push((0,y.ll)`, `)}let m=this.buildWithCTE(f),n=y.ll.join(j),o=d?(0,y.ll)` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,p=c?(0,y.ll)` on conflict ${c}`:void 0,q=!0===i?(0,y.ll)`overriding system value `:void 0;return(0,y.ll)`${m}insert into ${a} ${l} ${q}${n}${p}${o}`}buildRefreshMaterializedViewQuery({view:a,concurrently:b,withNoData:c}){let d=b?(0,y.ll)` concurrently`:void 0,e=c?(0,y.ll)` with no data`:void 0;return(0,y.ll)`refresh materialized view${d} ${a}${e}`}prepareTyping(a){if((0,e.is)(a,p.kn)||(0,e.is)(a,q.iX))return"json";if((0,e.is)(a,r.Z5))return"decimal";if((0,e.is)(a,s.Xd))return"time";if((0,e.is)(a,t.KM)||(0,e.is)(a,t.xQ))return"timestamp";if((0,e.is)(a,u.qw)||(0,e.is)(a,u.dw))return"date";else if((0,e.is)(a,v.dL))return"uuid";else return"none"}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:b})}buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:d,tableConfig:f,queryConfig:i,tableAlias:j,nestedQueryRelation:k,joinOn:l}){let o,p=[],q,r,s=[],t,u=[];if(!0===i)p=Object.entries(f.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:(0,g.ug)(b,j),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let d=Object.fromEntries(Object.entries(f.columns).map(([a,b])=>[a,(0,g.ug)(b,j)]));if(i.where){let a="function"==typeof i.where?i.where(d,(0,x.mm)()):i.where;t=a&&(0,g.yY)(a,j)}let k=[],l=[];if(i.columns){let a=!1;for(let[b,c]of Object.entries(i.columns))void 0!==c&&b in f.columns&&(a||!0!==c||(a=!0),l.push(b));l.length>0&&(l=a?l.filter(a=>i.columns?.[a]===!0):Object.keys(f.columns).filter(a=>!l.includes(a)))}else l=Object.keys(f.columns);for(let a of l){let b=f.columns[a];k.push({tsKey:a,value:b})}let n=[];if(i.with&&(n=Object.entries(i.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:f.relations[a]}))),i.extras)for(let[a,b]of Object.entries("function"==typeof i.extras?i.extras(d,{sql:y.ll}):i.extras))k.push({tsKey:a,value:(0,g.Hs)(b,j)});for(let{tsKey:a,value:b}of k)p.push({dbKey:(0,e.is)(b,y.Xs.Aliased)?b.fieldAlias:f.columns[a].name,tsKey:a,field:(0,e.is)(b,m.V)?(0,g.ug)(b,j):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let o="function"==typeof i.orderBy?i.orderBy(d,(0,x.rl)()):i.orderBy??[];for(let{tsKey:d,queryConfig:f,relation:k}of(Array.isArray(o)||(o=[o]),s=o.map(a=>(0,e.is)(a,m.V)?(0,g.ug)(a,j):(0,g.yY)(a,j)),q=i.limit,r=i.offset,n)){let i=(0,x.W0)(b,c,k),l=c[(0,h.Lf)(k.referencedTable)],m=`${j}_${d}`,n=(0,z.Uo)(...i.fields.map((a,b)=>(0,z.eq)((0,g.ug)(i.references[b],m),(0,g.ug)(a,j)))),o=this.buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:a[l],tableConfig:b[l],queryConfig:(0,e.is)(k,x.pD)?!0===f?{limit:1}:{...f,limit:1}:f,tableAlias:m,joinOn:n,nestedQueryRelation:k}),q=(0,y.ll)`${y.ll.identifier(m)}.${y.ll.identifier("data")}`.as(d);u.push({on:(0,y.ll)`true`,table:new A.n(o.sql,{},m),alias:m,joinType:"left",lateral:!0}),p.push({dbKey:d,tsKey:d,field:q,relationTableTsKey:l,isJson:!0,selection:o.selection})}}if(0===p.length)throw new n.n9({message:`No fields selected for table "${f.tsName}" ("${j}")`});if(t=(0,z.Uo)(l,t),k){let a=(0,y.ll)`json_build_array(${y.ll.join(p.map(({field:a,tsKey:b,isJson:c})=>c?(0,y.ll)`${y.ll.identifier(`${j}_${b}`)}.${y.ll.identifier("data")}`:(0,e.is)(a,y.Xs.Aliased)?a.sql:a),(0,y.ll)`, `)})`;(0,e.is)(k,x.iv)&&(a=(0,y.ll)`coalesce(json_agg(${a}${s.length>0?(0,y.ll)` order by ${y.ll.join(s,(0,y.ll)`, `)}`:void 0}), '[]'::json)`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:f.tsName,selection:p}];void 0!==q||void 0!==r||s.length>0?(o=this.buildSelectQuery({table:(0,g.oG)(d,j),fields:{},fieldsFlat:[{path:[],field:y.ll.raw("*")}],where:t,limit:q,offset:r,orderBy:s,setOperators:[]}),t=void 0,q=void 0,r=void 0,s=[]):o=(0,g.oG)(d,j),o=this.buildSelectQuery({table:(0,e.is)(o,w.mu)?o:new A.n(o,{},j),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:(0,e.is)(a,m.V)?(0,g.ug)(a,j):a})),joins:u,where:t,limit:q,offset:r,orderBy:s,setOperators:[]})}else o=this.buildSelectQuery({table:(0,g.oG)(d,j),fields:{},fieldsFlat:p.map(({field:a})=>({path:[],field:(0,e.is)(a,m.V)?(0,g.ug)(a,j):a})),joins:u,where:t,limit:q,offset:r,orderBy:s,setOperators:[]});return{tableTsKey:f.tsName,sql:o,selection:p}}}class F{static [e.i]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===C.n)return{...a[C.n],selectedFields:new Proxy(a[C.n].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=((0,e.is)(a,A.n)?a._.selectedFields:(0,e.is)(a,y.Ss)?a[C.n].selectedFields:a)[b];if((0,e.is)(c,y.Xs.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if((0,e.is)(c,y.Xs)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,e.is)(c,m.V)?this.config.alias?new Proxy(c,new g.Ht(new Proxy(c.table,new g.h_(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new F(this.config))}}class G{static [e.i]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}var H=c(1346),I=c(25332);function J(a){return(0,e.is)(a,w.mu)?[a[h.Sj]?`${a[h.Sj]}.${a[h.XI.Symbol.BaseName]}`:a[h.XI.Symbol.BaseName]]:(0,e.is)(a,A.n)?a._.usedTables??[]:(0,e.is)(a,y.Xs)?a.usedTables??[]:[]}class K{static [e.i]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,a.withList&&(this.withList=a.withList),this.distinct=a.distinct}authToken;setToken(a){return this.authToken=a,this}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:(0,e.is)(a,A.n)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):(0,e.is)(a,D)?a[C.n].selectedFields:(0,e.is)(a,y.Xs)?{}:(0,B.YD)(a),new M({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class L extends G{static [e.i]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(let h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=(0,B.zN)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},J(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a,b){return(c,d)=>{let f=this.tableName,g=(0,B.zN)(c);for(let a of J(c))this.usedTables.add(a);if("string"==typeof g&&this.config.joins?.some(a=>a.alias===g))throw Error(`Alias "${g}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof f&&(this.config.fields={[f]:this.config.fields}),"string"==typeof g&&!(0,e.is)(c,y.Xs))){let a=(0,e.is)(c,A.n)?c._.selectedFields:(0,e.is)(c,y.Ss)?c[C.n].selectedFields:c[h.XI.Symbol.Columns];this.config.fields[g]=a}if("function"==typeof d&&(d=d(new Proxy(this.config.fields,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:d,table:c,joinType:a,alias:g,lateral:b}),"string"==typeof g)switch(a){case"left":this.joinsNotNullableMap[g]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[g]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[g]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[g]=!1}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(a,b){return c=>{let d="function"==typeof c?c(O()):c;if(!(0,B.DV)(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new F({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new F({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}for(a,b={}){return this.config.lockingClause={strength:a,config:b},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...J(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...J(a.table));return new Proxy(new A.n(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new F({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new F({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}}class M extends L{static [e.i]="PgSelect";_prepare(a){let{session:b,config:c,dialect:d,joinsNotNullableMap:e,authToken:f,cacheConfig:g,usedTables:h}=this;if(!b)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:i}=c;return I.k.startActiveSpan("drizzle.prepareQuery",()=>{let c=(0,B.He)(i),j=b.prepareQuery(d.sqlToQuery(this.getSQL()),c,a,!0,void 0,{type:"select",tables:[...h]},g);return j.joinsNotNullableMap=e,j.setToken(f)})}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>I.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}function N(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!(0,B.DV)(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}(0,B.XJ)(M,[H.k]);let O=()=>({union:P,unionAll:Q,intersect:R,intersectAll:S,except:T,exceptAll:U}),P=N("union",!1),Q=N("union",!0),R=N("intersect",!1),S=N("intersect",!0),T=N("except",!1),U=N("except",!0);class V{static [e.i]="PgQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=(0,e.is)(a,E)?a:void 0,this.dialectConfig=(0,e.is)(a,E)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new A.J(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new F({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new K({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(a){return new K({fields:a??void 0,session:void 0,dialect:b.getDialect(),distinct:!0})},selectDistinctOn:function(a,c){return new K({fields:c??void 0,session:void 0,dialect:b.getDialect(),distinct:{on:a}})}}}select(a){return new K({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new K({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(a,b){return new K({fields:b??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:a}})}getDialect(){return this.dialect||(this.dialect=new E(this.dialectConfig)),this.dialect}}class W{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [e.i]="PgUpdateBuilder";authToken;setToken(a){return this.authToken=a,this}set(a){return new X(this.table,(0,B.q)(this.table,a),this.session,this.dialect,this.withList).setToken(this.authToken)}}class X extends H.k{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]},this.tableName=(0,B.zN)(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [e.i]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(a){let b=(0,B.zN)(a);return"string"==typeof b&&(this.joinsNotNullableMap[b]=!0),this.config.from=a,this}getTableLikeFields(a){return(0,e.is)(a,w.mu)?a[h.XI.Symbol.Columns]:(0,e.is)(a,A.n)?a._.selectedFields:a[C.n].selectedFields}createJoin(a){return(b,c)=>{let d=(0,B.zN)(b);if("string"==typeof d&&this.config.joins.some(a=>a.alias===d))throw Error(`Alias "${d}" is already used in this query`);if("function"==typeof c){let a=this.config.from&&!(0,e.is)(this.config.from,y.Xs)?this.getTableLikeFields(this.config.from):void 0;c=c(new Proxy(this.config.table[h.XI.Symbol.Columns],new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new F({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:c,table:b,joinType:a,alias:d}),"string"==typeof d)switch(a){case"left":this.joinsNotNullableMap[d]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!0;break;case"inner":this.joinsNotNullableMap[d]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}returning(a){if(!a&&(a=Object.assign({},this.config.table[h.XI.Symbol.Columns]),this.config.from)){let b=(0,B.zN)(this.config.from);if("string"==typeof b&&this.config.from&&!(0,e.is)(this.config.from,y.Xs)){let c=this.getTableLikeFields(this.config.from);a[b]=c}for(let b of this.config.joins){let c=(0,B.zN)(b.table);if("string"==typeof c&&!(0,e.is)(b.table,y.Xs)){let d=this.getTableLikeFields(b.table);a[c]=d}}}return this.config.returningFields=a,this.config.returning=(0,B.He)(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){let b=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:J(this.config.table)},this.cacheConfig);return b.joinsNotNullableMap=this.joinsNotNullableMap,b}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>this._prepare().execute(a,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new F({alias:(0,h.Io)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class Y{constructor(a,b,c,d,e){this.table=a,this.session=b,this.dialect=c,this.withList=d,this.overridingSystemValue_=e}static [e.i]="PgInsertBuilder";authToken;setToken(a){return this.authToken=a,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[h.XI.Symbol.Columns];for(let d of Object.keys(a)){let f=a[d];b[d]=(0,e.is)(f,y.Xs)?f:new y.Iw(f,c[d])}return b});return new Z(this.table,b,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(a){let b="function"==typeof a?a(new V):a;if(!(0,e.is)(b,y.Xs)&&!(0,B.DV)(this.table[h.e],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new Z(this.table,b,this.session,this.dialect,this.withList,!0)}}class Z extends H.k{constructor(a,b,c,d,e,f,g){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f,overridingSystemValue_:g}}static [e.i]="PgInsert";config;cacheConfig;returning(a=this.config.table[h.XI.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=(0,B.He)(a),this}onConflictDoNothing(a={}){if(void 0===a.target)this.config.onConflict=(0,y.ll)`do nothing`;else{let b="";b=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target));let c=a.where?(0,y.ll)` where ${a.where}`:void 0;this.config.onConflict=(0,y.ll)`(${y.ll.raw(b)})${c} do nothing`}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let b=a.where?(0,y.ll)` where ${a.where}`:void 0,c=a.targetWhere?(0,y.ll)` where ${a.targetWhere}`:void 0,d=a.setWhere?(0,y.ll)` where ${a.setWhere}`:void 0,e=this.dialect.buildUpdateSet(this.config.table,(0,B.q)(this.config.table,a.set)),f="";return f=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target)),this.config.onConflict=(0,y.ll)`(${y.ll.raw(f)})${c} do update set ${e}${b}${d}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return I.k.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:J(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>I.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new F({alias:(0,h.Io)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class $ extends H.k{constructor(a,b,c,d){super(),this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [e.i]="PgDelete";config;cacheConfig;where(a){return this.config.where=a,this}returning(a=this.config.table[h.XI.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=(0,B.He)(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return I.k.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"delete",tables:J(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>I.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new F({alias:(0,h.Io)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class _ extends y.Xs{constructor(a){super(_.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.mapWith(Number),this.session=a.session,this.sql=_.buildCount(a.source,a.filters)}sql;token;static [e.i]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(a,b){return(0,y.ll)`(select count(*) from ${a}${y.ll.raw(" where ").if(b)}${b})`}static buildCount(a,b){return(0,y.ll)`select count(*) as count from ${a}${y.ll.raw(" where ").if(b)}${b};`}setToken(a){return this.token=a,this}then(a,b){return Promise.resolve(this.session.count(this.sql,this.token)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class aa{constructor(a,b,c,d,e,f,g){this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g}static [e.i]="PgRelationalQueryBuilder";findMany(a){return new ab(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return new ab(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class ab extends H.k{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [e.i]="PgRelationalQuery";_prepare(a){return I.k.startActiveSpan("drizzle.prepareQuery",()=>{let{query:b,builtQuery:c}=this._toSQL();return this.session.prepareQuery(c,void 0,a,!0,(a,c)=>{let d=a.map(a=>(0,x.I$)(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})})}prepare(a){return this._prepare(a)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let a=this._getQuery(),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(a){return this.authToken=a,this}execute(){return I.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class ac extends H.k{constructor(a,b,c,d){super(),this.execute=a,this.sql=b,this.query=c,this.mapBatchResult=d}static [e.i]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class ad extends H.k{constructor(a,b,c){super(),this.session=b,this.dialect=c,this.config={view:a}}static [e.i]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return I.k.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,a,!0))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>I.k.startActiveSpan("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}class ae{constructor(a,b,c){if(this.dialect=a,this.session=b,this._=c?{schema:c.schema,fullSchema:c.fullSchema,tableNamesMap:c.tableNamesMap,session:b}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:b},this.query={},this._.schema)for(let[d,e]of Object.entries(this._.schema))this.query[d]=new aa(c.fullSchema,this._.schema,this._.tableNamesMap,c.fullSchema[d],e,a,b);this.$cache={invalidate:async a=>{}}}static [e.i]="PgDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new V(c.dialect))),new Proxy(new A.J(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new F({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new _({source:a,filters:b,session:this.session})}$cache;with(...a){let b=this;return{select:function(c){return new K({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new K({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},selectDistinctOn:function(c,d){return new K({fields:d??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:{on:c}})},update:function(c){return new W(c,b.session,b.dialect,a)},insert:function(c){return new Y(c,b.session,b.dialect,a)},delete:function(c){return new $(c,b.session,b.dialect,a)}}}select(a){return new K({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new K({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(a,b){return new K({fields:b??void 0,session:this.session,dialect:this.dialect,distinct:{on:a}})}update(a){return new W(a,this.session,this.dialect)}insert(a){return new Y(a,this.session,this.dialect)}delete(a){return new $(a,this.session,this.dialect)}refreshMaterializedView(a){return new ad(a,this.session,this.dialect)}authToken;execute(a){let b="string"==typeof a?y.ll.raw(a):a.getSQL(),c=this.dialect.sqlToQuery(b),d=this.session.prepareQuery(c,void 0,void 0,!1);return new ac(()=>d.execute(void 0,this.authToken),b,c,a=>d.mapResult(a,!0))}transaction(a,b){return this.session.transaction(a,b)}}class af{static [e.i]="Cache"}class ag extends af{strategy(){return"all"}static [e.i]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function ah(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class ai{constructor(a,b,c,d){this.query=a,this.cache=b,this.queryMetadata=c,this.cacheConfig=d,b&&"all"===b.strategy()&&void 0===d&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(a,b){return a}setToken(a){return this.authToken=a,this}static [e.i]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||(0,e.is)(this.cache,ag)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new n.Rv(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new n.Rv(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new n.Rv(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await ah(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new n.Rv(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await ah(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new n.Rv(a,b,c)}}}class aj{constructor(a){this.dialect=a}static [e.i]="PgSession";execute(a,b){return I.k.startActiveSpan("drizzle.operation",()=>I.k.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1)).setToken(b).execute(void 0,b))}all(a){return this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1).all()}async count(a,b){return Number((await this.execute(a,b))[0].count)}}class ak extends ae{constructor(a,b,c,d=0){super(a,b,c),this.schema=c,this.nestedIndex=d}static [e.i]="PgTransaction";rollback(){throw new n.jY}getTransactionConfigSQL(a){let b=[];return a.isolationLevel&&b.push(`isolation level ${a.isolationLevel}`),a.accessMode&&b.push(a.accessMode),"boolean"==typeof a.deferrable&&b.push(a.deferrable?"deferrable":"not deferrable"),y.ll.raw(b.join(" "))}setTransaction(a){return this.session.execute((0,y.ll)`set transaction ${this.getTransactionConfigSQL(a)}`)}}class al extends ai{constructor(a,b,c,d,e,f,g,h,i,j){super({sql:b,params:c},e,f,g),this.client=a,this.queryString=b,this.params=c,this.logger=d,this.fields=h,this._isResponseInArrayMode=i,this.customResultMapper=j}static [e.i]="PostgresJsPreparedQuery";async execute(a={}){return I.k.startActiveSpan("drizzle.execute",async b=>{let c=(0,y.Ct)(this.params,a);b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.logger.logQuery(this.queryString,c);let{fields:d,queryString:e,client:f,joinsNotNullableMap:g,customResultMapper:h}=this;if(!d&&!h)return I.k.startActiveSpan("drizzle.driver.execute",()=>this.queryWithCache(e,c,async()=>await f.unsafe(e,c)));let i=await I.k.startActiveSpan("drizzle.driver.execute",()=>(b?.setAttributes({"drizzle.query.text":e,"drizzle.query.params":JSON.stringify(c)}),this.queryWithCache(e,c,async()=>await f.unsafe(e,c).values())));return I.k.startActiveSpan("drizzle.mapResponse",()=>h?h(i):i.map(a=>(0,B.a6)(d,a,g)))})}all(a={}){return I.k.startActiveSpan("drizzle.execute",async b=>{let c=(0,y.Ct)(this.params,a);return b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.logger.logQuery(this.queryString,c),I.k.startActiveSpan("drizzle.driver.execute",()=>(b?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(c)}),this.queryWithCache(this.queryString,c,async()=>this.client.unsafe(this.queryString,c))))})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class am extends aj{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new f.Pv,this.cache=d.cache??new ag}static [e.i]="PostgresJsSession";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new al(this.client,a.sql,a.params,this.logger,this.cache,f,g,b,d,e)}query(a,b){return this.logger.logQuery(a,b),this.client.unsafe(a,b).values()}queryObjects(a,b){return this.client.unsafe(a,b)}transaction(a,b){return this.client.begin(async c=>{let d=new am(c,this.dialect,this.schema,this.options),e=new an(this.dialect,d,this.schema);return b&&await e.setTransaction(b),a(e)})}}class an extends ak{constructor(a,b,c,d=0){super(a,b,c,d),this.session=b}static [e.i]="PostgresJsTransaction";transaction(a){return this.session.client.savepoint(b=>{let c=new am(b,this.dialect,this.schema,this.session.options);return a(new an(this.dialect,c,this.schema))})}}class ao extends ae{static [e.i]="PostgresJsDatabase"}function ap(a,b={}){let c,d,e=a=>a;for(let b of["1184","1082","1083","1114","1182","1185","1115","1231"])a.options.parsers[b]=e,a.options.serializers[b]=e;a.options.serializers["114"]=e,a.options.serializers["3802"]=e;let g=new E({casing:b.casing});if(!0===b.logger?c=new f.w:!1!==b.logger&&(c=b.logger),b.schema){let a=(0,x._k)(b.schema,x.DZ);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let h=new am(a,g,d,{logger:c,cache:b.cache}),i=new ao(g,h,d);return i.$client=a,i.$cache=b.cache,i.$cache&&(i.$cache.invalidate=b.cache?.onMutate),i}function aq(...a){if("string"==typeof a[0])return ap((0,d.A)(a[0]),a[1]);if((0,B.Lq)(a[0])){let{connection:b,client:c,...e}=a[0];if(c)return ap(c,e);if("object"==typeof b&&void 0!==b.url){let{url:a,...c}=b;return ap((0,d.A)(a,c),e)}return ap((0,d.A)(b),e)}return ap(a[0],a[1])}(aq||(aq={})).mock=function(a){return ap({options:{parsers:{},serializers:{}}},a)}},7762:(a,b,c)=>{c.d(b,{CX:()=>h,HE:()=>k,Io:()=>p,Lf:()=>q,RG:()=>i,Sj:()=>f,W9:()=>l,XI:()=>n,bI:()=>o,e:()=>g,v6:()=>j});var d=c(8575),e=c(47389);let f=Symbol.for("drizzle:Schema"),g=Symbol.for("drizzle:Columns"),h=Symbol.for("drizzle:ExtraConfigColumns"),i=Symbol.for("drizzle:OriginalName"),j=Symbol.for("drizzle:BaseName"),k=Symbol.for("drizzle:IsAlias"),l=Symbol.for("drizzle:ExtraConfigBuilder"),m=Symbol.for("drizzle:IsDrizzleTable");class n{static [d.i]="Table";static Symbol={Name:e.E,Schema:f,OriginalName:i,Columns:g,ExtraConfigColumns:h,BaseName:j,IsAlias:k,ExtraConfigBuilder:l};[e.E];[i];[f];[g];[h];[j];[k]=!1;[m]=!0;[l]=void 0;constructor(a,b,c){this[e.E]=this[i]=a,this[f]=b,this[j]=c}}function o(a){return"object"==typeof a&&null!==a&&m in a}function p(a){return a[e.E]}function q(a){return`${a[f]??"public"}.${a[e.E]}`}},8575:(a,b,c)=>{c.d(b,{i:()=>d,is:()=>f,m:()=>e});let d=Symbol.for("drizzle:entityKind"),e=Symbol.for("drizzle:hasOwnEntityKind");function f(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,d))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(d in c&&c[d]===b[d])return!0;c=Object.getPrototypeOf(c)}return!1}},9055:(a,b,c)=>{c.d(b,{Q:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"JSONReferenceNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JSONReferenceNode",reference:a,traversal:b}),cloneWithTraversal:(a,b)=>(0,d.CN)({...a,traversal:b})})},9633:(a,b,c)=>{c.d(b,{mu:()=>aU,cJ:()=>aV});var d=c(8575),e=c(7762),f=c(37103),g=c(10289);class h extends g.pe{static [d.i]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class i extends h{static [d.i]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new j(a,this.config)}}class j extends g.Kl{static [d.i]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class k extends h{static [d.i]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new l(a,this.config)}}class l extends g.Kl{static [d.i]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}function m(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return"number"===d.mode?new i(c):new k(c)}class n extends g.pe{static [d.i]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new o(a,this.config)}}class o extends g.Kl{static [d.i]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class p extends g.pe{static [d.i]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new q(a,this.config)}}class q extends g.Kl{static [d.i]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}function r(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return"number"===d.mode?new n(c):new p(c)}var s=c(310);class t extends g.pe{static [d.i]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new u(a,this.config)}}class u extends g.Kl{static [d.i]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function v(a,b={}){let{name:c,config:d}=(0,f.Ll)(a,b);return new t(c,d)}class w extends g.pe{static [d.i]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new x(a,this.config)}}class x extends g.Kl{static [d.i]="PgCidr";getSQLType(){return"cidr"}}function y(a){return new w(a??"")}class z extends g.pe{static [d.i]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new A(a,this.config)}}class A extends g.Kl{static [d.i]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function B(a){return(b,c)=>{let{name:d,config:e}=(0,f.Ll)(b,c);return new z(d,e,a)}}var C=c(96508);class D extends g.pe{static [d.i]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new E(a,this.config)}}class E extends g.Kl{static [d.i]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}function F(a){return new D(a??"")}class G extends g.pe{static [d.i]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new H(a,this.config)}}class H extends g.Kl{static [d.i]="PgInet";getSQLType(){return"inet"}}function I(a){return new G(a??"")}class J extends h{static [d.i]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new K(a,this.config)}}class K extends g.Kl{static [d.i]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}function L(a){return new J(a??"")}class M extends g.pe{static [d.i]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new N(a,this.config)}}class N extends g.Kl{static [d.i]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}function O(a,b={}){let{name:c,config:d}=(0,f.Ll)(a,b);return new M(c,d)}var P=c(84246),Q=c(16406);class R extends g.pe{static [d.i]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new S(a,this.config)}}class S extends g.Kl{static [d.i]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class T extends g.pe{static [d.i]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new U(a,this.config)}}class U extends g.Kl{static [d.i]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}function V(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode&&"tuple"!==d.mode?new T(c):new R(c)}class W extends g.pe{static [d.i]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new X(a,this.config)}}class X extends g.Kl{static [d.i]="PgMacaddr";getSQLType(){return"macaddr"}}function Y(a){return new W(a??"")}class Z extends g.pe{static [d.i]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new $(a,this.config)}}class $ extends g.Kl{static [d.i]="PgMacaddr8";getSQLType(){return"macaddr8"}}function _(a){return new Z(a??"")}var aa=c(90593);class ab extends g.pe{static [d.i]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new ac(a,this.config)}}class ac extends g.Kl{static [d.i]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class ad extends g.pe{static [d.i]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new ae(a,this.config)}}class ae extends g.Kl{static [d.i]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}function af(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode&&"tuple"!==d.mode?new ad(c):new ab(c)}function ag(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function ah(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=ag(b,c),d=ag(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class ai extends g.pe{static [d.i]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new aj(a,this.config)}}class aj extends g.Kl{static [d.i]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return ah(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class ak extends g.pe{static [d.i]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new al(a,this.config)}}class al extends g.Kl{static [d.i]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=ah(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}function am(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return d?.mode&&"tuple"!==d.mode?new ak(c):new ai(c)}class an extends g.pe{static [d.i]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new ao(a,this.config)}}class ao extends g.Kl{static [d.i]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}function ap(a){return new an(a??"")}class aq extends g.pe{static [d.i]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new ar(a,this.config)}}class ar extends g.Kl{static [d.i]="PgSerial";getSQLType(){return"serial"}}function as(a){return new aq(a??"")}class at extends h{static [d.i]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new au(a,this.config)}}class au extends g.Kl{static [d.i]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}function av(a){return new at(a??"")}class aw extends g.pe{static [d.i]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new ax(a,this.config)}}class ax extends g.Kl{static [d.i]="PgSmallSerial";getSQLType(){return"smallserial"}}function ay(a){return new aw(a??"")}var az=c(35447),aA=c(97949),aB=c(96406),aC=c(70659);class aD extends g.pe{static [d.i]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new aE(a,this.config)}}class aE extends g.Kl{static [d.i]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function aF(a,b={}){let{name:c,config:d}=(0,f.Ll)(a,b);return new aD(c,d)}class aG extends g.pe{static [d.i]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new aH(a,this.config)}}class aH extends g.Kl{static [d.i]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function aI(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aG(c,d)}class aJ extends g.pe{static [d.i]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new aK(a,this.config)}}class aK extends g.Kl{static [d.i]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function aL(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aJ(c,d)}class aM extends g.pe{static [d.i]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new aN(a,this.config)}}class aN extends g.Kl{static [d.i]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function aO(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aM(c,d)}class aP extends g.pe{static [d.i]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new aQ(a,this.config)}}class aQ extends g.Kl{static [d.i]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function aR(a,b){let{name:c,config:d}=(0,f.Ll)(a,b);return new aP(c,d)}let aS=Symbol.for("drizzle:PgInlineForeignKeys"),aT=Symbol.for("drizzle:EnableRLS");class aU extends e.XI{static [d.i]="PgTable";static Symbol=Object.assign({},e.XI.Symbol,{InlineForeignKeys:aS,EnableRLS:aT});[aS]=[];[aT]=!1;[e.XI.Symbol.ExtraConfigBuilder]=void 0;[e.XI.Symbol.ExtraConfigColumns]={}}let aV=(a,b,c)=>(function(a,b,c,d,f=a){let g=new aU(a,d,f),h="function"==typeof b?b({bigint:m,bigserial:r,boolean:s.zM,char:v,cidr:y,customType:B,date:C.p6,doublePrecision:F,inet:I,integer:L,interval:O,json:P.Pq,jsonb:Q.Fx,line:V,macaddr:Y,macaddr8:_,numeric:aa.sH,point:af,geometry:am,real:ap,serial:as,smallint:av,smallserial:ay,text:az.Qq,time:aA.kB,timestamp:aB.vE,uuid:aC.uR,varchar:aF,bit:aI,halfvec:aL,sparsevec:aO,vector:aR}):b,i=Object.fromEntries(Object.entries(h).map(([a,b])=>{b.setName(a);let c=b.build(g);return g[aS].push(...b.buildForeignKeys(c,g)),[a,c]})),j=Object.fromEntries(Object.entries(h).map(([a,b])=>(b.setName(a),[a,b.buildExtraConfigColumn(g)]))),k=Object.assign(g,i);return k[e.XI.Symbol.Columns]=i,k[e.XI.Symbol.ExtraConfigColumns]=j,c&&(k[aU.Symbol.ExtraConfigBuilder]=c),Object.assign(k,{enableRLS:()=>(k[aU.Symbol.EnableRLS]=!0,k)})})(a,b,c,void 0)},9744:(a,b,c)=>{c.d(b,{B:()=>f,q:()=>g});var d=c(23244),e=c(59659);function f(a){return(0,e.Gv)(a)&&"expressionType"in a&&(0,d.N)(a)}function g(a){return(0,e.Gv)(a)&&"expression"in a&&(0,e.Kg)(a.alias)&&(0,d.N)(a)}},10289:(a,b,c)=>{c.d(b,{Kl:()=>q,pe:()=>p});var d=c(44272),e=c(98318),f=c(8575),g=c(47389);class h{static [f.i]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new i(a,this)}}class i{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [f.i]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[g.E],...d,c[0].table[g.E],...e];return a??`${f.join("_")}_fk`}}var j=c(5596);function k(a,b){return`${a[g.E]}_${b.join("_")}_unique`}class l{constructor(a,b){this.name=b,this.columns=a}static [f.i]=null;columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new n(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class m{static [f.i]=null;name;constructor(a){this.name=a}on(...a){return new l(a,this.name)}}class n{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??k(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [f.i]=null;columns;name;nullsNotDistinct=!1;getName(){return this.name}}function o(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}class p extends d.Q{foreignKeyConfigs=[];static [f.i]="PgColumnBuilder";array(a){return new t(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>(0,j.i)((c,d)=>{let e=new h(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new r(a,this.config)}}class q extends e.V{constructor(a,b){b.uniqueName||(b.uniqueName=k(a,[b.name])),super(a,b),this.table=a}static [f.i]="PgColumn"}class r extends q{static [f.i]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class s{static [f.i]=null;constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class t extends p{static [f.i]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new u(a,this.config,b)}}class u extends q{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [f.i]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=o(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=o(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:(0,f.is)(this.baseColumn,u)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}},11182:(a,b,c)=>{c.d(b,{o:()=>g});var d=c(59659),e=c(58436),f=c(38070);let g=(0,d.CN)({is:a=>"WhereNode"===a.kind,create:a=>(0,d.CN)({kind:"WhereNode",where:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,where:"And"===b?e.s.create(a.where,c):f.K.create(a.where,c)})})},11673:(a,b,c)=>{c.d(b,{s:()=>g});var d=c(70192),e=c(15247),f=c(59061);let g=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>d.aK.importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,g)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let h=await d.aK.sign("HMAC",a,"string"==typeof g?new TextEncoder().encode(g):g);return"hex"===b?e.u.encode(h):"base64"===b||"base64url"===b||"base64urlnopad"===b?f.z.encode(h,{padding:"base64urlnopad"!==b}):h},verify:async(a,g,h)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(h=e.u.decode(h)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(h=await f.K.decode(h)),d.aK.verify("HMAC",a,"string"==typeof h?new TextEncoder().encode(h):h,"string"==typeof g?new TextEncoder().encode(g):g))};return c}},13148:(a,b,c)=>{c.d(b,{$O:()=>w,$S:()=>aa,Au:()=>Q,Be:()=>j,Bj:()=>r,Ct:()=>s,Dl:()=>p,ER:()=>ab,Eb:()=>V,F7:()=>H,FO:()=>ai,Fk:()=>Y,Fn:()=>n,G1:()=>D,G8:()=>O,Hi:()=>U,Il:()=>af,KA:()=>M,KB:()=>B,K_:()=>g,Kn:()=>F,LK:()=>I,MB:()=>ak,Mu:()=>h,Ny:()=>v,Pw:()=>t,Rl:()=>f,Tx:()=>S,Uy:()=>x,WN:()=>ae,YA:()=>X,YY:()=>P,Zm:()=>R,_L:()=>J,_z:()=>u,aC:()=>o,bS:()=>ac,cU:()=>A,dN:()=>K,dR:()=>_,dZ:()=>ah,db:()=>E,em:()=>N,f2:()=>G,fU:()=>aj,fs:()=>q,gP:()=>y,hH:()=>Z,jw:()=>L,lo:()=>ad,m9:()=>W,nA:()=>k,pY:()=>l,qF:()=>$,qm:()=>T,rk:()=>C,rt:()=>z,tB:()=>i,wA:()=>m,xY:()=>ag});var d=c(2175),e=c(58054);function f(a,b){return new a({type:"string",...e.A2(b)})}function g(a,b){return new a({type:"string",coerce:!0,...e.A2(b)})}function h(a,b){return new a({type:"string",format:"email",check:"string_format",abort:!1,...e.A2(b)})}function i(a,b){return new a({type:"string",format:"guid",check:"string_format",abort:!1,...e.A2(b)})}function j(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,...e.A2(b)})}function k(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...e.A2(b)})}function l(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...e.A2(b)})}function m(a,b){return new a({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...e.A2(b)})}function n(a,b){return new a({type:"string",format:"url",check:"string_format",abort:!1,...e.A2(b)})}function o(a,b){return new a({type:"string",format:"emoji",check:"string_format",abort:!1,...e.A2(b)})}function p(a,b){return new a({type:"string",format:"nanoid",check:"string_format",abort:!1,...e.A2(b)})}function q(a,b){return new a({type:"string",format:"cuid",check:"string_format",abort:!1,...e.A2(b)})}function r(a,b){return new a({type:"string",format:"cuid2",check:"string_format",abort:!1,...e.A2(b)})}function s(a,b){return new a({type:"string",format:"ulid",check:"string_format",abort:!1,...e.A2(b)})}function t(a,b){return new a({type:"string",format:"xid",check:"string_format",abort:!1,...e.A2(b)})}function u(a,b){return new a({type:"string",format:"ksuid",check:"string_format",abort:!1,...e.A2(b)})}function v(a,b){return new a({type:"string",format:"ipv4",check:"string_format",abort:!1,...e.A2(b)})}function w(a,b){return new a({type:"string",format:"ipv6",check:"string_format",abort:!1,...e.A2(b)})}function x(a,b){return new a({type:"string",format:"cidrv4",check:"string_format",abort:!1,...e.A2(b)})}function y(a,b){return new a({type:"string",format:"cidrv6",check:"string_format",abort:!1,...e.A2(b)})}function z(a,b){return new a({type:"string",format:"base64",check:"string_format",abort:!1,...e.A2(b)})}function A(a,b){return new a({type:"string",format:"base64url",check:"string_format",abort:!1,...e.A2(b)})}function B(a,b){return new a({type:"string",format:"e164",check:"string_format",abort:!1,...e.A2(b)})}function C(a,b){return new a({type:"string",format:"jwt",check:"string_format",abort:!1,...e.A2(b)})}function D(a,b){return new a({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...e.A2(b)})}function E(a,b){return new a({type:"string",format:"date",check:"string_format",...e.A2(b)})}function F(a,b){return new a({type:"string",format:"time",check:"string_format",precision:null,...e.A2(b)})}function G(a,b){return new a({type:"string",format:"duration",check:"string_format",...e.A2(b)})}function H(a,b){return new a({type:"number",checks:[],...e.A2(b)})}function I(a,b){return new a({type:"number",check:"number_format",abort:!1,format:"safeint",...e.A2(b)})}function J(a,b){return new a({type:"boolean",...e.A2(b)})}function K(a,b){return new a({type:"boolean",coerce:!0,...e.A2(b)})}function L(a,b){return new a({type:"null",...e.A2(b)})}function M(a){return new a({type:"any"})}function N(a){return new a({type:"unknown"})}function O(a,b){return new a({type:"never",...e.A2(b)})}function P(a,b){return new a({type:"date",...e.A2(b)})}function Q(a,b){return new d.sm({check:"less_than",...e.A2(b),value:a,inclusive:!1})}function R(a,b){return new d.sm({check:"less_than",...e.A2(b),value:a,inclusive:!0})}function S(a,b){return new d.J_({check:"greater_than",...e.A2(b),value:a,inclusive:!1})}function T(a,b){return new d.J_({check:"greater_than",...e.A2(b),value:a,inclusive:!0})}function U(a,b){return new d.Jk({check:"multiple_of",...e.A2(b),value:a})}function V(a,b){return new d.Yk({check:"max_length",...e.A2(b),maximum:a})}function W(a,b){return new d.Kk({check:"min_length",...e.A2(b),minimum:a})}function X(a,b){return new d.RM({check:"length_equals",...e.A2(b),length:a})}function Y(a,b){return new d.DG({check:"string_format",format:"regex",...e.A2(b),pattern:a})}function Z(a){return new d.NI({check:"string_format",format:"lowercase",...e.A2(a)})}function $(a){return new d.kH({check:"string_format",format:"uppercase",...e.A2(a)})}function _(a,b){return new d.Tt({check:"string_format",format:"includes",...e.A2(b),includes:a})}function aa(a,b){return new d.J({check:"string_format",format:"starts_with",...e.A2(b),prefix:a})}function ab(a,b){return new d.E6({check:"string_format",format:"ends_with",...e.A2(b),suffix:a})}function ac(a){return new d.v$({check:"overwrite",tx:a})}function ad(a){return ac(b=>b.normalize(a))}function ae(){return ac(a=>a.trim())}function af(){return ac(a=>a.toLowerCase())}function ag(){return ac(a=>a.toUpperCase())}function ah(a,b,c){return new a({type:"array",element:b,...e.A2(c)})}function ai(a,b,c){let d=e.A2(c);return d.abort??(d.abort=!0),new a({type:"custom",check:"custom",fn:b,...d})}function aj(a,b,c){return new a({type:"custom",check:"custom",fn:b,...e.A2(c)})}function ak(a){let b=function(a,b){let c=new d.QP({check:"custom",...e.A2(void 0)});return c._zod.check=a,c}(c=>(c.addIssue=a=>{"string"==typeof a?c.issues.push(e.sn(a,c.value,b._zod.def)):(a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=c.value),a.inst??(a.inst=b),a.continue??(a.continue=!b._zod.def.abort),c.issues.push(e.sn(a)))},a(c.value,c)));return b}},13578:(a,b,c)=>{c.d(b,{Hs:()=>o,Ht:()=>i,Nq:()=>k,c0:()=>m,h_:()=>j,oG:()=>l,ug:()=>n,yY:()=>p});var d=c(98318),e=c(8575),f=c(98708),g=c(7762),h=c(16155);class i{constructor(a){this.table=a}static [e.i]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class j{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [e.i]="TableAliasProxyHandler";get(a,b){if(b===g.XI.Symbol.IsAlias)return!0;if(b===g.XI.Symbol.Name||this.replaceOriginalName&&b===g.XI.Symbol.OriginalName)return this.alias;if(b===h.n)return{...a[h.n],name:this.alias,isAlias:!0};if(b===g.XI.Symbol.Columns){let b=a[g.XI.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new i(new Proxy(a,this)))}),c}let c=a[b];return(0,e.is)(c,d.V)?new Proxy(c,new i(new Proxy(a,this))):c}}class k{constructor(a){this.alias=a}static [e.i]="RelationTableAliasProxyHandler";get(a,b){return"sourceTable"===b?l(a.sourceTable,this.alias):a[b]}}function l(a,b){return new Proxy(a,new j(b,!1))}function m(a,b){return new Proxy(a,new k(b))}function n(a,b){return new Proxy(a,new i(new Proxy(a.table,new j(b,!1))))}function o(a,b){return new f.Xs.Aliased(p(a.sql,b),a.fieldAlias)}function p(a,b){return f.ll.join(a.queryChunks.map(a=>(0,e.is)(a,d.V)?n(a,b):(0,e.is)(a,f.Xs)?p(a,b):(0,e.is)(a,f.Xs.Aliased)?o(a,b):a))}},15017:(a,b,c)=>{function d(a,b,c){function d(c,d){var e;for(let f in Object.defineProperty(c,"_zod",{value:c._zod??{},enumerable:!1}),(e=c._zod).traits??(e.traits=new Set),c._zod.traits.add(a),b(c,d),g.prototype)f in c||Object.defineProperty(c,f,{value:g.prototype[f].bind(c)});c._zod.constr=g,c._zod.def=d}let e=c?.Parent??Object;class f extends e{}function g(a){var b;let e=c?.Parent?new f:this;for(let c of(d(e,a),(b=e._zod).deferred??(b.deferred=[]),e._zod.deferred))c();return e}return Object.defineProperty(f,"name",{value:a}),Object.defineProperty(g,"init",{value:d}),Object.defineProperty(g,Symbol.hasInstance,{value:b=>!!c?.Parent&&b instanceof c.Parent||b?._zod?.traits?.has(a)}),Object.defineProperty(g,"name",{value:a}),g}c.d(b,{$W:()=>g,GT:()=>e,cr:()=>f,xI:()=>d}),Object.freeze({status:"aborted"}),Symbol("zod_brand");class e extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}let f={};function g(a){return a&&Object.assign(f,a),f}},15021:(a,b,c)=>{c.d(b,{JB:()=>j,M$:()=>m,Xm:()=>l,uJ:()=>k});var d=c(59659),e=c(15539),f=c(2059),g=c(78215),h=c(44344),i=c(46345);function j(a){return(0,d.MH)(a)?a.map(a=>k(a)):[k(a)]}function k(a){return(0,d.Kg)(a)?l(a):(0,i.uc)(a)?a.toOperationNode():(0,g.v0)(a)}function l(a){let b=" as ";if(!a.includes(b))return m(a);{let[c,d]=a.split(b).map(n);return e.N.create(m(c),h.O.create(d))}}function m(a){if(!a.includes("."))return f.H.create(a);{let[b,c]=a.split(".").map(n);return f.H.createWithSchema(b,c)}}function n(a){return a.trim()}},15247:(a,b,c)=>{c.d(b,{u:()=>d});let d={encode:a=>{if("string"==typeof a&&(a=new TextEncoder().encode(a)),0===a.byteLength)return"";let b=new Uint8Array(a),c="";for(let a of b)c+=a.toString(16).padStart(2,"0");return c},decode:a=>{if(!a)return"";if("string"==typeof a){if(a.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(a))throw Error("Invalid hexadecimal string");let b=new Uint8Array(a.length/2);for(let c=0;c<a.length;c+=2)b[c/2]=parseInt(a.slice(c,c+2),16);return new TextDecoder().decode(b)}return new TextDecoder().decode(a)}}},15539:(a,b,c)=>{c.d(b,{N:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"AliasNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AliasNode",node:a,alias:b})})},16151:(a,b,c)=>{c.d(b,{c:()=>d});class d{#a;#b;#c;constructor(){this.#a=new Promise((a,b)=>{this.#c=b,this.#b=a})}get promise(){return this.#a}resolve=a=>{this.#b&&this.#b(a)};reject=a=>{this.#c&&this.#c(a)}}},16155:(a,b,c)=>{c.d(b,{n:()=>d});let d=Symbol.for("drizzle:ViewBaseConfig")},16406:(a,b,c)=>{c.d(b,{Fx:()=>h,kn:()=>g});var d=c(8575),e=c(10289);class f extends e.pe{static [d.i]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new g(a,this.config)}}class g extends e.Kl{static [d.i]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function h(a){return new f(a??"")}},17174:(a,b,c)=>{c.d(b,{G:()=>h,g:()=>i});var d=c(87265),e=c(15017),f=c(58054);let g=(a,b)=>{d.a$.init(a,b),a.name="ZodError",Object.defineProperties(a,{format:{value:b=>d.Wk(a,b)},flatten:{value:b=>d.JM(a,b)},addIssue:{value:b=>{a.issues.push(b),a.message=JSON.stringify(a.issues,f.k8,2)}},addIssues:{value:b=>{a.issues.push(...b),a.message=JSON.stringify(a.issues,f.k8,2)}},isEmpty:{get:()=>0===a.issues.length}})},h=e.xI("ZodError",g),i=e.xI("ZodError",g,{Parent:Error})},18093:(a,b,c)=>{let d;c.d(b,{$:()=>aT,A:()=>ak,B:()=>am,C:()=>a4,D:()=>a5,E:()=>bb,F:()=>a9,G:()=>ba,I:()=>a8,J:()=>a2,K:()=>a6,L:()=>a7,M:()=>au,N:()=>at,O:()=>as,P:()=>aX,Q:()=>aV,R:()=>aY,S:()=>a1,T:()=>a0,U:()=>a_,V:()=>a3,W:()=>ax,X:()=>ay,Y:()=>aZ,Z:()=>aW,_:()=>aQ,a0:()=>aS,a1:()=>aP,i:()=>af,j:()=>ag,l:()=>ap,m:()=>an,t:()=>aM,w:()=>av,x:()=>aj,y:()=>ar,z:()=>a$});var e=c(42261),f=c(52376),g=c(506),h=c(36846),i=c(95856),j=c(59061),k=c(22887),l=c(28945),m=c(46584),n=c(77598),o=c(57975),p=c(48655),q=c(53410),r=c(20374),s=c(53628);let t=(0,o.promisify)(n.verify),u=async(a,b,c,d)=>{let e=(0,s.A)(a,b,"verify");if(a.startsWith("HS")){let b=await (0,r.A)(a,e,d);try{return n.timingSafeEqual(c,b)}catch{return!1}}let f=(0,p.A)(a),g=(0,q.A)(a,e);try{return await t(f,d,g,c)}catch{return!1}};var v=c(79841),w=c(50047),x=c(34650),y=c(78257),z=c(93330),A=c(89100),B=c(79288);async function C(a,b){if(!(0,y.A)(a))throw TypeError("JWK must be an object");switch(b||=a.alg,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return(0,m.D4)(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new v.T0('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":var c;return(c={...a,alg:b}).d?(0,n.createPrivateKey)({format:"jwk",key:c}):(0,n.createPublicKey)({format:"jwk",key:c});default:throw new v.T0('Unsupported "kty" (Key Type) Parameter value')}}async function D(a,b,c){let d,e;if(!(0,y.A)(a))throw new v.Ye("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new v.Ye('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new v.Ye("JWS Protected Header incorrect type");if(void 0===a.payload)throw new v.Ye("JWS Payload missing");if("string"!=typeof a.signature)throw new v.Ye("JWS Signature missing or incorrect type");if(void 0!==a.header&&!(0,y.A)(a.header))throw new v.Ye("JWS Unprotected Header incorrect type");let f={};if(a.protected)try{let b=(0,m.D4)(a.protected);f=JSON.parse(w.D0.decode(b))}catch{throw new v.Ye("JWS Protected Header is invalid")}if(!(0,x.A)(f,a.header))throw new v.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...f,...a.header},h=(0,A.A)(v.Ye,new Map([["b64",!0]]),c?.crit,f,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=f.b64))throw new v.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new v.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=c&&((a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)})("algorithms",c.algorithms);if(k&&!k.has(j))throw new v.Rb('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof a.payload)throw new v.Ye("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new v.Ye("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof b?(b=await b(f,a),l=!0,(0,z.I)(j,b,"verify"),(0,B.ll)(b)&&(b=await C(b,j))):(0,z.I)(j,b,"verify");let n=(0,w.xW)(w.Rd.encode(a.protected??""),w.Rd.encode("."),"string"==typeof a.payload?w.Rd.encode(a.payload):a.payload);try{d=(0,m.D4)(a.signature)}catch{throw new v.Ye("Failed to base64url decode the signature")}if(!await u(j,b,d,n))throw new v.h2;if(i)try{e=(0,m.D4)(a.payload)}catch{throw new v.Ye("Failed to base64url decode the payload")}else e="string"==typeof a.payload?w.Rd.encode(a.payload):a.payload;let o={payload:e};return(void 0!==a.protected&&(o.protectedHeader=f),void 0!==a.header&&(o.unprotectedHeader=a.header),l)?{...o,key:b}:o}async function E(a,b,c){if(a instanceof Uint8Array&&(a=w.D0.decode(a)),"string"!=typeof a)throw new v.Ye("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new v.Ye("Invalid Compact JWS");let h=await D({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}var F=c(41638),G=c(79609);let H=a=>a.toLowerCase().replace(/^application\//,"");async function I(a,b,c){let d=await E(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new v.Dp("JWTs MUST NOT use unencoded payload");let e={payload:((a,b,c={})=>{let d,e,f,g;try{d=JSON.parse(w.D0.decode(b))}catch{}if(!(0,y.A)(d))throw new v.Dp("JWT Claims Set must be a top-level JSON object");let{typ:h}=c;if(h&&("string"!=typeof a.typ||H(a.typ)!==H(h)))throw new v.ie('unexpected "typ" JWT header value',d,"typ","check_failed");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c,n=[...i];for(let a of(void 0!==m&&n.push("iat"),void 0!==l&&n.push("aud"),void 0!==k&&n.push("sub"),void 0!==j&&n.push("iss"),new Set(n.reverse())))if(!(a in d))throw new v.ie(`missing required "${a}" claim`,d,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(d.iss))throw new v.ie('unexpected "iss" claim value',d,"iss","check_failed");if(k&&d.sub!==k)throw new v.ie('unexpected "sub" claim value',d,"sub","check_failed");if(l&&(f=d.aud,g="string"==typeof l?[l]:l,"string"==typeof f?!g.includes(f):!(!!Array.isArray(f)&&g.some(Set.prototype.has.bind(new Set(f))))))throw new v.ie('unexpected "aud" claim value',d,"aud","check_failed");switch(typeof c.clockTolerance){case"string":e=(0,G.A)(c.clockTolerance);break;case"number":e=c.clockTolerance;break;case"undefined":e=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:o}=c,p=(0,F.A)(o||new Date);if((void 0!==d.iat||m)&&"number"!=typeof d.iat)throw new v.ie('"iat" claim must be a number',d,"iat","invalid");if(void 0!==d.nbf){if("number"!=typeof d.nbf)throw new v.ie('"nbf" claim must be a number',d,"nbf","invalid");if(d.nbf>p+e)throw new v.ie('"nbf" claim timestamp check failed',d,"nbf","check_failed")}if(void 0!==d.exp){if("number"!=typeof d.exp)throw new v.ie('"exp" claim must be a number',d,"exp","invalid");if(d.exp<=p-e)throw new v.n('"exp" claim timestamp check failed',d,"exp","check_failed")}if(m){let a=p-d.iat;if(a-e>("number"==typeof m?m:(0,G.A)(m)))throw new v.n('"iat" claim timestamp check failed (too far in the past)',d,"iat","check_failed");if(a<0-e)throw new v.ie('"iat" claim timestamp check failed (it should be in the past)',d,"iat","check_failed")}return d})(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}m.lF;let J=m.D4;function K(a){let b,c;if("string"!=typeof a)throw new v.Dp("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new v.Dp("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new v.Dp("Invalid JWT");if(!d)throw new v.Dp("JWTs must contain a payload");try{b=J(d)}catch{throw new v.Dp("Failed to base64url decode the payload")}try{c=JSON.parse(w.D0.decode(b))}catch{throw new v.Dp("Failed to parse the decoded payload as JSON")}if(!(0,y.A)(c))throw new v.Dp("Invalid JWT Claims Set");return c}var L=c(37067),M=c(44708),N=c(78474);let O=async(a,b,c)=>{let d;switch(a.protocol){case"https:":d=M.get;break;case"http:":d=L.get;break;default:throw TypeError("Unsupported URL protocol.")}let{agent:e,headers:f}=c,g=d(a.href,{agent:e,timeout:b,headers:f}),[h]=await Promise.race([(0,N.once)(g,"response"),(0,N.once)(g,"timeout")]);if(!h)throw g.destroy(),new v.xb;if(200!==h.statusCode)throw new v.i4("Expected 200 OK from the JSON Web Key Set HTTP response");let i=[];for await(let a of h)i.push(a);try{return JSON.parse(w.D0.decode((0,w.xW)(...i)))}catch{throw new v.i4("Failed to parse the JSON Web Key Set HTTP response as JSON")}};function P(a){return(0,y.A)(a)}function Q(a){return"function"==typeof structuredClone?structuredClone(a):JSON.parse(JSON.stringify(a))}class R{_jwks;_cached=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(P)}(a))throw new v.Dm("JSON Web Key Set malformed");this._jwks=Q(a)}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new v.T0('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this._jwks.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&"string"==typeof a.alg&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES256K":b="secp256k1"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":b="Ed25519"===a.crv;break;case"EdDSA":b="Ed25519"===a.crv||"Ed448"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new v.BT;if(1!==h){let a=new v.$4,{_cached:b}=this;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await S(b,a,c)}catch{}},a}return S(this._cached,g,c)}}async function S(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await C({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new v.Dm("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function T(a){let b=new R(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>Q(b._jwks),enumerable:!0,configurable:!1,writable:!1}}),c}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(d="jose/v5.10.0");let U=Symbol();class V{_url;_timeoutDuration;_cooldownDuration;_cacheMaxAge;_jwksTimestamp;_pendingFetch;_options;_local;_cache;constructor(a,b){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(a.href),this._options={agent:b?.agent,headers:b?.headers},this._timeoutDuration="number"==typeof b?.timeoutDuration?b?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof b?.cooldownDuration?b?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof b?.cacheMaxAge?b?.cacheMaxAge:6e5,b?.[U]!==void 0&&(this._cache=b?.[U],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!(0,y.A)(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,y.A)}(b?.[U],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=T(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(a,b){this._local&&this.fresh()||await this.reload();try{return await this._local(a,b)}catch(c){if(c instanceof v.BT&&!1===this.coolingDown())return await this.reload(),this._local(a,b);throw c}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);let a=new Headers(this._options.headers);d&&!a.has("User-Agent")&&(a.set("User-Agent",d),this._options.headers=Object.fromEntries(a.entries())),this._pendingFetch||=O(this._url,this._timeoutDuration,this._options).then(a=>{this._local=T(a),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=a),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(a=>{throw this._pendingFetch=void 0,a}),await this._pendingFetch}}c(15247);var W=c(22321),X=c(71068),Y=c(34698),Z=c(98642),$=c(11673),_=c(84719),aa=c(44989),ab=c(39955),ac=c(70250);c(32378);var ad=c(22041);let ae=(0,g.Ny)(async()=>({})),af=g.Ny.create({use:[ae,(0,g.Ny)(async()=>({}))]}),ag=g.UD.create({use:[ae]});function ah(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function ai(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function aj(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b)){let d=b.map(b=>`^${a(b,c)}$`);return`(?:${d.join("|")})`}let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=ah(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=ah(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=ah(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=ai.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}let ak=af(async a=>{if(a.request?.method!=="POST"||!a.request)return;let{body:b,query:c,context:d}=a,e=a.headers?.get("origin")||a.headers?.get("referer")||"",f=b?.callbackURL||c?.callbackURL,h=b?.redirectTo,i=b?.errorCallbackURL,j=b?.newUserCallbackURL,k=Array.isArray(d.options.trustedOrigins)?d.trustedOrigins:[...d.trustedOrigins,...await d.options.trustedOrigins?.(a.request)||[]],l=a.headers?.has("cookie"),m=(b,c)=>{if(b&&!k.some(a=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?aj(b)((0,X.g)(a)||a):aj(b)((0,X.b)(a));let c=(0,X.c)(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===(0,X.g)(a)})(b,a)||b?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(b)))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${k}`),new g.LG("FORBIDDEN",{message:`Invalid ${c}`})};l&&!a.context.options.advanced?.disableCSRFCheck&&m(e,"origin"),f&&m(f,"callbackURL"),h&&m(h,"redirectURL"),i&&m(i,"errorCallbackURL"),j&&m(j,"newUserCallbackURL")}),al=a=>af(async b=>{if(!b.request)return;let{context:c}=b,d=a(b),e=Array.isArray(c.options.trustedOrigins)?c.trustedOrigins:[...c.trustedOrigins,...await c.options.trustedOrigins?.(b.request)||[]],f=(a,c)=>{if(a&&!e.some(b=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*"))return b.includes("://")?aj(b)((0,X.g)(a)||a):aj(b)((0,X.b)(a));let c=(0,X.c)(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===(0,X.g)(a)})(a,b)||a?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a)))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${e}`),new g.LG("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(d)?d:[d])f(a,"callbackURL")}),am={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."},an=()=>ag("/get-session",{method:"GET",query:e.lq(e.Ik({disableCookieCache:f.zM().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:f.zM().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=a.getCookie(a.context.authCookies.sessionData.name),d=c?(0,Z.s)(_.a.decode(j.K.decode(c))):null;if(d&&!await (0,$.s)("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...d.session,expiresAt:d.expiresAt}),d.signature)){let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session;if(!(d.expiresAt<Date.now()||b.session.expiresAt<new Date))return a.context.session=b,a.json(b);{let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}}let f=await a.context.internalAdapter.findSession(b);if(a.context.session=f,!f||f.session.expiresAt<new Date)return(0,Y.eC)(a),f&&await a.context.internalAdapter.deleteSession(f.session.token),a.json(null);if(e||a.query?.disableRefresh)return a.json(f);let g=a.context.sessionConfig.expiresIn,i=a.context.sessionConfig.updateAge;if(f.session.expiresAt.valueOf()-1e3*g+1e3*i<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(f.session.token,{expiresAt:(0,h.g)(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return(0,Y.eC)(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;return await (0,Y.$G)(a,{session:b,user:f.user},!1,{maxAge:c}),a.json({session:b,user:f.user})}return await (0,Y.vt)(a,f),a.json(f)}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new g.LG("INTERNAL_SERVER_ERROR",{message:am.FAILED_TO_GET_SESSION})}}),ao=async(a,b)=>{if(a.context.session)return a.context.session;let c=await an()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},ap=af(async a=>{let b=await ao(a);if(!b?.session)throw new g.LG("UNAUTHORIZED");return{session:b}});af(async a=>{let b=await ao(a);if(!b?.session&&(a.request||a.headers))throw new g.LG("UNAUTHORIZED");return{session:b}});let aq=af(async a=>{let b=await ao(a);if(!b?.session)throw new g.LG("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,d=b.session.updatedAt?.valueOf()||b.session.createdAt.valueOf();if(!(Date.now()-d<1e3*c))throw new g.LG("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),ar=()=>ag("/list-sessions",{method:"GET",use:[ap],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b)}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),as=ag("/revoke-session",{method:"POST",body:e.Ik({token:e.Yj().meta({description:"The token to revoke"})}),use:[ap],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token,c=await a.context.internalAdapter.findSession(b);if(!c)throw new g.LG("BAD_REQUEST",{message:"Session not found"});if(c.session.userId!==a.context.session.user.id)throw new g.LG("UNAUTHORIZED");try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new g.LG("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),at=ag("/revoke-sessions",{method:"POST",use:[ap],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new g.LG("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),au=ag("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[ap],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new g.LG("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})});async function av(a,b,c,d=3600){return await (0,k.FA)({email:b.toLowerCase(),updateTo:c},a,d)}async function aw(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new g.LG("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await av(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:b,url:d,token:c},a.request)}let ax=ag("/send-verification-email",{method:"POST",body:e.Ik({email:e.Rp().meta({description:"The email to send the verification email to"}),callbackURL:e.Yj().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new g.LG("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await ao(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return c&&await aw(a,c.user),a.json({status:!0})}if(c?.user.emailVerified)throw new g.LG("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(c?.user.email!==b)throw new g.LG("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await aw(a,c.user),a.json({status:!0})}),ay=ag("/verify-email",{method:"GET",query:e.Ik({token:e.Yj().meta({description:"The token to verify the email"}),callbackURL:e.Yj().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[al(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new g.LG("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await I(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof v.n)return c("token_expired");return c("invalid_token")}let f=e.Ik({email:e.Yj().email(),updateTo:e.Yj().optional()}).parse(b.payload),h=await a.context.internalAdapter.findUserByEmail(f.email);if(!h)return c("user_not_found");if(f.updateTo){let b=await ao(a);if(!b||b.user.email!==f.email){if(a.query.callbackURL)throw a.redirect(`${a.query.callbackURL}?error=unauthorized`);return c("unauthorized")}let d=await a.context.internalAdapter.updateUserByEmail(f.email,{email:f.updateTo,emailVerified:!1},a),e=await av(a.context.secret,f.updateTo);if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${a.context.baseURL}/verify-email?token=${e}&callbackURL=${a.query.callbackURL||"/"}`,token:e},a.request),await (0,Y.$G)(a,{session:b.session,user:{...b.user,email:f.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(h.user,a.request);let i=await a.context.internalAdapter.updateUserByEmail(f.email,{emailVerified:!0},a);if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(i,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await ao(a);if(b&&b.user.email===f.email)await (0,Y.$G)(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(h.user.id,a);if(!b)throw new g.LG("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await (0,Y.$G)(a,{session:b,user:{...h.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}),az={isAction:!1};async function aA(a,b){let c=a.body?.callbackURL||a.context.options.baseURL;if(!c)throw new g.LG("BAD_REQUEST",{message:"callbackURL is required"});let d=(0,W.g)(128),e=(0,W.g)(32),f=JSON.stringify({callbackURL:c,codeVerifier:d,errorURL:a.body?.errorCallbackURL,newUserURL:a.body?.newUserCallbackURL,link:b,expiresAt:Date.now()+6e5,requestSignUp:a.body?.requestSignUp}),h=new Date;h.setMinutes(h.getMinutes()+10);let i=await a.context.internalAdapter.createVerificationValue({value:f,identifier:e,expiresAt:h},a);if(!i)throw a.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new g.LG("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:i.identifier,codeVerifier:d}}async function aB(a){let b=a.query.state||a.body.state,c=await a.context.internalAdapter.findVerificationValue(b);if(!c){a.context.logger.error("State Mismatch. Verification not found",{state:b});let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=please_restart_the_process`)}let d=e.Ik({callbackURL:e.Yj(),codeVerifier:e.Yj(),errorURL:e.Yj().optional(),newUserURL:e.Yj().optional(),expiresAt:e.ai(),link:e.Ik({email:e.Yj(),userId:f.Yj()}).optional(),requestSignUp:e.zM().optional()}).parse(JSON.parse(c.value));if(d.errorURL||(d.errorURL=`${a.context.baseURL}/error`),d.expiresAt<Date.now()){await a.context.internalAdapter.deleteVerificationValue(c.id);let b=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${b}?error=please_restart_the_process`)}return await a.context.internalAdapter.deleteVerificationValue(c.id),d}async function aC(a){let b=await (0,i.n)("SHA-256").digest(a);return j.z.encode(new Uint8Array(b),{padding:!1})}function aD(a){return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?(0,h.g)(a.expires_in,"sec"):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?(0,h.g)(a.refresh_token_expires_in,"sec"):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token}}function aE(a,b){return b.options.account?.encryptOAuthTokens&&a?(0,k.vX)({key:b.secret,data:a}):a}async function aF(a,{userInfo:b,account:c,callbackURL:d,disableSignUp:e,overrideUserInfo:f}){let h=await a.context.internalAdapter.findOAuthUser(b.email.toLowerCase(),c.accountId,c.providerId).catch(b=>{aa.a.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),i=h?.user,j=!i;if(h){let d=h.accounts.find(a=>a.providerId===c.providerId&&a.accountId===c.accountId);if(d){if(a.context.options.account?.updateAccountOnSignIn!==!1){let b=Object.fromEntries(Object.entries({idToken:c.idToken,accessToken:await aE(c.accessToken,a.context),refreshToken:await aE(c.refreshToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope}).filter(([a,b])=>void 0!==b));Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(d.id,b,a)}}else{let d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(c.providerId)&&!b.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return ac.b&&aa.a.warn(`User already exist but account isn't linked to ${c.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:c.providerId,accountId:b.id.toString(),userId:h.user.id,accessToken:await aE(c.accessToken,a.context),refreshToken:await aE(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope},a)}catch(a){return aa.a.error("Unable to link account",a),{error:"unable to link account",data:null}}}if(f){let{id:c,...d}=b;await a.context.internalAdapter.updateUser(h.user.id,{...d,email:b.email.toLowerCase(),emailVerified:b.email.toLowerCase()===h.user.email&&h.user.emailVerified||b.emailVerified})}}else{if(e)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:e,...f}=b;if(i=await a.context.internalAdapter.createOAuthUser({...f,email:b.email.toLowerCase()},{accessToken:await aE(c.accessToken,a.context),refreshToken:await aE(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope,providerId:c.providerId,accountId:b.id.toString()},a).then(a=>a?.user),!b.emailVerified&&i&&a.context.options.emailVerification?.sendOnSignUp){let b=await av(a.context.secret,i.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${d}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:i,url:c,token:b},a.request)}}catch(a){if(aa.a.error(a),a instanceof g.LG)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!i)return{error:"unable to create user",data:null,isRegister:!1};let k=await a.context.internalAdapter.createSession(i.id,a);return k?{data:{session:k,user:i},error:null,isRegister:j}:{error:"unable to create session",data:null,isRegister:!1}}async function aG({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(c);if(s.searchParams.set("response_type",l||"code"),s.searchParams.set("client_id",b.clientId),s.searchParams.set("state",d),s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await aC(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}async function aH({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={}}){let k=new URLSearchParams,m={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...h};if(k.set("grant_type","authorization_code"),k.set("code",a),b&&k.set("code_verifier",b),d.clientKey&&k.set("client_key",d.clientKey),g&&k.set("device_id",g),k.set("redirect_uri",d.redirectURI||c),k.set("client_id",d.clientId),"basic"===f){let a=j.K.encode(`${d.clientId}:${d.clientSecret}`);m.authorization=`Basic ${a}`}else k.set("client_secret",d.clientSecret);for(let[a,b]of Object.entries(i))k.has(a)||k.append(a,b);let{data:n,error:o}=await (0,l.zZ)(e,{method:"POST",body:k,headers:m});if(o)throw o;return aD(n)}async function aI({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e,grantType:f="refresh_token"}){let g=new URLSearchParams,h={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(g.set("grant_type",f),g.set("refresh_token",a),"basic"===d?h.authorization=j.K.encode(`${b.clientId}:${b.clientSecret}`):(g.set("client_id",b.clientId),g.set("client_secret",b.clientSecret)),e)for(let[a,b]of Object.entries(e))g.set(a,b);let{data:i,error:k}=await (0,l.zZ)(c,{method:"POST",body:g,headers:h});if(k)throw k;let m={accessToken:i.access_token,refreshToken:i.refresh_token,tokenType:i.token_type,scopes:i.scope?.split(" "),idToken:i.id_token};return i.expires_in&&(m.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*i.expires_in)),m}let aJ=async a=>{let{data:b}=await (0,l.zZ)("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new g.LG("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await C(c,c.alg)},aK=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://");var aL=(a=>(a[a.RUS=0]="RUS",a[a.UKR=1]="UKR",a[a.ENG=3]="ENG",a[a.SPA=4]="SPA",a[a.GERMAN=6]="GERMAN",a[a.POL=15]="POL",a[a.FRA=16]="FRA",a[a.TURKEY=82]="TURKEY",a))(aL||{});let aM={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await aG({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>aH({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=function(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(w.D0.decode(J(b)));if(!(0,y.A)(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}(b);if(!d||!e)return!1;let f=await aJ(d),{payload:g}=await I(b,f,{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.appBundleIdentifier||a.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{void 0!==g[a]&&(g[a]=!!g[a])}),(!c||g.nonce===c)&&!!g},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=K(b.idToken);if(!c)return null;let d=b.user?`${b.user.name?.firstName} ${b.user.name?.lastName}`:c.name||c.email,e="boolean"==typeof c.email_verified?c.email_verified:"true"===c.email_verified,f=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:d,emailVerified:e,email:c.email,...f},data:c}},options:a}),discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];return c&&e.push(...c),a.scope&&e.push(...a.scope),new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>aH({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar){let a="0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5;c.image_url=`https://cdn.discordapp.com/embed/avatars/${a}.png`}else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await aG({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>aH({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{let{payload:d}=await I(b,function(a,b){let c=new V(a,void 0),d=async(a,b)=>c.getKey(a,b);return Object.defineProperties(d,{coolingDown:{get:()=>c.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>c.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>c.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!c._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>c._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),d}(new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/")),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&d.nonce!==c)return!1;return!!d}catch(a){return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=K(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!0});return{user:{...d,emailVerified:!0,...e},data:c}}let c=["id","name","email","picture",...a?.fields||[]],{data:d,error:e}=await (0,l.zZ)("https://graph.facebook.com/me?fields="+c.join(","),{auth:{type:"Bearer",token:b.accessToken}});if(e)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.id,name:d.name,email:d.email,image:d.picture.data.url,emailVerified:d.email_verified,...f},data:d}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aG({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>aH({code:b,redirectURI:c,options:a,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await (0,l.zZ)("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id.toString(),name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=`https://login.microsoftonline.com/${b}/oauth2/v2.0/authorize`,d=`https://login.microsoftonline.com/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let d=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&d.push(...a.scope),b.scopes&&d.push(...b.scopes),aG({id:"microsoft",options:a,authorizationEndpoint:c,state:b.state,codeVerifier:b.codeVerifier,scopes:d,redirectURI:b.redirectURI,prompt:a.prompt})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:e})=>aH({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=K(b.idToken),d=a.profilePhotoSize||48;await (0,l.zZ)(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=b.response.clone(),d=await a.arrayBuffer(),e=j.K.encode(d);c.picture=`data:image/jpeg;base64, ${e}`}catch(a){aa.a.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:!0,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),aI({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:d})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw aa.a.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new ad.B("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new ad.B("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),"select_account+consent"===a.prompt&&(a.prompt="select_account consent"),await aG({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>aH({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${b}`,{data:e}=await (0,l.zZ)(d);return!!e&&e.aud===a.clientId&&("https://accounts.google.com"===e.iss||"accounts.google.com"===e.iss)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=K(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aG({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>aH({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>aH({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aG({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>aH({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),aG({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>aH({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return aa.a.error("No idToken found in token"),null;let d=K(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),aG({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>aH({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await (0,l.zZ)("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await aG({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await aH({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aG({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>aH({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!0,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aG({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>aH({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>aI({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!0,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await aG({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await aH({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>aI({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let{authorizationEndpoint:b,tokenEndpoint:c,userinfoEndpoint:d}=(a=>{let b=a||"https://gitlab.com";return{authorizationEndpoint:aK(`${b}/oauth/authorize`),tokenEndpoint:aK(`${b}/oauth/token`),userinfoEndpoint:aK(`${b}/api/v4/user`)}})(a.issuer),e="gitlab";return{id:e,name:"Gitlab",createAuthorizationURL:async({state:c,scopes:d,codeVerifier:f,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await aG({id:e,options:a,authorizationEndpoint:b,scopes:i,state:c,redirectURI:h,codeVerifier:f,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:d,codeVerifier:e})=>aH({code:b,redirectURI:d,options:a,codeVerifier:e,tokenEndpoint:c}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://gitlab.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:e}=await (0,l.zZ)(d,{headers:{authorization:`Bearer ${b.accessToken}`}});if(e||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id.toString(),name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:!0,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&client_secret=${a.clientSecret}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>aH({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!!c.data.user.email},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),aG({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),e={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${j.K.encode(`${a.clientId}:${a.clientSecret}`)}`},{data:f,error:g}=await (0,l.zZ)("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:e,body:d.toString()});if(g)throw g;return aD(f)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account+consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>aH({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!0,...e},data:{...c}}},options:a}),vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),aG({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>aH({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>aI({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await (0,l.zZ)("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e||!d.user.email)return null;let f=await a.mapProfileToUser?.(d);return{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!!d.user.email,birthday:d.user.birthday,sex:d.user.sex,...f},data:d}},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await aC(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>aH({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await (0,l.zZ)("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),aG({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>aH({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>aI({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await (0,l.zZ)("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!!e.person?.email,...f},data:e}},options:a}}},aN=Object.keys(aM),aO=e.k5(aN).or(e.Yj()),aP=ag("/sign-in/social",{method:"POST",body:e.Ik({callbackURL:e.Yj().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:e.Yj().optional(),errorCallbackURL:e.Yj().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:aO,disableRedirect:e.zM().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:e.lq(e.Ik({token:e.Yj().meta({description:"ID token from the provider"}),nonce:e.Yj().meta({description:"Nonce used to generate the token"}).optional(),accessToken:e.Yj().meta({description:"Access token from the provider"}).optional(),refreshToken:e.Yj().meta({description:"Refresh token from the provider"}).optional(),expiresAt:e.ai().meta({description:"Expiry date of the token"}).optional()})),scopes:e.YO(e.Yj()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:e.zM().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:e.Yj().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:am.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:am.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:am.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:am.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:am.USER_EMAIL_NOT_FOUND});let f=await aF(a,{userInfo:{...e.user,email:e.user.email,id:e.user.id,name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:e.user.id,accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(f.error)throw new g.LG("UNAUTHORIZED",{message:f.error});return await (0,Y.$G)(a,f.data),a.json({redirect:!1,token:f.data.session.token,url:void 0,user:{id:f.data.user.id,email:f.data.user.email,name:f.data.user.name,image:f.data.user.image,emailVerified:f.data.user.emailVerified,createdAt:f.data.user.createdAt,updatedAt:f.data.user.updatedAt}})}let{codeVerifier:c,state:d}=await aA(a),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),aQ=ag("/sign-in/email",{method:"POST",body:e.Ik({email:e.Yj().meta({description:"Email of the user"}),password:e.Yj().meta({description:"Password of the user"}),callbackURL:e.Yj().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:e.zM().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new g.LG("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!e.Yj().email().safeParse(b).success)throw new g.LG("BAD_REQUEST",{message:am.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new g.LG("UNAUTHORIZED",{message:am.INVALID_EMAIL_OR_PASSWORD});let f=d.accounts.find(a=>"credential"===a.providerId);if(!f)throw a.context.logger.error("Credential account not found",{email:b}),new g.LG("UNAUTHORIZED",{message:am.INVALID_EMAIL_OR_PASSWORD});let h=f?.password;if(!h)throw a.context.logger.error("Password not found",{email:b}),new g.LG("UNAUTHORIZED",{message:am.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:h,password:c}))throw a.context.logger.error("Invalid password"),new g.LG("UNAUTHORIZED",{message:am.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new g.LG("FORBIDDEN",{message:am.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await av(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:c,token:b},a.request)}throw new g.LG("FORBIDDEN",{message:am.EMAIL_NOT_VERIFIED})}let i=await a.context.internalAdapter.createSession(d.user.id,a,!1===a.body.rememberMe);if(!i)throw a.context.logger.error("Failed to create session"),new g.LG("UNAUTHORIZED",{message:am.FAILED_TO_CREATE_SESSION});return await (0,Y.$G)(a,{session:i,user:d.user},!1===a.body.rememberMe),a.json({redirect:!!a.body.callbackURL,token:i.token,url:a.body.callbackURL,user:{id:d.user.id,email:d.user.email,name:d.user.name,image:d.user.image,emailVerified:d.user.emailVerified,createdAt:d.user.createdAt,updatedAt:d.user.updatedAt}})}),aR=e.Ik({code:e.Yj().optional(),error:e.Yj().optional(),device_id:e.Yj().optional(),error_description:e.Yj().optional(),state:e.Yj().optional(),user:e.Yj().optional()}),aS=ag("/callback/:id",{method:["GET","POST"],body:aR.optional(),query:aR.optional(),metadata:az},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;try{if("GET"===a.method)b=aR.parse(a.query);else if("POST"===a.method)b=aR.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:j}=b;if(g)throw a.redirect(`${e}?error=${g}&error_description=${i}`);if(!h)throw a.context.logger.error("State not found",g),a.redirect(`${e}?error=state_not_found`);let{codeVerifier:k,callbackURL:l,link:m,errorURL:n,newUserURL:o,requestSignUp:p}=await aB(a);function q(b){let c=n||e;throw c=c.includes("?")?`${c}&error=${b}`:`${c}?error=${b}`,a.redirect(c)}if(!f)throw a.context.logger.error("Code not found"),q("no_code");let r=a.context.socialProviders.find(b=>b.id===a.params.id);if(!r)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),q("oauth_provider_not_found");try{c=await r.validateAuthorizationCode({code:f,codeVerifier:k,deviceId:j,redirectURI:`${a.context.baseURL}/callback/${r.id}`})}catch(b){throw a.context.logger.error("",b),q("invalid_code")}let s=await r.getUserInfo({...c,user:a.body?.user?(0,Z.s)(a.body.user):void 0}).then(a=>a?.user);if(!s)return a.context.logger.error("Unable to get user info"),q("unable_to_get_user_info");if(!l)throw a.context.logger.error("No callback URL found"),q("no_callback_url");if(m){let b,d=a.context.options.account?.accountLinking?.trustedProviders;if(!d?.includes(r.id)&&!s.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),q("unable_to_link_account");let e=await a.context.internalAdapter.findAccount(s.id);if(e){if(e.userId.toString()!==m.userId.toString())return q("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await aE(c.accessToken,a.context),refreshToken:await aE(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(e.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:m.userId,providerId:r.id,accountId:s.id,...c,accessToken:await aE(c.accessToken,a.context),refreshToken:await aE(c.refreshToken,a.context),scope:c.scopes?.join(",")},a))return q("unable_to_link_account");try{b=l.toString()}catch{b=l}throw a.redirect(b)}if(!s.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),q("email_not_found");let t=await aF(a,{userInfo:{...s,email:s.email,name:s.name||s.email},account:{providerId:r.id,accountId:s.id,...c,scope:c.scopes?.join(",")},callbackURL:l,disableSignUp:r.disableImplicitSignUp&&!p||r.options?.disableSignUp,overrideUserInfo:r.options?.overrideUserInfoOnSignIn});if(t.error)return a.context.logger.error(t.error.split(" ").join("_")),q(t.error.split(" ").join("_"));let{session:u,user:v}=t.data;await (0,Y.$G)(a,{session:u,user:v});try{d=(t.isRegister&&o||l).toString()}catch{d=t.isRegister&&o||l}throw a.redirect(d)}),aT=ag("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)throw(0,Y.eC)(a),new g.LG("BAD_REQUEST",{message:am.FAILED_TO_GET_SESSION});return await a.context.internalAdapter.deleteSession(b),(0,Y.eC)(a),a.json({success:!0})});function aU(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let aV=ag("/request-password-reset",{method:"POST",body:e.Ik({email:e.Rp().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:e.Yj().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new g.LG("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=(0,h.g)(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,aa.g)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let i=c?encodeURIComponent(c):"",j=`${a.context.baseURL}/reset-password/${f}?callbackURL=${i}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:j,token:f},a.request),a.json({status:!0})}),aW=ag("/forget-password",{method:"POST",body:e.Ik({email:e.Yj().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:e.Yj().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new g.LG("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=(0,h.g)(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,aa.g)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e},a);let i=c?encodeURIComponent(c):"",j=`${a.context.baseURL}/reset-password/${f}?callbackURL=${i}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:j,token:f},a.request),a.json({status:!0})}),aX=ag("/reset-password/:token",{method:"GET",query:e.Ik({callbackURL:e.Yj().meta({description:"The URL to redirect the user to reset their password"})}),use:[al(a=>a.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{let{token:b}=a.params,{callbackURL:c}=a.query;if(!b||!c)throw a.redirect(aU(a.context,c,{error:"INVALID_TOKEN"}));let d=await a.context.internalAdapter.findVerificationValue(`reset-password:${b}`);if(!d||d.expiresAt<new Date)throw a.redirect(aU(a.context,c,{error:"INVALID_TOKEN"}));throw a.redirect(function(a,b,c){let d=new URL(b,a.baseURL);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}(a.context,c,{token:b}))}),aY=aX,aZ=ag("/reset-password",{method:"POST",query:e.Ik({token:e.Yj().optional()}).optional(),body:e.Ik({newPassword:e.Yj().meta({description:"The new password to set"}),token:e.Yj().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new g.LG("BAD_REQUEST",{message:am.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new g.LG("BAD_REQUEST",{message:am.PASSWORD_TOO_SHORT});if(c.length>e)throw new g.LG("BAD_REQUEST",{message:am.PASSWORD_TOO_LONG});let f=`reset-password:${b}`,h=await a.context.internalAdapter.findVerificationValue(f);if(!h||h.expiresAt<new Date)throw new g.LG("BAD_REQUEST",{message:am.INVALID_TOKEN});let i=h.value,j=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(i)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(i,j,a):await a.context.internalAdapter.createAccount({userId:i,providerId:"credential",password:j,accountId:i},a),await a.context.internalAdapter.deleteVerificationValue(h.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(i);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(i),a.json({status:!0})}),a$=()=>ag("/update-user",{method:"POST",body:e.g1(e.Yj().meta({description:"Field name must be a string"}),e.bz()),use:[ap],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},async a=>{let b=a.body;if(b.email)throw new g.LG("BAD_REQUEST",{message:am.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,f=a.context.session;if(void 0===d&&void 0===c&&0===Object.keys(e).length)return a.json({status:!0});let h=(0,ab.f)(a.context.options,e,"update"),i=await a.context.internalAdapter.updateUser(f.user.id,{name:c,image:d,...h},a);return await (0,Y.$G)(a,{session:f.session,user:i}),a.json({status:!0})}),a_=ag("/change-password",{method:"POST",body:e.Ik({newPassword:e.Yj().meta({description:"The new password to set"}),currentPassword:e.Yj().meta({description:"The current password is required"}),revokeOtherSessions:e.zM().meta({description:"Must be a boolean value"}).optional()}),use:[ap],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,f=a.context.password.config.minPasswordLength;if(b.length<f)throw a.context.logger.error("Password is too short"),new g.LG("BAD_REQUEST",{message:am.PASSWORD_TOO_SHORT});let h=a.context.password.config.maxPasswordLength;if(b.length>h)throw a.context.logger.error("Password is too long"),new g.LG("BAD_REQUEST",{message:am.PASSWORD_TOO_LONG});let i=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!i||!i.password)throw new g.LG("BAD_REQUEST",{message:am.CREDENTIAL_ACCOUNT_NOT_FOUND});let j=await a.context.password.hash(b);if(!await a.context.password.verify({hash:i.password,password:c}))throw new g.LG("BAD_REQUEST",{message:am.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(i.id,{password:j});let k=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id,a);if(!b)throw new g.LG("INTERNAL_SERVER_ERROR",{message:am.FAILED_TO_GET_SESSION});await (0,Y.$G)(a,{session:b,user:e.user}),k=b.token}return a.json({token:k,user:{id:e.user.id,email:e.user.email,name:e.user.name,image:e.user.image,emailVerified:e.user.emailVerified,createdAt:e.user.createdAt,updatedAt:e.user.updatedAt}})}),a0=ag("/set-password",{method:"POST",body:e.Ik({newPassword:e.Yj().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[ap]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new g.LG("BAD_REQUEST",{message:am.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new g.LG("BAD_REQUEST",{message:am.PASSWORD_TOO_LONG});let f=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),h=await a.context.password.hash(b);if(!f)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:h},a),a.json({status:!0});throw new g.LG("BAD_REQUEST",{message:"user already has a password"})}),a1=ag("/delete-user",{method:"POST",use:[ap],body:e.Ik({callbackURL:e.Yj().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:e.Yj().meta({description:"The password of the user is required to delete the user"}).optional(),token:e.Yj().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options",{session:a.context.session}),new g.LG("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new g.LG("BAD_REQUEST",{message:am.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new g.LG("BAD_REQUEST",{message:am.INVALID_PASSWORD})}if(a.body.token)return await a2({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=(0,W.g)(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))},a);let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=b.session.createdAt.getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new g.LG("BAD_REQUEST",{message:am.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),(0,Y.eC)(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),a2=ag("/delete-user/callback",{method:"GET",query:e.Ik({token:e.Yj().meta({description:"The token to verify the deletion request"}),callbackURL:e.Yj().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[al(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new g.LG("NOT_FOUND");let b=await ao(a);if(!b)throw new g.LG("NOT_FOUND",{message:am.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new g.LG("NOT_FOUND",{message:am.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),(0,Y.eC)(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),a3=ag("/change-email",{method:"POST",body:e.Ik({newEmail:e.Rp().meta({description:"The new email address to set must be a valid email address"}),callbackURL:e.Yj().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[ap],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new g.LG("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new g.LG("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new g.LG("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==a.context.session.user.emailVerified){if(await a.context.internalAdapter.findUserByEmail(b))throw new g.LG("UNPROCESSABLE_ENTITY",{message:am.USER_ALREADY_EXISTS});if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b},a),await (0,Y.$G)(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await av(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)}return a.json({status:!0})}if(!a.context.options.user.changeEmail.sendChangeEmailVerification)throw a.context.logger.error("Verification email isn't enabled."),new g.LG("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await av(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.changeEmail.sendChangeEmailVerification({user:a.context.session.user,newEmail:b,url:d,token:c},a.request),a.json({status:!0})}),a4=ag("/error",{method:"GET",metadata:{...az,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>new Response(((a="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>
    </div>
</body>
</html>`)(new URL(a.request?.url||"").searchParams.get("error")||"Unknown"),{headers:{"Content-Type":"text/html"}})),a5=ag("/ok",{method:"GET",metadata:{...az,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0})),a6=ag("/list-accounts",{method:"GET",use:[ap],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},provider:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","provider","createdAt","updatedAt","accountId","scopes"]}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(a=>({id:a.id,provider:a.providerId,createdAt:a.createdAt,updatedAt:a.updatedAt,accountId:a.accountId,scopes:a.scope?.split(",")||[]})))}),a7=ag("/link-social",{method:"POST",requireHeaders:!0,body:e.Ik({callbackURL:e.Yj().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:aO,idToken:e.Ik({token:e.Yj(),nonce:e.Yj().optional(),accessToken:e.Yj().optional(),refreshToken:e.Yj().optional(),scopes:e.YO(e.Yj()).optional()}).optional(),requestSignUp:e.zM().optional(),scopes:e.YO(e.Yj()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:e.Yj().meta({description:"The URL to redirect to if there is an error during the link process"}).optional()}),use:[ap],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:am.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new g.LG("NOT_FOUND",{message:am.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:am.INVALID_TOKEN});let f=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!f||!f?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:am.FAILED_TO_GET_USER_INFO});if(!f.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new g.LG("UNAUTHORIZED",{message:am.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===f.user.id))return a.json({redirect:!1,url:"",status:!0});let h=a.context.options.account?.accountLinking?.trustedProviders;if(!h?.includes(c.id)&&!f.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new g.LG("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(f.user.email!==b.user.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new g.LG("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:f.user.id.toString(),accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")},a)}catch(a){throw new g.LG("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:f.user?.name,image:f.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({redirect:!1,url:"",status:!0})}let d=await aA(a,{userId:b.user.id,email:b.user.email}),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.json({url:e.toString(),redirect:!0})}),a8=ag("/unlink-account",{method:"POST",body:e.Ik({providerId:e.Yj(),accountId:e.Yj().optional()}),use:[aq],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new g.LG("BAD_REQUEST",{message:am.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new g.LG("BAD_REQUEST",{message:am.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),a9=ag("/get-access-token",{method:"POST",body:e.Ik({providerId:e.Yj().meta({description:"The provider ID for the OAuth provider"}),accountId:e.Yj().meta({description:"The account ID associated with the refresh token"}).optional(),userId:e.Yj().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,f=await ao(a);if(e&&!f)throw a.error("UNAUTHORIZED");let h=f?.user?.id||d;if(!h)throw new g.LG("BAD_REQUEST",{message:"Either userId or session is required"});if(!a.context.socialProviders.find(a=>a.id===b))throw new g.LG("BAD_REQUEST",{message:`Provider ${b} is not supported.`});let i=(await a.context.internalAdapter.findAccounts(h)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!i)throw new g.LG("BAD_REQUEST",{message:"Account not found"});let j=a.context.socialProviders.find(a=>a.id===b);if(!j)throw new g.LG("BAD_REQUEST",{message:`Provider ${b} not found.`});try{let b=null,c=i.accessTokenExpiresAt&&new Date(i.accessTokenExpiresAt).getTime()-Date.now()<5e3;i.refreshToken&&c&&j.refreshAccessToken&&(b=await j.refreshAccessToken(i.refreshToken),await a.context.internalAdapter.updateAccount(i.id,{accessToken:await aE(b.accessToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshToken:await aE(b.refreshToken,a.context),refreshTokenExpiresAt:b.refreshTokenExpiresAt}));let d={accessToken:await function(a,b){return a&&b.options.account?.encryptOAuthTokens?(0,k.zp)({key:b.secret,data:a}):a}(b?.accessToken??i.accessToken??"",a.context),accessTokenExpiresAt:b?.accessTokenExpiresAt??i.accessTokenExpiresAt??void 0,scopes:i.scope?.split(",")??[],idToken:b?.idToken??i.idToken??void 0};return a.json(d)}catch(a){throw new g.LG("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),ba=ag("/refresh-token",{method:"POST",body:e.Ik({providerId:e.Yj().meta({description:"The provider ID for the OAuth provider"}),accountId:e.Yj().meta({description:"The account ID associated with the refresh token"}).optional(),userId:e.Yj().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let{providerId:b,accountId:c,userId:d}=a.body,e=a.request,f=await ao(a);if(e&&!f)throw a.error("UNAUTHORIZED");let h=f?.user?.id||d;if(!h)throw new g.LG("BAD_REQUEST",{message:"Either userId or session is required"});let i=(await a.context.internalAdapter.findAccounts(h)).find(a=>c?a.id===c&&a.providerId===b:a.providerId===b);if(!i)throw new g.LG("BAD_REQUEST",{message:"Account not found"});let j=a.context.socialProviders.find(a=>a.id===b);if(!j)throw new g.LG("BAD_REQUEST",{message:`Provider ${b} not found.`});if(!j.refreshAccessToken)throw new g.LG("BAD_REQUEST",{message:`Provider ${b} does not support token refreshing.`});try{let b=await j.refreshAccessToken(i.refreshToken);return await a.context.internalAdapter.updateAccount(i.id,{accessToken:await aE(b.accessToken,a.context),refreshToken:await aE(b.refreshToken,a.context),accessTokenExpiresAt:b.accessTokenExpiresAt,refreshTokenExpiresAt:b.refreshTokenExpiresAt}),a.json(b)}catch(a){throw new g.LG("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),bb=ag("/account-info",{method:"POST",use:[ap],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:e.Ik({accountId:e.Yj().meta({description:"The provider given account id for which to get the account info"})})},async a=>{let b=await a.context.internalAdapter.findAccount(a.body.accountId);if(!b||b.userId!==a.context.session.user.id)throw new g.LG("BAD_REQUEST",{message:"Account not found"});let c=a.context.socialProviders.find(a=>a.id===b.providerId);if(!c)throw new g.LG("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let d=await a9({...a,body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1});if(!d.accessToken)throw new g.LG("BAD_REQUEST",{message:"Access token not found"});let e=await c.getUserInfo({...d,accessToken:d.accessToken});return a.json(e)})},18634:(a,b,c)=>{c.d(b,{GB:()=>n,KN:()=>r,Ve:()=>q,ds:()=>o,vC:()=>p});var d=c(63966),e=c(59659),f=c(23244),g=c(221),h=c(34082),i=c(93806),j=c(65968),k=c(58436),l=c(36398),m=c(38070);function n(a){if(3===a.length)return o(a[0],a[1],a[2]);if(1===a.length)return(0,i.$s)(a[0]);throw Error(`invalid arguments: ${JSON.stringify(a)}`)}function o(a,b,c){var e;return("is"===(e=b)||"is not"===e)&&s(c)?d.l.create((0,h.$O)(a),t(b),j.q.createImmediate(c)):d.l.create((0,h.$O)(a),t(b),(0,i.U2)(c))}function p(a,b,c){return d.l.create((0,h.$O)(a),t(b),(0,h.$O)(c))}function q(a,b){return r(Object.entries(a).filter(([,a])=>!(0,e.b0)(a)).map(([a,b])=>o(a,s(b)?"is":"=",b)),b)}function r(a,b,c=!0){let e="and"===b?k.s.create:m.K.create;if(0===a.length)return d.l.create(j.q.createImmediate(1),g.zX.create("="),j.q.createImmediate(+("and"===b)));let f=u(a[0]);for(let b=1;b<a.length;++b)f=e(f,u(a[b]));return a.length>1&&c?l.k.create(f):f}function s(a){return(0,e.kZ)(a)||(0,e.Lm)(a)}function t(a){if((0,e.Kg)(a)&&g.we.includes(a))return g.zX.create(a);if((0,f.N)(a))return a.toOperationNode();throw Error(`invalid operator ${JSON.stringify(a)}`)}function u(a){return(0,f.N)(a)?a.toOperationNode():a}},18712:(a,b,c)=>{c.d(b,{Pv:()=>g,d7:()=>e,w:()=>f});var d=c(8575);class e{static [d.i]="ConsoleLogWriter";write(a){console.log(a)}}class f{static [d.i]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new e}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class g{static [d.i]="NoopLogger";logQuery(){}}},18868:(a,b,c)=>{a.exports=c(44870)},20374:(a,b,c)=>{c.d(b,{A:()=>k});var d=c(77598),e=c(57975),f=c(48655),g=c(79841),h=c(53410),i=c(53628);let j=(0,e.promisify)(d.sign),k=async(a,b,c)=>{let e=(0,i.A)(a,b,"sign");if(a.startsWith("HS")){let b=d.createHmac(function(a){switch(a){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new g.T0(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}(a),e);return b.update(c),b.digest()}return j((0,f.A)(a),c,(0,h.A)(a,e))}},20493:(a,b,c)=>{c.d(b,{g:()=>d});let d=a=>{let b=a.plugins?.reduce((a,b)=>{let c=b.schema;if(!c)return a;for(let[b,d]of Object.entries(c))a[b]={fields:{...a[b]?.fields,...d.fields},modelName:d.modelName||b};return a},{}),c=a.rateLimit?.storage==="database",d={rateLimit:{modelName:a.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:a.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:a.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:a.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:e,session:f,account:g,...h}=b||{},i={session:{modelName:a.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:a.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:a.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:a.session?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:a.session?.fields?.updatedAt||"updatedAt"},ipAddress:{type:"string",required:!1,fieldName:a.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:a.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:a.session?.fields?.userId||"userId",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...f?.fields,...a.session?.additionalFields},order:2}};return{user:{modelName:a.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:a.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:a.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:()=>!1,required:!0,fieldName:a.user?.fields?.emailVerified||"emailVerified"},image:{type:"string",required:!1,fieldName:a.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:a.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:a.user?.fields?.updatedAt||"updatedAt"},...e?.fields,...a.user?.additionalFields},order:1},...!a.secondaryStorage||a.session?.storeSessionInDatabase?i:{},account:{modelName:a.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:a.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:a.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:a.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:a.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:a.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:a.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:a.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:a.account?.fields?.accessTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:a.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:a.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:a.account?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,fieldName:a.account?.fields?.updatedAt||"updatedAt"},...g?.fields},order:3},verification:{modelName:a.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:a.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:a.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:a.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:a.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!1,defaultValue:()=>new Date,fieldName:a.verification?.fields?.updatedAt||"updatedAt"}},order:4},...h,...c?d:{}}}},21461:(a,b,c)=>{c.d(b,{a:()=>h});var d=c(47581),e=c(18634),f=c(97434),g=c(15021);function h(a,b){var c,h,i,j,k,l,m,n;if(3===b.length){return c=a,h=b[0],i=b[1],j=b[2],d.b.createWithOn(c,(0,g.uJ)(h),(0,e.vC)(i,"=",j))}if(2===b.length){return k=a,l=b[0],(0,b[1])((0,f.GQ)(k,l)).toOperationNode()}if(1===b.length){return m=a,n=b[0],d.b.create(m,(0,g.uJ)(n))}throw Error("not implemented")}},22041:(a,b,c)=>{c.d(b,{B:()=>d});class d extends Error{constructor(a,b){super(a),this.name="BetterAuthError",this.message=a,this.cause=b,this.stack=""}}},22321:(a,b,c)=>{c.d(b,{g:()=>d});let d=(0,c(61741).q)("a-z","0-9","A-Z","-_")},22715:(a,b,c)=>{c.d(b,{O:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"OrderByNode"===a.kind,create:a=>(0,d.CN)({kind:"OrderByNode",items:(0,d.CN)([...a])}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})})},22887:(a,b,c)=>{c.d(b,{Er:()=>aW,FA:()=>aT,zp:()=>aZ,vX:()=>aY,BE:()=>aX});var d=c(95856);function e(a){if(!Number.isSafeInteger(a)||a<0)throw Error(`positive integer expected, not ${a}`)}function f(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function g(a){return a instanceof Uint8Array||null!=a&&"object"==typeof a&&"Uint8Array"===a.constructor.name}function h(a,...b){if(!g(a))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error(`Uint8Array expected of length ${b}, not of length=${a.length}`)}function i(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}let j=a=>new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4));if(68!==new Uint8Array(new Uint32Array([0x11223344]).buffer)[0])throw Error("Non little-endian hardware is not supported");let k=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0")),l={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function m(a){return a>=l._0&&a<=l._9?a-l._0:a>=l._A&&a<=l._F?a-(l._A-10):a>=l._a&&a<=l._f?a-(l._a-10):void 0}function n(a){if("string"!=typeof a)throw Error(`string expected, got ${typeof a}`);return new Uint8Array(new TextEncoder().encode(a))}function o(a){if("string"==typeof a)a=n(a);else if(g(a))a=q(a);else throw Error(`Uint8Array expected, got ${typeof a}`);return a}function p(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}function q(a){return Uint8Array.from(a)}function r(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let s=a=>Uint8Array.from(a.split("").map(a=>a.charCodeAt(0))),t=s("expand 16-byte k"),u=s("expand 32-byte k"),v=j(t),w=j(u);function x(a,b){return a<<b|a>>>32-b}function y(a){return a.byteOffset%4==0}w.slice();let z=0x100000000-1,A=new Uint32Array;function B(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:g,counterRight:i,rounds:k}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return e(g),e(k),f(i),f(c),(b,f,l,m,n=0)=>{h(b),h(f),h(l);let o=l.length;if(void 0===m&&(m=new Uint8Array(o)),h(m),e(n),n<0||n>=z)throw Error("arx: counter overflow");if(m.length<o)throw Error(`arx: output (${m.length}) is shorter than data (${o})`);let p=[],s=b.length,t,u;if(32===s)p.push(t=q(b)),u=w;else if(16===s&&c)(t=new Uint8Array(32)).set(b),t.set(b,16),u=v,p.push(t);else throw Error(`arx: invalid 32-byte key, got length=${s}`);y(f)||p.push(f=q(f));let x=j(t);if(d){if(24!==f.length)throw Error("arx: extended nonce must be 24 bytes");d(u,x,j(f.subarray(0,16)),x),f=f.subarray(16)}let B=16-g;if(B!==f.length)throw Error(`arx: nonce must be ${B} or 16 bytes`);if(12!==B){let a=new Uint8Array(12);a.set(f,i?0:12-f.length),f=a,p.push(f)}return!function(a,b,c,d,e,f,g,h){let i=e.length,k=new Uint8Array(64),l=j(k),m=y(e)&&y(f),n=m?j(e):A,o=m?j(f):A;for(let j=0;j<i;g++){if(a(b,c,d,l,g,h),g>=z)throw Error("arx: counter overflow");let p=Math.min(64,i-j);if(m&&64===p){let a=j/4;if(j%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)o[c=a+b]=n[c]^l[b];j+=64;continue}for(let a=0,b;a<p;a++)f[b=j+a]=e[b]^k[a];j+=p}}(a,u,x,j(f),l,m,n,k),r(...p),m}}let C=(a,b)=>255&a[b++]|(255&a[b++])<<8;class D{constructor(a){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,h(a=o(a),32);let b=C(a,0),c=C(a,2),d=C(a,4),e=C(a,6),f=C(a,8),g=C(a,10),i=C(a,12),j=C(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|i<<5)&8065,this.r[8]=(i>>>8|j<<8)&8191,this.r[9]=j>>>5&127;for(let b=0;b<8;b++)this.pad[b]=C(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=C(a,b+0),q=C(a,b+2),r=C(a,b+4),s=C(a,b+6),t=C(a,b+8),u=C(a,b+10),v=C(a,b+12),w=C(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),D=d[5]+(t>>>1&8191),E=d[6]+((t>>>14|u<<2)&8191),F=d[7]+((u>>>11|v<<5)&8191),G=d[8]+((v>>>8|w<<8)&8191),H=d[9]+(w>>>5|2048*!c),I=0,J=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;I=J>>>13,J&=8191,J+=5*k*D+5*j*E+5*i*F+5*h*G+5*g*H,I+=J>>>13,J&=8191;let K=I+x*g+y*f+5*o*z+5*n*A+5*m*B;I=K>>>13,K&=8191,K+=5*l*D+5*k*E+5*j*F+5*i*G+5*h*H,I+=K>>>13,K&=8191;let L=I+x*h+y*g+z*f+5*o*A+5*n*B;I=L>>>13,L&=8191,L+=5*m*D+5*l*E+5*k*F+5*j*G+5*i*H,I+=L>>>13,L&=8191;let M=I+x*i+y*h+z*g+A*f+5*o*B;I=M>>>13,M&=8191,M+=5*n*D+5*m*E+5*l*F+5*k*G+5*j*H,I+=M>>>13,M&=8191;let N=I+x*j+y*i+z*h+A*g+B*f;I=N>>>13,N&=8191,N+=5*o*D+5*n*E+5*m*F+5*l*G+5*k*H,I+=N>>>13,N&=8191;let O=I+x*k+y*j+z*i+A*h+B*g;I=O>>>13,O&=8191,O+=D*f+5*o*E+5*n*F+5*m*G+5*l*H,I+=O>>>13,O&=8191;let P=I+x*l+y*k+z*j+A*i+B*h;I=P>>>13,P&=8191,P+=D*g+E*f+5*o*F+5*n*G+5*m*H,I+=P>>>13,P&=8191;let Q=I+x*m+y*l+z*k+A*j+B*i;I=Q>>>13,Q&=8191,Q+=D*h+E*g+F*f+5*o*G+5*n*H,I+=Q>>>13,Q&=8191;let R=I+x*n+y*m+z*l+A*k+B*j;I=R>>>13,R&=8191,R+=D*i+E*h+F*g+G*f+5*o*H,I+=R>>>13,R&=8191;let S=I+x*o+y*n+z*m+A*l+B*k;I=S>>>13,S&=8191,S+=D*j+E*i+F*h+G*g+H*f,I+=S>>>13,S&=8191,J=8191&(I=(I=(I<<2)+I|0)+J|0),I>>>=13,K+=I,d[0]=J,d[1]=K,d[2]=L,d[3]=M,d[4]=N,d[5]=O,d[6]=P,d[7]=Q,d[8]=R,d[9]=S}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;r(c)}update(a){i(this);let{buffer:b,blockLen:c}=this,d=(a=o(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){r(this.h,this.r,this.buffer,this.pad)}digestInto(a){i(this);h(a);let b=this.outputLen;if(a.length<b)throw Error(`digestInto() expects output buffer of length at least ${b}`);this.finished=!0;let{buffer:c,h:d}=this,{pos:e}=this;if(e){for(c[e++]=1;e<16;e++)c[e]=0;this.process(c,0,!0)}this.finalize();let f=0;for(let b=0;b<8;b++)a[f++]=d[b]>>>0,a[f++]=d[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let E=function(a){let b=(b,c)=>a(c).update(o(b)).digest(),c=a(new Uint8Array(32));return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=b=>a(b),b}(a=>new D(a));function F(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,y=i,z=j,A=k,B=l,C=m,D=n,E=o,G=p,H=q,I=r,J=e,K=s,L=t,M=u;for(let a=0;a<f;a+=2)E=E+(J=x(J^(v=v+A|0),16))|0,v=v+(A=x(A^E,12))|0,E=E+(J=x(J^v,8))|0,A=x(A^E,7),G=G+(K=x(K^(w=w+B|0),16))|0,w=w+(B=x(B^G,12))|0,G=G+(K=x(K^w,8))|0,B=x(B^G,7),H=H+(L=x(L^(y=y+C|0),16))|0,y=y+(C=x(C^H,12))|0,H=H+(L=x(L^y,8))|0,C=x(C^H,7),I=I+(M=x(M^(z=z+D|0),16))|0,z=z+(D=x(D^I,12))|0,I=I+(M=x(M^z,8))|0,D=x(D^I,7),H=H+(M=x(M^(v=v+B|0),16))|0,v=v+(B=x(B^H,12))|0,H=H+(M=x(M^v,8))|0,B=x(B^H,7),I=I+(J=x(J^(w=w+C|0),16))|0,w=w+(C=x(C^I,12))|0,I=I+(J=x(J^w,8))|0,C=x(C^I,7),E=E+(K=x(K^(y=y+D|0),16))|0,y=y+(D=x(D^E,12))|0,E=E+(K=x(K^y,8))|0,D=x(D^E,7),G=G+(L=x(L^(z=z+A|0),16))|0,z=z+(A=x(A^G,12))|0,G=G+(L=x(L^z,8))|0,A=x(A^G,7);let N=0;d[N++]=g+v|0,d[N++]=h+w|0,d[N++]=i+y|0,d[N++]=j+z|0,d[N++]=k+A|0,d[N++]=l+B|0,d[N++]=m+C|0,d[N++]=n+D|0,d[N++]=o+E|0,d[N++]=p+G|0,d[N++]=q+H|0,d[N++]=r+I|0,d[N++]=e+J|0,d[N++]=s+K|0,d[N++]=t+L|0,d[N++]=u+M|0}let G=B(F,{counterRight:!1,counterLength:4,allowShortKeys:!1}),H=B(F,{counterRight:!1,counterLength:8,extendNonceFn:function(a,b,c,d){let e=a[0],f=a[1],g=a[2],h=a[3],i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=c[0],r=c[1],s=c[2],t=c[3];for(let a=0;a<20;a+=2)m=m+(q=x(q^(e=e+i|0),16))|0,e=e+(i=x(i^m,12))|0,m=m+(q=x(q^e,8))|0,i=x(i^m,7),n=n+(r=x(r^(f=f+j|0),16))|0,f=f+(j=x(j^n,12))|0,n=n+(r=x(r^f,8))|0,j=x(j^n,7),o=o+(s=x(s^(g=g+k|0),16))|0,g=g+(k=x(k^o,12))|0,o=o+(s=x(s^g,8))|0,k=x(k^o,7),p=p+(t=x(t^(h=h+l|0),16))|0,h=h+(l=x(l^p,12))|0,p=p+(t=x(t^h,8))|0,l=x(l^p,7),o=o+(t=x(t^(e=e+j|0),16))|0,e=e+(j=x(j^o,12))|0,o=o+(t=x(t^e,8))|0,j=x(j^o,7),p=p+(q=x(q^(f=f+k|0),16))|0,f=f+(k=x(k^p,12))|0,p=p+(q=x(q^f,8))|0,k=x(k^p,7),m=m+(r=x(r^(g=g+l|0),16))|0,g=g+(l=x(l^m,12))|0,m=m+(r=x(r^g,8))|0,l=x(l^m,7),n=n+(s=x(s^(h=h+i|0),16))|0,h=h+(i=x(i^n,12))|0,n=n+(s=x(s^h,8))|0,i=x(i^n,7);let u=0;d[u++]=e,d[u++]=f,d[u++]=g,d[u++]=h,d[u++]=q,d[u++]=r,d[u++]=s,d[u++]=t},allowShortKeys:!1}),I=new Uint8Array(16),J=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(I.subarray(c))},K=new Uint8Array(32);function L(a,b,c,d,e){let f=a(b,c,K),g=E.create(f);e&&J(g,e),J(g,d);let h=new Uint8Array(16),i=new DataView(h.buffer,h.byteOffset,h.byteLength);p(i,0,BigInt(e?e.length:0),!0),p(i,8,BigInt(d.length),!0),g.update(h);let j=g.digest();return r(f,h),j}let M=a=>(b,c,d)=>(h(b,32),h(c),{encrypt(e,f){let g=e.length,i=g+16;f?h(f,i):f=new Uint8Array(i),a(b,c,e,f,1);let j=L(a,b,c,f.subarray(0,-16),d);return f.set(j,g),r(j),f},decrypt(e,f){let g=e.length,i=g-16;if(g<16)throw Error("encrypted data must be at least 16 bytes");f?h(f,i):f=new Uint8Array(i);let j=e.subarray(0,-16),k=e.subarray(-16),l=L(a,b,c,j,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(k,l))throw Error("invalid tag");return a(b,c,j,f,1),r(l),f}});M(G);let N=((a,b)=>(Object.assign(b,a),b))({blockSize:64,nonceLength:24,tagLength:16},M(H));var O=c(77598),P=c.t(O,2);let Q=P&&"object"==typeof P&&"webcrypto"in P?O.webcrypto:void 0;function R(){if(Q&&"object"==typeof Q.subtle&&null!=Q.subtle)return Q.subtle;throw Error("crypto.subtle must be defined")}function S(a){return e(a.nonceLength),(b,...c)=>({encrypt(d,...e){let{nonceLength:f}=a,g=function(a=32){if(Q&&"function"==typeof Q.getRandomValues)return Q.getRandomValues(new Uint8Array(a));throw Error("crypto.getRandomValues must be defined")}(f),i=a(b,g,...c).encrypt(d,...e),j=function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];h(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(g,i);return i.fill(0),j},decrypt(d,...e){let{nonceLength:f}=a,g=d.subarray(0,f),h=d.subarray(f);return a(b,g,...c).decrypt(h,...e)}})}let T={async encrypt(a,b,c,d){let e=R(),f=await e.importKey("raw",a,b,!0,["encrypt"]);return new Uint8Array(await e.encrypt(c,f,d))},async decrypt(a,b,c,d){let e=R(),f=await e.importKey("raw",a,b,!0,["decrypt"]);return new Uint8Array(await e.decrypt(c,f,d))}},U={CBC:"AES-CBC",CTR:"AES-CTR",GCM:"AES-GCM"};function V(a){return(b,c,d)=>{h(b),h(c);let e={name:a,length:8*b.length},f=function(a,b,c){if(a===U.CBC)return{name:U.CBC,iv:b};if(a===U.CTR)return{name:U.CTR,counter:b,length:64};if(a===U.GCM)if(c)return{name:U.GCM,iv:b,additionalData:c};else return{name:U.GCM,iv:b};throw Error("unknown aes block mode")}(a,c,d);return{encrypt:a=>(h(a),T.encrypt(b,e,f,a)),decrypt:a=>(h(a),T.decrypt(b,e,f,a))}}}V(U.CBC),V(U.CTR),V(U.GCM),c(59061);var W=c(46584),X=c(20374),Y=c(34650),Z=c(79841),$=c(50047),_=c(93330),aa=c(89100);class ab{_payload;_protectedHeader;_unprotectedHeader;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=a}setProtectedHeader(a){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=a,this}setUnprotectedHeader(a){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=a,this}async sign(a,b){let c;if(!this._protectedHeader&&!this._unprotectedHeader)throw new Z.Ye("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!(0,Y.A)(this._protectedHeader,this._unprotectedHeader))throw new Z.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let d={...this._protectedHeader,...this._unprotectedHeader},e=(0,aa.A)(Z.Ye,new Map([["b64",!0]]),b?.crit,this._protectedHeader,d),f=!0;if(e.has("b64")&&"boolean"!=typeof(f=this._protectedHeader.b64))throw new Z.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:g}=d;if("string"!=typeof g||!g)throw new Z.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');(0,_.I)(g,a,"sign");let h=this._payload;f&&(h=$.Rd.encode((0,W.lF)(h))),c=this._protectedHeader?$.Rd.encode((0,W.lF)(JSON.stringify(this._protectedHeader))):$.Rd.encode("");let i=(0,$.xW)(c,$.Rd.encode("."),h),j=await (0,X.A)(g,a,i),k={signature:(0,W.lF)(j),payload:""};return f&&(k.payload=$.D0.decode(h)),this._unprotectedHeader&&(k.header=this._unprotectedHeader),this._protectedHeader&&(k.protected=$.D0.decode(c)),k}}class ac{_flattened;constructor(a){this._flattened=new ab(a)}setProtectedHeader(a){return this._flattened.setProtectedHeader(a),this}async sign(a,b){let c=await this._flattened.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}var ad=c(41638),ae=c(78257),af=c(79609);function ag(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}class ah{_payload;constructor(a={}){if(!(0,ae.A)(a))throw TypeError("JWT Claims Set MUST be an object");this._payload=a}setIssuer(a){return this._payload={...this._payload,iss:a},this}setSubject(a){return this._payload={...this._payload,sub:a},this}setAudience(a){return this._payload={...this._payload,aud:a},this}setJti(a){return this._payload={...this._payload,jti:a},this}setNotBefore(a){return"number"==typeof a?this._payload={...this._payload,nbf:ag("setNotBefore",a)}:a instanceof Date?this._payload={...this._payload,nbf:ag("setNotBefore",(0,ad.A)(a))}:this._payload={...this._payload,nbf:(0,ad.A)(new Date)+(0,af.A)(a)},this}setExpirationTime(a){return"number"==typeof a?this._payload={...this._payload,exp:ag("setExpirationTime",a)}:a instanceof Date?this._payload={...this._payload,exp:ag("setExpirationTime",(0,ad.A)(a))}:this._payload={...this._payload,exp:(0,ad.A)(new Date)+(0,af.A)(a)},this}setIssuedAt(a){return void 0===a?this._payload={...this._payload,iat:(0,ad.A)(new Date)}:a instanceof Date?this._payload={...this._payload,iat:ag("setIssuedAt",(0,ad.A)(a))}:"string"==typeof a?this._payload={...this._payload,iat:ag("setIssuedAt",(0,ad.A)(new Date)+(0,af.A)(a))}:this._payload={...this._payload,iat:ag("setIssuedAt",a)},this}}class ai extends ah{_protectedHeader;setProtectedHeader(a){return this._protectedHeader=a,this}async sign(a,b){let c=new ac($.Rd.encode(JSON.stringify(this._payload)));if(c.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new Z.Dp("JWTs MUST NOT use unencoded payload");return c.sign(a,b)}}function aj(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function ak(a,...b){if(!(a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name))throw Error("Uint8Array expected");if(b.length>0&&!b.includes(a.length))throw Error("Uint8Array expected of length "+b+", got length="+a.length)}function al(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash should be wrapped by utils.createHasher");aj(a.outputLen),aj(a.blockLen)}function am(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function an(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ao(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function ap(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function aq(a,b){return a<<32-b|a>>>b}function ar(a,b){return a<<b|a>>>32-b>>>0}let as=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a},at="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,au={_0:48,_9:57,A:65,F:70,a:97,f:102};function av(a){return a>=au._0&&a<=au._9?a-au._0:a>=au.A&&a<=au.F?a-(au.A-10):a>=au.a&&a<=au.f?a-(au.a-10):void 0}let aw=async()=>{};async function ax(a,b,c){let d=Date.now();for(let e=0;e<a;e++){c(e);let a=Date.now()-d;a>=0&&a<b||(await aw(),d+=a)}}function ay(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}function az(a){return"string"==typeof a&&(a=ay(a)),ak(a),a}function aA(a){return"string"==typeof a&&(a=ay(a)),ak(a),a}function aB(a,b){if(void 0!==b&&"[object Object]"!==({}).toString.call(b))throw Error("options should be object or undefined");return Object.assign(a,b)}class aC{}class aD extends aC{constructor(a,b){super(),this.finished=!1,this.destroyed=!1,al(a);let c=az(b);if(this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let d=this.blockLen,e=new Uint8Array(d);e.set(c.length>d?a.create().update(c).digest():c);for(let a=0;a<e.length;a++)e[a]^=54;this.iHash.update(e),this.oHash=a.create();for(let a=0;a<e.length;a++)e[a]^=106;this.oHash.update(e),ao(e)}update(a){return am(this),this.iHash.update(a),this}digestInto(a){am(this),ak(a,this.outputLen),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||(a=Object.create(Object.getPrototypeOf(this),{}));let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let aE=(a,b,c)=>new aD(a,b).update(c).digest();function aF(a,b,c,d){var e;let f,{c:g,dkLen:h,DK:i,PRF:j,PRFSalt:k}=function(a,b,c,d){al(a);let{c:e,dkLen:f,asyncTick:g}=aB({dkLen:32,asyncTick:10},d);if(aj(e),aj(f),aj(g),e<1)throw Error("iterations (c) should be >= 1");let h=aA(b),i=aA(c),j=new Uint8Array(f),k=aE.create(a,h),l=k._cloneInto().update(i);return{c:e,dkLen:f,asyncTick:g,DK:j,PRF:k,PRFSalt:l}}(a,b,c,d),l=new Uint8Array(4),m=ap(l),n=new Uint8Array(j.outputLen);for(let a=1,b=0;b<h;a++,b+=j.outputLen){let c=i.subarray(b,b+j.outputLen);m.setInt32(0,a,!1),(f=k._cloneInto(f)).update(l).digestInto(n),c.set(n.subarray(0,c.length));for(let a=1;a<g;a++){j._cloneInto(f).update(n).digestInto(n);for(let a=0;a<c.length;a++)c[a]^=n[a]}}return e=f,j.destroy(),k.destroy(),e&&e.destroy(),ao(n),i}aE.create=(a,b)=>new aD(a,b);class aG extends aC{constructor(a,b,c,d){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=ap(this.buffer)}update(a){am(this),ak(a=az(a));let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=ap(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){am(this);ak(a);let b=this.outputLen;if(a.length<b)throw Error("digestInto() expects output buffer of length at least "+b);this.finished=!0;let{buffer:c,view:d,blockLen:e,isLE:f}=this,{pos:g}=this;c[g++]=128,ao(this.buffer.subarray(g)),this.padOffset>e-g&&(this.process(d,0),g=0);for(let a=g;a<e;a++)c[a]=0;!function(a,b,c,d){if("function"==typeof a.setBigUint64)return a.setBigUint64(b,c,d);let e=BigInt(32),f=BigInt(0xffffffff),g=Number(c>>e&f),h=Number(c&f),i=4*!!d,j=4*!d;a.setUint32(b+i,g,d),a.setUint32(b+j,h,d)}(d,e-8,BigInt(8*this.length),f),this.process(d,0);let h=ap(a),i=this.outputLen;if(i%4)throw Error("_sha2: outputLen should be aligned to 32bit");let j=i/4,k=this.get();if(j>k.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<j;a++)h.setUint32(4*a,k[a],f)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){a||(a=new this.constructor),a.set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let aH=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),aI=BigInt(0x100000000-1),aJ=BigInt(32),aK=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),aL=new Uint32Array(64);class aM extends aG{constructor(a=32){super(64,a,8,!1),this.A=0|aH[0],this.B=0|aH[1],this.C=0|aH[2],this.D=0|aH[3],this.E=0|aH[4],this.F=0|aH[5],this.G=0|aH[6],this.H=0|aH[7]}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)aL[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=aL[a-15],c=aL[a-2],d=aq(b,7)^aq(b,18)^b>>>3,e=aq(c,17)^aq(c,19)^c>>>10;aL[a]=e+aL[a-7]+d+aL[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(aq(g,6)^aq(g,11)^aq(g,25))+((k=g)&h^~k&i)+aK[a]+aL[a]|0,o=(aq(c,2)^aq(c,13)^aq(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){ao(aL)}destroy(){this.set(0,0,0,0,0,0,0,0),ao(this.buffer)}}!function(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&aI),l:Number(a>>aJ&aI)}:{h:0|Number(a>>aJ&aI),l:0|Number(a&aI)}}(a[f],b);[d[f],e[f]]=[c,g]}}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a)));let aN=function(a){let b=b=>a().update(az(b)).digest(),c=a();return b.outputLen=c.outputLen,b.blockLen=c.blockLen,b.create=()=>a(),b}(()=>new aM);function aO(a,b,c,d,e,f){let g=a[b++]^c[d++],h=a[b++]^c[d++],i=a[b++]^c[d++],j=a[b++]^c[d++],k=a[b++]^c[d++],l=a[b++]^c[d++],m=a[b++]^c[d++],n=a[b++]^c[d++],o=a[b++]^c[d++],p=a[b++]^c[d++],q=a[b++]^c[d++],r=a[b++]^c[d++],s=a[b++]^c[d++],t=a[b++]^c[d++],u=a[b++]^c[d++],v=a[b++]^c[d++],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v;for(let a=0;a<8;a+=2)A^=ar(w+I|0,7),E^=ar(A+w|0,9),I^=ar(E+A|0,13),w^=ar(I+E|0,18),F^=ar(B+x|0,7),J^=ar(F+B|0,9),x^=ar(J+F|0,13),B^=ar(x+J|0,18),K^=ar(G+C|0,7),y^=ar(K+G|0,9),C^=ar(y+K|0,13),G^=ar(C+y|0,18),z^=ar(L+H|0,7),D^=ar(z+L|0,9),H^=ar(D+z|0,13),L^=ar(H+D|0,18),x^=ar(w+z|0,7),y^=ar(x+w|0,9),z^=ar(y+x|0,13),w^=ar(z+y|0,18),C^=ar(B+A|0,7),D^=ar(C+B|0,9),A^=ar(D+C|0,13),B^=ar(A+D|0,18),H^=ar(G+F|0,7),E^=ar(H+G|0,9),F^=ar(E+H|0,13),G^=ar(F+E|0,18),I^=ar(L+K|0,7),J^=ar(I+L|0,9),K^=ar(J+I|0,13),L^=ar(K+J|0,18);e[f++]=g+w|0,e[f++]=h+x|0,e[f++]=i+y|0,e[f++]=j+z|0,e[f++]=k+A|0,e[f++]=l+B|0,e[f++]=m+C|0,e[f++]=n+D|0,e[f++]=o+E|0,e[f++]=p+F|0,e[f++]=q+G|0,e[f++]=r+H|0,e[f++]=s+I|0,e[f++]=t+J|0,e[f++]=u+K|0,e[f++]=v+L|0}function aP(a,b,c,d,e){let f=d+0,g=d+16*e;for(let d=0;d<16;d++)c[g+d]=a[b+(2*e-1)*16+d];for(let d=0;d<e;d++,f+=16,b+=16)aO(c,g,a,b,c,f),d>0&&(g+=16),aO(c,f,a,b+=16,c,g)}async function aQ(a,b,c){let{N:d,r:e,p:f,dkLen:g,blockSize32:h,V:i,B32:j,B:k,tmp:l,blockMixCb:m,asyncTick:n}=function(a,b,c){let{N:d,r:e,p:f,dkLen:g,asyncTick:h,maxmem:i,onProgress:j}=aB({dkLen:32,asyncTick:10,maxmem:0x40000400},c);if(aj(d),aj(e),aj(f),aj(g),aj(h),aj(i),void 0!==j&&"function"!=typeof j)throw Error("progressCb should be function");let k=128*e,l=k/4;if(d<=1||(d&d-1)!=0||d>0x100000000)throw Error("Scrypt: N must be larger than 1, a power of 2, and less than 2^32");if(f<0||f>0x1fffffffe0/k)throw Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(g<0||g>0x1fffffffe0)throw Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");if(k*(d+f)>i)throw Error("Scrypt: memused is bigger than maxMem. Expected 128 * r * (N + p) > maxmem of "+i);let m=aF(aN,a,b,{c:1,dkLen:k*f}),n=an(m),o=an(new Uint8Array(k*d)),p=an(new Uint8Array(k)),q=()=>{};if(j){let a=2*d*f,b=Math.max(Math.floor(a/1e4),1),c=0;q=()=>{c++,j&&(!(c%b)||c===a)&&j(c/a)}}return{N:d,r:e,p:f,dkLen:g,blockSize32:l,V:o,B32:n,B:m,tmp:p,blockMixCb:q,asyncTick:h}}(a,b,c);as(j);for(let a=0;a<f;a++){let b=h*a;for(let a=0;a<h;a++)i[a]=j[b+a];let c=0;await ax(d-1,n,()=>{aP(i,c,i,c+=h,e),m()}),aP(i,(d-1)*h,j,b,e),m(),await ax(d,n,()=>{let a=j[b+h-16]%d;for(let c=0;c<h;c++)l[c]=j[b+c]^i[a*h+c];aP(l,0,j,b,e),m()})}as(j);let o=aF(aN,a,k,{c:1,dkLen:g});return ao(k,i,l),o}var aR=c(70192),aS=c(15247);async function aT(a,b,c=3600){return await new ai(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+c).sign(new TextEncoder().encode(b))}c(22321);let aU={N:16384,r:16,p:1,dkLen:64};async function aV(a,b){return await aQ(a.normalize("NFKC"),b,{N:aU.N,p:aU.p,r:aU.r,dkLen:aU.dkLen,maxmem:128*aU.N*aU.r*2})}let aW=async a=>{let b=aS.u.encode((0,aR.UY)(new Uint8Array(16))),c=await aV(a,b);return`${b}:${aS.u.encode(c)}`},aX=async({hash:a,password:b})=>{let[c,d]=a.split(":");return function(a,b){let c=new Uint8Array(a),d=new Uint8Array(b);if(c.length!==d.length)return!1;let e=0;for(let a=0;a<c.length;a++)e|=c[a]^d[a];return 0===e}(await aV(b,c),function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(at)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=av(a.charCodeAt(e)),f=av(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(d))},aY=async({key:a,data:b})=>{let c=await (0,d.n)("SHA-256").digest(a),e=n(b);return function(a){h(a);let b="";for(let c=0;c<a.length;c++)b+=k[a[c]];return b}(S(N)(new Uint8Array(c)).encrypt(e))},aZ=async({key:a,data:b})=>{let c=await (0,d.n)("SHA-256").digest(a),e=function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);let b=a.length,c=b/2;if(b%2)throw Error("padded hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=m(a.charCodeAt(e)),f=m(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(b),f=S(N)(new Uint8Array(c));return new TextDecoder().decode(f.decrypt(e))}},23244:(a,b,c)=>{c.d(b,{N:()=>e});var d=c(59659);function e(a){return(0,d.Gv)(a)&&(0,d.Tn)(a.toOperationNode)}},23921:(a,b,c)=>{c.d(b,{Y:()=>e,i:()=>f});var d=c(98708);function e(a){return(0,d.ll)`${a} asc`}function f(a){return(0,d.ll)`${a} desc`}},24047:(a,b,c)=>{c.d(b,{AC:()=>G,Ak:()=>i,Gl:()=>e,K3:()=>s,OI:()=>u,Os:()=>k,Rp:()=>m,Yj:()=>B,Z0:()=>f,Zg:()=>n,Zv:()=>H,ai:()=>D,ch:()=>F,fO:()=>h,gF:()=>d,hQ:()=>v,kB:()=>z,kM:()=>g,l7:()=>r,nd:()=>C,p0:()=>j,p6:()=>x,r0:()=>t,uR:()=>l,uX:()=>o,ug:()=>p,w$:()=>A,zM:()=>E,zr:()=>q});let d=/^[cC][^\s-]{8,}$/,e=/^[0-9a-z]+$/,f=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,g=/^[0-9a-vA-V]{20}$/,h=/^[A-Za-z0-9]{27}$/,i=/^[a-zA-Z0-9_-]{21}$/,j=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,k=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,l=a=>a?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${a}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000)$/,m=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/;function n(){return RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")}let o=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,p=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})$/,q=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,r=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,s=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,t=/^[A-Za-z0-9_-]*$/,u=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,v=/^\+(?:[0-9]){6,14}[0-9]$/,w="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",x=RegExp(`^${w}$`);function y(a){let b="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof a.precision?-1===a.precision?`${b}`:0===a.precision?`${b}:[0-5]\\d`:`${b}:[0-5]\\d\\.\\d{${a.precision}}`:`${b}(?::[0-5]\\d(?:\\.\\d+)?)?`}function z(a){return RegExp(`^${y(a)}$`)}function A(a){let b=y({precision:a.precision}),c=["Z"];a.local&&c.push(""),a.offset&&c.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");let d=`${b}(?:${c.join("|")})`;return RegExp(`^${w}T(?:${d})$`)}let B=a=>{let b=a?`[\\s\\S]{${a?.minimum??0},${a?.maximum??""}}`:"[\\s\\S]*";return RegExp(`^${b}$`)},C=/^\d+$/,D=/^-?\d+(?:\.\d+)?/i,E=/true|false/i,F=/null/i,G=/^[^A-Z]*$/,H=/^[^a-z]*$/},25332:(a,b,c)=>{let d,e;c.d(b,{k:()=>g});var f=c(5596);let g={startActiveSpan:(a,b)=>d?(e||(e=d.trace.getTracer("drizzle-orm","0.44.4")),(0,f.i)((c,d)=>d.startActiveSpan(a,a=>{try{return b(a)}catch(b){throw a.setStatus({code:c.SpanStatusCode.ERROR,message:b instanceof Error?b.message:"Unknown error"}),b}finally{a.end()}}),d,e)):b()}},26407:(a,b,c)=>{c.d(b,{A:()=>f,R:()=>g});var d=c(77598),e=c(57975);let f=d.webcrypto,g=a=>e.types.isCryptoKey(a)},26764:(a,b,c)=>{c.d(b,{n:()=>p});var d=c(44674),e=c(88565),f=c(59659);class g{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#d=(0,f.CN)({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),RenameConstraintNode:this.visitRenameConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),RefreshMaterializedViewNode:this.visitRefreshMaterializedView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this),OrActionNode:this.visitOrAction.bind(this),CollateNode:this.visitCollate.bind(this)});visitNode=a=>{this.nodeStack.push(a),this.#d[a.kind](a),this.nodeStack.pop()}}var h=c(221),i=c(36398),j=c(71767),k=c(46221),l=c(71763),m=c(79648),n=c(62020);let o=/'/g;class p extends g{#e="";#f=[];get numParameters(){return this.#f.length}compileQuery(a,b){return this.#e="",this.#f=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(a),(0,f.CN)({query:a,queryId:b,sql:this.getSql(),parameters:[...this.#f]})}getSql(){return this.#e}visitSelectQuery(a){let b=void 0!==this.parentNode&&!i.k.is(this.parentNode)&&!e.o.is(this.parentNode)&&!d.B.is(this.parentNode)&&!k.Y.is(this.parentNode)&&!l.i.is(this.parentNode);void 0===this.parentNode&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("select"),a.distinctOn&&(this.append(" "),this.compileDistinctOn(a.distinctOn)),a.frontModifiers?.length&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.top&&(this.append(" "),this.visitNode(a.top)),a.selections&&(this.append(" "),this.compileList(a.selections)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.groupBy&&(this.append(" "),this.visitNode(a.groupBy)),a.having&&(this.append(" "),this.visitNode(a.having)),a.setOperations&&(this.append(" "),this.compileList(a.setOperations," ")),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.offset&&(this.append(" "),this.visitNode(a.offset)),a.fetch&&(this.append(" "),this.visitNode(a.fetch)),a.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...a.endModifiers])," ")),b&&this.append(")")}visitFrom(a){this.append("from "),this.compileList(a.froms)}visitSelection(a){this.visitNode(a.selection)}visitColumn(a){this.visitNode(a.column)}compileDistinctOn(a){this.append("distinct on ("),this.compileList(a),this.append(")")}compileList(a,b=", "){let c=a.length-1;for(let d=0;d<=c;d++)this.visitNode(a[d]),d<c&&this.append(b)}visitWhere(a){this.append("where "),this.visitNode(a.where)}visitHaving(a){this.append("having "),this.visitNode(a.having)}visitInsertQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append(a.replace?"replace":"insert"),a.ignore&&((0,n.u)("`InsertQueryNode.ignore` is deprecated. Use `InsertQueryNode.orAction` instead."),this.append(" ignore")),a.orAction&&(this.append(" "),this.visitNode(a.orAction)),a.top&&(this.append(" "),this.visitNode(a.top)),a.into&&(this.append(" into "),this.visitNode(a.into)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.output&&(this.append(" "),this.visitNode(a.output)),a.values&&(this.append(" "),this.visitNode(a.values)),a.defaultValues&&(this.append(" "),this.append("default values")),a.onConflict&&(this.append(" "),this.visitNode(a.onConflict)),a.onDuplicateKey&&(this.append(" "),this.visitNode(a.onDuplicateKey)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitValues(a){this.append("values "),this.compileList(a.values)}visitDeleteQuery(a){let b=this.nodeStack.find(j.L.is)!==a;!b&&a.explain&&(this.visitNode(a.explain),this.append(" ")),b&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("delete "),a.top&&(this.visitNode(a.top),this.append(" ")),this.visitNode(a.from),a.output&&(this.append(" "),this.visitNode(a.output)),a.using&&(this.append(" "),this.visitNode(a.using)),a.joins&&(this.append(" "),this.compileList(a.joins," ")),a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),b&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitReturning(a){this.append("returning "),this.compileList(a.selections)}visitAlias(a){this.visitNode(a.node),this.append(" as "),this.visitNode(a.alias)}visitReference(a){a.table&&(this.visitNode(a.table),this.append(".")),this.visitNode(a.column)}visitSelectAll(a){this.append("*")}visitIdentifier(a){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(a),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(a){if(!(0,f.Kg)(a.name))throw Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(a.name))}visitAnd(a){this.visitNode(a.left),this.append(" and "),this.visitNode(a.right)}visitOr(a){this.visitNode(a.left),this.append(" or "),this.visitNode(a.right)}visitValue(a){a.immediate?this.appendImmediateValue(a.value):this.appendValue(a.value)}visitValueList(a){this.append("("),this.compileList(a.values),this.append(")")}visitTuple(a){this.append("("),this.compileList(a.values),this.append(")")}visitPrimitiveValueList(a){this.append("(");let{values:b}=a;for(let a=0;a<b.length;++a)this.appendValue(b[a]),a!==b.length-1&&this.append(", ");this.append(")")}visitParens(a){this.append("("),this.visitNode(a.node),this.append(")")}visitJoin(a){this.append(s[a.joinType]),this.append(" "),this.visitNode(a.table),a.on&&(this.append(" "),this.visitNode(a.on))}visitOn(a){this.append("on "),this.visitNode(a.on)}visitRaw(a){let{sqlFragments:b,parameters:c}=a;for(let a=0;a<b.length;++a)this.append(b[a]),c.length>a&&this.visitNode(c[a])}visitOperator(a){this.append(a.operator)}visitTable(a){this.visitNode(a.table)}visitSchemableIdentifier(a){a.schema&&(this.visitNode(a.schema),this.append(".")),this.visitNode(a.identifier)}visitCreateTable(a){this.append("create "),a.frontModifiers&&a.frontModifiers.length>0&&(this.compileList(a.frontModifiers," "),this.append(" ")),a.temporary&&this.append("temporary "),this.append("table "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.table),a.selectQuery?(this.append(" as "),this.visitNode(a.selectQuery)):(this.append(" ("),this.compileList([...a.columns,...a.constraints??[]]),this.append(")"),a.onCommit&&(this.append(" on commit "),this.append(a.onCommit)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," ")))}visitColumnDefinition(a){a.ifNotExists&&this.append("if not exists "),this.visitNode(a.column),this.append(" "),this.visitNode(a.dataType),a.unsigned&&this.append(" unsigned"),a.frontModifiers&&a.frontModifiers.length>0&&(this.append(" "),this.compileList(a.frontModifiers," ")),a.generated&&(this.append(" "),this.visitNode(a.generated)),a.identity&&this.append(" identity"),a.defaultTo&&(this.append(" "),this.visitNode(a.defaultTo)),a.notNull&&this.append(" not null"),a.unique&&this.append(" unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.primaryKey&&this.append(" primary key"),a.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),a.references&&(this.append(" "),this.visitNode(a.references)),a.check&&(this.append(" "),this.visitNode(a.check)),a.endModifiers&&a.endModifiers.length>0&&(this.append(" "),this.compileList(a.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(a){this.append("references "),this.visitNode(a.table),this.append(" ("),this.compileList(a.columns),this.append(")"),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate))}visitDropTable(a){this.append("drop table "),a.ifExists&&this.append("if exists "),this.visitNode(a.table),a.cascade&&this.append(" cascade")}visitDataType(a){this.append(a.dataType)}visitOrderBy(a){this.append("order by "),this.compileList(a.items)}visitOrderByItem(a){this.visitNode(a.orderBy),a.collation&&(this.append(" "),this.visitNode(a.collation)),a.direction&&(this.append(" "),this.visitNode(a.direction)),a.nulls&&(this.append(" nulls "),this.append(a.nulls))}visitGroupBy(a){this.append("group by "),this.compileList(a.items)}visitGroupByItem(a){this.visitNode(a.groupBy)}visitUpdateQuery(a){let b=this.nodeStack.find(j.L.is),c=b!==a;if(!c&&a.explain&&(this.visitNode(a.explain),this.append(" ")),c&&!m.r.is(b)&&this.append("("),a.with&&(this.visitNode(a.with),this.append(" ")),this.append("update "),a.top&&(this.visitNode(a.top),this.append(" ")),a.table&&(this.visitNode(a.table),this.append(" ")),this.append("set "),a.updates&&this.compileList(a.updates),a.output&&(this.append(" "),this.visitNode(a.output)),a.from&&(this.append(" "),this.visitNode(a.from)),a.joins){if(!a.from)throw Error("Joins in an update query are only supported as a part of a PostgreSQL 'update set from join' query. If you want to create a MySQL 'update join set' query, see https://kysely.dev/docs/examples/update/my-sql-joins");this.append(" "),this.compileList(a.joins," ")}a.where&&(this.append(" "),this.visitNode(a.where)),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),a.limit&&(this.append(" "),this.visitNode(a.limit)),a.returning&&(this.append(" "),this.visitNode(a.returning)),c&&!m.r.is(b)&&this.append(")"),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitColumnUpdate(a){this.visitNode(a.column),this.append(" = "),this.visitNode(a.value)}visitLimit(a){this.append("limit "),this.visitNode(a.limit)}visitOffset(a){this.append("offset "),this.visitNode(a.offset)}visitOnConflict(a){this.append("on conflict"),a.columns?(this.append(" ("),this.compileList(a.columns),this.append(")")):a.constraint?(this.append(" on constraint "),this.visitNode(a.constraint)):a.indexExpression&&(this.append(" ("),this.visitNode(a.indexExpression),this.append(")")),a.indexWhere&&(this.append(" "),this.visitNode(a.indexWhere)),!0===a.doNothing?this.append(" do nothing"):a.updates&&(this.append(" do update set "),this.compileList(a.updates),a.updateWhere&&(this.append(" "),this.visitNode(a.updateWhere)))}visitOnDuplicateKey(a){this.append("on duplicate key update "),this.compileList(a.updates)}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.using&&(this.append(" using "),this.visitNode(a.using)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.nullsNotDistinct&&this.append(" nulls not distinct"),a.where&&(this.append(" "),this.visitNode(a.where))}visitDropIndex(a){this.append("drop index "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.table&&(this.append(" on "),this.visitNode(a.table)),a.cascade&&this.append(" cascade")}visitCreateSchema(a){this.append("create schema "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.schema)}visitDropSchema(a){this.append("drop schema "),a.ifExists&&this.append("if exists "),this.visitNode(a.schema),a.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("primary key ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}buildDeferrable(a){void 0!==a.deferrable&&(a.deferrable?this.append(" deferrable"):this.append(" not deferrable")),void 0!==a.initiallyDeferred&&(a.initiallyDeferred?this.append(" initially deferred"):this.append(" initially immediate"))}visitUniqueConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("unique"),a.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(a.columns),this.append(")"),this.buildDeferrable(a)}visitCheckConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("check ("),this.visitNode(a.expression),this.append(")")}visitForeignKeyConstraint(a){a.name&&(this.append("constraint "),this.visitNode(a.name),this.append(" ")),this.append("foreign key ("),this.compileList(a.columns),this.append(") "),this.visitNode(a.references),a.onDelete&&(this.append(" on delete "),this.append(a.onDelete)),a.onUpdate&&(this.append(" on update "),this.append(a.onUpdate)),this.buildDeferrable(a)}visitList(a){this.compileList(a.items)}visitWith(a){this.append("with "),a.recursive&&this.append("recursive "),this.compileList(a.expressions)}visitCommonTableExpression(a){this.visitNode(a.name),this.append(" as "),(0,f.Lm)(a.materialized)&&(a.materialized||this.append("not "),this.append("materialized ")),this.visitNode(a.expression)}visitCommonTableExpressionName(a){this.visitNode(a.table),a.columns&&(this.append("("),this.compileList(a.columns),this.append(")"))}visitAlterTable(a){this.append("alter table "),this.visitNode(a.table),this.append(" "),a.renameTo&&(this.append("rename to "),this.visitNode(a.renameTo)),a.setSchema&&(this.append("set schema "),this.visitNode(a.setSchema)),a.addConstraint&&this.visitNode(a.addConstraint),a.dropConstraint&&this.visitNode(a.dropConstraint),a.renameConstraint&&this.visitNode(a.renameConstraint),a.columnAlterations&&this.compileColumnAlterations(a.columnAlterations),a.addIndex&&this.visitNode(a.addIndex),a.dropIndex&&this.visitNode(a.dropIndex)}visitAddColumn(a){this.append("add column "),this.visitNode(a.column)}visitRenameColumn(a){this.append("rename column "),this.visitNode(a.column),this.append(" to "),this.visitNode(a.renameTo)}visitDropColumn(a){this.append("drop column "),this.visitNode(a.column)}visitAlterColumn(a){this.append("alter column "),this.visitNode(a.column),this.append(" "),a.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(a.dataType),a.dataTypeExpression&&(this.append("using "),this.visitNode(a.dataTypeExpression))),a.setDefault&&(this.append("set default "),this.visitNode(a.setDefault)),a.dropDefault&&this.append("drop default"),a.setNotNull&&this.append("set not null"),a.dropNotNull&&this.append("drop not null")}visitModifyColumn(a){this.append("modify column "),this.visitNode(a.column)}visitAddConstraint(a){this.append("add "),this.visitNode(a.constraint)}visitDropConstraint(a){this.append("drop constraint "),a.ifExists&&this.append("if exists "),this.visitNode(a.constraintName),"cascade"===a.modifier?this.append(" cascade"):"restrict"===a.modifier&&this.append(" restrict")}visitRenameConstraint(a){this.append("rename constraint "),this.visitNode(a.oldName),this.append(" to "),this.visitNode(a.newName)}visitSetOperation(a){this.append(a.operator),this.append(" "),a.all&&this.append("all "),this.visitNode(a.expression)}visitCreateView(a){this.append("create "),a.orReplace&&this.append("or replace "),a.materialized&&this.append("materialized "),a.temporary&&this.append("temporary "),this.append("view "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),this.append(" "),a.columns&&(this.append("("),this.compileList(a.columns),this.append(") ")),a.as&&(this.append("as "),this.visitNode(a.as))}visitRefreshMaterializedView(a){this.append("refresh materialized view "),a.concurrently&&this.append("concurrently "),this.visitNode(a.name),a.withNoData?this.append(" with no data"):this.append(" with data")}visitDropView(a){this.append("drop "),a.materialized&&this.append("materialized "),this.append("view "),a.ifExists&&this.append("if exists "),this.visitNode(a.name),a.cascade&&this.append(" cascade")}visitGenerated(a){this.append("generated "),a.always&&this.append("always "),a.byDefault&&this.append("by default "),this.append("as "),a.identity&&this.append("identity"),a.expression&&(this.append("("),this.visitNode(a.expression),this.append(")")),a.stored&&this.append(" stored")}visitDefaultValue(a){this.append("default "),this.visitNode(a.defaultValue)}visitSelectModifier(a){a.rawModifier?this.visitNode(a.rawModifier):this.append(q[a.modifier]),a.of&&(this.append(" of "),this.compileList(a.of,", "))}visitCreateType(a){this.append("create type "),this.visitNode(a.name),a.enum&&(this.append(" as enum "),this.visitNode(a.enum))}visitDropType(a){this.append("drop type "),a.ifExists&&this.append("if exists "),this.visitNode(a.name)}visitExplain(a){this.append("explain"),(a.options||a.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),a.options&&(this.visitNode(a.options),a.format&&this.append(this.getExplainOptionsDelimiter())),a.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(a.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(a){this.append("default")}visitAggregateFunction(a){this.append(a.func),this.append("("),a.distinct&&this.append("distinct "),this.compileList(a.aggregated),a.orderBy&&(this.append(" "),this.visitNode(a.orderBy)),this.append(")"),a.withinGroup&&(this.append(" within group ("),this.visitNode(a.withinGroup),this.append(")")),a.filter&&(this.append(" filter("),this.visitNode(a.filter),this.append(")")),a.over&&(this.append(" "),this.visitNode(a.over))}visitOver(a){this.append("over("),a.partitionBy&&(this.visitNode(a.partitionBy),a.orderBy&&this.append(" ")),a.orderBy&&this.visitNode(a.orderBy),this.append(")")}visitPartitionBy(a){this.append("partition by "),this.compileList(a.items)}visitPartitionByItem(a){this.visitNode(a.partitionBy)}visitBinaryOperation(a){this.visitNode(a.leftOperand),this.append(" "),this.visitNode(a.operator),this.append(" "),this.visitNode(a.rightOperand)}visitUnaryOperation(a){this.visitNode(a.operator),this.isMinusOperator(a.operator)||this.append(" "),this.visitNode(a.operand)}isMinusOperator(a){return h.zX.is(a)&&"-"===a.operator}visitUsing(a){this.append("using "),this.compileList(a.tables)}visitFunction(a){this.append(a.func),this.append("("),this.compileList(a.arguments),this.append(")")}visitCase(a){this.append("case"),a.value&&(this.append(" "),this.visitNode(a.value)),a.when&&(this.append(" "),this.compileList(a.when," ")),a.else&&(this.append(" else "),this.visitNode(a.else)),this.append(" end"),a.isStatement&&this.append(" case")}visitWhen(a){this.append("when "),this.visitNode(a.condition),a.result&&(this.append(" then "),this.visitNode(a.result))}visitJSONReference(a){this.visitNode(a.reference),this.visitNode(a.traversal)}visitJSONPath(a){for(let b of(a.inOperator&&this.visitNode(a.inOperator),this.append("'$"),a.pathLegs))this.visitNode(b);this.append("'")}visitJSONPathLeg(a){let b="ArrayLocation"===a.type;this.append(b?"[":"."),this.append(String(a.value)),b&&this.append("]")}visitJSONOperatorChain(a){for(let b=0,c=a.values.length;b<c;b++)b===c-1?this.visitNode(a.operator):this.append("->"),this.visitNode(a.values[b])}visitMergeQuery(a){a.with&&(this.visitNode(a.with),this.append(" ")),this.append("merge "),a.top&&(this.visitNode(a.top),this.append(" ")),this.append("into "),this.visitNode(a.into),a.using&&(this.append(" "),this.visitNode(a.using)),a.whens&&(this.append(" "),this.compileList(a.whens," ")),a.returning&&(this.append(" "),this.visitNode(a.returning)),a.output&&(this.append(" "),this.visitNode(a.output)),a.endModifiers?.length&&(this.append(" "),this.compileList(a.endModifiers," "))}visitMatched(a){a.not&&this.append("not "),this.append("matched"),a.bySource&&this.append(" by source")}visitAddIndex(a){this.append("add "),a.unique&&this.append("unique "),this.append("index "),this.visitNode(a.name),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.using&&(this.append(" using "),this.visitNode(a.using))}visitCast(a){this.append("cast("),this.visitNode(a.expression),this.append(" as "),this.visitNode(a.dataType),this.append(")")}visitFetch(a){this.append("fetch next "),this.visitNode(a.rowCount),this.append(` rows ${a.modifier}`)}visitOutput(a){this.append("output "),this.compileList(a.selections)}visitTop(a){this.append(`top(${a.expression})`),a.modifiers&&this.append(` ${a.modifiers}`)}visitOrAction(a){this.append(a.action)}visitCollate(a){this.append("collate "),this.visitNode(a.collation)}append(a){this.#e+=a}appendValue(a){this.addParameter(a),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(a){let b=this.getLeftIdentifierWrapper(),c=this.getRightIdentifierWrapper(),d="";for(let e of a)d+=e,e===b?d+=b:e===c&&(d+=c);return d}sanitizeStringLiteral(a){return a.replace(o,"''")}addParameter(a){this.#f.push(a)}appendImmediateValue(a){if((0,f.Kg)(a))this.appendStringLiteral(a);else if((0,f.Et)(a)||(0,f.Lm)(a)||(0,f.sI)(a))this.append(a.toString());else if((0,f.kZ)(a))this.append("null");else if((0,f.$P)(a))this.appendImmediateValue(a.toISOString());else throw Error(`invalid immediate value ${a}`)}appendStringLiteral(a){this.append("'"),this.append(this.sanitizeStringLiteral(a)),this.append("'")}sortSelectModifiers(a){return a.sort((a,b)=>a.modifier&&b.modifier?r[a.modifier]-r[b.modifier]:1),(0,f.CN)(a)}compileColumnAlterations(a){this.compileList(a)}announcesNewColumnDataType(){return!0}}let q=(0,f.CN)({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),r=(0,f.CN)({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),s=(0,f.CN)({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",CrossJoin:"cross join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",LateralCrossJoin:"cross join lateral",OuterApply:"outer apply",CrossApply:"cross apply",Using:"using"})},27895:(a,b,c)=>{c.d(b,{Od:()=>i,Rb:()=>h,Tj:()=>g,bp:()=>l,wG:()=>k,xL:()=>j});var d=c(15017),e=c(87265),f=c(58054);let g=a=>(b,c,e,g)=>{let h=e?Object.assign(e,{async:!1}):{async:!1},i=b._zod.run({value:c,issues:[]},h);if(i instanceof Promise)throw new d.GT;if(i.issues.length){let b=new(g?.Err??a)(i.issues.map(a=>f.iR(a,h,d.$W())));throw f.gx(b,g?.callee),b}return i.value};e.Kd;let h=a=>async(b,c,e,g)=>{let h=e?Object.assign(e,{async:!0}):{async:!0},i=b._zod.run({value:c,issues:[]},h);if(i instanceof Promise&&(i=await i),i.issues.length){let b=new(g?.Err??a)(i.issues.map(a=>f.iR(a,h,d.$W())));throw f.gx(b,g?.callee),b}return i.value};e.Kd;let i=a=>(b,c,g)=>{let h=g?{...g,async:!1}:{async:!1},i=b._zod.run({value:c,issues:[]},h);if(i instanceof Promise)throw new d.GT;return i.issues.length?{success:!1,error:new(a??e.a$)(i.issues.map(a=>f.iR(a,h,d.$W())))}:{success:!0,data:i.value}},j=i(e.Kd),k=a=>async(b,c,e)=>{let g=e?Object.assign(e,{async:!0}):{async:!0},h=b._zod.run({value:c,issues:[]},g);return h instanceof Promise&&(h=await h),h.issues.length?{success:!1,error:new a(h.issues.map(a=>f.iR(a,g,d.$W())))}:{success:!0,data:h.value}},l=k(e.Kd)},28730:(a,b,c)=>{c.d(b,{c:()=>D});var d=c(15539),e=c(59659);let f=(0,e.CN)({is:a=>"SelectModifierNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"SelectModifierNode",modifier:a,of:b}),createWithExpression:a=>(0,e.CN)({kind:"SelectModifierNode",rawModifier:a})});var g=c(21461),h=c(15021),i=c(91164),j=c(34082),k=c(91054),l=c(71767),m=c(80038),n=c(98546);let o=(0,e.CN)({is:a=>"OffsetNode"===a.kind,create:a=>(0,e.CN)({kind:"OffsetNode",offset:a})}),p=(0,e.CN)({is:a=>"GroupByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"GroupByItemNode",groupBy:a})});var q=c(65505),r=c(30228),s=c(44344),t=c(71763),u=c(78215);function v(a,b,c){return(0,e.Tn)(b)&&(b=b((0,q.O)())),(0,e.MH)(b)||(b=[b]),b.map(b=>t.i.create(a,(0,u.YK)(b),c))}var w=c(18634),x=c(88202),y=c(93806),z=c(65968);let A={create:(a,b)=>({kind:"FetchNode",rowCount:z.q.create(a),modifier:b})};var B=c(4031);class C{#g;constructor(a){this.#g=(0,e.CN)(a)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...a){return new C({...this.#g,queryNode:l.L.cloneWithWhere(this.#g.queryNode,(0,w.GB)(a))})}whereRef(a,b,c){return new C({...this.#g,queryNode:l.L.cloneWithWhere(this.#g.queryNode,(0,w.vC)(a,b,c))})}having(...a){return new C({...this.#g,queryNode:k.L.cloneWithHaving(this.#g.queryNode,(0,w.GB)(a))})}havingRef(a,b,c){return new C({...this.#g,queryNode:k.L.cloneWithHaving(this.#g.queryNode,(0,w.vC)(a,b,c))})}select(a){return new C({...this.#g,queryNode:k.L.cloneWithSelections(this.#g.queryNode,(0,i.G)(a))})}distinctOn(a){return new C({...this.#g,queryNode:k.L.cloneWithDistinctOn(this.#g.queryNode,(0,j.kU)(a))})}modifyFront(a){return new C({...this.#g,queryNode:k.L.cloneWithFrontModifier(this.#g.queryNode,f.createWithExpression(a.toOperationNode()))})}modifyEnd(a){return new C({...this.#g,queryNode:l.L.cloneWithEndModifier(this.#g.queryNode,f.createWithExpression(a.toOperationNode()))})}distinct(){return new C({...this.#g,queryNode:k.L.cloneWithFrontModifier(this.#g.queryNode,f.create("Distinct"))})}forUpdate(a){return new C({...this.#g,queryNode:l.L.cloneWithEndModifier(this.#g.queryNode,f.create("ForUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}forShare(a){return new C({...this.#g,queryNode:l.L.cloneWithEndModifier(this.#g.queryNode,f.create("ForShare",a?(0,e._j)(a).map(h.M$):void 0))})}forKeyShare(a){return new C({...this.#g,queryNode:l.L.cloneWithEndModifier(this.#g.queryNode,f.create("ForKeyShare",a?(0,e._j)(a).map(h.M$):void 0))})}forNoKeyUpdate(a){return new C({...this.#g,queryNode:l.L.cloneWithEndModifier(this.#g.queryNode,f.create("ForNoKeyUpdate",a?(0,e._j)(a).map(h.M$):void 0))})}skipLocked(){return new C({...this.#g,queryNode:l.L.cloneWithEndModifier(this.#g.queryNode,f.create("SkipLocked"))})}noWait(){return new C({...this.#g,queryNode:l.L.cloneWithEndModifier(this.#g.queryNode,f.create("NoWait"))})}selectAll(a){return new C({...this.#g,queryNode:k.L.cloneWithSelections(this.#g.queryNode,(0,i.J)(a))})}innerJoin(...a){return this.#h("InnerJoin",a)}leftJoin(...a){return this.#h("LeftJoin",a)}rightJoin(...a){return this.#h("RightJoin",a)}fullJoin(...a){return this.#h("FullJoin",a)}crossJoin(...a){return this.#h("CrossJoin",a)}innerJoinLateral(...a){return this.#h("LateralInnerJoin",a)}leftJoinLateral(...a){return this.#h("LateralLeftJoin",a)}crossJoinLateral(...a){return this.#h("LateralCrossJoin",a)}crossApply(...a){return this.#h("CrossApply",a)}outerApply(...a){return this.#h("OuterApply",a)}#h(a,b){return new C({...this.#g,queryNode:l.L.cloneWithJoin(this.#g.queryNode,(0,g.a)(a,b))})}orderBy(...a){return new C({...this.#g,queryNode:l.L.cloneWithOrderByItems(this.#g.queryNode,(0,m.xk)(a))})}groupBy(a){var b;return new C({...this.#g,queryNode:k.L.cloneWithGroupByItems(this.#g.queryNode,(b=a,b=(0,e.Tn)(b)?b((0,q.A)()):b,(0,j.kU)(b).map(p.create)))})}limit(a){return new C({...this.#g,queryNode:k.L.cloneWithLimit(this.#g.queryNode,n.a.create((0,y.$s)(a)))})}offset(a){return new C({...this.#g,queryNode:k.L.cloneWithOffset(this.#g.queryNode,o.create((0,y.$s)(a)))})}fetch(a,b="only"){return new C({...this.#g,queryNode:k.L.cloneWithFetch(this.#g.queryNode,function(a,b){var c;if(!(0,e.Et)(a)&&!(0,e.sI)(a))throw Error(`Invalid fetch row count: ${a}`);if("only"!==(c=b)&&"with ties"!==c)throw Error(`Invalid fetch modifier: ${b}`);return A.create(a,b)}(a,b))})}top(a,b){return new C({...this.#g,queryNode:l.L.cloneWithTop(this.#g.queryNode,(0,B.f)(a,b))})}union(a){return new C({...this.#g,queryNode:k.L.cloneWithSetOperations(this.#g.queryNode,v("union",a,!1))})}unionAll(a){return new C({...this.#g,queryNode:k.L.cloneWithSetOperations(this.#g.queryNode,v("union",a,!0))})}intersect(a){return new C({...this.#g,queryNode:k.L.cloneWithSetOperations(this.#g.queryNode,v("intersect",a,!1))})}intersectAll(a){return new C({...this.#g,queryNode:k.L.cloneWithSetOperations(this.#g.queryNode,v("intersect",a,!0))})}except(a){return new C({...this.#g,queryNode:k.L.cloneWithSetOperations(this.#g.queryNode,v("except",a,!1))})}exceptAll(a){return new C({...this.#g,queryNode:k.L.cloneWithSetOperations(this.#g.queryNode,v("except",a,!0))})}as(a){return new E(this,a)}clearSelect(){return new C({...this.#g,queryNode:k.L.cloneWithoutSelections(this.#g.queryNode)})}clearWhere(){return new C({...this.#g,queryNode:l.L.cloneWithoutWhere(this.#g.queryNode)})}clearLimit(){return new C({...this.#g,queryNode:k.L.cloneWithoutLimit(this.#g.queryNode)})}clearOffset(){return new C({...this.#g,queryNode:k.L.cloneWithoutOffset(this.#g.queryNode)})}clearOrderBy(){return new C({...this.#g,queryNode:l.L.cloneWithoutOrderBy(this.#g.queryNode)})}clearGroupBy(){return new C({...this.#g,queryNode:k.L.cloneWithoutGroupBy(this.#g.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new C({...this.#g})}$castTo(){return new C(this.#g)}$narrowType(){return new C(this.#g)}$assertType(){return new C(this.#g)}$asTuple(){return new x.Is(this.toOperationNode())}$asScalar(){return new x.Is(this.toOperationNode())}withPlugin(a){return new C({...this.#g,executor:this.#g.executor.withPlugin(a)})}toOperationNode(){return this.#g.executor.transformQuery(this.#g.queryNode,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){let a=this.compile();return(await this.#g.executor.executeQuery(a)).rows}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=r.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,r.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#g.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new C({...this.#g,queryNode:l.L.cloneWithExplain(this.#g.queryNode,a,b)});return await c.execute()}}function D(a){return new C(a)}class E{#i;#j;constructor(a,b){this.#i=a,this.#j=b}get expression(){return this.#i}get alias(){return this.#j}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return d.N.create(this.#i.toOperationNode(),s.O.create(this.#j))}}},28945:(a,b,c)=>{c.d(b,{zZ:()=>z});var d=Object.defineProperty,e=Object.defineProperties,f=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,j=(a,b,c)=>b in a?d(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,k=(a,b)=>{for(var c in b||(b={}))h.call(b,c)&&j(a,c,b[c]);if(g)for(var c of g(b))i.call(b,c)&&j(a,c,b[c]);return a},l=(a,b)=>e(a,f(b)),m=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c}},n=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},o=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},p=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},q=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let d=c(a.auth.username),e=c(a.auth.password);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let d=c(a.auth.value);if(!d)return b;b.authorization=`${c(a.auth.prefix)} ${d}`}}return b},r=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function s(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function t(a){try{return JSON.parse(a)}catch(b){return a}}function u(a){return"function"==typeof a}async function v(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await q(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=s(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var w=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function x(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new w(c.issues);return c.value}var y=["get","post","put","patch","delete"],z=async(a,b)=>{var c,d,e,f,g,h,i,j;let{hooks:q,url:w,options:A}=await n(a,b),B=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&u(globalThis.fetch))return globalThis.fetch;if("undefined"!=typeof window&&u(window.fetch))return window.fetch;throw Error("No fetch implementation found")}(A),C=new AbortController,D=null!=(c=A.signal)?c:C.signal,E=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];y.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{}))null!=b&&i.set(a,String(b));if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(w,A),F=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(s(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return a.body}(A),G=await v(A),H=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return y.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(w,A),I=l(k({},A),{url:E,headers:G,body:F,method:H,signal:D});for(let a of q.onRequest)if(a){let b=await a(I);b instanceof Object&&(I=b)}("pipeTo"in I&&"function"==typeof I.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in I)&&(I.duplex="half");let{clearTimeout:J}=function(a,b){let c;return!(null==a?void 0:a.signal)&&(null==a?void 0:a.timeout)&&(c=setTimeout(()=>null==b?void 0:b.abort(),null==a?void 0:a.timeout)),{abortTimeout:c,clearTimeout:()=>{c&&clearTimeout(c)}}}(A,C),K=await B(I.url,I);J();let L={response:K,request:I};for(let a of q.onResponse)if(a){let c=await a(l(k({},L),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?K.clone():K}));c instanceof Response?K=c:c instanceof Object&&(K=c.response)}if(K.ok){if("HEAD"===I.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return r.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(K),c={data:"",response:K,request:I};if("json"===a||"text"===a){let a=await K.text(),b=null!=(f=I.jsonParser)?f:t;c.data=await b(a)}else c.data=await K[a]();for(let a of((null==I?void 0:I.output)&&I.output&&!I.disableValidation&&(c.data=await x(I.output,c.data)),q.onSuccess))a&&await a(l(k({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?K.clone():K}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let M=null!=(h=null==b?void 0:b.jsonParser)?h:t,N=await K.text(),O=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(N),P=O?await M(N):null,Q={response:K,responseText:N,request:I,error:l(k({},P),{status:K.status,statusText:K.statusText})};for(let a of q.onError)a&&await a(l(k({},Q),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?K.clone():K}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new o({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new o(a);case"exponential":return new p(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,K)){for(let a of q.onRetry)a&&await a(L);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await z(a,l(k({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new m(K.status,K.statusText,O?P:N);return{data:null,error:l(k({},P),{status:K.status,statusText:K.statusText})}}},29995:(a,b,c)=>{c.d(b,{C:()=>h,g:()=>g});var d=c(23244),e=c(34082),f=c(59659);class g{#k;get dynamicReference(){return this.#k}get refType(){}constructor(a){this.#k=a}toOperationNode(){return(0,e.vd)(this.#k)}}function h(a){return(0,f.Gv)(a)&&(0,d.N)(a)&&(0,f.Kg)(a.dynamicReference)}},30228:(a,b,c)=>{c.d(b,{F:()=>d,x:()=>e});class d extends Error{node;constructor(a){super("no result"),this.node=a}}function e(a){return Object.prototype.hasOwnProperty.call(a,"prototype")}},32378:(a,b,c)=>{function d(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function e(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,e=".",f){if(!d(c))return a(b,{},e,f);let g=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let h=b[c];null!=h&&(f&&f(g,c,h,e)||(Array.isArray(h)&&Array.isArray(g[c])?g[c]=[...h,...g[c]]:d(h)&&d(g[c])?g[c]=a(h,g[c],(e?`${e}.`:"")+c.toString(),f):g[c]=h))}return g})(b,c,"",a),{})}c.d(b,{$Q:()=>f,Ay:()=>f});let f=e();e((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),e((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0})},33385:(a,b,c)=>{c.d(b,{s:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"ValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueListNode",values:(0,d.CN)(a)})})},34082:(a,b,c)=>{c.d(b,{$O:()=>r,DT:()=>u,NF:()=>s,Ow:()=>w,RY:()=>v,kU:()=>q,q5:()=>t,vd:()=>p});var d=c(15539),e=c(67423),f=c(50952),g=c(2059),h=c(59659),i=c(78215),j=c(44344),k=c(80038),l=c(221),m=c(9055),n=c(34144),o=c(42749);function p(a){return(0,h.Kg)(a)?t(a):a.toOperationNode()}function q(a){return(0,h.MH)(a)?a.map(a=>r(a)):[r(a)]}function r(a){return(0,i.SS)(a)?(0,i.YK)(a):p(a)}function s(a,b){let c=t(a);if((0,l.Xm)(b))return m.Q.create(c,n.k.create(l.zX.create(b)));let d=b.slice(0,-1);if((0,l.Xm)(d))return m.Q.create(c,o.c.create(l.zX.create(d)));throw Error(`Invalid JSON operator: ${b}`)}function t(a){if(!a.includes("."))return f.q.create(e.Z.create(a));let b=a.split(".").map(x);if(3===b.length){var c=b;let[a,d,h]=c;return f.q.create(e.Z.create(h),g.H.createWithSchema(a,d))}if(2===b.length){var d=b;let[a,c]=d;return f.q.create(e.Z.create(c),g.H.create(a))}throw Error(`invalid column reference ${a}`)}function u(a){let b=" as ";if(!a.includes(b))return t(a);{let[c,e]=a.split(b).map(x);return d.N.create(t(c),j.O.create(e))}}function v(a){return e.Z.create(a)}function w(a){if(!a.includes(" "))return v(a);{let[b,c]=a.split(" ").map(x);if(!(0,k.bE)(c))throw Error(`invalid order direction "${c}" next to "${b}"`);return(0,k.xk)([b,c])[0]}}function x(a){return a.trim()}},34144:(a,b,c)=>{c.d(b,{k:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"JSONOperatorChainNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONOperatorChainNode",operator:a,values:(0,d.CN)([])}),cloneWithValue:(a,b)=>(0,d.CN)({...a,values:(0,d.CN)([...a.values,b])})})},34650:(a,b,c)=>{c.d(b,{A:()=>d});let d=(...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0}},34698:(a,b,c)=>{c.d(b,{$G:()=>o,OR:()=>m,To:()=>k,a6:()=>l,eC:()=>p,vt:()=>n});var d=c(22041),e=c(36846),f=c(70250),g=c(59061),h=c(11673);c(71068),c(84719);let i=(a,b)=>{let c={t:`${a}${b}`,value:a,tFormat:b,toMilliseconds:()=>{switch(b){case"ms":return a;case"s":return 1e3*a;case"m":return 1e3*a*60;case"h":return 1e3*a*3600;case"d":return 1e3*a*86400;case"w":return 1e3*a*604800;case"y":return 1e3*a*31536e3}},toSeconds:()=>c.toMilliseconds()/1e3,toMinutes:()=>c.toSeconds()/60,toHours:()=>c.toMinutes()/60,toDays:()=>c.toHours()/24,toWeeks:()=>c.toDays()/7,toYears:()=>c.toDays()/365,getDate:()=>new Date(Date.now()+c.toMilliseconds()),add:a=>{let b="string"==typeof a?j(a).toMilliseconds():a.toMilliseconds();return i(c.toMilliseconds()+b,"ms")},subtract:a=>{let b="string"==typeof a?j(a).toMilliseconds():a.toMilliseconds();return i(c.toMilliseconds()-b,"ms")},multiply:a=>i(c.toMilliseconds()*a,"ms"),divide:a=>i(c.toMilliseconds()/a,"ms"),equals:a=>{let b="string"==typeof a?j(a).toMilliseconds():a.toMilliseconds();return c.toMilliseconds()===b},lessThan:a=>{let b="string"==typeof a?j(a).toMilliseconds():a.toMilliseconds();return c.toMilliseconds()<b},greaterThan:a=>{let b="string"==typeof a?j(a).toMilliseconds():a.toMilliseconds();return c.toMilliseconds()>b},format:a=>{let b=c.getDate();return a.replace(/YYYY|MM|DD|HH|mm|ss/g,a=>{switch(a){case"YYYY":return b.getFullYear().toString();case"MM":return(b.getMonth()+1).toString().padStart(2,"0");case"DD":return b.getDate().toString().padStart(2,"0");case"HH":return b.getHours().toString().padStart(2,"0");case"mm":return b.getMinutes().toString().padStart(2,"0");case"ss":return b.getSeconds().toString().padStart(2,"0");default:return a}})},fromNow:()=>{let a=c.toMilliseconds();return a<0?c.ago():a<1e3?"in a few seconds":a<6e4?`in ${Math.round(a/1e3)} seconds`:a<36e5?`in ${Math.round(a/6e4)} minutes`:a<864e5?`in ${Math.round(a/36e5)} hours`:a<6048e5?`in ${Math.round(a/864e5)} days`:a<26298e5?`in ${Math.round(a/6048e5)} weeks`:a<315576e5?`in ${Math.round(a/26298e5)} months`:`in ${Math.round(a/315576e5)} years`},ago:()=>{let a=-c.toMilliseconds();return a<0?c.fromNow():a<1e3?"a few seconds ago":a<6e4?`${Math.round(a/1e3)} seconds ago`:a<36e5?`${Math.round(a/6e4)} minutes ago`:a<864e5?`${Math.round(a/36e5)} hours ago`:a<6048e5?`${Math.round(a/864e5)} days ago`:a<26298e5?`${Math.round(a/6048e5)} weeks ago`:a<315576e5?`${Math.round(a/26298e5)} months ago`:`${Math.round(a/315576e5)} years ago`}};return c},j=a=>{let b=a.match(/^(\d+)(ms|s|m|h|d|w|y)$/);if(!b)throw Error("Invalid time format");return i(parseInt(b[1]),b[2])};function k(a){let b=new Map;return a.split(", ").forEach(a=>{let[c,...d]=a.split(";").map(a=>a.trim()),[e,...f]=c.split("="),g=f.join("=");if(!e||void 0===g)return;let h={value:g};d.forEach(a=>{let[b,...c]=a.split("="),d=c.join("="),e=b.trim().toLowerCase();switch(e){case"max-age":h["max-age"]=d?parseInt(d.trim(),10):void 0;break;case"expires":h.expires=d?new Date(d.trim()):void 0;break;case"domain":h.domain=d?d.trim():void 0;break;case"path":h.path=d?d.trim():void 0;break;case"secure":h.secure=!0;break;case"httponly":h.httponly=!0;break;case"samesite":h.samesite=d?d.trim().toLowerCase():void 0;break;default:h[e]=!d||d.trim()}}),b.set(e,h)}),b}function l(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:void 0!==a.baseURL?!!a.baseURL.startsWith("https://"):f.a)?"__Secure-":"",c=!!a.advanced?.crossSubDomainCookies?.enabled,e=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!e)throw new d.B("baseURL is required when crossSubdomainCookies are enabled");return function(d,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[d]?.name||`${g}.${d}`,i=a.advanced?.cookies?.[d]?.attributes;return{name:`${b}${h}`,attributes:{secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:e}:{},...a.advanced?.defaultCookieAttributes,...f,...i}}}}function m(a){let b=l(a),c=b("session_token",{maxAge:a.session?.expiresIn||i(7,"d").toSeconds()}),d=b("session_data",{maxAge:a.session?.cookieCache?.maxAge||300}),e=b("dont_remember");return{sessionToken:{name:c.name,options:c.attributes},sessionData:{name:d.name,options:d.attributes},dontRememberToken:{name:e.name,options:e.attributes}}}async function n(a,b){if(a.context.options.session?.cookieCache?.enabled){let c={session:Object.entries(b.session).reduce((b,[c,d])=>{let e=a.context.options.session?.additionalFields?.[c];return e&&!1===e.returned||(b[c]=d),b},{}),user:b.user},f=(0,e.g)(a.context.authCookies.sessionData.options.maxAge||60,"sec").getTime(),i=g.z.encode(JSON.stringify({session:c,expiresAt:f,signature:await (0,h.s)("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...c,expiresAt:f}))}),{padding:!1});if(i.length>4093)throw new d.B("Session data is too large to store in the cookie. Please disable session cookie caching or reduce the size of the session data");a.setCookie(a.context.authCookies.sessionData.name,i,a.context.authCookies.sessionData.options)}}async function o(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.options,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.options),await n(a,b),a.context.setNewSession(b),a.context.options.secondaryStorage&&await a.context.secondaryStorage?.set(b.session.token,JSON.stringify({user:b.user,session:b.session}),Math.floor((new Date(b.session.expiresAt).getTime()-Date.now())/1e3))}function p(a,b){a.setCookie(a.context.authCookies.sessionToken.name,"",{...a.context.authCookies.sessionToken.options,maxAge:0}),a.setCookie(a.context.authCookies.sessionData.name,"",{...a.context.authCookies.sessionData.options,maxAge:0}),b||a.setCookie(a.context.authCookies.dontRememberToken.name,"",{...a.context.authCookies.dontRememberToken.options,maxAge:0})}},35447:(a,b,c)=>{c.d(b,{Qq:()=>i});var d=c(8575),e=c(37103),f=c(10289);class g extends f.pe{static [d.i]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new h(a,this.config)}}class h extends f.Kl{static [d.i]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function i(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return new g(c,d)}},35684:(a,b,c)=>{c.d(b,{n:()=>an});var d=c(28730),e=c(91164),f=c(67423),g=c(60949),h=c(33385),i=c(59659),j=c(93806);let k=(0,i.CN)({is:a=>"ValuesNode"===a.kind,create:a=>(0,i.CN)({kind:"ValuesNode",values:(0,i.CN)(a)})});var l=c(78215);let m=(0,i.CN)({is:a=>"DefaultInsertValueNode"===a.kind,create:()=>(0,i.CN)({kind:"DefaultInsertValueNode"})});var n=c(65505);function o(a){let b=(0,i.Tn)(a)?a((0,n.A)()):a;var c=(0,i.MH)(b)?b:(0,i.CN)([b]);let d=function(a){let b=new Map;for(let c of a)for(let a of Object.keys(c))b.has(a)||void 0===c[a]||b.set(a,b.size);return b}(c);return[(0,i.CN)([...d.keys()].map(f.Z.create)),k.create(c.map(a=>(function(a,b){let c=Object.keys(a),d=Array.from({length:b.size}),e=!1,f=c.length;for(let g of c){let c=b.get(g);if((0,i.b0)(c)){f--;continue}let h=a[g];((0,i.b0)(h)||(0,l.SS)(h))&&(e=!0),d[c]=h}if(f<b.size||e){let a=m.create();return h.s.create(d.map(b=>(0,i.b0)(b)?a:(0,j.$s)(b)))}return g.h.create(d)})(a,d)))]}var p=c(88565),q=c(71767);let r=(0,i.CN)({is:a=>"ColumnUpdateNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ColumnUpdateNode",column:a,value:b})});var s=c(34082);function t(a){return Object.entries((0,i.Tn)(a)?a((0,n.A)()):a).filter(([a,b])=>void 0!==b).map(([a,b])=>r.create(f.Z.create(a),(0,j.$s)(b)))}let u=(0,i.CN)({is:a=>"OnDuplicateKeyNode"===a.kind,create:a=>(0,i.CN)({kind:"OnDuplicateKeyNode",updates:a})});class v{insertId;numInsertedOrUpdatedRows;constructor(a,b){this.insertId=a,this.numInsertedOrUpdatedRows=b}}var w=c(30228),x=c(44344),y=c(11182);let z=(0,i.CN)({is:a=>"OnConflictNode"===a.kind,create:()=>(0,i.CN)({kind:"OnConflictNode"}),cloneWith:(a,b)=>(0,i.CN)({...a,...b}),cloneWithIndexWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"And",b):y.o.create(b)}),cloneWithIndexOrWhere:(a,b)=>(0,i.CN)({...a,indexWhere:a.indexWhere?y.o.cloneWithOperation(a.indexWhere,"Or",b):y.o.create(b)}),cloneWithUpdateWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"And",b):y.o.create(b)}),cloneWithUpdateOrWhere:(a,b)=>(0,i.CN)({...a,updateWhere:a.updateWhere?y.o.cloneWithOperation(a.updateWhere,"Or",b):y.o.create(b)}),cloneWithoutIndexWhere:a=>(0,i.CN)({...a,indexWhere:void 0}),cloneWithoutUpdateWhere:a=>(0,i.CN)({...a,updateWhere:void 0})});var A=c(18634);class B{#g;constructor(a){this.#g=(0,i.CN)(a)}column(a){let b=f.Z.create(a);return new B({...this.#g,onConflictNode:z.cloneWith(this.#g.onConflictNode,{columns:this.#g.onConflictNode.columns?(0,i.CN)([...this.#g.onConflictNode.columns,b]):(0,i.CN)([b])})})}columns(a){let b=a.map(f.Z.create);return new B({...this.#g,onConflictNode:z.cloneWith(this.#g.onConflictNode,{columns:this.#g.onConflictNode.columns?(0,i.CN)([...this.#g.onConflictNode.columns,...b]):(0,i.CN)(b)})})}constraint(a){return new B({...this.#g,onConflictNode:z.cloneWith(this.#g.onConflictNode,{constraint:x.O.create(a)})})}expression(a){return new B({...this.#g,onConflictNode:z.cloneWith(this.#g.onConflictNode,{indexExpression:a.toOperationNode()})})}where(...a){return new B({...this.#g,onConflictNode:z.cloneWithIndexWhere(this.#g.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new B({...this.#g,onConflictNode:z.cloneWithIndexWhere(this.#g.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new B({...this.#g,onConflictNode:z.cloneWithoutIndexWhere(this.#g.onConflictNode)})}doNothing(){return new C({...this.#g,onConflictNode:z.cloneWith(this.#g.onConflictNode,{doNothing:!0})})}doUpdateSet(a){return new D({...this.#g,onConflictNode:z.cloneWith(this.#g.onConflictNode,{updates:t(a)})})}$call(a){return a(this)}}class C{#g;constructor(a){this.#g=(0,i.CN)(a)}toOperationNode(){return this.#g.onConflictNode}}class D{#g;constructor(a){this.#g=(0,i.CN)(a)}where(...a){return new D({...this.#g,onConflictNode:z.cloneWithUpdateWhere(this.#g.onConflictNode,(0,A.GB)(a))})}whereRef(a,b,c){return new D({...this.#g,onConflictNode:z.cloneWithUpdateWhere(this.#g.onConflictNode,(0,A.vC)(a,b,c))})}clearWhere(){return new D({...this.#g,onConflictNode:z.cloneWithoutUpdateWhere(this.#g.onConflictNode)})}$call(a){return a(this)}toOperationNode(){return this.#g.onConflictNode}}var E=c(4031);let F=(0,i.CN)({is:a=>"OrActionNode"===a.kind,create:a=>(0,i.CN)({kind:"OrActionNode",action:a})});class G{#g;constructor(a){this.#g=(0,i.CN)(a)}values(a){let[b,c]=o(a);return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{columns:b,values:c})})}columns(a){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{columns:(0,i.CN)(a.map(f.Z.create))})})}expression(a){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{values:(0,l.YK)(a)})})}defaultValues(){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{defaultValues:!0})})}modifyEnd(a){return new G({...this.#g,queryNode:q.L.cloneWithEndModifier(this.#g.queryNode,a.toOperationNode())})}ignore(){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{orAction:F.create("ignore")})})}orIgnore(){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{orAction:F.create("ignore")})})}orAbort(){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{orAction:F.create("abort")})})}orFail(){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{orAction:F.create("fail")})})}orReplace(){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{orAction:F.create("replace")})})}orRollback(){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{orAction:F.create("rollback")})})}top(a,b){return new G({...this.#g,queryNode:q.L.cloneWithTop(this.#g.queryNode,(0,E.f)(a,b))})}onConflict(a){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{onConflict:a(new B({onConflictNode:z.create()})).toOperationNode()})})}onDuplicateKeyUpdate(a){return new G({...this.#g,queryNode:p.o.cloneWith(this.#g.queryNode,{onDuplicateKey:u.create(t(a))})})}returning(a){return new G({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.G)(a))})}returningAll(){return new G({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.J)())})}output(a){return new G({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.G)(a))})}outputAll(a){return new G({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.J)(a))})}clearReturning(){return new G({...this.#g,queryNode:q.L.cloneWithoutReturning(this.#g.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new G({...this.#g})}$castTo(){return new G(this.#g)}$narrowType(){return new G(this.#g)}$assertType(){return new G(this.#g)}withPlugin(a){return new G({...this.#g,executor:this.#g.executor.withPlugin(a)})}toOperationNode(){return this.#g.executor.transformQuery(this.#g.queryNode,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){let a=this.compile(),b=await this.#g.executor.executeQuery(a),{adapter:c}=this.#g.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new v(b.insertId,b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#g.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new G({...this.#g,queryNode:q.L.cloneWithExplain(this.#g.queryNode,a,b)});return await c.execute()}}var H=c(21461),I=c(15021);class J{numDeletedRows;constructor(a){this.numDeletedRows=a}}var K=c(94295),L=c(98546),M=c(80038);class N{#g;constructor(a){this.#g=(0,i.CN)(a)}where(...a){return new N({...this.#g,queryNode:q.L.cloneWithWhere(this.#g.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new N({...this.#g,queryNode:q.L.cloneWithWhere(this.#g.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new N({...this.#g,queryNode:q.L.cloneWithoutWhere(this.#g.queryNode)})}top(a,b){return new N({...this.#g,queryNode:q.L.cloneWithTop(this.#g.queryNode,(0,E.f)(a,b))})}using(a){return new N({...this.#g,queryNode:K.e.cloneWithUsing(this.#g.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#h("InnerJoin",a)}leftJoin(...a){return this.#h("LeftJoin",a)}rightJoin(...a){return this.#h("RightJoin",a)}fullJoin(...a){return this.#h("FullJoin",a)}#h(a,b){return new N({...this.#g,queryNode:q.L.cloneWithJoin(this.#g.queryNode,(0,H.a)(a,b))})}returning(a){return new N({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.G)(a))})}returningAll(a){return new N({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.J)(a))})}output(a){return new N({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.G)(a))})}outputAll(a){return new N({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.J)(a))})}clearReturning(){return new N({...this.#g,queryNode:q.L.cloneWithoutReturning(this.#g.queryNode)})}clearLimit(){return new N({...this.#g,queryNode:K.e.cloneWithoutLimit(this.#g.queryNode)})}orderBy(...a){return new N({...this.#g,queryNode:q.L.cloneWithOrderByItems(this.#g.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new N({...this.#g,queryNode:q.L.cloneWithoutOrderBy(this.#g.queryNode)})}limit(a){return new N({...this.#g,queryNode:K.e.cloneWithLimit(this.#g.queryNode,L.a.create((0,j.$s)(a)))})}modifyEnd(a){return new N({...this.#g,queryNode:q.L.cloneWithEndModifier(this.#g.queryNode,a.toOperationNode())})}$call(a){return a(this)}$if(a,b){return a?b(this):new N({...this.#g})}$castTo(){return new N(this.#g)}$narrowType(){return new N(this.#g)}$assertType(){return new N(this.#g)}withPlugin(a){return new N({...this.#g,executor:this.#g.executor.withPlugin(a)})}toOperationNode(){return this.#g.executor.transformQuery(this.#g.queryNode,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){let a=this.compile(),b=await this.#g.executor.executeQuery(a),{adapter:c}=this.#g.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new J(b.numAffectedRows??BigInt(0))]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#g.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new N({...this.#g,queryNode:q.L.cloneWithExplain(this.#g.queryNode,a,b)});return await c.execute()}}var O=c(97733);class P{numUpdatedRows;numChangedRows;constructor(a,b){this.numUpdatedRows=a,this.numChangedRows=b}}class Q{#g;constructor(a){this.#g=(0,i.CN)(a)}where(...a){return new Q({...this.#g,queryNode:q.L.cloneWithWhere(this.#g.queryNode,(0,A.GB)(a))})}whereRef(a,b,c){return new Q({...this.#g,queryNode:q.L.cloneWithWhere(this.#g.queryNode,(0,A.vC)(a,b,c))})}clearWhere(){return new Q({...this.#g,queryNode:q.L.cloneWithoutWhere(this.#g.queryNode)})}top(a,b){return new Q({...this.#g,queryNode:q.L.cloneWithTop(this.#g.queryNode,(0,E.f)(a,b))})}from(a){return new Q({...this.#g,queryNode:O.U.cloneWithFromItems(this.#g.queryNode,(0,I.JB)(a))})}innerJoin(...a){return this.#h("InnerJoin",a)}leftJoin(...a){return this.#h("LeftJoin",a)}rightJoin(...a){return this.#h("RightJoin",a)}fullJoin(...a){return this.#h("FullJoin",a)}#h(a,b){return new Q({...this.#g,queryNode:q.L.cloneWithJoin(this.#g.queryNode,(0,H.a)(a,b))})}orderBy(...a){return new Q({...this.#g,queryNode:q.L.cloneWithOrderByItems(this.#g.queryNode,(0,M.xk)(a))})}clearOrderBy(){return new Q({...this.#g,queryNode:q.L.cloneWithoutOrderBy(this.#g.queryNode)})}limit(a){return new Q({...this.#g,queryNode:O.U.cloneWithLimit(this.#g.queryNode,L.a.create((0,j.$s)(a)))})}set(...a){return new Q({...this.#g,queryNode:O.U.cloneWithUpdates(this.#g.queryNode,function(...a){return 2===a.length?[r.create((0,s.$O)(a[0]),(0,j.$s)(a[1]))]:t(a[0])}(...a))})}returning(a){return new Q({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.G)(a))})}returningAll(a){return new Q({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.J)(a))})}output(a){return new Q({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.G)(a))})}outputAll(a){return new Q({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.J)(a))})}modifyEnd(a){return new Q({...this.#g,queryNode:q.L.cloneWithEndModifier(this.#g.queryNode,a.toOperationNode())})}clearReturning(){return new Q({...this.#g,queryNode:q.L.cloneWithoutReturning(this.#g.queryNode)})}$call(a){return a(this)}$if(a,b){return a?b(this):new Q({...this.#g})}$castTo(){return new Q(this.#g)}$narrowType(){return new Q(this.#g)}$assertType(){return new Q(this.#g)}withPlugin(a){return new Q({...this.#g,executor:this.#g.executor.withPlugin(a)})}toOperationNode(){return this.#g.executor.transformQuery(this.#g.queryNode,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){let a=this.compile(),b=await this.#g.executor.executeQuery(a),{adapter:c}=this.#g.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new P(b.numAffectedRows??BigInt(0),b.numChangedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}async *stream(a=100){let b=this.compile();for await(let c of this.#g.executor.stream(b,a))yield*c.rows}async explain(a,b){let c=new Q({...this.#g,queryNode:q.L.cloneWithExplain(this.#g.queryNode,a,b)});return await c.execute()}}var R=c(91054),S=c(2059);let T=(0,i.CN)({is:a=>"CommonTableExpressionNameNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNameNode",table:S.H.create(a),columns:b?(0,i.CN)(b.map(f.Z.create)):void 0})});var U=c(97434);let V=(0,i.CN)({is:a=>"CommonTableExpressionNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"CommonTableExpressionNode",name:a,expression:b}),cloneWith:(a,b)=>(0,i.CN)({...a,...b})});class W{#g;constructor(a){this.#g=(0,i.CN)(a)}materialized(){return new W({...this.#g,node:V.cloneWith(this.#g.node,{materialized:!0})})}notMaterialized(){return new W({...this.#g,node:V.cloneWith(this.#g.node,{materialized:!1})})}toOperationNode(){return this.#g.node}}function X(a,b){var c;let d=b((0,U.bl)()).toOperationNode();return(0,i.Tn)(a)?a((c=d,a=>new W({node:V.create(Y(a),c)}))).toOperationNode():V.create(Y(a),d)}function Y(a){if(!a.includes("("))return T.create(a);{let b=a.split(/[\(\)]/),c=b[0],d=b[1].split(",").map(a=>a.trim());return T.create(c,d)}}let Z=(0,i.CN)({is:a=>"WithNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"WithNode",expressions:(0,i.CN)([a]),...b}),cloneWithExpression:(a,b)=>(0,i.CN)({...a,expressions:(0,i.CN)([...a.expressions,b])})});var $=c(70030),_=c(58077),aa=c(79648);let ab=(0,i.CN)({is:a=>"MatchedNode"===a.kind,create:(a,b=!1)=>(0,i.CN)({kind:"MatchedNode",not:a,bySource:b})});var ac=c(23244),ad=c(82493),ae=c(84793);function af(a,b,c){return ae.t.create((0,A.KN)([ab.create(!a.isMatched,a.bySource),...b&&b.length>0?[3===b.length&&c?(0,A.vC)(b[0],b[1],b[2]):(0,A.GB)(b)]:[]],"and",!1))}function ag(a){return(0,i.Kg)(a)?ad.z.create([a],[]):(0,ac.N)(a)?a.toOperationNode():a}var ah=c(59865);class ai{numChangedRows;constructor(a){this.numChangedRows=a}}class aj{#g;constructor(a){this.#g=(0,i.CN)(a)}modifyEnd(a){return new aj({...this.#g,queryNode:q.L.cloneWithEndModifier(this.#g.queryNode,a.toOperationNode())})}top(a,b){return new aj({...this.#g,queryNode:q.L.cloneWithTop(this.#g.queryNode,(0,E.f)(a,b))})}using(...a){return new ak({...this.#g,queryNode:aa.r.cloneWithUsing(this.#g.queryNode,(0,H.a)("Using",a))})}returning(a){return new aj({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.G)(a))})}returningAll(a){return new aj({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.J)(a))})}output(a){return new aj({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.G)(a))})}outputAll(a){return new aj({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.J)(a))})}}class ak{#g;constructor(a){this.#g=(0,i.CN)(a)}modifyEnd(a){return new ak({...this.#g,queryNode:q.L.cloneWithEndModifier(this.#g.queryNode,a.toOperationNode())})}top(a,b){return new ak({...this.#g,queryNode:q.L.cloneWithTop(this.#g.queryNode,(0,E.f)(a,b))})}whenMatched(){return this.#l([])}whenMatchedAnd(...a){return this.#l(a)}whenMatchedAndRef(a,b,c){return this.#l([a,b,c],!0)}#l(a,b){return new al({...this.#g,queryNode:aa.r.cloneWithWhen(this.#g.queryNode,af({isMatched:!0},a,b))})}whenNotMatched(){return this.#m([])}whenNotMatchedAnd(...a){return this.#m(a)}whenNotMatchedAndRef(a,b,c){return this.#m([a,b,c],!0)}whenNotMatchedBySource(){return this.#m([],!1,!0)}whenNotMatchedBySourceAnd(...a){return this.#m(a,!1,!0)}whenNotMatchedBySourceAndRef(a,b,c){return this.#m([a,b,c],!0,!0)}returning(a){return new ak({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.G)(a))})}returningAll(a){return new ak({...this.#g,queryNode:q.L.cloneWithReturning(this.#g.queryNode,(0,e.J)(a))})}output(a){return new ak({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.G)(a))})}outputAll(a){return new ak({...this.#g,queryNode:q.L.cloneWithOutput(this.#g.queryNode,(0,e.J)(a))})}#m(a,b=!1,c=!1){let d={...this.#g,queryNode:aa.r.cloneWithWhen(this.#g.queryNode,af({isMatched:!1,bySource:c},a,b))};return new(c?al:am)(d)}$call(a){return a(this)}$if(a,b){return a?b(this):new ak({...this.#g})}toOperationNode(){return this.#g.executor.transformQuery(this.#g.queryNode,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){let a=this.compile(),b=await this.#g.executor.executeQuery(a),{adapter:c}=this.#g.executor,d=a.query;return d.returning&&c.supportsReturning||d.output&&c.supportsOutput?b.rows:[new ai(b.numAffectedRows)]}async executeTakeFirst(){let[a]=await this.execute();return a}async executeTakeFirstOrThrow(a=w.F){let b=await this.executeTakeFirst();if(void 0===b)throw(0,w.x)(a)?new a(this.toOperationNode()):a(this.toOperationNode());return b}}class al{#g;constructor(a){this.#g=(0,i.CN)(a)}thenDelete(){return new ak({...this.#g,queryNode:aa.r.cloneWithThen(this.#g.queryNode,ag("delete"))})}thenDoNothing(){return new ak({...this.#g,queryNode:aa.r.cloneWithThen(this.#g.queryNode,ag("do nothing"))})}thenUpdate(a){return new ak({...this.#g,queryNode:aa.r.cloneWithThen(this.#g.queryNode,ag(a(new Q({queryId:this.#g.queryId,executor:ah.W,queryNode:O.U.createWithoutTable()}))))})}thenUpdateSet(...a){return this.thenUpdate(b=>b.set(...a))}}class am{#g;constructor(a){this.#g=(0,i.CN)(a)}thenDoNothing(){return new ak({...this.#g,queryNode:aa.r.cloneWithThen(this.#g.queryNode,ag("do nothing"))})}thenInsertValues(a){let[b,c]=o(a);return new ak({...this.#g,queryNode:aa.r.cloneWithThen(this.#g.queryNode,ag(p.o.cloneWith(p.o.createWithoutInto(),{columns:b,values:c})))})}}class an{#g;constructor(a){this.#g=(0,i.CN)(a)}selectFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#g.executor,queryNode:R.L.createFrom((0,I.JB)(a),this.#g.withNode)})}selectNoFrom(a){return(0,d.c)({queryId:(0,$.a)(),executor:this.#g.executor,queryNode:R.L.cloneWithSelections(R.L.create(this.#g.withNode),(0,e.G)(a))})}insertInto(a){return new G({queryId:(0,$.a)(),executor:this.#g.executor,queryNode:p.o.create((0,I.M$)(a),this.#g.withNode)})}replaceInto(a){return new G({queryId:(0,$.a)(),executor:this.#g.executor,queryNode:p.o.create((0,I.M$)(a),this.#g.withNode,!0)})}deleteFrom(a){return new N({queryId:(0,$.a)(),executor:this.#g.executor,queryNode:K.e.create((0,I.JB)(a),this.#g.withNode)})}updateTable(a){return new Q({queryId:(0,$.a)(),executor:this.#g.executor,queryNode:O.U.create((0,I.JB)(a),this.#g.withNode)})}mergeInto(a){return new aj({queryId:(0,$.a)(),executor:this.#g.executor,queryNode:aa.r.create((0,I.Xm)(a),this.#g.withNode)})}with(a,b){let c=X(a,b);return new an({...this.#g,withNode:this.#g.withNode?Z.cloneWithExpression(this.#g.withNode,c):Z.create(c)})}withRecursive(a,b){let c=X(a,b);return new an({...this.#g,withNode:this.#g.withNode?Z.cloneWithExpression(this.#g.withNode,c):Z.create(c,{recursive:!0})})}withPlugin(a){return new an({...this.#g,executor:this.#g.executor.withPlugin(a)})}withoutPlugins(){return new an({...this.#g,executor:this.#g.executor.withoutPlugins()})}withSchema(a){return new an({...this.#g,executor:this.#g.executor.withPluginAtFront(new _.B(a))})}}},36197:(a,b,c)=>{c.d(b,{d:()=>q,O:()=>p}),c(70250),c(59061),c(11673),c(84719);var d=c(34698);c(506);var e=c(18093);c(39955);var f=c(42261),g=c(52376),h=c(44989);c(32378),c(95856),c(15247),c(22321),(0,e.i)(async()=>({})),(0,e.i)({use:[e.l]},async a=>({session:a.context.session}));let i=f.Yj(),j=f.k5(["pending","accepted","rejected","canceled"]).default("pending");f.Ik({id:f.Yj().default(h.g),name:f.Yj(),slug:f.Yj(),logo:f.Yj().nullish().optional(),metadata:f.g1(f.Yj(),f.L5()).or(f.Yj().transform(a=>JSON.parse(a))).optional(),createdAt:f.p6()}),f.Ik({id:f.Yj().default(h.g),organizationId:f.Yj(),userId:g.Yj(),role:i,createdAt:f.p6().default(()=>new Date)}),f.Ik({id:f.Yj().default(h.g),organizationId:f.Yj(),email:f.Yj(),role:i,status:j,teamId:f.Yj().optional(),inviterId:f.Yj(),expiresAt:f.p6()}),f.Ik({id:f.Yj().default(h.g),name:f.Yj().min(1),organizationId:f.Yj(),createdAt:f.p6(),updatedAt:f.p6().optional()}),f.Ik({id:f.Yj().default(h.g),teamId:f.Yj(),userId:f.Yj(),createdAt:f.p6().default(()=>new Date)});let k=["admin","member","owner"];f.KC([f.k5(k),f.YO(f.k5(k))]);var l=c(22041);function m(a){return{newRole:a=>{var b;return{authorize(a,c="AND"){let d=!1;for(let[e,f]of Object.entries(a)){let a=b[e];if(!a)return{success:!1,error:`You are not allowed to access resource: ${e}`};if(Array.isArray(f))d=f.every(b=>a.includes(b));else if("object"==typeof f)d="OR"===f.connector?f.actions.some(b=>a.includes(b)):f.actions.every(b=>a.includes(b));else throw new l.B("Invalid access control request");if(d&&"OR"===c)return{success:d};if(!d&&"AND"===c)return{success:!1,error:`unauthorized to access resource "${e}"`}}return d?{success:d}:{success:!1,error:"Not authorized"}},statements:b=a}},statements:a}}let n=m({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]});n.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"]}),n.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"]}),n.newRole({organization:[],member:[],invitation:[],team:[]});let o=m({user:["create","list","set-role","ban","impersonate","delete","set-password","update"],session:["list","revoke","delete"]});function p(a){let b=async b=>"handler"in a?a.handler(b):a(b);return{GET:b,POST:b}}o.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","update"],session:["list","revoke","delete"]}),o.newRole({user:[],session:[]}),c(28945),f.Ik({id:f.Yj(),publicKey:f.Yj(),privateKey:f.Yj(),createdAt:f.p6()}),c(71068),c(22887);let q=()=>({id:"next-cookies",hooks:{after:[{matcher:a=>!0,handler:(0,e.i)(async a=>{let b=a.context.responseHeaders;if((!("_flag"in a)||"router"!==a._flag)&&b instanceof Headers){let a,e=b?.get("set-cookie");if(!e)return;let f=(0,d.To)(e),{cookies:g}=await c.e(438).then(c.bind(c,46057));try{a=await g()}catch(a){if(a instanceof Error&&a.message.startsWith("`cookies` was called outside a request scope."))return;throw a}f.forEach((b,c)=>{if(!c)return;let d={sameSite:b.samesite,secure:b.secure,maxAge:b["max-age"],httpOnly:b.httponly,domain:b.domain,path:b.path};try{a.set(c,decodeURIComponent(b.value),d)}catch(a){}});return}})}]}})},36398:(a,b,c)=>{c.d(b,{k:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"ParensNode"===a.kind,create:a=>(0,d.CN)({kind:"ParensNode",node:a})})},36846:(a,b,c)=>{c.d(b,{g:()=>d});let d=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a))},37103:(a,b,c)=>{c.d(b,{DV:()=>k,He:()=>function a(b,c){return Object.entries(b).reduce((b,[g,i])=>{if("string"!=typeof g)return b;let j=c?[...c,g]:[g];return(0,e.is)(i,d.V)||(0,e.is)(i,f.Xs)||(0,e.is)(i,f.Xs.Aliased)?b.push({path:j,field:i}):(0,e.is)(i,h.XI)?b.push(...a(i[h.XI.Symbol.Columns],j)):b.push(...a(i,j)),b},[])},Ll:()=>q,Lq:()=>r,O1:()=>o,XJ:()=>m,YD:()=>n,a6:()=>j,q:()=>l,zN:()=>p});var d=c(98318),e=c(8575),f=c(98708),g=c(72354),h=c(7762),i=c(16155);function j(a,b,c){let g={},i=a.reduce((a,{path:i,field:j},k)=>{let l;l=(0,e.is)(j,d.V)?j:(0,e.is)(j,f.Xs)?j.decoder:j.sql.decoder;let m=a;for(let[a,f]of i.entries())if(a<i.length-1)f in m||(m[f]={}),m=m[f];else{let a=b[k],n=m[f]=null===a?null:l.mapFromDriverValue(a);if(c&&(0,e.is)(j,d.V)&&2===i.length){let a=i[0];a in g?"string"==typeof g[a]&&g[a]!==(0,h.Io)(j.table)&&(g[a]=!1):g[a]=null===n&&(0,h.Io)(j.table)}}return a},{});if(c&&Object.keys(g).length>0)for(let[a,b]of Object.entries(g))"string"!=typeof b||c[b]||(i[a]=null);return i}function k(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function l(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>(0,e.is)(c,f.Xs)||(0,e.is)(c,d.V)?[b,c]:[b,new f.Iw(c,a[h.XI.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function m(a,b){for(let c of b)for(let b of Object.getOwnPropertyNames(c.prototype))"constructor"!==b&&Object.defineProperty(a.prototype,b,Object.getOwnPropertyDescriptor(c.prototype,b)||Object.create(null))}function n(a){return a[h.XI.Symbol.Columns]}function o(a){return a[i.n].selectedFields}function p(a){return(0,e.is)(a,g.n)?a._.alias:(0,e.is)(a,f.Ss)?a[i.n].name:(0,e.is)(a,f.Xs)?void 0:a[h.XI.Symbol.IsAlias]?a[h.XI.Symbol.Name]:a[h.XI.Symbol.BaseName]}function q(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}function r(a){if("object"!=typeof a||null===a||"Object"!==a.constructor.name)return!1;if("logger"in a){let b=typeof a.logger;return"boolean"===b||"object"===b&&"function"==typeof a.logger.logQuery||"undefined"===b}if("schema"in a){let b=typeof a.schema;return"object"===b||"undefined"===b}if("casing"in a){let b=typeof a.casing;return"string"===b||"undefined"===b}if("mode"in a)return"default"===a.mode&&"planetscale"===a.mode&&void 0===a.mode;if("connection"in a){let b=typeof a.connection;return"string"===b||"object"===b||"undefined"===b}if("client"in a){let b=typeof a.client;return"object"===b||"function"===b||"undefined"===b}return 0===Object.keys(a).length}},38070:(a,b,c)=>{c.d(b,{K:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"OrNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"OrNode",left:a,right:b})})},39955:(a,b,c)=>{c.d(b,{b:()=>i,d:()=>j,f:()=>k});var d=c(42261),e=c(52376),f=c(506);function g(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}!1!==e.returned&&(d[b]=a[b])}return d}function h(a,b){let c={..."user"===b?a.user?.additionalFields:{},..."session"===b?a.session?.additionalFields:{}};for(let d of a.plugins||[])d.schema&&d.schema[b]&&(c={...c,...d.schema[b].fields});return c}function i(a,b){return g(b,{fields:h(a,"user")})}function j(a,b){return g(b,{fields:h(a,"session")})}function k(a,b,c){return function(a,b){let c=b.action||"create",d=b.fields,e={};for(let b in d){if(b in a){if(!1===d[b].input){d[b].defaultValue&&(e[b]=d[b].defaultValue);continue}if(d[b].validator?.input&&void 0!==a[b]){e[b]=d[b].validator.input.parse(a[b]);continue}if(d[b].transform?.input&&void 0!==a[b]){e[b]=d[b].transform?.input(a[b]);continue}e[b]=a[b];continue}if(d[b].defaultValue&&"create"===c){e[b]=d[b].defaultValue;continue}if(d[b].required&&"create"===c)throw new f.LG("BAD_REQUEST",{message:`${b} is required`})}return e}(b||{},{fields:h(a,"user"),action:c})}d.Ik({id:d.Yj(),providerId:d.Yj(),accountId:d.Yj(),userId:e.Yj(),accessToken:d.Yj().nullish(),refreshToken:d.Yj().nullish(),idToken:d.Yj().nullish(),accessTokenExpiresAt:d.p6().nullish(),refreshTokenExpiresAt:d.p6().nullish(),scope:d.Yj().nullish(),password:d.Yj().nullish(),createdAt:d.p6().default(()=>new Date),updatedAt:d.p6().default(()=>new Date)}),d.Ik({id:d.Yj(),email:d.Yj().transform(a=>a.toLowerCase()),emailVerified:d.zM().default(!1),name:d.Yj(),image:d.Yj().nullish(),createdAt:d.p6().default(()=>new Date),updatedAt:d.p6().default(()=>new Date)}),d.Ik({id:d.Yj(),userId:e.Yj(),expiresAt:d.p6(),createdAt:d.p6().default(()=>new Date),updatedAt:d.p6().default(()=>new Date),token:d.Yj(),ipAddress:d.Yj().nullish(),userAgent:d.Yj().nullish()}),d.Ik({id:d.Yj(),value:d.Yj(),createdAt:d.p6().default(()=>new Date),updatedAt:d.p6().default(()=>new Date),expiresAt:d.p6(),identifier:d.Yj()})},41638:(a,b,c)=>{c.d(b,{A:()=>d});let d=a=>Math.floor(a.getTime()/1e3)},42261:(a,b,c)=>{c.d(b,{WF:()=>a2,ND:()=>aD,EB:()=>aF,bz:()=>a7,YO:()=>be,K3:()=>aX,zM:()=>a3,Ie:()=>bJ,p6:()=>bc,gM:()=>bm,Rp:()=>aH,k5:()=>br,Nl:()=>bK,RZ:()=>bH,eu:()=>bt,_H:()=>bi,ch:()=>a5,ai:()=>a0,Ik:()=>bg,lq:()=>bw,g1:()=>bp,re:()=>bh,Yj:()=>aE,KC:()=>bk,L5:()=>a9});var d=c(15017),e=c(2175);class f{constructor(a=[]){this.content=[],this.indent=0,this&&(this.args=a)}indented(a){this.indent+=1,a(this),this.indent-=1}write(a){if("function"==typeof a){a(this,{execution:"sync"}),a(this,{execution:"async"});return}let b=a.split("\n").filter(a=>a),c=Math.min(...b.map(a=>a.length-a.trimStart().length));for(let a of b.map(a=>a.slice(c)).map(a=>" ".repeat(2*this.indent)+a))this.content.push(a)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(a=>`  ${a}`)].join("\n"))}}var g=c(27895),h=c(24047),i=c(58054);let j={major:4,minor:0,patch:17},k=d.xI("$ZodType",(a,b)=>{var c;a??(a={}),a._zod.def=b,a._zod.bag=a._zod.bag||{},a._zod.version=j;let e=[...a._zod.def.checks??[]];for(let b of(a._zod.traits.has("$ZodCheck")&&e.unshift(a),e))for(let c of b._zod.onattach)c(a);if(0===e.length)(c=a._zod).deferred??(c.deferred=[]),a._zod.deferred?.push(()=>{a._zod.run=a._zod.parse});else{let b=(a,b,c)=>{let e,f=i.QH(a);for(let g of b){if(g._zod.def.when){if(!g._zod.def.when(a))continue}else if(f)continue;let b=a.issues.length,h=g._zod.check(a);if(h instanceof Promise&&c?.async===!1)throw new d.GT;if(e||h instanceof Promise)e=(e??Promise.resolve()).then(async()=>{await h,a.issues.length!==b&&(f||(f=i.QH(a,b)))});else{if(a.issues.length===b)continue;f||(f=i.QH(a,b))}}return e?e.then(()=>a):a};a._zod.run=(c,f)=>{let g=a._zod.parse(c,f);if(g instanceof Promise){if(!1===f.async)throw new d.GT;return g.then(a=>b(a,e,f))}return b(g,e,f)}}a["~standard"]={validate:b=>{try{let c=(0,g.xL)(a,b);return c.success?{value:c.data}:{issues:c.error?.issues}}catch(c){return(0,g.bp)(a,b).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),l=d.xI("$ZodString",(a,b)=>{k.init(a,b),a._zod.pattern=[...a?._zod.bag?.patterns??[]].pop()??h.Yj(a._zod.bag),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=String(c.value)}catch(a){}return"string"==typeof c.value||c.issues.push({expected:"string",code:"invalid_type",input:c.value,inst:a}),c}}),m=d.xI("$ZodStringFormat",(a,b)=>{e.ql.init(a,b),l.init(a,b)}),n=d.xI("$ZodGUID",(a,b)=>{b.pattern??(b.pattern=h.Os),m.init(a,b)}),o=d.xI("$ZodUUID",(a,b)=>{if(b.version){let a={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[b.version];if(void 0===a)throw Error(`Invalid UUID version: "${b.version}"`);b.pattern??(b.pattern=h.uR(a))}else b.pattern??(b.pattern=h.uR());m.init(a,b)}),p=d.xI("$ZodEmail",(a,b)=>{b.pattern??(b.pattern=h.Rp),m.init(a,b)}),q=d.xI("$ZodURL",(a,b)=>{m.init(a,b),a._zod.check=c=>{try{let d=c.value.trim(),e=new URL(d);b.hostname&&(b.hostname.lastIndex=0,b.hostname.test(e.hostname)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:h.OI.source,input:c.value,inst:a,continue:!b.abort})),b.protocol&&(b.protocol.lastIndex=0,b.protocol.test(e.protocol.endsWith(":")?e.protocol.slice(0,-1):e.protocol)||c.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:b.protocol.source,input:c.value,inst:a,continue:!b.abort})),b.normalize?c.value=e.href:c.value=d;return}catch(d){c.issues.push({code:"invalid_format",format:"url",input:c.value,inst:a,continue:!b.abort})}}}),r=d.xI("$ZodEmoji",(a,b)=>{b.pattern??(b.pattern=h.Zg()),m.init(a,b)}),s=d.xI("$ZodNanoID",(a,b)=>{b.pattern??(b.pattern=h.Ak),m.init(a,b)}),t=d.xI("$ZodCUID",(a,b)=>{b.pattern??(b.pattern=h.gF),m.init(a,b)}),u=d.xI("$ZodCUID2",(a,b)=>{b.pattern??(b.pattern=h.Gl),m.init(a,b)}),v=d.xI("$ZodULID",(a,b)=>{b.pattern??(b.pattern=h.Z0),m.init(a,b)}),w=d.xI("$ZodXID",(a,b)=>{b.pattern??(b.pattern=h.kM),m.init(a,b)}),x=d.xI("$ZodKSUID",(a,b)=>{b.pattern??(b.pattern=h.fO),m.init(a,b)}),y=d.xI("$ZodISODateTime",(a,b)=>{b.pattern??(b.pattern=h.w$(b)),m.init(a,b)}),z=d.xI("$ZodISODate",(a,b)=>{b.pattern??(b.pattern=h.p6),m.init(a,b)}),A=d.xI("$ZodISOTime",(a,b)=>{b.pattern??(b.pattern=h.kB(b)),m.init(a,b)}),B=d.xI("$ZodISODuration",(a,b)=>{b.pattern??(b.pattern=h.p0),m.init(a,b)}),C=d.xI("$ZodIPv4",(a,b)=>{b.pattern??(b.pattern=h.uX),m.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv4"})}),D=d.xI("$ZodIPv6",(a,b)=>{b.pattern??(b.pattern=h.ug),m.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.format="ipv6"}),a._zod.check=c=>{try{new URL(`http://[${c.value}]`)}catch{c.issues.push({code:"invalid_format",format:"ipv6",input:c.value,inst:a,continue:!b.abort})}}}),E=d.xI("$ZodCIDRv4",(a,b)=>{b.pattern??(b.pattern=h.zr),m.init(a,b)}),F=d.xI("$ZodCIDRv6",(a,b)=>{b.pattern??(b.pattern=h.l7),m.init(a,b),a._zod.check=c=>{let[d,e]=c.value.split("/");try{if(!e)throw Error();let a=Number(e);if(`${a}`!==e||a<0||a>128)throw Error();new URL(`http://[${d}]`)}catch{c.issues.push({code:"invalid_format",format:"cidrv6",input:c.value,inst:a,continue:!b.abort})}}});function G(a){if(""===a)return!0;if(a.length%4!=0)return!1;try{return atob(a),!0}catch{return!1}}let H=d.xI("$ZodBase64",(a,b)=>{b.pattern??(b.pattern=h.K3),m.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64"}),a._zod.check=c=>{G(c.value)||c.issues.push({code:"invalid_format",format:"base64",input:c.value,inst:a,continue:!b.abort})}}),I=d.xI("$ZodBase64URL",(a,b)=>{b.pattern??(b.pattern=h.r0),m.init(a,b),a._zod.onattach.push(a=>{a._zod.bag.contentEncoding="base64url"}),a._zod.check=c=>{!function(a){if(!h.r0.test(a))return!1;let b=a.replace(/[-_]/g,a=>"-"===a?"+":"/");return G(b.padEnd(4*Math.ceil(b.length/4),"="))}(c.value)&&c.issues.push({code:"invalid_format",format:"base64url",input:c.value,inst:a,continue:!b.abort})}}),J=d.xI("$ZodE164",(a,b)=>{b.pattern??(b.pattern=h.hQ),m.init(a,b)}),K=d.xI("$ZodJWT",(a,b)=>{m.init(a,b),a._zod.check=c=>{!function(a,b=null){try{let c=a.split(".");if(3!==c.length)return!1;let[d]=c;if(!d)return!1;let e=JSON.parse(atob(d));if("typ"in e&&e?.typ!=="JWT"||!e.alg||b&&(!("alg"in e)||e.alg!==b))return!1;return!0}catch{return!1}}(c.value,b.alg)&&c.issues.push({code:"invalid_format",format:"jwt",input:c.value,inst:a,continue:!b.abort})}}),L=d.xI("$ZodNumber",(a,b)=>{k.init(a,b),a._zod.pattern=a._zod.bag.pattern??h.ai,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=Number(c.value)}catch(a){}let e=c.value;if("number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e))return c;let f="number"==typeof e?Number.isNaN(e)?"NaN":Number.isFinite(e)?void 0:"Infinity":void 0;return c.issues.push({expected:"number",code:"invalid_type",input:e,inst:a,...f?{received:f}:{}}),c}}),M=d.xI("$ZodNumber",(a,b)=>{e.KH.init(a,b),L.init(a,b)}),N=d.xI("$ZodBoolean",(a,b)=>{k.init(a,b),a._zod.pattern=h.zM,a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=!!c.value}catch(a){}let e=c.value;return"boolean"==typeof e||c.issues.push({expected:"boolean",code:"invalid_type",input:e,inst:a}),c}}),O=d.xI("$ZodNull",(a,b)=>{k.init(a,b),a._zod.pattern=h.ch,a._zod.values=new Set([null]),a._zod.parse=(b,c)=>{let d=b.value;return null===d||b.issues.push({expected:"null",code:"invalid_type",input:d,inst:a}),b}}),P=d.xI("$ZodAny",(a,b)=>{k.init(a,b),a._zod.parse=a=>a}),Q=d.xI("$ZodUnknown",(a,b)=>{k.init(a,b),a._zod.parse=a=>a}),R=d.xI("$ZodNever",(a,b)=>{k.init(a,b),a._zod.parse=(b,c)=>(b.issues.push({expected:"never",code:"invalid_type",input:b.value,inst:a}),b)}),S=d.xI("$ZodDate",(a,b)=>{k.init(a,b),a._zod.parse=(c,d)=>{if(b.coerce)try{c.value=new Date(c.value)}catch(a){}let e=c.value,f=e instanceof Date;return f&&!Number.isNaN(e.getTime())||c.issues.push({expected:"date",code:"invalid_type",input:e,...f?{received:"Invalid Date"}:{},inst:a}),c}});function T(a,b,c){a.issues.length&&b.issues.push(...i.lQ(c,a.issues)),b.value[c]=a.value}let U=d.xI("$ZodArray",(a,b)=>{k.init(a,b),a._zod.parse=(c,d)=>{let e=c.value;if(!Array.isArray(e))return c.issues.push({expected:"array",code:"invalid_type",input:e,inst:a}),c;c.value=Array(e.length);let f=[];for(let a=0;a<e.length;a++){let g=e[a],h=b.element._zod.run({value:g,issues:[]},d);h instanceof Promise?f.push(h.then(b=>T(b,c,a))):T(h,c,a)}return f.length?Promise.all(f).then(()=>c):c}});function V(a,b,c,d){a.issues.length&&b.issues.push(...i.lQ(c,a.issues)),void 0===a.value?c in d&&(b.value[c]=void 0):b.value[c]=a.value}let W=d.xI("$ZodObject",(a,b)=>{let c,e;k.init(a,b);let g=i.PO(()=>{let a=Object.keys(b.shape);for(let c of a)if(!b.shape[c]._zod.traits.has("$ZodType"))throw Error(`Invalid element at key "${c}": expected a Zod schema`);let c=i.NM(b.shape);return{shape:b.shape,keys:a,keySet:new Set(a),numKeys:a.length,optionalKeys:new Set(c)}});i.gJ(a._zod,"propValues",()=>{let a=b.shape,c={};for(let b in a){let d=a[b]._zod;if(d.values)for(let a of(c[b]??(c[b]=new Set),d.values))c[b].add(a)}return c});let h=i.Gv,j=!d.cr.jitless,l=i.hI,m=j&&l.value,n=b.catchall;a._zod.parse=(d,k)=>{e??(e=g.value);let l=d.value;if(!h(l))return d.issues.push({expected:"object",code:"invalid_type",input:l,inst:a}),d;let o=[];if(j&&m&&k?.async===!1&&!0!==k.jitless)c||(c=(a=>{let b=new f(["shape","payload","ctx"]),c=g.value,d=a=>{let b=i.UQ(a);return`shape[${b}]._zod.run({ value: input[${b}], issues: [] }, ctx)`};b.write("const input = payload.value;");let e=Object.create(null),h=0;for(let a of c.keys)e[a]=`key_${h++}`;for(let a of(b.write("const newResult = {}"),c.keys)){let c=e[a],f=i.UQ(a);b.write(`const ${c} = ${d(a)};`),b.write(`
        if (${c}.issues.length) {
          payload.issues = payload.issues.concat(${c}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${f}, ...iss.path] : [${f}]
          })));
        }
        
        if (${c}.value === undefined) {
          if (${f} in input) {
            newResult[${f}] = undefined;
          }
        } else {
          newResult[${f}] = ${c}.value;
        }
      `)}b.write("payload.value = newResult;"),b.write("return payload;");let j=b.compile();return(b,c)=>j(a,b,c)})(b.shape)),d=c(d,k);else{d.value={};let a=e.shape;for(let b of e.keys){let c=a[b]._zod.run({value:l[b],issues:[]},k);c instanceof Promise?o.push(c.then(a=>V(a,d,b,l))):V(c,d,b,l)}}if(!n)return o.length?Promise.all(o).then(()=>d):d;let p=[],q=e.keySet,r=n._zod,s=r.def.type;for(let a of Object.keys(l)){if(q.has(a))continue;if("never"===s){p.push(a);continue}let b=r.run({value:l[a],issues:[]},k);b instanceof Promise?o.push(b.then(b=>V(b,d,a,l))):V(b,d,a,l)}return(p.length&&d.issues.push({code:"unrecognized_keys",keys:p,input:l,inst:a}),o.length)?Promise.all(o).then(()=>d):d}});function X(a,b,c,e){for(let c of a)if(0===c.issues.length)return b.value=c.value,b;let f=a.filter(a=>!i.QH(a));return 1===f.length?(b.value=f[0].value,f[0]):(b.issues.push({code:"invalid_union",input:b.value,inst:c,errors:a.map(a=>a.issues.map(a=>i.iR(a,e,d.$W())))}),b)}let Y=d.xI("$ZodUnion",(a,b)=>{k.init(a,b),i.gJ(a._zod,"optin",()=>b.options.some(a=>"optional"===a._zod.optin)?"optional":void 0),i.gJ(a._zod,"optout",()=>b.options.some(a=>"optional"===a._zod.optout)?"optional":void 0),i.gJ(a._zod,"values",()=>{if(b.options.every(a=>a._zod.values))return new Set(b.options.flatMap(a=>Array.from(a._zod.values)))}),i.gJ(a._zod,"pattern",()=>{if(b.options.every(a=>a._zod.pattern)){let a=b.options.map(a=>a._zod.pattern);return RegExp(`^(${a.map(a=>i.p6(a.source)).join("|")})$`)}});let c=1===b.options.length,d=b.options[0]._zod.run;a._zod.parse=(e,f)=>{if(c)return d(e,f);let g=!1,h=[];for(let a of b.options){let b=a._zod.run({value:e.value,issues:[]},f);if(b instanceof Promise)h.push(b),g=!0;else{if(0===b.issues.length)return b;h.push(b)}}return g?Promise.all(h).then(b=>X(b,e,a,f)):X(h,e,a,f)}}),Z=d.xI("$ZodDiscriminatedUnion",(a,b)=>{Y.init(a,b);let c=a._zod.parse;i.gJ(a._zod,"propValues",()=>{let a={};for(let c of b.options){let d=c._zod.propValues;if(!d||0===Object.keys(d).length)throw Error(`Invalid discriminated union option at index "${b.options.indexOf(c)}"`);for(let[b,c]of Object.entries(d))for(let d of(a[b]||(a[b]=new Set),c))a[b].add(d)}return a});let d=i.PO(()=>{let a=b.options,c=new Map;for(let d of a){let a=d._zod.propValues?.[b.discriminator];if(!a||0===a.size)throw Error(`Invalid discriminated union option at index "${b.options.indexOf(d)}"`);for(let b of a){if(c.has(b))throw Error(`Duplicate discriminator value "${String(b)}"`);c.set(b,d)}}return c});a._zod.parse=(e,f)=>{let g=e.value;if(!i.Gv(g))return e.issues.push({code:"invalid_type",expected:"object",input:g,inst:a}),e;let h=d.value.get(g?.[b.discriminator]);return h?h._zod.run(e,f):b.unionFallback?c(e,f):(e.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:b.discriminator,input:g,path:[b.discriminator],inst:a}),e)}}),$=d.xI("$ZodIntersection",(a,b)=>{k.init(a,b),a._zod.parse=(a,c)=>{let d=a.value,e=b.left._zod.run({value:d,issues:[]},c),f=b.right._zod.run({value:d,issues:[]},c);return e instanceof Promise||f instanceof Promise?Promise.all([e,f]).then(([b,c])=>_(a,b,c)):_(a,e,f)}});function _(a,b,c){if(b.issues.length&&a.issues.push(...b.issues),c.issues.length&&a.issues.push(...c.issues),i.QH(a))return a;let d=function a(b,c){if(b===c||b instanceof Date&&c instanceof Date&&+b==+c)return{valid:!0,data:b};if(i.Qd(b)&&i.Qd(c)){let d=Object.keys(c),e=Object.keys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1,mergeErrorPath:[d,...e.mergeErrorPath]};f[d]=e.data}return{valid:!0,data:f}}if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return{valid:!1,mergeErrorPath:[]};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1,mergeErrorPath:[e,...f.mergeErrorPath]};d.push(f.data)}return{valid:!0,data:d}}return{valid:!1,mergeErrorPath:[]}}(b.value,c.value);if(!d.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(d.mergeErrorPath)}`);return a.value=d.data,a}let aa=d.xI("$ZodRecord",(a,b)=>{k.init(a,b),a._zod.parse=(c,e)=>{let f=c.value;if(!i.Qd(f))return c.issues.push({expected:"record",code:"invalid_type",input:f,inst:a}),c;let g=[];if(b.keyType._zod.values){let d,h=b.keyType._zod.values;for(let a of(c.value={},h))if("string"==typeof a||"number"==typeof a||"symbol"==typeof a){let d=b.valueType._zod.run({value:f[a],issues:[]},e);d instanceof Promise?g.push(d.then(b=>{b.issues.length&&c.issues.push(...i.lQ(a,b.issues)),c.value[a]=b.value})):(d.issues.length&&c.issues.push(...i.lQ(a,d.issues)),c.value[a]=d.value)}for(let a in f)h.has(a)||(d=d??[]).push(a);d&&d.length>0&&c.issues.push({code:"unrecognized_keys",input:f,inst:a,keys:d})}else for(let h of(c.value={},Reflect.ownKeys(f))){if("__proto__"===h)continue;let j=b.keyType._zod.run({value:h,issues:[]},e);if(j instanceof Promise)throw Error("Async schemas not supported in object keys currently");if(j.issues.length){c.issues.push({code:"invalid_key",origin:"record",issues:j.issues.map(a=>i.iR(a,e,d.$W())),input:h,path:[h],inst:a}),c.value[j.value]=j.value;continue}let k=b.valueType._zod.run({value:f[h],issues:[]},e);k instanceof Promise?g.push(k.then(a=>{a.issues.length&&c.issues.push(...i.lQ(h,a.issues)),c.value[j.value]=a.value})):(k.issues.length&&c.issues.push(...i.lQ(h,k.issues)),c.value[j.value]=k.value)}return g.length?Promise.all(g).then(()=>c):c}}),ab=d.xI("$ZodEnum",(a,b)=>{k.init(a,b);let c=i.w5(b.entries),d=new Set(c);a._zod.values=d,a._zod.pattern=RegExp(`^(${c.filter(a=>i.qQ.has(typeof a)).map(a=>"string"==typeof a?i.$f(a):a.toString()).join("|")})$`),a._zod.parse=(b,e)=>{let f=b.value;return d.has(f)||b.issues.push({code:"invalid_value",values:c,input:f,inst:a}),b}}),ac=d.xI("$ZodLiteral",(a,b)=>{if(k.init(a,b),0===b.values.length)throw Error("Cannot create literal schema with no valid values");a._zod.values=new Set(b.values),a._zod.pattern=RegExp(`^(${b.values.map(a=>"string"==typeof a?i.$f(a):a?i.$f(a.toString()):String(a)).join("|")})$`),a._zod.parse=(c,d)=>{let e=c.value;return a._zod.values.has(e)||c.issues.push({code:"invalid_value",values:b.values,input:e,inst:a}),c}}),ad=d.xI("$ZodTransform",(a,b)=>{k.init(a,b),a._zod.parse=(a,c)=>{let e=b.transform(a.value,a);if(c.async)return(e instanceof Promise?e:Promise.resolve(e)).then(b=>(a.value=b,a));if(e instanceof Promise)throw new d.GT;return a.value=e,a}});function ae(a,b){return a.issues.length&&void 0===b?{issues:[],value:void 0}:a}let af=d.xI("$ZodOptional",(a,b)=>{k.init(a,b),a._zod.optin="optional",a._zod.optout="optional",i.gJ(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,void 0]):void 0),i.gJ(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${i.p6(a.source)})?$`):void 0}),a._zod.parse=(a,c)=>{if("optional"===b.innerType._zod.optin){let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(b=>ae(b,a.value)):ae(d,a.value)}return void 0===a.value?a:b.innerType._zod.run(a,c)}}),ag=d.xI("$ZodNullable",(a,b)=>{k.init(a,b),i.gJ(a._zod,"optin",()=>b.innerType._zod.optin),i.gJ(a._zod,"optout",()=>b.innerType._zod.optout),i.gJ(a._zod,"pattern",()=>{let a=b.innerType._zod.pattern;return a?RegExp(`^(${i.p6(a.source)}|null)$`):void 0}),i.gJ(a._zod,"values",()=>b.innerType._zod.values?new Set([...b.innerType._zod.values,null]):void 0),a._zod.parse=(a,c)=>null===a.value?a:b.innerType._zod.run(a,c)}),ah=d.xI("$ZodDefault",(a,b)=>{k.init(a,b),a._zod.optin="optional",i.gJ(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{if(void 0===a.value)return a.value=b.defaultValue,a;let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(a=>ai(a,b)):ai(d,b)}});function ai(a,b){return void 0===a.value&&(a.value=b.defaultValue),a}let aj=d.xI("$ZodPrefault",(a,b)=>{k.init(a,b),a._zod.optin="optional",i.gJ(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>(void 0===a.value&&(a.value=b.defaultValue),b.innerType._zod.run(a,c))}),ak=d.xI("$ZodNonOptional",(a,b)=>{k.init(a,b),i.gJ(a._zod,"values",()=>{let a=b.innerType._zod.values;return a?new Set([...a].filter(a=>void 0!==a)):void 0}),a._zod.parse=(c,d)=>{let e=b.innerType._zod.run(c,d);return e instanceof Promise?e.then(b=>al(b,a)):al(e,a)}});function al(a,b){return a.issues.length||void 0!==a.value||a.issues.push({code:"invalid_type",expected:"nonoptional",input:a.value,inst:b}),a}let am=d.xI("$ZodCatch",(a,b)=>{k.init(a,b),i.gJ(a._zod,"optin",()=>b.innerType._zod.optin),i.gJ(a._zod,"optout",()=>b.innerType._zod.optout),i.gJ(a._zod,"values",()=>b.innerType._zod.values),a._zod.parse=(a,c)=>{let e=b.innerType._zod.run(a,c);return e instanceof Promise?e.then(e=>(a.value=e.value,e.issues.length&&(a.value=b.catchValue({...a,error:{issues:e.issues.map(a=>i.iR(a,c,d.$W()))},input:a.value}),a.issues=[]),a)):(a.value=e.value,e.issues.length&&(a.value=b.catchValue({...a,error:{issues:e.issues.map(a=>i.iR(a,c,d.$W()))},input:a.value}),a.issues=[]),a)}}),an=d.xI("$ZodPipe",(a,b)=>{k.init(a,b),i.gJ(a._zod,"values",()=>b.in._zod.values),i.gJ(a._zod,"optin",()=>b.in._zod.optin),i.gJ(a._zod,"optout",()=>b.out._zod.optout),i.gJ(a._zod,"propValues",()=>b.in._zod.propValues),a._zod.parse=(a,c)=>{let d=b.in._zod.run(a,c);return d instanceof Promise?d.then(a=>ao(a,b,c)):ao(d,b,c)}});function ao(a,b,c){return a.issues.length?a:b.out._zod.run({value:a.value,issues:a.issues},c)}let ap=d.xI("$ZodReadonly",(a,b)=>{k.init(a,b),i.gJ(a._zod,"propValues",()=>b.innerType._zod.propValues),i.gJ(a._zod,"values",()=>b.innerType._zod.values),i.gJ(a._zod,"optin",()=>b.innerType._zod.optin),i.gJ(a._zod,"optout",()=>b.innerType._zod.optout),a._zod.parse=(a,c)=>{let d=b.innerType._zod.run(a,c);return d instanceof Promise?d.then(aq):aq(d)}});function aq(a){return a.value=Object.freeze(a.value),a}let ar=d.xI("$ZodLazy",(a,b)=>{k.init(a,b),i.gJ(a._zod,"innerType",()=>b.getter()),i.gJ(a._zod,"pattern",()=>a._zod.innerType._zod.pattern),i.gJ(a._zod,"propValues",()=>a._zod.innerType._zod.propValues),i.gJ(a._zod,"optin",()=>a._zod.innerType._zod.optin??void 0),i.gJ(a._zod,"optout",()=>a._zod.innerType._zod.optout??void 0),a._zod.parse=(b,c)=>a._zod.innerType._zod.run(b,c)}),as=d.xI("$ZodCustom",(a,b)=>{e.QP.init(a,b),k.init(a,b),a._zod.parse=(a,b)=>a,a._zod.check=c=>{let d=c.value,e=b.fn(d);if(e instanceof Promise)return e.then(b=>at(b,c,d,a));at(e,c,d,a)}});function at(a,b,c,d){if(!a){let a={code:"custom",input:c,inst:d,path:[...d._zod.def.path??[]],continue:!d._zod.def.abort};d._zod.def.params&&(a.params=d._zod.def.params),b.issues.push(i.sn(a))}}var au=c(63345),av=c(13148);let aw=d.xI("ZodISODateTime",(a,b)=>{y.init(a,b),aF.init(a,b)}),ax=d.xI("ZodISODate",(a,b)=>{z.init(a,b),aF.init(a,b)}),ay=d.xI("ZodISOTime",(a,b)=>{A.init(a,b),aF.init(a,b)}),az=d.xI("ZodISODuration",(a,b)=>{B.init(a,b),aF.init(a,b)});var aA=c(4806);let aB=d.xI("ZodType",(a,b)=>(k.init(a,b),a.def=b,Object.defineProperty(a,"_def",{value:b}),a.check=(...c)=>a.clone({...b,checks:[...b.checks??[],...c.map(a=>"function"==typeof a?{_zod:{check:a,def:{check:"custom"},onattach:[]}}:a)]}),a.clone=(b,c)=>i.o8(a,b,c),a.brand=()=>a,a.register=(b,c)=>(b.add(a,c),a),a.parse=(b,c)=>aA.qg(a,b,c,{callee:a.parse}),a.safeParse=(b,c)=>aA.xL(a,b,c),a.parseAsync=async(b,c)=>aA.EJ(a,b,c,{callee:a.parseAsync}),a.safeParseAsync=async(b,c)=>aA.bp(a,b,c),a.spa=a.safeParseAsync,a.refine=(b,c)=>a.check(function(a,b={}){return av.fU(bI,a,b)}(b,c)),a.superRefine=b=>{var c;return a.check((c=b,av.MB(c)))},a.overwrite=b=>a.check(av.bS(b)),a.optional=()=>bw(a),a.nullable=()=>by(a),a.nullish=()=>bw(by(a)),a.nonoptional=b=>{var c,d;return c=a,d=b,new bB({type:"nonoptional",innerType:c,...i.A2(d)})},a.array=()=>be(a),a.or=b=>bk([a,b]),a.and=b=>new bn({type:"intersection",left:a,right:b}),a.transform=b=>bE(a,new bu({type:"transform",transform:b})),a.default=b=>(function(a,b){return new bz({type:"default",innerType:a,get defaultValue(){return"function"==typeof b?b():i.yG(b)}})})(a,b),a.prefault=b=>(function(a,b){return new bA({type:"prefault",innerType:a,get defaultValue(){return"function"==typeof b?b():i.yG(b)}})})(a,b),a.catch=b=>(function(a,b){return new bC({type:"catch",innerType:a,catchValue:"function"==typeof b?b:()=>b})})(a,b),a.pipe=b=>bE(a,b),a.readonly=()=>new bF({type:"readonly",innerType:a}),a.describe=b=>{let c=a.clone();return au.fd.add(c,{description:b}),c},Object.defineProperty(a,"description",{get:()=>au.fd.get(a)?.description,configurable:!0}),a.meta=(...b)=>{if(0===b.length)return au.fd.get(a);let c=a.clone();return au.fd.add(c,b[0]),c},a.isOptional=()=>a.safeParse(void 0).success,a.isNullable=()=>a.safeParse(null).success,a)),aC=d.xI("_ZodString",(a,b)=>{l.init(a,b),aB.init(a,b);let c=a._zod.bag;a.format=c.format??null,a.minLength=c.minimum??null,a.maxLength=c.maximum??null,a.regex=(...b)=>a.check(av.Fk(...b)),a.includes=(...b)=>a.check(av.dR(...b)),a.startsWith=(...b)=>a.check(av.$S(...b)),a.endsWith=(...b)=>a.check(av.ER(...b)),a.min=(...b)=>a.check(av.m9(...b)),a.max=(...b)=>a.check(av.Eb(...b)),a.length=(...b)=>a.check(av.YA(...b)),a.nonempty=(...b)=>a.check(av.m9(1,...b)),a.lowercase=b=>a.check(av.hH(b)),a.uppercase=b=>a.check(av.qF(b)),a.trim=()=>a.check(av.WN()),a.normalize=(...b)=>a.check(av.lo(...b)),a.toLowerCase=()=>a.check(av.Il()),a.toUpperCase=()=>a.check(av.xY())}),aD=d.xI("ZodString",(a,b)=>{l.init(a,b),aC.init(a,b),a.email=b=>a.check(av.Mu(aG,b)),a.url=b=>a.check(av.Fn(aK,b)),a.jwt=b=>a.check(av.rk(a$,b)),a.emoji=b=>a.check(av.aC(aL,b)),a.guid=b=>a.check(av.tB(aI,b)),a.uuid=b=>a.check(av.Be(aJ,b)),a.uuidv4=b=>a.check(av.nA(aJ,b)),a.uuidv6=b=>a.check(av.pY(aJ,b)),a.uuidv7=b=>a.check(av.wA(aJ,b)),a.nanoid=b=>a.check(av.Dl(aM,b)),a.guid=b=>a.check(av.tB(aI,b)),a.cuid=b=>a.check(av.fs(aN,b)),a.cuid2=b=>a.check(av.Bj(aO,b)),a.ulid=b=>a.check(av.Ct(aP,b)),a.base64=b=>a.check(av.rt(aW,b)),a.base64url=b=>a.check(av.cU(aY,b)),a.xid=b=>a.check(av.Pw(aQ,b)),a.ksuid=b=>a.check(av._z(aR,b)),a.ipv4=b=>a.check(av.Ny(aS,b)),a.ipv6=b=>a.check(av.$O(aT,b)),a.cidrv4=b=>a.check(av.Uy(aU,b)),a.cidrv6=b=>a.check(av.gP(aV,b)),a.e164=b=>a.check(av.KB(aZ,b)),a.datetime=b=>a.check(av.G1(aw,b)),a.date=b=>a.check(av.db(ax,b)),a.time=b=>a.check(av.Kn(ay,b)),a.duration=b=>a.check(av.f2(az,b))});function aE(a){return av.Rl(aD,a)}let aF=d.xI("ZodStringFormat",(a,b)=>{m.init(a,b),aC.init(a,b)}),aG=d.xI("ZodEmail",(a,b)=>{p.init(a,b),aF.init(a,b)});function aH(a){return av.Mu(aG,a)}let aI=d.xI("ZodGUID",(a,b)=>{n.init(a,b),aF.init(a,b)}),aJ=d.xI("ZodUUID",(a,b)=>{o.init(a,b),aF.init(a,b)}),aK=d.xI("ZodURL",(a,b)=>{q.init(a,b),aF.init(a,b)}),aL=d.xI("ZodEmoji",(a,b)=>{r.init(a,b),aF.init(a,b)}),aM=d.xI("ZodNanoID",(a,b)=>{s.init(a,b),aF.init(a,b)}),aN=d.xI("ZodCUID",(a,b)=>{t.init(a,b),aF.init(a,b)}),aO=d.xI("ZodCUID2",(a,b)=>{u.init(a,b),aF.init(a,b)}),aP=d.xI("ZodULID",(a,b)=>{v.init(a,b),aF.init(a,b)}),aQ=d.xI("ZodXID",(a,b)=>{w.init(a,b),aF.init(a,b)}),aR=d.xI("ZodKSUID",(a,b)=>{x.init(a,b),aF.init(a,b)}),aS=d.xI("ZodIPv4",(a,b)=>{C.init(a,b),aF.init(a,b)}),aT=d.xI("ZodIPv6",(a,b)=>{D.init(a,b),aF.init(a,b)}),aU=d.xI("ZodCIDRv4",(a,b)=>{E.init(a,b),aF.init(a,b)}),aV=d.xI("ZodCIDRv6",(a,b)=>{F.init(a,b),aF.init(a,b)}),aW=d.xI("ZodBase64",(a,b)=>{H.init(a,b),aF.init(a,b)});function aX(a){return av.rt(aW,a)}let aY=d.xI("ZodBase64URL",(a,b)=>{I.init(a,b),aF.init(a,b)}),aZ=d.xI("ZodE164",(a,b)=>{J.init(a,b),aF.init(a,b)}),a$=d.xI("ZodJWT",(a,b)=>{K.init(a,b),aF.init(a,b)}),a_=d.xI("ZodNumber",(a,b)=>{L.init(a,b),aB.init(a,b),a.gt=(b,c)=>a.check(av.Tx(b,c)),a.gte=(b,c)=>a.check(av.qm(b,c)),a.min=(b,c)=>a.check(av.qm(b,c)),a.lt=(b,c)=>a.check(av.Au(b,c)),a.lte=(b,c)=>a.check(av.Zm(b,c)),a.max=(b,c)=>a.check(av.Zm(b,c)),a.int=b=>{var c;return a.check((c=b,av.LK(a1,c)))},a.safe=b=>{var c;return a.check((c=b,av.LK(a1,c)))},a.positive=b=>a.check(av.Tx(0,b)),a.nonnegative=b=>a.check(av.qm(0,b)),a.negative=b=>a.check(av.Au(0,b)),a.nonpositive=b=>a.check(av.Zm(0,b)),a.multipleOf=(b,c)=>a.check(av.Hi(b,c)),a.step=(b,c)=>a.check(av.Hi(b,c)),a.finite=()=>a;let c=a._zod.bag;a.minValue=Math.max(c.minimum??-1/0,c.exclusiveMinimum??-1/0)??null,a.maxValue=Math.min(c.maximum??1/0,c.exclusiveMaximum??1/0)??null,a.isInt=(c.format??"").includes("int")||Number.isSafeInteger(c.multipleOf??.5),a.isFinite=!0,a.format=c.format??null});function a0(a){return av.F7(a_,a)}let a1=d.xI("ZodNumberFormat",(a,b)=>{M.init(a,b),a_.init(a,b)}),a2=d.xI("ZodBoolean",(a,b)=>{N.init(a,b),aB.init(a,b)});function a3(a){return av._L(a2,a)}let a4=d.xI("ZodNull",(a,b)=>{O.init(a,b),aB.init(a,b)});function a5(a){return av.jw(a4,a)}let a6=d.xI("ZodAny",(a,b)=>{P.init(a,b),aB.init(a,b)});function a7(){return av.KA(a6)}let a8=d.xI("ZodUnknown",(a,b)=>{Q.init(a,b),aB.init(a,b)});function a9(){return av.em(a8)}let ba=d.xI("ZodNever",(a,b)=>{R.init(a,b),aB.init(a,b)}),bb=d.xI("ZodDate",(a,b)=>{S.init(a,b),aB.init(a,b),a.min=(b,c)=>a.check(av.qm(b,c)),a.max=(b,c)=>a.check(av.Zm(b,c));let c=a._zod.bag;a.minDate=c.minimum?new Date(c.minimum):null,a.maxDate=c.maximum?new Date(c.maximum):null});function bc(a){return av.YY(bb,a)}let bd=d.xI("ZodArray",(a,b)=>{U.init(a,b),aB.init(a,b),a.element=b.element,a.min=(b,c)=>a.check(av.m9(b,c)),a.nonempty=b=>a.check(av.m9(1,b)),a.max=(b,c)=>a.check(av.Eb(b,c)),a.length=(b,c)=>a.check(av.YA(b,c)),a.unwrap=()=>a.element});function be(a,b){return av.dZ(bd,a,b)}let bf=d.xI("ZodObject",(a,b)=>{W.init(a,b),aB.init(a,b),i.gJ(a,"shape",()=>b.shape),a.keyof=()=>br(Object.keys(a._zod.def.shape)),a.catchall=b=>a.clone({...a._zod.def,catchall:b}),a.passthrough=()=>a.clone({...a._zod.def,catchall:a9()}),a.loose=()=>a.clone({...a._zod.def,catchall:a9()}),a.strict=()=>a.clone({...a._zod.def,catchall:av.G8(ba,void 0)}),a.strip=()=>a.clone({...a._zod.def,catchall:void 0}),a.extend=b=>i.X$(a,b),a.merge=b=>i.h1(a,b),a.pick=b=>i.Up(a,b),a.omit=b=>i.cJ(a,b),a.partial=(...b)=>i.OH(bv,a,b[0]),a.required=(...b)=>i.mw(bB,a,b[0])});function bg(a,b){return new bf({type:"object",get shape(){return i.Vy(this,"shape",a?i.ZV(a):{}),this.shape},...i.A2(b)})}function bh(a,b){return new bf({type:"object",get shape(){return i.Vy(this,"shape",i.ZV(a)),this.shape},catchall:av.G8(ba,void 0),...i.A2(b)})}function bi(a,b){return new bf({type:"object",get shape(){return i.Vy(this,"shape",i.ZV(a)),this.shape},catchall:a9(),...i.A2(b)})}let bj=d.xI("ZodUnion",(a,b)=>{Y.init(a,b),aB.init(a,b),a.options=b.options});function bk(a,b){return new bj({type:"union",options:a,...i.A2(b)})}let bl=d.xI("ZodDiscriminatedUnion",(a,b)=>{bj.init(a,b),Z.init(a,b)});function bm(a,b,c){return new bl({type:"union",options:b,discriminator:a,...i.A2(c)})}let bn=d.xI("ZodIntersection",(a,b)=>{$.init(a,b),aB.init(a,b)}),bo=d.xI("ZodRecord",(a,b)=>{aa.init(a,b),aB.init(a,b),a.keyType=b.keyType,a.valueType=b.valueType});function bp(a,b,c){return new bo({type:"record",keyType:a,valueType:b,...i.A2(c)})}let bq=d.xI("ZodEnum",(a,b)=>{ab.init(a,b),aB.init(a,b),a.enum=b.entries,a.options=Object.values(b.entries);let c=new Set(Object.keys(b.entries));a.extract=(a,d)=>{let e={};for(let d of a)if(c.has(d))e[d]=b.entries[d];else throw Error(`Key ${d} not found in enum`);return new bq({...b,checks:[],...i.A2(d),entries:e})},a.exclude=(a,d)=>{let e={...b.entries};for(let b of a)if(c.has(b))delete e[b];else throw Error(`Key ${b} not found in enum`);return new bq({...b,checks:[],...i.A2(d),entries:e})}});function br(a,b){return new bq({type:"enum",entries:Array.isArray(a)?Object.fromEntries(a.map(a=>[a,a])):a,...i.A2(b)})}let bs=d.xI("ZodLiteral",(a,b)=>{ac.init(a,b),aB.init(a,b),a.values=new Set(b.values),Object.defineProperty(a,"value",{get(){if(b.values.length>1)throw Error("This schema contains multiple valid literal values. Use `.values` instead.");return b.values[0]}})});function bt(a,b){return new bs({type:"literal",values:Array.isArray(a)?a:[a],...i.A2(b)})}let bu=d.xI("ZodTransform",(a,b)=>{ad.init(a,b),aB.init(a,b),a._zod.parse=(c,d)=>{c.addIssue=d=>{"string"==typeof d?c.issues.push(i.sn(d,c.value,b)):(d.fatal&&(d.continue=!1),d.code??(d.code="custom"),d.input??(d.input=c.value),d.inst??(d.inst=a),c.issues.push(i.sn(d)))};let e=b.transform(c.value,c);return e instanceof Promise?e.then(a=>(c.value=a,c)):(c.value=e,c)}}),bv=d.xI("ZodOptional",(a,b)=>{af.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.innerType});function bw(a){return new bv({type:"optional",innerType:a})}let bx=d.xI("ZodNullable",(a,b)=>{ag.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.innerType});function by(a){return new bx({type:"nullable",innerType:a})}let bz=d.xI("ZodDefault",(a,b)=>{ah.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeDefault=a.unwrap}),bA=d.xI("ZodPrefault",(a,b)=>{aj.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.innerType}),bB=d.xI("ZodNonOptional",(a,b)=>{ak.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.innerType}),bC=d.xI("ZodCatch",(a,b)=>{am.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.innerType,a.removeCatch=a.unwrap}),bD=d.xI("ZodPipe",(a,b)=>{an.init(a,b),aB.init(a,b),a.in=b.in,a.out=b.out});function bE(a,b){return new bD({type:"pipe",in:a,out:b})}let bF=d.xI("ZodReadonly",(a,b)=>{ap.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.innerType}),bG=d.xI("ZodLazy",(a,b)=>{ar.init(a,b),aB.init(a,b),a.unwrap=()=>a._zod.def.getter()});function bH(a){return new bG({type:"lazy",getter:a})}let bI=d.xI("ZodCustom",(a,b)=>{as.init(a,b),aB.init(a,b)});function bJ(a,b){return av.FO(bI,a??(()=>!0),b)}function bK(a,b={error:`Input not instance of ${a.name}`}){let c=new bI({type:"custom",check:"custom",fn:b=>b instanceof a,abort:!0,...i.A2(b)});return c._zod.bag.Class=a,c}},42517:(a,b,c)=>{c.d(b,{v:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"ListNode"===a.kind,create:a=>(0,d.CN)({kind:"ListNode",items:(0,d.CN)(a)})})},42522:(a,b,c)=>{c.d(b,{t:()=>u});var d=c(88202),e=c(59659),f=c(11182),g=c(22715);let h=(0,e.CN)({is:a=>"AggregateFunctionNode"===a.kind,create:(a,b=[])=>(0,e.CN)({kind:"AggregateFunctionNode",func:a,aggregated:b}),cloneWithDistinct:a=>(0,e.CN)({...a,distinct:!0}),cloneWithOrderBy(a,b,c=!1){let d=c?"withinGroup":"orderBy";return(0,e.CN)({...a,[d]:a[d]?g.O.cloneWithItems(a[d],b):g.O.create(b)})},cloneWithFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"And",b):f.o.create(b)}),cloneWithOrFilter:(a,b)=>(0,e.CN)({...a,filter:a.filter?f.o.cloneWithOperation(a.filter,"Or",b):f.o.create(b)}),cloneWithOver:(a,b)=>(0,e.CN)({...a,over:b})}),i=(0,e.CN)({is:a=>"FunctionNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"FunctionNode",func:a,arguments:b})});var j=c(34082),k=c(91164),l=c(15539),m=c(44344),n=c(97434),o=c(18634),p=c(80038),q=c(71767);class r{#g;constructor(a){this.#g=(0,e.CN)(a)}get expressionType(){}as(a){return new s(this,a)}distinct(){return new r({...this.#g,aggregateFunctionNode:h.cloneWithDistinct(this.#g.aggregateFunctionNode)})}orderBy(...a){return new r({...this.#g,aggregateFunctionNode:q.L.cloneWithOrderByItems(this.#g.aggregateFunctionNode,(0,p.xk)(a))})}clearOrderBy(){return new r({...this.#g,aggregateFunctionNode:q.L.cloneWithoutOrderBy(this.#g.aggregateFunctionNode)})}withinGroupOrderBy(...a){return new r({...this.#g,aggregateFunctionNode:h.cloneWithOrderBy(this.#g.aggregateFunctionNode,(0,p.xk)(a),!0)})}filterWhere(...a){return new r({...this.#g,aggregateFunctionNode:h.cloneWithFilter(this.#g.aggregateFunctionNode,(0,o.GB)(a))})}filterWhereRef(a,b,c){return new r({...this.#g,aggregateFunctionNode:h.cloneWithFilter(this.#g.aggregateFunctionNode,(0,o.vC)(a,b,c))})}over(a){let b=(0,n.EQ)();return new r({...this.#g,aggregateFunctionNode:h.cloneWithOver(this.#g.aggregateFunctionNode,(a?a(b):b).toOperationNode())})}$call(a){return a(this)}$castTo(){return new r(this.#g)}$notNull(){return new r(this.#g)}toOperationNode(){return this.#g.aggregateFunctionNode}}class s{#n;#j;constructor(a,b){this.#n=a,this.#j=b}get expression(){return this.#n}get alias(){return this.#j}toOperationNode(){return l.N.create(this.#n.toOperationNode(),m.O.create(this.#j))}}var t=c(15021);function u(){let a=(a,b)=>new d.Is(i.create(a,(0,j.kU)(b??[]))),b=(a,b)=>new r({aggregateFunctionNode:h.create(a,b?(0,j.kU)(b):void 0)});return Object.assign(a,{agg:b,avg:a=>b("avg",[a]),coalesce:(...b)=>a("coalesce",b),count:a=>b("count",[a]),countAll:a=>new r({aggregateFunctionNode:h.create("count",(0,k.J)(a))}),max:a=>b("max",[a]),min:a=>b("min",[a]),sum:a=>b("sum",[a]),any:b=>a("any",[b]),jsonAgg:a=>new r({aggregateFunctionNode:h.create("json_agg",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()])}),toJson:a=>new d.Is(i.create("to_json",[(0,e.Kg)(a)?(0,t.M$)(a):a.toOperationNode()]))})}},42749:(a,b,c)=>{c.d(b,{c:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"JSONPathNode"===a.kind,create:a=>(0,d.CN)({kind:"JSONPathNode",inOperator:a,pathLegs:(0,d.CN)([])}),cloneWithLeg:(a,b)=>(0,d.CN)({...a,pathLegs:(0,d.CN)([...a.pathLegs,b])})})},44272:(a,b,c)=>{c.d(b,{Q:()=>e});var d=c(8575);class e{static [d.i]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}},44344:(a,b,c)=>{c.d(b,{O:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"IdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"IdentifierNode",name:a})})},44674:(a,b,c)=>{c.d(b,{B:()=>f,o:()=>e});var d=c(59659);let e=["preserve rows","delete rows","drop"],f=(0,d.CN)({is:a=>"CreateTableNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateTableNode",table:a,columns:(0,d.CN)([])}),cloneWithColumn:(a,b)=>(0,d.CN)({...a,columns:(0,d.CN)([...a.columns,b])}),cloneWithConstraint:(a,b)=>(0,d.CN)({...a,constraints:a.constraints?(0,d.CN)([...a.constraints,b]):(0,d.CN)([b])}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithEndModifier:(a,b)=>(0,d.CN)({...a,endModifiers:a.endModifiers?(0,d.CN)([...a.endModifiers,b]):(0,d.CN)([b])}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},44796:(a,b,c)=>{c.d(b,{IV:()=>h,P2:()=>j,T9:()=>m,U9:()=>g,Zf:()=>i,cz:()=>k,jk:()=>n,oh:()=>l});var d=c(98318),e=c(8575),f=c(98708);function g(a){return(0,f.ll)`count(${a||f.ll.raw("*")})`.mapWith(Number)}function h(a){return(0,f.ll)`count(distinct ${a})`.mapWith(Number)}function i(a){return(0,f.ll)`avg(${a})`.mapWith(String)}function j(a){return(0,f.ll)`avg(distinct ${a})`.mapWith(String)}function k(a){return(0,f.ll)`sum(${a})`.mapWith(String)}function l(a){return(0,f.ll)`sum(distinct ${a})`.mapWith(String)}function m(a){return(0,f.ll)`max(${a})`.mapWith((0,e.is)(a,d.V)?a:String)}function n(a){return(0,f.ll)`min(${a})`.mapWith((0,e.is)(a,d.V)?a:String)}},44989:(a,b,c)=>{c.d(b,{a:()=>j,c:()=>i,g:()=>e});var d=c(61741);let e=a=>(0,d.q)("a-z","A-Z","0-9")(a||32),f=["info","success","warn","error","debug"],g={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{red:"\x1b[31m",green:"\x1b[32m",yellow:"\x1b[33m",blue:"\x1b[34m",magenta:"\x1b[35m"}},h={info:g.fg.blue,success:g.fg.green,warn:g.fg.yellow,error:g.fg.red,debug:g.fg.magenta},i=a=>{let b=a?.disabled!==!0,c=a?.level??"error";return Object.fromEntries(f.map(d=>[d,(...[e,...i])=>((d,e,i=[])=>{if(!b||!(f.indexOf(d)<=f.indexOf(c)))return;let j=((a,b)=>{let c=new Date().toISOString();return`${g.dim}${c}${g.reset} ${h[a]}${a.toUpperCase()}${g.reset} ${g.bright}[Better Auth]:${g.reset} ${b}`})(d,e);if(!a||"function"!=typeof a.log)return void("error"===d?console.error(j,...i):"warn"===d?console.warn(j,...i):console.log(j,...i));a.log("success"===d?"info":d,e,...i)})(d,e,i)]))},j=i()},46221:(a,b,c)=>{c.d(b,{Y:()=>f});var d=c(59659),e=c(87197);let f=(0,d.CN)({is:a=>"CreateViewNode"===a.kind,create:a=>(0,d.CN)({kind:"CreateViewNode",name:e.y.create(a)}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},46345:(a,b,c)=>{c.d(b,{bj:()=>i,uc:()=>k});var d=c(15539),e=c(44344),f=c(23244),g=c(15021),h=c(59659);class i{#o;get table(){return this.#o}constructor(a){this.#o=a}as(a){return new j(this.#o,a)}}class j{#o;#j;get table(){return this.#o}get alias(){return this.#j}constructor(a,b){this.#o=a,this.#j=b}toOperationNode(){return d.N.create((0,g.M$)(this.#o),e.O.create(this.#j))}}function k(a){return(0,h.Gv)(a)&&(0,f.N)(a)&&(0,h.Kg)(a.table)&&(0,h.Kg)(a.alias)}},46584:(a,b,c)=>{c.d(b,{D4:()=>g,lF:()=>f});var d=c(4573),e=c(50047);let f=a=>d.Buffer.from(a).toString("base64url"),g=a=>new Uint8Array(d.Buffer.from(function(a){let b=a;return b instanceof Uint8Array&&(b=e.D0.decode(b)),b}(a),"base64url"))},47389:(a,b,c)=>{c.d(b,{E:()=>d});let d=Symbol.for("drizzle:Name")},47581:(a,b,c)=>{c.d(b,{b:()=>h});var d=c(59659),e=c(58436),f=c(38070);let g=(0,d.CN)({is:a=>"OnNode"===a.kind,create:a=>(0,d.CN)({kind:"OnNode",on:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,on:"And"===b?e.s.create(a.on,c):f.K.create(a.on,c)})}),h=(0,d.CN)({is:a=>"JoinNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:void 0}),createWithOn:(a,b,c)=>(0,d.CN)({kind:"JoinNode",joinType:a,table:b,on:g.create(c)}),cloneWithOn:(a,b)=>(0,d.CN)({...a,on:a.on?g.cloneWithOperation(a.on,"And",b):g.create(b)})})},47609:(a,b,c)=>{c.d(b,{c:()=>j});var d=c(98642),e=c(20493),f=c(44989);c(506),c(95856),c(59061),c(15247),c(22321);let g=[],h=-1,i={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",fg:{yellow:"\x1b[33m",magenta:"\x1b[35m"},bg:{black:"\x1b[40m"}},j=({adapter:a,config:b})=>c=>{let i={...b,supportsBooleans:b.supportsBooleans??!0,supportsDates:b.supportsDates??!0,supportsJSON:b.supportsJSON??!1,adapterName:b.adapterName??b.adapterId,supportsNumericIds:b.supportsNumericIds??!0};if(c.advanced?.database?.useNumberId===!0&&!1===i.supportsNumericIds)throw Error(`[${i.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let j=(0,e.g)(c),o=({field:a,model:b})=>{if("id"===a||"_id"===a)return"id";let c=p(b),d=j[c]?.fields[a];if(d||(d=Object.values(j[c]?.fields).find(b=>b.fieldName===a)),!d)throw s(`Field ${a} not found in model ${c}`),s("Schema:",j),Error(`Field ${a} not found in model ${c}`);return a},p=a=>{if(i.usePlural&&"s"===a.charAt(a.length-1)){let b=a.slice(0,-1),c=j[b]?b:void 0;if(c||(c=Object.entries(j).find(([a,c])=>c.modelName===b)?.[0]),c)return c}let b=j[a]?a:void 0;if(b||(b=Object.entries(j).find(([b,c])=>c.modelName===a)?.[0]),!b)throw s(`Model "${a}" not found in schema`),s("Schema:",j),Error(`Model "${a}" not found in schema`);return b},q=a=>{let b=p(a),c=i&&i.usePlural;return j&&j[b]&&j[b].modelName!==a?c?`${j[b].modelName}s`:j[b].modelName:c?`${a}s`:a};function r({model:a,field:b}){let c=p(a),d=o({model:c,field:b});return j[c]?.fields[d]?.fieldName||d}let s=(...a)=>{if(!0===i.debugLogs||"object"==typeof i.debugLogs){if("object"==typeof i.debugLogs&&"isRunningAdapterTests"in i.debugLogs){i.debugLogs.isRunningAdapterTests&&(a.shift(),g.push(a));return}if("object"!=typeof i.debugLogs||!i.debugLogs.logCondition||i.debugLogs.logCondition?.())if("object"==typeof a[0]&&"method"in a[0]){let b=a.shift().method;if("object"==typeof i.debugLogs){if("create"===b&&!i.debugLogs.create)return;else if("update"===b&&!i.debugLogs.update)return;else if("updateMany"===b&&!i.debugLogs.updateMany)return;else if("findOne"===b&&!i.debugLogs.findOne)return;else if("findMany"===b&&!i.debugLogs.findMany)return;else if("delete"===b&&!i.debugLogs.delete)return;else if("deleteMany"===b&&!i.debugLogs.deleteMany)return;else if("count"===b&&!i.debugLogs.count)return}f.a.info(`[${i.adapterName}]`,...a)}else f.a.info(`[${i.adapterName}]`,...a)}},t=({customModelName:a,forceAllowId:b})=>{let d=!i.disableIdGeneration&&!c.advanced?.database?.useNumberId&&!b,e=p(a??"id");return{type:c.advanced?.database?.useNumberId?"number":"string",required:!!d,...d?{defaultValue(){if(i.disableIdGeneration)return;let a=c.advanced?.database?.useNumberId,b=c.advanced?.database?.generateId;if(c.advanced?.generateId!==void 0&&(f.a.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),b=c.advanced?.generateId),!1!==b&&!a)return b?b({model:e}):i.customIdGenerator?i.customIdGenerator({model:e}):(0,f.g)()}}:{}}},u=({model:a,field:b})=>{let c=p(a),d=o({field:b,model:a}),e=j[c].fields;return e.id=t({customModelName:c}),e[d]},v=a({options:c,schema:j,debugLog:s,getFieldName:r,getModelName:q,getDefaultModelName:p,getDefaultFieldName:o,getFieldAttributes:u}),w=async(a,b,d,e)=>{let f={},g=j[b].fields,h=i.mapKeysTransformInput??{};for(let k in i.disableIdGeneration||c.advanced?.database?.useNumberId||(g.id=t({customModelName:b,forceAllowId:e&&"id"in a})),g){let e=a[k],l=g[k],m=h[k]||g[k].fieldName||k;if(void 0===e&&(!l.defaultValue&&!l.transform?.input||"update"===d))continue;let n=function(a,b,c){return"update"===c?a:null==a&&void 0!==b.defaultValue?"function"==typeof b.defaultValue?b.defaultValue():b.defaultValue:a}(e,l,d);l.transform?.input&&(n=await l.transform.input(n)),l.references?.field==="id"&&c.advanced?.database?.useNumberId?n=Array.isArray(n)?n.map(Number):Number(n):!1===i.supportsJSON&&"object"==typeof n&&"json"===l.type?n=JSON.stringify(n):!1===i.supportsDates&&n instanceof Date&&"date"===l.type?n=n.toISOString():!1===i.supportsBooleans&&"boolean"==typeof n&&(n=+!!n),i.customTransformInput&&(n=i.customTransformInput({data:n,action:d,field:m,fieldAttributes:l,model:b,schema:j,options:c})),f[m]=n}return f},x=async(a,b,e=[])=>{if(!a)return null;let f=i.mapKeysTransformOutput??{},g={},h=j[b].fields;for(let k in h[Object.entries(f).find(([a,b])=>"id"===b)?.[0]??"id"]={type:c.advanced?.database?.useNumberId?"number":"string"},h){if(e.length&&!e.includes(k))continue;let l=h[k];if(l){let h=l.fieldName||k,m=a[Object.entries(f).find(([a,b])=>b===h)?.[0]||h];l.transform?.output&&(m=await l.transform.output(m));let n=f[k]||k;"id"===h||l.references?.field==="id"?void 0!==m&&(m=String(m)):!1===i.supportsJSON&&"string"==typeof m&&"json"===l.type?m=(0,d.s)(m):!1===i.supportsDates&&"string"==typeof m&&"date"===l.type?m=new Date(m):!1===i.supportsBooleans&&"number"==typeof m&&"boolean"===l.type&&(m=1===m),i.customTransformOutput&&(m=i.customTransformOutput({data:m,field:n,fieldAttributes:l,select:e,model:b,schema:j,options:c})),g[n]=m}}return g},y=({model:a,where:b})=>{if(!b)return;let d=i.mapKeysTransformInput??{};return b.map(b=>{let{field:e,value:f,operator:g="eq",connector:h="AND"}=b;if("in"===g&&!Array.isArray(f))throw Error("Value must be an array");let i=p(a),j=o({field:e,model:a}),k=d[j]||r({field:j,model:i}),l=u({field:j,model:i});return("id"===j||l.references?.field==="id")&&c.advanced?.database?.useNumberId?Array.isArray(f)?{operator:g,connector:h,field:k,value:f.map(Number)}:{operator:g,connector:h,field:k,value:Number(f)}:{operator:g,connector:h,field:k,value:f}})};return{create:async({data:a,model:b,select:c,forceAllowId:d=!1})=>{let e=++h,g=q(b);if("id"in a&&!d){f.a.warn(`[${i.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);let b=Error();console.log(b.stack?.split("\n").filter((a,b)=>1!==b).join("\n").replace("Error:","Create method with `id` being called at:")),a.id=void 0}s({method:"create"},`${k(e)} ${l(1,4)}`,`${m("create")} ${n("Unsafe Input")}:`,{model:g,data:a});let j=await w(a,b,"create",d);s({method:"create"},`${k(e)} ${l(2,4)}`,`${m("create")} ${n("Parsed Input")}:`,{model:g,data:j});let o=await v.create({data:j,model:g});s({method:"create"},`${k(e)} ${l(3,4)}`,`${m("create")} ${n("DB Result")}:`,{model:g,res:o});let p=await x(o,b,c);return s({method:"create"},`${k(e)} ${l(4,4)}`,`${m("create")} ${n("Parsed Result")}:`,{model:g,data:p}),p},update:async({model:a,where:b,update:c})=>{let d=++h,e=q(a),f=y({model:a,where:b});s({method:"update"},`${k(d)} ${l(1,4)}`,`${m("update")} ${n("Unsafe Input")}:`,{model:e,data:c});let g=await w(c,a,"update");s({method:"update"},`${k(d)} ${l(2,4)}`,`${m("update")} ${n("Parsed Input")}:`,{model:e,data:g});let i=await v.update({model:e,where:f,update:g});s({method:"update"},`${k(d)} ${l(3,4)}`,`${m("update")} ${n("DB Result")}:`,{model:e,data:i});let j=await x(i,a);return s({method:"update"},`${k(d)} ${l(4,4)}`,`${m("update")} ${n("Parsed Result")}:`,{model:e,data:j}),j},updateMany:async({model:a,where:b,update:c})=>{let d=++h,e=q(a),f=y({model:a,where:b});s({method:"updateMany"},`${k(d)} ${l(1,4)}`,`${m("updateMany")} ${n("Unsafe Input")}:`,{model:e,data:c});let g=await w(c,a,"update");s({method:"updateMany"},`${k(d)} ${l(2,4)}`,`${m("updateMany")} ${n("Parsed Input")}:`,{model:e,data:g});let i=await v.updateMany({model:e,where:f,update:g});return s({method:"updateMany"},`${k(d)} ${l(3,4)}`,`${m("updateMany")} ${n("DB Result")}:`,{model:e,data:i}),s({method:"updateMany"},`${k(d)} ${l(4,4)}`,`${m("updateMany")} ${n("Parsed Result")}:`,{model:e,data:i}),i},findOne:async({model:a,where:b,select:c})=>{let d=++h,e=q(a),f=y({model:a,where:b});s({method:"findOne"},`${k(d)} ${l(1,3)}`,`${m("findOne")}:`,{model:e,where:f,select:c});let g=await v.findOne({model:e,where:f,select:c});s({method:"findOne"},`${k(d)} ${l(2,3)}`,`${m("findOne")} ${n("DB Result")}:`,{model:e,data:g});let i=await x(g,a,c);return s({method:"findOne"},`${k(d)} ${l(3,3)}`,`${m("findOne")} ${n("Parsed Result")}:`,{model:e,data:i}),i},findMany:async({model:a,where:b,limit:d,sortBy:e,offset:f})=>{let g=++h,i=d??c.advanced?.database?.defaultFindManyLimit??100,j=q(a),o=y({model:a,where:b});s({method:"findMany"},`${k(g)} ${l(1,3)}`,`${m("findMany")}:`,{model:j,where:o,limit:i,sortBy:e,offset:f});let p=await v.findMany({model:j,where:o,limit:i,sortBy:e,offset:f});s({method:"findMany"},`${k(g)} ${l(2,3)}`,`${m("findMany")} ${n("DB Result")}:`,{model:j,data:p});let r=await Promise.all(p.map(async b=>await x(b,a)));return s({method:"findMany"},`${k(g)} ${l(3,3)}`,`${m("findMany")} ${n("Parsed Result")}:`,{model:j,data:r}),r},delete:async({model:a,where:b})=>{let c=++h,d=q(a),e=y({model:a,where:b});s({method:"delete"},`${k(c)} ${l(1,2)}`,`${m("delete")}:`,{model:d,where:e}),await v.delete({model:d,where:e}),s({method:"delete"},`${k(c)} ${l(2,2)}`,`${m("delete")} ${n("DB Result")}:`,{model:d})},deleteMany:async({model:a,where:b})=>{let c=++h,d=q(a),e=y({model:a,where:b});s({method:"deleteMany"},`${k(c)} ${l(1,2)}`,`${m("deleteMany")} ${n("DeleteMany")}:`,{model:d,where:e});let f=await v.deleteMany({model:d,where:e});return s({method:"deleteMany"},`${k(c)} ${l(2,2)}`,`${m("deleteMany")} ${n("DB Result")}:`,{model:d,data:f}),f},count:async({model:a,where:b})=>{let c=++h,d=q(a),e=y({model:a,where:b});s({method:"count"},`${k(c)} ${l(1,2)}`,`${m("count")}:`,{model:d,where:e});let f=await v.count({model:d,where:e});return s({method:"count"},`${k(c)} ${l(2,2)}`,`${m("count")}:`,{model:d,data:f}),f},createSchema:v.createSchema?async(a,b)=>{let d=(0,e.g)(c);return c.secondaryStorage&&!c.session?.storeSessionInDatabase&&delete d.session,c.rateLimit&&"database"===c.rateLimit.storage&&(void 0===c.rateLimit.enabled||!0===c.rateLimit.enabled)&&(d.ratelimit={modelName:c.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:c.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:c.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:c.rateLimit.fields?.lastRequest??"lastRequest"}}}),v.createSchema({file:b,tables:d})}:void 0,options:{adapterConfig:i,...v.options??{}},id:i.adapterId,...i.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){g=[]},printDebugLogs(){let a=`\u2500`.repeat(80);console.log(...g.reverse().map(a=>(a[0]=`
${a[0]}`,[...a,"\n"])).reduce((a,b)=>[...b,...a],[`
${a}`]))}}}:{}}};function k(a){return`${i.fg.magenta}#${a}${i.reset}`}function l(a,b){return`${i.bg.black}${i.fg.yellow}[${a}/${b}]${i.reset}`}function m(a){return`${i.bright}${a}${i.reset}`}function n(a){return`${i.dim}(${a})${i.reset}`}},48655:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(79841);function e(a){switch(a){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new d.T0(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}},49161:(a,b,c)=>{c.d(b,{N:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"FromNode"===a.kind,create:a=>(0,d.CN)({kind:"FromNode",froms:(0,d.CN)(a)}),cloneWithFroms:(a,b)=>(0,d.CN)({...a,froms:(0,d.CN)([...a.froms,...b])})})},49828:(a,b,c)=>{c.d(b,{R:()=>h});var d=c(59659),e=c(57727),f=c(62020);let g=(0,d.CN)([]);class h{#p;constructor(a=g){this.#p=a}get plugins(){return this.#p}transformQuery(a,b){for(let c of this.#p){let d=c.transformQuery({node:a,queryId:b});if(d.kind===a.kind)a=d;else throw Error(`KyselyPlugin.transformQuery must return a node of the same kind that was given to it. The plugin was given a ${a.kind} but it returned a ${d.kind}`)}return a}async executeQuery(a){return await this.provideConnection(async b=>{let c=await b.executeQuery(a);return"numUpdatedOrDeletedRows"in c&&(0,f.u)("kysely:warning: outdated driver/plugin detected! `QueryResult.numUpdatedOrDeletedRows` has been replaced with `QueryResult.numAffectedRows`."),await this.#q(c,a.queryId)})}async *stream(a,b){let{connection:c,release:d}=await (0,e.G)(this);try{for await(let d of c.streamQuery(a,b))yield await this.#q(d,a.queryId)}finally{d()}}async #q(a,b){for(let c of this.#p)a=await c.transformResult({result:a,queryId:b});return a}}},50047:(a,b,c)=>{c.d(b,{D0:()=>e,Rd:()=>d,xW:()=>f});let d=new TextEncoder,e=new TextDecoder;function f(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}},50952:(a,b,c)=>{c.d(b,{q:()=>f});var d=c(3047),e=c(59659);let f=(0,e.CN)({is:a=>"ReferenceNode"===a.kind,create:(a,b)=>(0,e.CN)({kind:"ReferenceNode",table:b,column:a}),createSelectAll:a=>(0,e.CN)({kind:"ReferenceNode",table:a,column:d.U.create()})})},52094:(a,b,c)=>{c.d(b,{l:()=>r});var d=c(44344),e=c(23244),f=c(82493),g=c(65968),h=c(34082),i=c(15021),j=c(93806),k=c(70030),l=c(15539),m=c(59659),n=c(59865);class o{#g;constructor(a){this.#g=(0,m.CN)(a)}get expressionType(){}get isRawBuilder(){return!0}as(a){return new q(this,a)}$castTo(){return new o({...this.#g})}$notNull(){return new o(this.#g)}withPlugin(a){return new o({...this.#g,plugins:void 0!==this.#g.plugins?(0,m.CN)([...this.#g.plugins,a]):(0,m.CN)([a])})}toOperationNode(){return this.#r(this.#s())}compile(a){return this.#t(this.#s(a))}async execute(a){let b=this.#s(a);return b.executeQuery(this.#t(b))}#s(a){let b=void 0!==a?a.getExecutor():n.W;return void 0!==this.#g.plugins?b.withPlugins(this.#g.plugins):b}#r(a){return a.transformQuery(this.#g.rawNode,this.#g.queryId)}#t(a){return a.compileQuery(this.#r(a),this.#g.queryId)}}function p(a){return new o(a)}class q{#u;#j;constructor(a,b){this.#u=a,this.#j=b}get expression(){return this.#u}get alias(){return this.#j}get rawBuilder(){return this.#u}toOperationNode(){return l.N.create(this.#u.toOperationNode(),(0,e.N)(this.#j)?this.#j.toOperationNode():d.O.create(this.#j))}}let r=Object.assign((a,...b)=>p({queryId:(0,k.a)(),rawNode:f.z.create(a,b?.map(s)??[])}),{ref:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,h.q5)(a))}),val:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,j.$s)(a))}),value(a){return this.val(a)},table:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild((0,i.M$)(a))}),id(...a){let b=Array(a.length+1).fill(".");return b[0]="",b[b.length-1]="",p({queryId:(0,k.a)(),rawNode:f.z.create(b,a.map(d.O.create))})},lit:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithChild(g.q.createImmediate(a))}),literal(a){return this.lit(a)},raw:a=>p({queryId:(0,k.a)(),rawNode:f.z.createWithSql(a)}),join(a,b=r`, `){let c=Array(Math.max(2*a.length-1,0)),d=b.toOperationNode();for(let b=0;b<a.length;++b)c[2*b]=s(a[b]),b!==a.length-1&&(c[2*b+1]=d);return p({queryId:(0,k.a)(),rawNode:f.z.createWithChildren(c)})}});function s(a){return(0,e.N)(a)?a.toOperationNode():(0,j.$s)(a)}},52376:(a,b,c)=>{c.d(b,{Yj:()=>f,zM:()=>g});var d=c(13148),e=c(42261);function f(a){return d.K_(e.ND,a)}function g(a){return d.dN(e.WF,a)}},52723:(a,b,c)=>{c.d(b,{AU:()=>m,B3:()=>B,DQ:()=>D,KJ:()=>w,KL:()=>s,ME:()=>F,Pe:()=>u,Q8:()=>h,RK:()=>A,RO:()=>o,RV:()=>r,Tq:()=>x,Uo:()=>k,eq:()=>i,gt:()=>n,kZ:()=>t,lt:()=>p,mj:()=>z,ne:()=>j,o8:()=>y,or:()=>l,q1:()=>C,t2:()=>v,wJ:()=>q,zy:()=>E});var d=c(98318),e=c(8575),f=c(7762),g=c(98708);function h(a,b){return!(0,g.eG)(b)||(0,g.qt)(a)||(0,e.is)(a,g.Iw)||(0,e.is)(a,g.Or)||(0,e.is)(a,d.V)||(0,e.is)(a,f.XI)||(0,e.is)(a,g.Ss)?a:new g.Iw(a,b)}let i=(a,b)=>(0,g.ll)`${a} = ${h(b,a)}`,j=(a,b)=>(0,g.ll)`${a} <> ${h(b,a)}`;function k(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" and ")),new g.DJ(")")])}function l(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new g.Xs(1===b.length?b:[new g.DJ("("),g.ll.join(b,new g.DJ(" or ")),new g.DJ(")")])}function m(a){return(0,g.ll)`not ${a}`}let n=(a,b)=>(0,g.ll)`${a} > ${h(b,a)}`,o=(a,b)=>(0,g.ll)`${a} >= ${h(b,a)}`,p=(a,b)=>(0,g.ll)`${a} < ${h(b,a)}`,q=(a,b)=>(0,g.ll)`${a} <= ${h(b,a)}`;function r(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`false`:(0,g.ll)`${a} in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} in ${h(b,a)}`}function s(a,b){return Array.isArray(b)?0===b.length?(0,g.ll)`true`:(0,g.ll)`${a} not in ${b.map(b=>h(b,a))}`:(0,g.ll)`${a} not in ${h(b,a)}`}function t(a){return(0,g.ll)`${a} is null`}function u(a){return(0,g.ll)`${a} is not null`}function v(a){return(0,g.ll)`exists ${a}`}function w(a){return(0,g.ll)`not exists ${a}`}function x(a,b,c){return(0,g.ll)`${a} between ${h(b,a)} and ${h(c,a)}`}function y(a,b,c){return(0,g.ll)`${a} not between ${h(b,a)} and ${h(c,a)}`}function z(a,b){return(0,g.ll)`${a} like ${b}`}function A(a,b){return(0,g.ll)`${a} not like ${b}`}function B(a,b){return(0,g.ll)`${a} ilike ${b}`}function C(a,b){return(0,g.ll)`${a} not ilike ${b}`}function D(a,b){if(Array.isArray(b)){if(0===b.length)throw Error("arrayContains requires at least one value");let c=(0,g.ll)`${h(b,a)}`;return(0,g.ll)`${a} @> ${c}`}return(0,g.ll)`${a} @> ${h(b,a)}`}function E(a,b){if(Array.isArray(b)){if(0===b.length)throw Error("arrayContained requires at least one value");let c=(0,g.ll)`${h(b,a)}`;return(0,g.ll)`${a} <@ ${c}`}return(0,g.ll)`${a} <@ ${h(b,a)}`}function F(a,b){if(Array.isArray(b)){if(0===b.length)throw Error("arrayOverlaps requires at least one value");let c=(0,g.ll)`${h(b,a)}`;return(0,g.ll)`${a} && ${c}`}return(0,g.ll)`${a} && ${h(b,a)}`}},53097:(a,b,c)=>{Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(63473),e=c(892),f=c(11);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},53410:(a,b,c)=>{c.d(b,{A:()=>m});var d=c(77598),e=c(79841),f=c(26407),g=c(66626),h=c(54983),i=c(86434),j=c(79288);new WeakMap;let k=(a,b)=>{let c;try{c=a instanceof d.KeyObject?a.asymmetricKeyDetails?.modulusLength:Buffer.from(a.n,"base64url").byteLength<<3}catch{}if("number"!=typeof c||c<2048)throw TypeError(`${b} requires key modulusLength to be 2048 bits or larger`)},l=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function m(a,b){let c,m,n,o;if(b instanceof d.KeyObject)c=b.asymmetricKeyType,m=b.asymmetricKeyDetails;else switch(n=!0,b.kty){case"RSA":c="rsa";break;case"EC":c="ec";break;case"OKP":if("Ed25519"===b.crv){c="ed25519";break}if("Ed448"===b.crv){c="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(a){case"Ed25519":if("ed25519"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(c))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");k(b,a);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===c){let{hashAlgorithm:b,mgf1HashAlgorithm:c,saltLength:d}=m,e=parseInt(a.slice(-3),10);if(void 0!==b&&(b!==`sha${e}`||c!==b))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${a}`);if(void 0!==d&&d>e>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${a}`)}else if("rsa"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");k(b,a),o={padding:d.constants.RSA_PKCS1_PSS_PADDING,saltLength:d.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let k=((a,b)=>{let c;if((0,f.R)(a))c=d.KeyObject.from(a);else if((0,g.A)(a))c=a;else if((0,j.ll)(a))return a.crv;else throw TypeError((0,h.A)(a,...i.g));if("secret"===c.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(c.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${c.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${c.asymmetricKeyType.slice(1)}`;case"ec":{let a=c.asymmetricKeyDetails.namedCurve;if(b)return a;switch(a){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new e.T0("Unsupported key curve for this operation")}}default:throw TypeError("Invalid asymmetric key type for this operation")}})(b),m=l.get(a);if(k!==m)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${m}, got ${k}`);o={dsaEncoding:"ieee-p1363"};break}default:throw new e.T0(`alg ${a} is not supported either by JOSE or your javascript runtime`)}return n?{format:"jwk",key:b,...o}:o?{...o,key:b}:b}},53628:(a,b,c)=>{c.d(b,{A:()=>l});var d=c(77598),e=c(26407);function f(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function g(a,b){return a.name===b}function h(a){return parseInt(a.name.slice(4),10)}var i=c(54983),j=c(86434),k=c(79288);function l(a,b,c){if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError((0,i.A)(b,...j.g));return(0,d.createSecretKey)(b)}if(b instanceof d.KeyObject)return b;if((0,e.R)(b))return!function(a,b,...c){switch(b){case"HS256":case"HS384":case"HS512":{if(!g(a.algorithm,"HMAC"))throw f("HMAC");let c=parseInt(b.slice(2),10);if(h(a.algorithm.hash)!==c)throw f(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!g(a.algorithm,"RSASSA-PKCS1-v1_5"))throw f("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(h(a.algorithm.hash)!==c)throw f(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!g(a.algorithm,"RSA-PSS"))throw f("RSA-PSS");let c=parseInt(b.slice(2),10);if(h(a.algorithm.hash)!==c)throw f(`SHA-${c}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==a.algorithm.name&&"Ed448"!==a.algorithm.name)throw f("Ed25519 or Ed448");break;case"Ed25519":if(!g(a.algorithm,"Ed25519"))throw f("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!g(a.algorithm,"ECDSA"))throw f("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw f(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(c.length&&!c.some(b=>a.usages.includes(b))){let a="CryptoKey does not support this operation, its usages must include ";if(c.length>2){let b=c.pop();a+=`one of ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of ${c[0]} or ${c[1]}.`:a+=`${c[0]}.`;throw TypeError(a)}}(b,a,c),d.KeyObject.from(b);if(k.ll(b))return a.startsWith("HS")?(0,d.createSecretKey)(Buffer.from(b.k,"base64url")):b;throw TypeError((0,i.A)(b,...j.g,"Uint8Array","JSON Web Key"))}},54983:(a,b,c)=>{function d(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}c.d(b,{A:()=>e,t:()=>f});let e=(a,...b)=>d("Key must be ",a,...b);function f(a,b,...c){return d(`Key for the ${a} algorithm must be `,b,...c)}},55298:(a,b,c)=>{c.d(b,{V:()=>e});var d=c(59659);class e{nodeStack=[];#v=(0,d.CN)({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),RenameConstraintNode:this.transformRenameConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),RefreshMaterializedViewNode:this.transformRefreshMaterializedView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this),OrActionNode:this.transformOrAction.bind(this),CollateNode:this.transformCollate.bind(this)});transformNode(a,b){if(!a)return a;this.nodeStack.push(a);let c=this.transformNodeImpl(a,b);return this.nodeStack.pop(),(0,d.CN)(c)}transformNodeImpl(a,b){return this.#v[a.kind](a,b)}transformNodeList(a,b){return a?(0,d.CN)(a.map(a=>this.transformNode(a,b))):a}transformSelectQuery(a,b){return{kind:"SelectQueryNode",from:this.transformNode(a.from,b),selections:this.transformNodeList(a.selections,b),distinctOn:this.transformNodeList(a.distinctOn,b),joins:this.transformNodeList(a.joins,b),groupBy:this.transformNode(a.groupBy,b),orderBy:this.transformNode(a.orderBy,b),where:this.transformNode(a.where,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),limit:this.transformNode(a.limit,b),offset:this.transformNode(a.offset,b),with:this.transformNode(a.with,b),having:this.transformNode(a.having,b),explain:this.transformNode(a.explain,b),setOperations:this.transformNodeList(a.setOperations,b),fetch:this.transformNode(a.fetch,b),top:this.transformNode(a.top,b)}}transformSelection(a,b){return{kind:"SelectionNode",selection:this.transformNode(a.selection,b)}}transformColumn(a,b){return{kind:"ColumnNode",column:this.transformNode(a.column,b)}}transformAlias(a,b){return{kind:"AliasNode",node:this.transformNode(a.node,b),alias:this.transformNode(a.alias,b)}}transformTable(a,b){return{kind:"TableNode",table:this.transformNode(a.table,b)}}transformFrom(a,b){return{kind:"FromNode",froms:this.transformNodeList(a.froms,b)}}transformReference(a,b){return{kind:"ReferenceNode",column:this.transformNode(a.column,b),table:this.transformNode(a.table,b)}}transformAnd(a,b){return{kind:"AndNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformOr(a,b){return{kind:"OrNode",left:this.transformNode(a.left,b),right:this.transformNode(a.right,b)}}transformValueList(a,b){return{kind:"ValueListNode",values:this.transformNodeList(a.values,b)}}transformParens(a,b){return{kind:"ParensNode",node:this.transformNode(a.node,b)}}transformJoin(a,b){return{kind:"JoinNode",joinType:a.joinType,table:this.transformNode(a.table,b),on:this.transformNode(a.on,b)}}transformRaw(a,b){return{kind:"RawNode",sqlFragments:(0,d.CN)([...a.sqlFragments]),parameters:this.transformNodeList(a.parameters,b)}}transformWhere(a,b){return{kind:"WhereNode",where:this.transformNode(a.where,b)}}transformInsertQuery(a,b){return{kind:"InsertQueryNode",into:this.transformNode(a.into,b),columns:this.transformNodeList(a.columns,b),values:this.transformNode(a.values,b),returning:this.transformNode(a.returning,b),onConflict:this.transformNode(a.onConflict,b),onDuplicateKey:this.transformNode(a.onDuplicateKey,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),ignore:a.ignore,orAction:this.transformNode(a.orAction,b),replace:a.replace,explain:this.transformNode(a.explain,b),defaultValues:a.defaultValues,top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformValues(a,b){return{kind:"ValuesNode",values:this.transformNodeList(a.values,b)}}transformDeleteQuery(a,b){return{kind:"DeleteQueryNode",from:this.transformNode(a.from,b),using:this.transformNode(a.using,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),orderBy:this.transformNode(a.orderBy,b),limit:this.transformNode(a.limit,b),explain:this.transformNode(a.explain,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b)}}transformReturning(a,b){return{kind:"ReturningNode",selections:this.transformNodeList(a.selections,b)}}transformCreateTable(a,b){return{kind:"CreateTableNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),constraints:this.transformNodeList(a.constraints,b),temporary:a.temporary,ifNotExists:a.ifNotExists,onCommit:a.onCommit,frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),selectQuery:this.transformNode(a.selectQuery,b)}}transformColumnDefinition(a,b){return{kind:"ColumnDefinitionNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),references:this.transformNode(a.references,b),primaryKey:a.primaryKey,autoIncrement:a.autoIncrement,unique:a.unique,notNull:a.notNull,unsigned:a.unsigned,defaultTo:this.transformNode(a.defaultTo,b),check:this.transformNode(a.check,b),generated:this.transformNode(a.generated,b),frontModifiers:this.transformNodeList(a.frontModifiers,b),endModifiers:this.transformNodeList(a.endModifiers,b),nullsNotDistinct:a.nullsNotDistinct,identity:a.identity,ifNotExists:a.ifNotExists}}transformAddColumn(a,b){return{kind:"AddColumnNode",column:this.transformNode(a.column,b)}}transformDropTable(a,b){return{kind:"DropTableNode",table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformOrderBy(a,b){return{kind:"OrderByNode",items:this.transformNodeList(a.items,b)}}transformOrderByItem(a,b){return{kind:"OrderByItemNode",orderBy:this.transformNode(a.orderBy,b),direction:this.transformNode(a.direction,b),collation:this.transformNode(a.collation,b),nulls:a.nulls}}transformGroupBy(a,b){return{kind:"GroupByNode",items:this.transformNodeList(a.items,b)}}transformGroupByItem(a,b){return{kind:"GroupByItemNode",groupBy:this.transformNode(a.groupBy,b)}}transformUpdateQuery(a,b){return{kind:"UpdateQueryNode",table:this.transformNode(a.table,b),from:this.transformNode(a.from,b),joins:this.transformNodeList(a.joins,b),where:this.transformNode(a.where,b),updates:this.transformNodeList(a.updates,b),returning:this.transformNode(a.returning,b),endModifiers:this.transformNodeList(a.endModifiers,b),with:this.transformNode(a.with,b),explain:this.transformNode(a.explain,b),limit:this.transformNode(a.limit,b),top:this.transformNode(a.top,b),output:this.transformNode(a.output,b),orderBy:this.transformNode(a.orderBy,b)}}transformColumnUpdate(a,b){return{kind:"ColumnUpdateNode",column:this.transformNode(a.column,b),value:this.transformNode(a.value,b)}}transformLimit(a,b){return{kind:"LimitNode",limit:this.transformNode(a.limit,b)}}transformOffset(a,b){return{kind:"OffsetNode",offset:this.transformNode(a.offset,b)}}transformOnConflict(a,b){return{kind:"OnConflictNode",columns:this.transformNodeList(a.columns,b),constraint:this.transformNode(a.constraint,b),indexExpression:this.transformNode(a.indexExpression,b),indexWhere:this.transformNode(a.indexWhere,b),updates:this.transformNodeList(a.updates,b),updateWhere:this.transformNode(a.updateWhere,b),doNothing:a.doNothing}}transformOnDuplicateKey(a,b){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(a.updates,b)}}transformCreateIndex(a,b){return{kind:"CreateIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists,where:this.transformNode(a.where,b),nullsNotDistinct:a.nullsNotDistinct}}transformList(a,b){return{kind:"ListNode",items:this.transformNodeList(a.items,b)}}transformDropIndex(a,b){return{kind:"DropIndexNode",name:this.transformNode(a.name,b),table:this.transformNode(a.table,b),ifExists:a.ifExists,cascade:a.cascade}}transformPrimaryKeyConstraint(a,b){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformUniqueConstraint(a,b){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(a.columns,b),name:this.transformNode(a.name,b),nullsNotDistinct:a.nullsNotDistinct,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformForeignKeyConstraint(a,b){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(a.columns,b),references:this.transformNode(a.references,b),name:this.transformNode(a.name,b),onDelete:a.onDelete,onUpdate:a.onUpdate,deferrable:a.deferrable,initiallyDeferred:a.initiallyDeferred}}transformSetOperation(a,b){return{kind:"SetOperationNode",operator:a.operator,expression:this.transformNode(a.expression,b),all:a.all}}transformReferences(a,b){return{kind:"ReferencesNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b),onDelete:a.onDelete,onUpdate:a.onUpdate}}transformCheckConstraint(a,b){return{kind:"CheckConstraintNode",expression:this.transformNode(a.expression,b),name:this.transformNode(a.name,b)}}transformWith(a,b){return{kind:"WithNode",expressions:this.transformNodeList(a.expressions,b),recursive:a.recursive}}transformCommonTableExpression(a,b){return{kind:"CommonTableExpressionNode",name:this.transformNode(a.name,b),materialized:a.materialized,expression:this.transformNode(a.expression,b)}}transformCommonTableExpressionName(a,b){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(a.table,b),columns:this.transformNodeList(a.columns,b)}}transformHaving(a,b){return{kind:"HavingNode",having:this.transformNode(a.having,b)}}transformCreateSchema(a,b){return{kind:"CreateSchemaNode",schema:this.transformNode(a.schema,b),ifNotExists:a.ifNotExists}}transformDropSchema(a,b){return{kind:"DropSchemaNode",schema:this.transformNode(a.schema,b),ifExists:a.ifExists,cascade:a.cascade}}transformAlterTable(a,b){return{kind:"AlterTableNode",table:this.transformNode(a.table,b),renameTo:this.transformNode(a.renameTo,b),setSchema:this.transformNode(a.setSchema,b),columnAlterations:this.transformNodeList(a.columnAlterations,b),addConstraint:this.transformNode(a.addConstraint,b),dropConstraint:this.transformNode(a.dropConstraint,b),renameConstraint:this.transformNode(a.renameConstraint,b),addIndex:this.transformNode(a.addIndex,b),dropIndex:this.transformNode(a.dropIndex,b)}}transformDropColumn(a,b){return{kind:"DropColumnNode",column:this.transformNode(a.column,b)}}transformRenameColumn(a,b){return{kind:"RenameColumnNode",column:this.transformNode(a.column,b),renameTo:this.transformNode(a.renameTo,b)}}transformAlterColumn(a,b){return{kind:"AlterColumnNode",column:this.transformNode(a.column,b),dataType:this.transformNode(a.dataType,b),dataTypeExpression:this.transformNode(a.dataTypeExpression,b),setDefault:this.transformNode(a.setDefault,b),dropDefault:a.dropDefault,setNotNull:a.setNotNull,dropNotNull:a.dropNotNull}}transformModifyColumn(a,b){return{kind:"ModifyColumnNode",column:this.transformNode(a.column,b)}}transformAddConstraint(a,b){return{kind:"AddConstraintNode",constraint:this.transformNode(a.constraint,b)}}transformDropConstraint(a,b){return{kind:"DropConstraintNode",constraintName:this.transformNode(a.constraintName,b),ifExists:a.ifExists,modifier:a.modifier}}transformRenameConstraint(a,b){return{kind:"RenameConstraintNode",oldName:this.transformNode(a.oldName,b),newName:this.transformNode(a.newName,b)}}transformCreateView(a,b){return{kind:"CreateViewNode",name:this.transformNode(a.name,b),temporary:a.temporary,orReplace:a.orReplace,ifNotExists:a.ifNotExists,materialized:a.materialized,columns:this.transformNodeList(a.columns,b),as:this.transformNode(a.as,b)}}transformRefreshMaterializedView(a,b){return{kind:"RefreshMaterializedViewNode",name:this.transformNode(a.name,b),concurrently:a.concurrently,withNoData:a.withNoData}}transformDropView(a,b){return{kind:"DropViewNode",name:this.transformNode(a.name,b),ifExists:a.ifExists,materialized:a.materialized,cascade:a.cascade}}transformGenerated(a,b){return{kind:"GeneratedNode",byDefault:a.byDefault,always:a.always,identity:a.identity,stored:a.stored,expression:this.transformNode(a.expression,b)}}transformDefaultValue(a,b){return{kind:"DefaultValueNode",defaultValue:this.transformNode(a.defaultValue,b)}}transformOn(a,b){return{kind:"OnNode",on:this.transformNode(a.on,b)}}transformSelectModifier(a,b){return{kind:"SelectModifierNode",modifier:a.modifier,rawModifier:this.transformNode(a.rawModifier,b),of:this.transformNodeList(a.of,b)}}transformCreateType(a,b){return{kind:"CreateTypeNode",name:this.transformNode(a.name,b),enum:this.transformNode(a.enum,b)}}transformDropType(a,b){return{kind:"DropTypeNode",name:this.transformNode(a.name,b),ifExists:a.ifExists}}transformExplain(a,b){return{kind:"ExplainNode",format:a.format,options:this.transformNode(a.options,b)}}transformSchemableIdentifier(a,b){return{kind:"SchemableIdentifierNode",schema:this.transformNode(a.schema,b),identifier:this.transformNode(a.identifier,b)}}transformAggregateFunction(a,b){return{kind:"AggregateFunctionNode",func:a.func,aggregated:this.transformNodeList(a.aggregated,b),distinct:a.distinct,orderBy:this.transformNode(a.orderBy,b),withinGroup:this.transformNode(a.withinGroup,b),filter:this.transformNode(a.filter,b),over:this.transformNode(a.over,b)}}transformOver(a,b){return{kind:"OverNode",orderBy:this.transformNode(a.orderBy,b),partitionBy:this.transformNode(a.partitionBy,b)}}transformPartitionBy(a,b){return{kind:"PartitionByNode",items:this.transformNodeList(a.items,b)}}transformPartitionByItem(a,b){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(a.partitionBy,b)}}transformBinaryOperation(a,b){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(a.leftOperand,b),operator:this.transformNode(a.operator,b),rightOperand:this.transformNode(a.rightOperand,b)}}transformUnaryOperation(a,b){return{kind:"UnaryOperationNode",operator:this.transformNode(a.operator,b),operand:this.transformNode(a.operand,b)}}transformUsing(a,b){return{kind:"UsingNode",tables:this.transformNodeList(a.tables,b)}}transformFunction(a,b){return{kind:"FunctionNode",func:a.func,arguments:this.transformNodeList(a.arguments,b)}}transformCase(a,b){return{kind:"CaseNode",value:this.transformNode(a.value,b),when:this.transformNodeList(a.when,b),else:this.transformNode(a.else,b),isStatement:a.isStatement}}transformWhen(a,b){return{kind:"WhenNode",condition:this.transformNode(a.condition,b),result:this.transformNode(a.result,b)}}transformJSONReference(a,b){return{kind:"JSONReferenceNode",reference:this.transformNode(a.reference,b),traversal:this.transformNode(a.traversal,b)}}transformJSONPath(a,b){return{kind:"JSONPathNode",inOperator:this.transformNode(a.inOperator,b),pathLegs:this.transformNodeList(a.pathLegs,b)}}transformJSONPathLeg(a,b){return{kind:"JSONPathLegNode",type:a.type,value:a.value}}transformJSONOperatorChain(a,b){return{kind:"JSONOperatorChainNode",operator:this.transformNode(a.operator,b),values:this.transformNodeList(a.values,b)}}transformTuple(a,b){return{kind:"TupleNode",values:this.transformNodeList(a.values,b)}}transformMergeQuery(a,b){return{kind:"MergeQueryNode",into:this.transformNode(a.into,b),using:this.transformNode(a.using,b),whens:this.transformNodeList(a.whens,b),with:this.transformNode(a.with,b),top:this.transformNode(a.top,b),endModifiers:this.transformNodeList(a.endModifiers,b),output:this.transformNode(a.output,b),returning:this.transformNode(a.returning,b)}}transformMatched(a,b){return{kind:"MatchedNode",not:a.not,bySource:a.bySource}}transformAddIndex(a,b){return{kind:"AddIndexNode",name:this.transformNode(a.name,b),columns:this.transformNodeList(a.columns,b),unique:a.unique,using:this.transformNode(a.using,b),ifNotExists:a.ifNotExists}}transformCast(a,b){return{kind:"CastNode",expression:this.transformNode(a.expression,b),dataType:this.transformNode(a.dataType,b)}}transformFetch(a,b){return{kind:"FetchNode",rowCount:this.transformNode(a.rowCount,b),modifier:a.modifier}}transformTop(a,b){return{kind:"TopNode",expression:a.expression,modifiers:a.modifiers}}transformOutput(a,b){return{kind:"OutputNode",selections:this.transformNodeList(a.selections,b)}}transformDataType(a,b){return a}transformSelectAll(a,b){return a}transformIdentifier(a,b){return a}transformValue(a,b){return a}transformPrimitiveValueList(a,b){return a}transformOperator(a,b){return a}transformDefaultInsertValue(a,b){return a}transformOrAction(a,b){return a}transformCollate(a,b){return a}}},57727:(a,b,c)=>{c.d(b,{G:()=>f});var d=c(16151),e=c(59659);async function f(a){let b=new d.c,c=new d.c;return a.provideConnection(async a=>(b.resolve(a),await c.promise)).catch(a=>b.reject(a)),(0,e.CN)({connection:await b.promise,release:c.resolve})}},58054:(a,b,c)=>{function d(a){let b=Object.values(a).filter(a=>"number"==typeof a);return Object.entries(a).filter(([a,c])=>-1===b.indexOf(+a)).map(([a,b])=>b)}function e(a,b){return"bigint"==typeof b?b.toString():b}function f(a){return{get value(){{let b=a();return Object.defineProperty(this,"value",{value:b}),b}}}}function g(a){return null==a}function h(a){let b=+!!a.startsWith("^"),c=a.endsWith("$")?a.length-1:a.length;return a.slice(b,c)}function i(a,b){let c=(a.toString().split(".")[1]||"").length,d=b.toString(),e=(d.split(".")[1]||"").length;if(0===e&&/\d?e-\d?/.test(d)){let a=d.match(/\d?e-(\d?)/);a?.[1]&&(e=Number.parseInt(a[1]))}let f=c>e?c:e;return Number.parseInt(a.toFixed(f).replace(".",""))%Number.parseInt(b.toFixed(f).replace(".",""))/10**f}c.d(b,{$f:()=>v,A2:()=>x,Gv:()=>q,LG:()=>i,NM:()=>y,OH:()=>E,PO:()=>f,QH:()=>G,Qd:()=>s,Rc:()=>K,UQ:()=>o,Up:()=>A,Vy:()=>m,X$:()=>C,ZV:()=>l,cJ:()=>B,cl:()=>g,gJ:()=>k,gx:()=>p,h1:()=>D,hI:()=>r,iR:()=>J,k8:()=>e,lQ:()=>H,mw:()=>F,o8:()=>w,p6:()=>h,qQ:()=>u,sn:()=>L,w5:()=>d,yG:()=>t,zH:()=>z});let j=Symbol("evaluating");function k(a,b,c){let d;Object.defineProperty(a,b,{get(){if(d!==j)return void 0===d&&(d=j,d=c()),d},set(c){Object.defineProperty(a,b,{value:c})},configurable:!0})}function l(a){return Object.create(Object.getPrototypeOf(a),Object.getOwnPropertyDescriptors(a))}function m(a,b,c){Object.defineProperty(a,b,{value:c,writable:!0,enumerable:!0,configurable:!0})}function n(...a){let b={};for(let c of a)Object.assign(b,Object.getOwnPropertyDescriptors(c));return Object.defineProperties({},b)}function o(a){return JSON.stringify(a)}let p="captureStackTrace"in Error?Error.captureStackTrace:(...a)=>{};function q(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}let r=f(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(a){return!1}});function s(a){if(!1===q(a))return!1;let b=a.constructor;if(void 0===b)return!0;let c=b.prototype;return!1!==q(c)&&!1!==Object.prototype.hasOwnProperty.call(c,"isPrototypeOf")}function t(a){return s(a)?{...a}:a}let u=new Set(["string","number","symbol"]);function v(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function w(a,b,c){let d=new a._zod.constr(b??a._zod.def);return(!b||c?.parent)&&(d._zod.parent=a),d}function x(a){if(!a)return{};if("string"==typeof a)return{error:()=>a};if(a?.message!==void 0){if(a?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");a.error=a.message}return(delete a.message,"string"==typeof a.error)?{...a,error:()=>a.error}:a}function y(a){return Object.keys(a).filter(b=>"optional"===a[b]._zod.optin&&"optional"===a[b]._zod.optout)}let z={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function A(a,b){let c=a._zod.def,d=n(a._zod.def,{get shape(){let a={};for(let d in b){if(!(d in c.shape))throw Error(`Unrecognized key: "${d}"`);b[d]&&(a[d]=c.shape[d])}return m(this,"shape",a),a},checks:[]});return w(a,d)}function B(a,b){let c=a._zod.def,d=n(a._zod.def,{get shape(){let d={...a._zod.def.shape};for(let a in b){if(!(a in c.shape))throw Error(`Unrecognized key: "${a}"`);b[a]&&delete d[a]}return m(this,"shape",d),d},checks:[]});return w(a,d)}function C(a,b){if(!s(b))throw Error("Invalid input to extend: expected a plain object");let c=n(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b};return m(this,"shape",c),c},checks:[]});return w(a,c)}function D(a,b){let c=n(a._zod.def,{get shape(){let c={...a._zod.def.shape,...b._zod.def.shape};return m(this,"shape",c),c},get catchall(){return b._zod.def.catchall},checks:[]});return w(a,c)}function E(a,b,c){let d=n(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in d))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=a?new a({type:"optional",innerType:d[b]}):d[b])}else for(let b in d)e[b]=a?new a({type:"optional",innerType:d[b]}):d[b];return m(this,"shape",e),e},checks:[]});return w(b,d)}function F(a,b,c){let d=n(b._zod.def,{get shape(){let d=b._zod.def.shape,e={...d};if(c)for(let b in c){if(!(b in e))throw Error(`Unrecognized key: "${b}"`);c[b]&&(e[b]=new a({type:"nonoptional",innerType:d[b]}))}else for(let b in d)e[b]=new a({type:"nonoptional",innerType:d[b]});return m(this,"shape",e),e},checks:[]});return w(b,d)}function G(a,b=0){for(let c=b;c<a.issues.length;c++)if(a.issues[c]?.continue!==!0)return!0;return!1}function H(a,b){return b.map(b=>(b.path??(b.path=[]),b.path.unshift(a),b))}function I(a){return"string"==typeof a?a:a?.message}function J(a,b,c){let d={...a,path:a.path??[]};return a.message||(d.message=I(a.inst?._zod.def?.error?.(a))??I(b?.error?.(a))??I(c.customError?.(a))??I(c.localeError?.(a))??"Invalid input"),delete d.inst,delete d.continue,b?.reportInput||delete d.input,d}function K(a){return Array.isArray(a)?"array":"string"==typeof a?"string":"unknown"}function L(...a){let[b,c,d]=a;return"string"==typeof b?{message:b,code:"custom",input:c,inst:d}:{...b}}},58077:(a,b,c)=>{c.d(b,{B:()=>m});var d=c(15539),e=c(44344),f=c(42517),g=c(55298),h=c(87197),i=c(2059);let j=(0,c(59659).CN)({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,RefreshMaterializedViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0}),k={json_agg:!0,to_json:!0};class l extends g.V{#w;#x=new Set;#y=new Set;constructor(a){super(),this.#w=a}transformNodeImpl(a,b){if(!this.#z(a))return super.transformNodeImpl(a,b);let c=this.#A(a);for(let a of c)this.#y.add(a);let d=this.#B(a);for(let a of d)this.#x.add(a);let e=super.transformNodeImpl(a,b);for(let a of d)this.#x.delete(a);for(let a of c)this.#y.delete(a);return e}transformSchemableIdentifier(a,b){let c=super.transformSchemableIdentifier(a,b);return c.schema||!this.#x.has(a.identifier.name)?c:{...c,schema:e.O.create(this.#w)}}transformReferences(a,b){let c=super.transformReferences(a,b);return c.table.table.schema?c:{...c,table:i.H.createWithSchema(this.#w,c.table.table.identifier.name)}}transformAggregateFunction(a,b){return{...super.transformAggregateFunction({...a,aggregated:[]},b),aggregated:this.#C(a,b,"aggregated")}}transformFunction(a,b){return{...super.transformFunction({...a,arguments:[]},b),arguments:this.#C(a,b,"arguments")}}#C(a,b,c){return k[a.func]?a[c].map(a=>!i.H.is(a)||a.table.schema?this.transformNode(a,b):{...a,table:this.transformIdentifier(a.table.identifier,b)}):this.transformNodeList(a[c],b)}#z(a){return a.kind in j}#B(a){let b=new Set;if("name"in a&&a.name&&h.y.is(a.name)&&this.#D(a.name,b),"from"in a&&a.from)for(let c of a.from.froms)this.#E(c,b);if("into"in a&&a.into&&this.#E(a.into,b),"table"in a&&a.table&&this.#E(a.table,b),"joins"in a&&a.joins)for(let c of a.joins)this.#E(c.table,b);return"using"in a&&a.using&&this.#E(a.using,b),b}#A(a){let b=new Set;return"with"in a&&a.with&&this.#F(a.with,b),b}#E(a,b){if(i.H.is(a))this.#D(a.table,b);else if(d.N.is(a)&&i.H.is(a.node))this.#D(a.node.table,b);else if(f.v.is(a))for(let c of a.items)this.#E(c,b)}#D(a,b){let c=a.identifier.name;this.#x.has(c)||this.#y.has(c)||b.add(c)}#F(a,b){for(let c of a.expressions){let a=c.name.table.table.identifier.name;this.#y.has(a)||b.add(a)}}}class m{#G;constructor(a){this.#G=new l(a)}transformQuery(a){return this.#G.transformNode(a.node,a.queryId)}async transformResult(a){return a.result}}},58436:(a,b,c)=>{c.d(b,{s:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"AndNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"AndNode",left:a,right:b})})},58586:(a,b,c)=>{c.d(b,{A:()=>au});var d=c(21820),e=c(29021);let f=new Map,g=new Map,h=Symbol("OriginError"),i={};class j extends Promise{constructor(a,b,c,d,e={}){let g,i;super((a,b)=>{g=a,i=b}),this.tagged=Array.isArray(a.raw),this.strings=a,this.args=b,this.handler=c,this.canceller=d,this.options=e,this.state=null,this.statement=null,this.resolve=a=>(this.active=!1,g(a)),this.reject=a=>(this.active=!1,i(a)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[h]=this.handler.debug?Error():this.tagged&&function(a){if(f.has(a))return f.get(a);let b=Error.stackTraceLimit;return Error.stackTraceLimit=4,f.set(a,Error()),Error.stackTraceLimit=b,f.get(a)}(this.strings)}get origin(){return(this.handler.debug?this[h].stack:this.tagged&&g.has(this.strings)?g.get(this.strings):g.set(this.strings,this[h].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(a=1,b){let c;return(this.options.simple=!1,"function"==typeof a&&(b=a,a=1),this.cursorRows=a,"function"==typeof b)?(this.cursorFn=b,this):{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};c&&c();let a=new Promise((a,b)=>{this.cursorFn=b=>(a({value:b,done:!1}),new Promise(a=>c=a)),this.resolve=()=>(this.active=!1,a({done:!0})),this.reject=a=>(this.active=!1,b(a))});return this.execute(),a},return:()=>(c&&c(i),{done:!0})})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw Error(".stream has been renamed to .forEach")}forEach(a){return this.forEachFn=a,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}class k extends Error{constructor(a){super(a.message),this.name=this.constructor.name,Object.assign(this,a)}}let l={connection:function a(b,c,d){let{host:e,port:f}=d||c,g=Object.assign(Error("write "+b+" "+(c.path||e+":"+f)),{code:b,errno:b,address:c.path||e},c.path?{}:{port:f});return Error.captureStackTrace(g,a),g},postgres:function a(b){let c=new k(b);return Error.captureStackTrace(c,a),c},generic:function a(b,c){let d=Object.assign(Error(b+": "+c),{code:b});return Error.captureStackTrace(d,a),d},notSupported:function a(b){let c=Object.assign(Error(b+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:b});return Error.captureStackTrace(c,a),c}};class m{then(){z()}catch(){z()}finally(){z()}}class n extends m{constructor(a){super(),this.value=F(a)}}class o extends m{constructor(a,b,c){super(),this.value=a,this.type=b,this.array=c}}class p extends m{constructor(a,b){super(),this.first=a,this.rest=b}build(a,b,c,d){let e=y.map(([b,c])=>({fn:c,i:a.search(b)})).sort((a,b)=>a.i-b.i).pop();return -1===e.i?E(this.first,d):e.fn(this.first,this.rest,b,c,d)}}function q(a,b,c,d){let e=a instanceof o?a.value:a;if(void 0===e&&(a instanceof o?a.value=d.transform.undefined:e=a=d.transform.undefined,void 0===e))throw l.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+c.push(a instanceof o?(b.push(a.value),a.array?a.array[a.type||G(a.value)]||a.type||function a(b){return Array.isArray(b)?a(b[0]):1009*("string"==typeof b)}(a.value):a.type):(b.push(a),G(a)))}let r=D({string:{to:25,from:null,serialize:a=>""+a},number:{to:0,from:[21,23,26,700,701],serialize:a=>""+a,parse:a=>+a},json:{to:114,from:[114,3802],serialize:a=>JSON.stringify(a),parse:a=>JSON.parse(a)},boolean:{to:16,from:16,serialize:a=>!0===a?"t":"f",parse:a=>"t"===a},date:{to:1184,from:[1082,1114,1184],serialize:a=>(a instanceof Date?a:new Date(a)).toISOString(),parse:a=>new Date(a)},bytea:{to:17,from:17,serialize:a=>"\\x"+Buffer.from(a).toString("hex"),parse:a=>Buffer.from(a.slice(2),"hex")}});function s(a,b,c,d,e,f){for(let g=1;g<a.strings.length;g++)b+=t(b,c,d,e,f)+a.strings[g],c=a.args[g];return b}function t(a,b,c,d,e){return b instanceof p?b.build(a,c,d,e):b instanceof j?u(b,c,d,e):b instanceof n?b.value:b&&b[0]instanceof j?b.reduce((a,b)=>a+" "+u(b,c,d,e),""):q(b,c,d,e)}function u(a,b,c,d){return a.fragment=!0,s(a,a.strings[0],a.args[0],b,c,d)}function v(a,b,c,d,e){return a.map(a=>"("+d.map(d=>t("values",a[d],b,c,e)).join(",")+")").join(",")}function w(a,b,c,d,e){let f=Array.isArray(a[0]),g=b.length?b.flat():Object.keys(f?a[0]:a);return v(f?a:[a],c,d,g,e)}function x(a,b,c,d,e){let f;return("string"==typeof a&&(a=[a].concat(b)),Array.isArray(a))?E(a,e):(b.length?b.flat():Object.keys(a)).map(b=>((f=a[b])instanceof j?u(f,c,d,e):f instanceof n?f.value:q(f,c,d,e))+" as "+F(e.transform.column.to?e.transform.column.to(b):b)).join(",")}let y=Object.entries({values:w,in:(...a)=>{let b=w(...a);return"()"===b?"(null)":b},select:x,as:x,returning:x,"\\(":x,update:(a,b,c,d,e)=>(b.length?b.flat():Object.keys(a)).map(b=>F(e.transform.column.to?e.transform.column.to(b):b)+"="+t("values",a[b],c,d,e)),insert(a,b,c,d,e){let f=b.length?b.flat():Object.keys(Array.isArray(a)?a[0]:a);return"("+E(f,e)+")values"+v(Array.isArray(a)?a:[a],c,d,f,e)}}).map(([a,b])=>[RegExp("((?:^|[\\s(])"+a+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),b]);function z(){throw l.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}let A=r.serializers,B=r.parsers,C=function(a){let b=D(a||{});return{serializers:Object.assign({},A,b.serializers),parsers:Object.assign({},B,b.parsers)}};function D(a){return Object.keys(a).reduce((b,c)=>(a[c].from&&[].concat(a[c].from).forEach(d=>b.parsers[d]=a[c].parse),a[c].serialize&&(b.serializers[a[c].to]=a[c].serialize,a[c].from&&[].concat(a[c].from).forEach(d=>b.serializers[d]=a[c].serialize)),b),{parsers:{},serializers:{}})}function E(a,{transform:{column:b}}){return a.map(a=>F(b.to?b.to(a):a)).join(",")}let F=function(a){return'"'+a.replace(/"/g,'""').replace(/\./g,'"."')+'"'},G=function a(b){return b instanceof o?b.type:b instanceof Date?1184:b instanceof Uint8Array?17:!0===b||!1===b?16:"bigint"==typeof b?20:Array.isArray(b)?a(b[0]):0},H=/\\/g,I=/"/g,J=function a(b,c,d,e){if(!1===Array.isArray(b))return b;if(!b.length)return"{}";let f=b[0],g=1020===e?";":",";return Array.isArray(f)&&!f.type?"{"+b.map(b=>a(b,c,d,e)).join(g)+"}":"{"+b.map(a=>{if(void 0===a&&void 0===(a=d.transform.undefined))throw l.generic("UNDEFINED_VALUE","Undefined values are not allowed");return null===a?"null":'"'+(c?c(a.type?a.value:a):""+a).replace(H,"\\\\").replace(I,'\\"')+'"'}).join(g)+"}"},K={i:0,char:null,str:"",quoted:!1,last:0},L=a=>{let b=a[0];for(let c=1;c<a.length;c++)b+="_"===a[c]?a[++c].toUpperCase():a[c];return b},M=a=>{let b=a[0].toUpperCase();for(let c=1;c<a.length;c++)b+="_"===a[c]?a[++c].toUpperCase():a[c];return b},N=a=>a.replace(/_/g,"-"),O=a=>a.replace(/([A-Z])/g,"_$1").toLowerCase(),P=a=>(a.slice(0,1)+a.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),Q=a=>a.replace(/-/g,"_");function R(a){return function b(c,d){return"object"==typeof c&&null!==c&&(114===d.type||3802===d.type)?Array.isArray(c)?c.map(a=>b(a,d)):Object.entries(c).reduce((c,[e,f])=>Object.assign(c,{[a(e)]:b(f,d)}),{}):c}}L.column={from:L},L.value={from:R(L)},O.column={to:O};let S={...L};S.column.to=O,M.column={from:M},M.value={from:R(M)},P.column={to:P};let T={...M};T.column.to=P,N.column={from:N},N.value={from:R(N)},Q.column={to:Q};let U={...N};U.column.to=Q;var V=c(91645),W=c(34631),X=c(55511),Y=c(27910),Z=c(74998);class $ extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}let _=function(a=[]){let b=a.slice(),c=0;return{get length(){return b.length-c},remove:a=>{let c=b.indexOf(a);return -1===c?null:(b.splice(c,1),a)},push:a=>(b.push(a),a),shift:()=>{let a=b[c++];return c===b.length?(c=0,b=[]):b[c-1]=void 0,a}}},aa=Buffer.allocUnsafe(256),ab=Object.assign(function(){return ab.i=0,ab},"BCcDdEFfHPpQSX".split("").reduce((a,b)=>{let c=b.charCodeAt(0);return a[b]=()=>(aa[0]=c,ab.i=5,ab),a},{}),{N:"\0",i:0,inc:a=>(ab.i+=a,ab),str(a){let b=Buffer.byteLength(a);return ac(b),ab.i+=aa.write(a,ab.i,b,"utf8"),ab},i16:a=>(ac(2),aa.writeUInt16BE(a,ab.i),ab.i+=2,ab),i32:(a,b)=>(b||0===b?aa.writeUInt32BE(a,b):(ac(4),aa.writeUInt32BE(a,ab.i),ab.i+=4),ab),z:a=>(ac(a),aa.fill(0,ab.i,ab.i+a),ab.i+=a,ab),raw:a=>(aa=Buffer.concat([aa.subarray(0,ab.i),a]),ab.i=aa.length,ab),end(a=1){aa.writeUInt32BE(ab.i-a,a);let b=aa.subarray(0,ab.i);return ab.i=0,aa=Buffer.allocUnsafe(256),b}});function ac(a){if(aa.length-ab.i<a){let b=aa,c=b.length;aa=Buffer.allocUnsafe(c+(c>>1)+a),b.copy(aa)}}let ad=function a(b,c={},{onopen:d=ak,onend:e=ak,onclose:f=ak}={}){let{ssl:g,max:h,user:k,host:m,port:n,database:o,parsers:p,transform:r,onnotice:t,onnotify:u,onparameter:v,max_pipeline:w,keep_alive:x,backoff:y,target_session_attrs:z}=b,A=_(),B=ae++,C={pid:null,secret:null},D=aq(aU,b.idle_timeout),E=aq(aU,b.max_lifetime),F=aq(function(){aS(l.connection("CONNECT_TIMEOUT",b,G)),G.destroy()},b.connect_timeout),G=null,H,I=new $,L=Buffer.alloc(0),M=b.fetch_types,N={},O={},P=Math.random().toString(36).slice(2),Q=1,R=0,S=0,T=0,U=0,aa=0,ac=0,ad=0,am=null,ar=null,as=!1,at=null,au=null,av=null,aw=null,ax=null,ay=null,az=null,aA=null,aB=null,aC=null,aD={queue:c.closed,idleTimer:D,connect(a){av=a,aP()},terminate:aV,execute:aG,cancel:aF,end:aU,count:0,id:B};return c.closed&&c.closed.push(aD),aD;async function aE(){let a;try{a=b.socket?await Promise.resolve(b.socket(b)):new V.Socket}catch(a){aR(a);return}return a.on("error",aR),a.on("close",aW),a.on("drain",aM),a}async function aF({pid:a,secret:b},c,d){try{H=ab().i32(16).i32(0x4d2162e).i32(a).i32(b).end(16),await aO(),G.once("error",d),G.once("close",c)}catch(a){d(a)}}function aG(a){if(as)return aT(a,l.connection("CONNECTION_DESTROYED",b));if(!a.cancelled)try{return a.state=C,aB?A.push(a):(aB=a).active=!0,function(a){let c=[],d=[],e=s(a,a.strings[0],a.args[0],c,d,b);a.tagged||a.args.forEach(a=>q(a,c,d,b)),a.prepare=b.prepare&&(!("prepare"in a.options)||a.options.prepare),a.string=e,a.signature=a.prepare&&d+e,a.onlyDescribe&&delete O[a.signature],a.parameters=a.parameters||c,a.prepared=a.prepare&&a.signature in O,a.describeFirst=a.onlyDescribe||c.length&&!a.prepared,a.statement=a.prepared?O[a.signature]:{string:e,types:d,name:a.prepare?P+Q++:""},"function"==typeof b.debug&&b.debug(B,e,c,d)}(a),aJ(function(a){var b;if(a.parameters.length>=65534)throw l.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return a.options.simple?ab().Q().str(a.statement.string+ab.N).end():a.describeFirst?Buffer.concat([aH(a),ag]):a.prepare?a.prepared?aI(a):Buffer.concat([aH(a),aI(a)]):(b=a,Buffer.concat([a4(b.statement.string,b.parameters,b.statement.types),aj,aI(b)]))}(a))&&!a.describeFirst&&!a.cursorFn&&A.length<w&&(!a.options.onexecute||a.options.onexecute(aD))}catch(a){return 0===A.length&&aJ(af),aS(a),!0}}function aH(a){return Buffer.concat([a4(a.statement.string,a.parameters,a.statement.types,a.statement.name),function(a,b=""){return ab().D().str("S").str(b+ab.N).end()}("S",a.statement.name)])}function aI(a){return Buffer.concat([function(a,c,d="",e=""){let f,g;return ab().B().str(e+ab.N).str(d+ab.N).i16(0).i16(a.length),a.forEach((d,e)=>{if(null===d)return ab.i32(0xffffffff);g=c[e],a[e]=d=g in b.serializers?b.serializers[g](d):""+d,f=ab.i,ab.inc(4).str(d).i32(ab.i-f-4,f)}),ab.i16(0),ab.end()}(a.parameters,a.statement.types,a.statement.name,a.cursorName),a.cursorFn?a5("",a.cursorRows):ai])}function aJ(a,b){return(ay=ay?Buffer.concat([ay,a]):Buffer.from(a),b||ay.length>=1024)?aK(b):(null===ar&&(ar=setImmediate(aK)),!0)}function aK(a){let b=G.write(ay,a);return null!==ar&&clearImmediate(ar),ay=ar=null,b}async function aL(){if(aJ(ah),!await new Promise(a=>G.once("data",b=>a(83===b[0])))&&"prefer"===g)return aQ();G.removeAllListeners(),(G=W.connect({socket:G,servername:V.isIP(G.host)?void 0:G.host,..."require"===g||"allow"===g||"prefer"===g?{rejectUnauthorized:!1}:"verify-full"===g?{}:"object"==typeof g?g:{}})).on("secureConnect",aQ),G.on("error",aR),G.on("close",aW),G.on("drain",aM)}function aM(){aB||d(aD)}function aN(c){if(!at||(at.push(c),!((S-=c.length)>0)))for(L=at?Buffer.concat(at,aa-S):0===L.length?c:Buffer.concat([L,c],L.length+c.length);L.length>4;){if((aa=L.readUInt32BE(1))>=L.length){S=aa-L.length,at=[L];break}try{!function(c,e=c[0]){(68===e?function(a){let b,c,d,e=7,f=aB.isRaw?Array(aB.statement.columns.length):{};for(let g=0;g<aB.statement.columns.length;g++)c=aB.statement.columns[g],b=a.readInt32BE(e),e+=4,d=-1===b?null:!0===aB.isRaw?a.subarray(e,e+=b):void 0===c.parser?a.toString("utf8",e,e+=b):!0===c.parser.array?c.parser(a.toString("utf8",e+1,e+=b)):c.parser(a.toString("utf8",e,e+=b)),aB.isRaw?f[g]=!0===aB.isRaw?d:r.value.from?r.value.from(d,c):d:f[c.name]=r.value.from?r.value.from(d,c):d;aB.forEachFn?aB.forEachFn(r.row.from?r.row.from(f):f,I):I[ad++]=r.row.from?r.row.from(f):f}:100===e?function(a){ax&&(ax.push(a.subarray(5))||G.pause())}:65===e?function(a){if(!u)return;let b=9;for(;0!==a[b++];);u(a.toString("utf8",9,b-1),a.toString("utf8",b,a.length-1))}:83===e?function(a){let[c,d]=a.toString("utf8",5,a.length-1).split(ab.N);N[c]=d,b.parameters[c]!==d&&(b.parameters[c]=d,v&&v(c,d))}:90===e?function(c){if(aB&&aB.options.simple&&aB.resolve(au||I),aB=au=null,I=new $,F.cancel(),av){if(z)if(N.in_hot_standby&&N.default_transaction_read_only){var e,f;if(e=z,f=N,"read-write"===e&&"on"===f.default_transaction_read_only||"read-only"===e&&"off"===f.default_transaction_read_only||"primary"===e&&"on"===f.in_hot_standby||"standby"===e&&"off"===f.in_hot_standby||"prefer-standby"===e&&"off"===f.in_hot_standby&&b.host[U])return aV()}else{let a=new j([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],aG,null,{simple:!0});a.resolve=([[a],[b]])=>{N.default_transaction_read_only=a.transaction_read_only,N.in_hot_standby=b.pg_is_in_recovery?"on":"off"},a.execute();return}return M?(av.reserve&&(av=null),a2()):(av&&!av.reserve&&aG(av),b.shared.retries=U=0,void(av=null))}for(;A.length&&(aB=A.shift())&&(aB.active=!0,aB.cancelled);)a(b).cancel(aB.state,aB.cancelled.resolve,aB.cancelled.reject);aB||(aD.reserved?aD.reserved.release||73!==c[5]?aD.reserved():aw?aV():(aD.reserved=null,d(aD)):aw?aV():d(aD))}:67===e?function(a){ad=0;for(let b=a.length-1;b>0;b--)if(32===a[b]&&a[b+1]<58&&null===I.count&&(I.count=+a.toString("utf8",b+1,a.length-1)),a[b-1]>=65){I.command=a.toString("utf8",5,b),I.state=C;break}return(aC&&(aC(),aC=null),"BEGIN"!==I.command||1===h||aD.reserved)?aB.options.simple?aX():void(aB.cursorFn&&(I.count&&aB.cursorFn(I),aJ(af)),aB.resolve(I)):aS(l.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"))}:50===e?aX:49===e?function(){aB.parsing=!1}:116===e?function(a){let b=a.readUInt16BE(5);for(let c=0;c<b;++c)aB.statement.types[c]||(aB.statement.types[c]=a.readUInt32BE(7+4*c));aB.prepare&&(O[aB.signature]=aB.statement),aB.describeFirst&&!aB.onlyDescribe&&(aJ(aI(aB)),aB.describeFirst=!1)}:84===e?function(a){let b;I.command&&((au=au||[I]).push(I=new $),I.count=null,aB.statement.columns=null);let c=a.readUInt16BE(5),d=7;aB.statement.columns=Array(c);for(let e=0;e<c;++e){for(b=d;0!==a[d++];);let c=a.readUInt32BE(d),f=a.readUInt16BE(d+4),g=a.readUInt32BE(d+6);aB.statement.columns[e]={name:r.column.from?r.column.from(a.toString("utf8",b,d-1)):a.toString("utf8",b,d-1),parser:p[g],table:c,number:f,type:g},d+=18}if(I.statement=aB.statement,aB.onlyDescribe)return aB.resolve(aB.statement),aJ(af)}:82===e?aY:110===e?function(){if(I.statement=aB.statement,I.statement.columns=[],aB.onlyDescribe)return aB.resolve(aB.statement),aJ(af)}:75===e?function(a){C.pid=a.readUInt32BE(5),C.secret=a.readUInt32BE(9)}:69===e?function(a){var b,c;aB&&(aB.cursorFn||aB.describeFirst)&&aJ(af);let d=l.postgres(an(a));aB&&aB.retried?aS(aB.retried):aB&&aB.prepared&&al.has(d.routine)?(b=aB,c=d,delete O[b.signature],b.retried=c,aG(b)):aS(d)}:115===e?a3:51===e?function(){I.count&&aB.cursorFn(I),aB.resolve(I)}:71===e?function(){ax=new Y.Writable({autoDestroy:!0,write(a,b,c){G.write(ab().d().raw(a).end(),c)},destroy(a,b){b(a),G.write(ab().f().str(a+ab.N).end()),ax=null},final(a){G.write(ab().c().end()),aC=a}}),aB.resolve(ax)}:78===e?function(a){t?t(an(a)):console.log(an(a))}:72===e?function(){ax=new Y.Readable({read(){G.resume()}}),aB.resolve(ax)}:99===e?function(){ax&&ax.push(null),ax=null}:73===e?function(){}:86===e?function(){aS(l.notSupported("FunctionCallResponse"))}:118===e?function(){aS(l.notSupported("NegotiateProtocolVersion"))}:87===e?function(){ax=new Y.Duplex({autoDestroy:!0,read(){G.resume()},write(a,b,c){G.write(ab().d().raw(a).end(),c)},destroy(a,b){b(a),G.write(ab().f().str(a+ab.N).end()),ax=null},final(a){G.write(ab().c().end()),aC=a}}),aB.resolve(ax)}:function(a){console.error("Postgres.js : Unknown Message:",a[0])})(c)}(L.subarray(0,aa+1))}catch(a){aB&&(aB.cursorFn||aB.describeFirst)&&aJ(af),aS(a)}L=L.subarray(aa+1),S=0,at=null}}async function aO(){if(as=!1,N={},G||(G=await aE()),G){if(F.start(),b.socket)return g?aL():aQ();if(G.on("connect",g?aL:aQ),b.path)return G.connect(b.path);G.ssl=g,G.connect(n[T],m[T]),G.host=m[T],G.port=n[T],T=(T+1)%n.length}}function aP(){setTimeout(aO,R?R+ac-Z.performance.now():0)}function aQ(){try{O={},M=b.fetch_types,P=Math.random().toString(36).slice(2),Q=1,E.start(),G.on("data",aN),x&&G.setKeepAlive&&G.setKeepAlive(!0,1e3*x);let a=H||ab().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:k,database:o,client_encoding:"UTF8"},b.connection)).filter(([,a])=>a).map(([a,b])=>a+ab.N+b).join(ab.N)).z(2).end(0);aJ(a)}catch(a){aR(a)}}function aR(a){if(aD.queue!==c.connecting||!b.host[U+1])for(aS(a);A.length;)aT(A.shift(),a)}function aS(a){ax&&(ax.destroy(a),ax=null),aB&&aT(aB,a),av&&(aT(av,a),av=null)}function aT(a,c){if(a.reserve)return a.reject(c);c&&"object"==typeof c||(c=Error(c)),"query"in c||"parameters"in c||Object.defineProperties(c,{stack:{value:c.stack+a.origin.replace(/.*\n/,"\n"),enumerable:b.debug},query:{value:a.string,enumerable:b.debug},parameters:{value:a.parameters,enumerable:b.debug},args:{value:a.args,enumerable:b.debug},types:{value:a.statement&&a.statement.types,enumerable:b.debug}}),a.reject(c)}function aU(){return aw||(aD.reserved||e(aD),aD.reserved||av||aB||0!==A.length?aw=new Promise(a=>az=a):(aV(),new Promise(a=>G&&"closed"!==G.readyState?G.once("close",a):a())))}function aV(){as=!0,(ax||aB||av||A.length)&&aR(l.connection("CONNECTION_DESTROYED",b)),clearImmediate(ar),G&&(G.removeListener("data",aN),G.removeListener("connect",aQ),"open"===G.readyState&&G.end(ab().X().end())),az&&(az(),aw=az=null)}async function aW(a){if(L=Buffer.alloc(0),S=0,at=null,clearImmediate(ar),G.removeListener("data",aN),G.removeListener("connect",aQ),D.cancel(),E.cancel(),F.cancel(),G.removeAllListeners(),G=null,av)return aP();!a&&(aB||A.length)&&aR(l.connection("CONNECTION_CLOSED",b,G)),R=Z.performance.now(),a&&b.shared.retries++,ac=("function"==typeof y?y(b.shared.retries):y)*1e3,f(aD,l.connection("CONNECTION_CLOSED",b,G))}function aX(){I.statement||(I.statement=aB.statement),I.columns=aB.statement.columns}async function aY(a,b=a.readUInt32BE(5)){(3===b?aZ:5===b?a$:10===b?a_:11===b?a0:12===b?function(a){a.toString("utf8",9).split(ab.N,1)[0].slice(2)!==am&&(aS(l.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),G.destroy())}:0!==b?function(a,b){console.error("Postgres.js : Unknown Auth:",b)}:ak)(a,b)}async function aZ(){let a=await a1();aJ(ab().p().str(a).z(1).end())}async function a$(a){let b="md5"+await ao(Buffer.concat([Buffer.from(await ao(await a1()+k)),a.subarray(9)]));aJ(ab().p().str(b).z(1).end())}async function a_(){aA=(await X.randomBytes(18)).toString("base64"),ab().p().str("SCRAM-SHA-256"+ab.N);let a=ab.i;aJ(ab.inc(4).str("n,,n=*,r="+aA).i32(ab.i-a-4,a).end())}async function a0(a){var b;let c=a.toString("utf8",9).split(",").reduce((a,b)=>(a[b[0]]=b.slice(2),a),{}),d=await X.pbkdf2Sync(await a1(),Buffer.from(c.s,"base64"),parseInt(c.i),32,"sha256"),e=await ap(d,"Client Key"),f="n=*,r="+aA+",r="+c.r+",s="+c.s+",i="+c.i+",c=biws,r="+c.r;am=(await ap(await ap(d,"Server Key"),f)).toString("base64");let g="c=biws,r="+c.r+",p="+(function(a,b){let c=Math.max(a.length,b.length),d=Buffer.allocUnsafe(c);for(let e=0;e<c;e++)d[e]=a[e]^b[e];return d})(e,Buffer.from(await ap(await (b=e,X.createHash("sha256").update(b).digest()),f))).toString("base64");aJ(ab().p().str(g).end())}function a1(){return Promise.resolve("function"==typeof b.pass?b.pass():b.pass)}async function a2(){M=!1,(await new j([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],aG)).forEach(({oid:a,typarray:c})=>(function(a,c){if(b.parsers[c]&&b.serializers[c])return;let d=b.parsers[a];b.shared.typeArrayMap[a]=c,b.parsers[c]=a=>(K.i=K.last=0,function a(b,c,d,e){let f=[],g=1020===e?";":",";for(;b.i<c.length;b.i++){if(b.char=c[b.i],b.quoted)"\\"===b.char?b.str+=c[++b.i]:'"'===b.char?(f.push(d?d(b.str):b.str),b.str="",b.quoted='"'===c[b.i+1],b.last=b.i+2):b.str+=b.char;else if('"'===b.char)b.quoted=!0;else if("{"===b.char)b.last=++b.i,f.push(a(b,c,d,e));else if("}"===b.char){b.quoted=!1,b.last<b.i&&f.push(d?d(c.slice(b.last,b.i)):c.slice(b.last,b.i)),b.last=b.i+1;break}else b.char===g&&"}"!==b.p&&'"'!==b.p&&(f.push(d?d(c.slice(b.last,b.i)):c.slice(b.last,b.i)),b.last=b.i+1);b.p=b.char}return b.last<b.i&&f.push(d?d(c.slice(b.last,b.i+1)):c.slice(b.last,b.i+1)),f}(K,a,d,c)),b.parsers[c].array=!0,b.serializers[c]=d=>J(d,b.serializers[a],b,c)})(a,c))}async function a3(){try{let a=await Promise.resolve(aB.cursorFn(I));ad=0,a===i?aJ(function(a=""){return Buffer.concat([ab().C().str("P").str(a+ab.N).end(),ab().S().end()])}(aB.portal)):(I=new $,aJ(a5("",aB.cursorRows)))}catch(a){aJ(af),aB.reject(a)}}function a4(a,b,c,d=""){return ab().P().str(d+ab.N).str(a+ab.N).i16(b.length),b.forEach((a,b)=>ab.i32(c[b]||0)),ab.end()}function a5(a="",b=0){return Buffer.concat([ab().E().str(a+ab.N).i32(b).end(),ag])}},ae=1,af=ab().S().end(),ag=ab().H().end(),ah=ab().i32(8).i32(0x4d2162f).end(8),ai=Buffer.concat([ab().E().str(ab.N).i32(0).end(),af]),aj=ab().D().str("S").str(ab.N).end(),ak=()=>{},al=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),am={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function an(a){let b={},c=5;for(let d=5;d<a.length-1;d++)0===a[d]&&(b[am[a[c]]]=a.toString("utf8",c+1,d),c=d+1);return b}function ao(a){return X.createHash("md5").update(a).digest("hex")}function ap(a,b){return X.createHmac("sha256",a).update(b).digest()}function aq(a,b){let c;if(!(b="function"==typeof b?b():b))return{cancel:ak,start:ak};return{cancel(){c&&(clearTimeout(c),c=null)},start(){c&&clearTimeout(c),c=setTimeout(d,1e3*b,arguments)}};function d(b){a.apply(null,b),c=null}}let ar=()=>{};function as(a,b,c,d){let e,f,g,h=d.raw?Array(b.length):{};for(let i=0;i<b.length;i++)e=a[c++],f=b[i],g=110===e?null:117===e?void 0:void 0===f.parser?a.toString("utf8",c+4,c+=4+a.readUInt32BE(c)):!0===f.parser.array?f.parser(a.toString("utf8",c+5,c+=4+a.readUInt32BE(c))):f.parser(a.toString("utf8",c+4,c+=4+a.readUInt32BE(c))),d.raw?h[i]=!0===d.raw?g:d.value.from?d.value.from(g,f):g:h[f.name]=d.value.from?d.value.from(g,f):g;return{i:c,row:d.row.from?d.row.from(h):h}}function at(a,b,c=393216){return new Promise(async(d,e)=>{await a.begin(async a=>{let e;b||([{oid:b}]=await a`select lo_creat(-1) as oid`);let[{fd:f}]=await a`select lo_open(${b}, ${c}) as fd`,g={writable:i,readable:h,close:()=>a`select lo_close(${f})`.then(e),tell:()=>a`select lo_tell64(${f})`,read:b=>a`select loread(${f}, ${b}) as data`,write:b=>a`select lowrite(${f}, ${b})`,truncate:b=>a`select lo_truncate64(${f}, ${b})`,seek:(b,c=0)=>a`select lo_lseek64(${f}, ${b}, ${c})`,size:()=>a`
          select
            lo_lseek64(${f}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return d(g),new Promise(async a=>e=a);async function h({highWaterMark:a=16384,start:b=0,end:c=1/0}={}){let d=c-b;return b&&await g.seek(b),new Y.Readable({highWaterMark:a,async read(a){let b=a>d?a-d:a;d-=a;let[{data:c}]=await g.read(b);this.push(c),c.length<a&&this.push(null)}})}async function i({highWaterMark:a=16384,start:b=0}={}){return b&&await g.seek(b),new Y.Writable({highWaterMark:a,write(a,b,c){g.write(a).then(()=>c(),c)}})}}).catch(e)})}Object.assign(av,{PostgresError:k,toPascal:M,pascal:T,toCamel:L,camel:S,toKebab:N,kebab:U,fromPascal:P,fromCamel:O,fromKebab:Q,BigInt:{to:20,from:[20],parse:a=>BigInt(a),serialize:a=>a.toString()}});let au=av;function av(a,b){let c=function(a,b){var c;if(a&&a.shared)return a;let e=process.env,f=(a&&"string"!=typeof a?a:b)||{},{url:g,multihost:h}=function(a){if(!a||"string"!=typeof a)return{url:{searchParams:new Map}};let b=a;b=decodeURIComponent((b=b.slice(b.indexOf("://")+3).split(/[?/]/)[0]).slice(b.indexOf("@")+1));let c=new URL(a.replace(b,b.split(",")[0]));return{url:{username:decodeURIComponent(c.username),password:decodeURIComponent(c.password),host:c.host,hostname:c.hostname,port:c.port,pathname:c.pathname,searchParams:c.searchParams},multihost:b.indexOf(",")>-1&&b}}(a),i=[...g.searchParams].reduce((a,[b,c])=>(a[b]=c,a),{}),j=f.hostname||f.host||h||g.hostname||e.PGHOST||"localhost",k=f.port||g.port||e.PGPORT||5432,l=f.user||f.username||g.username||e.PGUSERNAME||e.PGUSER||function(){try{return d.userInfo().username}catch(a){return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}();f.no_prepare&&(f.prepare=!1),i.sslmode&&(i.ssl=i.sslmode,delete i.sslmode),"timeout"in f&&(console.log("The timeout option is deprecated, use idle_timeout instead"),f.idle_timeout=f.timeout),"system"===i.sslrootcert&&(i.ssl="verify-full");let m=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],n={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:ax,max_pipeline:100,backoff:aw,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(j)?j:j.split(",").map(a=>a.split(":")[0]),port:Array.isArray(k)?k:j.split(",").map(a=>parseInt(a.split(":")[1]||k)),path:f.path||j.indexOf("/")>-1&&j+"/.s.PGSQL."+k,database:f.database||f.db||(g.pathname||"").slice(1)||e.PGDATABASE||l,user:l,pass:f.pass||f.password||g.password||e.PGPASSWORD||"",...Object.entries(n).reduce((a,[b,c])=>{let d=b in f?f[b]:b in i?"disable"!==i[b]&&"false"!==i[b]&&i[b]:e["PG"+b.toUpperCase()]||c;return a[b]="string"==typeof d&&m.includes(b)?+d:d,a},{}),connection:{application_name:e.PGAPPNAME||"postgres.js",...f.connection,...Object.entries(i).reduce((a,[b,c])=>(b in n||(a[b]=c),a),{})},types:f.types||{},target_session_attrs:function(a,b,c){let d=a.target_session_attrs||b.searchParams.get("target_session_attrs")||c.PGTARGETSESSIONATTRS;if(!d||["read-write","read-only","primary","standby","prefer-standby"].includes(d))return d;throw Error("target_session_attrs "+d+" is not supported")}(f,g,e),onnotice:f.onnotice,onnotify:f.onnotify,onclose:f.onclose,onparameter:f.onparameter,socket:f.socket,transform:{undefined:(c=f.transform||{undefined:void 0}).undefined,column:{from:"function"==typeof c.column?c.column:c.column&&c.column.from,to:c.column&&c.column.to},value:{from:"function"==typeof c.value?c.value:c.value&&c.value.from,to:c.value&&c.value.to},row:{from:"function"==typeof c.row?c.row:c.row&&c.row.from,to:c.row&&c.row.to}},parameters:{},shared:{retries:0,typeArrayMap:{}},...C(f.types)}}(a,b),f=c.no_subscribe||function(a,b){let c=new Map,d="postgresjs_"+Math.random().toString(36).slice(2),e={},f,g,h=!1,i=l.sql=a({...b,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...b.connection,replication:"database"},onclose:async function(){h||(g=null,e.pid=e.secret=void 0,m(await n(i,d,b.publications)),c.forEach(a=>a.forEach(({onsubscribe:a})=>a())))},no_subscribe:!0}),j=i.end,k=i.close;return i.end=async()=>(h=!0,g&&await new Promise(a=>(g.once("close",a),g.end())),j()),i.close=async()=>(g&&await new Promise(a=>(g.once("close",a),g.end())),k()),l;async function l(a,h,j=ar,k=ar){a=function(a){let b=a.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!b)throw Error("Malformed subscribe pattern: "+a);let[,c,d,e]=b;return(c||"*")+(d?":"+(-1===d.indexOf(".")?"public."+d:d):"")+(e?"="+e:"")}(a),f||(f=n(i,d,b.publications));let o={fn:h,onsubscribe:j},p=c.has(a)?c.get(a).add(o):c.set(a,new Set([o])).get(a),q=()=>{p.delete(o),0===p.size&&c.delete(a)};return f.then(a=>(m(a),j(),g&&g.on("error",k),{unsubscribe:q,state:e,sql:i}))}function m(a){g=a.stream,e.pid=a.state.pid,e.secret=a.state.secret}async function n(a,c,d){if(!d)throw Error("Missing publication names");let e=await a.unsafe(`CREATE_REPLICATION_SLOT ${c} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[f]=e,g=await a.unsafe(`START_REPLICATION SLOT ${c} LOGICAL ${f.consistent_point} (proto_version '1', publication_names '${d}')`).writable(),h={lsn:Buffer.concat(f.consistent_point.split("/").map(a=>Buffer.from(("00000000"+a).slice(-8),"hex")))};return g.on("data",function(c){var d,e,f,j,k;119===c[0]?(d=c.subarray(25),e=h,f=a.options.parsers,j=i,k=b.transform,Object.entries({R:a=>{let b=1,c=e[a.readUInt32BE(b)]={schema:a.toString("utf8",b+=4,b=a.indexOf(0,b))||"pg_catalog",table:a.toString("utf8",b+1,b=a.indexOf(0,b+1)),columns:Array(a.readUInt16BE(b+=2)),keys:[]};b+=2;let d=0,g;for(;b<a.length;)(g=c.columns[d++]={key:a[b++],name:k.column.from?k.column.from(a.toString("utf8",b,b=a.indexOf(0,b))):a.toString("utf8",b,b=a.indexOf(0,b)),type:a.readUInt32BE(b+=1),parser:f[a.readUInt32BE(b)],atttypmod:a.readUInt32BE(b+=4)}).key&&c.keys.push(g),b+=4},Y:()=>{},O:()=>{},B:a=>{var b;b=a.readBigInt64BE(9),e.date=new Date(Date.UTC(2e3,0,1)+Number(b/BigInt(1e3))),e.lsn=a.subarray(1,9)},I:a=>{let b=1,c=e[a.readUInt32BE(b)],{row:d}=as(a,c.columns,b+=7,k);j(d,{command:"insert",relation:c})},D:a=>{let b=1,c=e[a.readUInt32BE(b)],d=75===a[b+=4];j(d||79===a[b]?as(a,c.columns,b+=3,k).row:null,{command:"delete",relation:c,key:d})},U:a=>{let b=1,c=e[a.readUInt32BE(b)],d=75===a[b+=4],f=d||79===a[b]?as(a,c.columns,b+=3,k):null;f&&(b=f.i);let{row:g}=as(a,c.columns,b+3,k);j(g,{command:"update",relation:c,key:d,old:f&&f.row})},T:()=>{},C:()=>{}}).reduce((a,[b,c])=>(a[b.charCodeAt(0)]=c,a),{})[d[0]](d)):107===c[0]&&c[17]&&(h.lsn=c.subarray(1,9),function(){let a=Buffer.alloc(34);a[0]=114,a.fill(h.lsn,1),a.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),g.write(a)}())}),g.on("error",function(a){console.error("Unexpected error during logical streaming - reconnecting",a)}),g.on("close",a.close),{stream:g,state:e.state};function i(a,b){let c=b.relation.schema+"."+b.relation.table;o("*",a,b),o("*:"+c,a,b),b.relation.keys.length&&o("*:"+c+"="+b.relation.keys.map(b=>a[b.name]),a,b),o(b.command,a,b),o(b.command+":"+c,a,b),b.relation.keys.length&&o(b.command+":"+c+"="+b.relation.keys.map(b=>a[b.name]),a,b)}}function o(a,b,d){c.has(a)&&c.get(a).forEach(({fn:c})=>c(b,d,a))}}(av,{...c}),g=!1,h=_(),m=_(),q=_(),r=_(),s=_(),t=_(),u=_(),v=_(),w={connecting:m,reserved:q,closed:r,ended:s,open:t,busy:u,full:v},x=[...Array(c.max)].map(()=>ad(c,w,{onopen:P,onend:O,onclose:Q})),y=z(function(a){return g?a.reject(l.connection("CONNECTION_ENDED",c,c)):t.length?I(t.shift(),a):r.length?N(r.shift(),a):void(u.length?I(u.shift(),a):h.push(a))});return Object.assign(y,{get parameters(){return c.parameters},largeObject:at.bind(null,y),subscribe:f,CLOSE:i,END:i,PostgresError:k,options:c,reserve:D,listen:A,begin:E,close:L,end:K}),y;function z(a){return a.debug=c.debug,Object.entries(c.types).reduce((a,[b,c])=>(a[b]=a=>new o(a,c.to),a),b),Object.assign(d,{types:b,typed:b,unsafe:function(b,c=[],d={}){return 2!=arguments.length||Array.isArray(c)||(d=c,c=[]),new j([b],c,a,J,{prepare:!1,...d,simple:"simple"in d?d.simple:0===c.length})},notify:B,array:function a(b,d){return Array.isArray(b)?new o(b,d||(b.length?G(b)||25:0),c.shared.typeArrayMap):a(Array.from(arguments))},json:H,file:function(b,c=[],d={}){return 2!=arguments.length||Array.isArray(c)||(d=c,c=[]),new j([],c,c=>{e.readFile(b,"utf8",(b,d)=>{if(b)return c.reject(b);c.strings=[d],a(c)})},J,{...d,simple:"simple"in d?d.simple:0===c.length})}}),d;function b(a,b){return new o(a,b)}function d(b,...e){return b&&Array.isArray(b.raw)?new j(b,e,a,J):"string"!=typeof b||e.length?new p(b,e):new n(c.transform.column.to?c.transform.column.to(b):b)}}async function A(a,b,d){let e={fn:b,onlisten:d},f=A.sql||(A.sql=av({...c,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(A.channels).forEach(([a,{listeners:b}])=>{delete A.channels[a],Promise.all(b.map(b=>A(a,b.fn,b.onlisten).catch(()=>{})))})},onnotify(a,b){a in A.channels&&A.channels[a].listeners.forEach(a=>a.fn(b))}})),g=A.channels||(A.channels={});if(a in g){g[a].listeners.push(e);let b=await g[a].result;return e.onlisten&&e.onlisten(),{state:b.state,unlisten:i}}g[a]={result:f`listen ${f.unsafe('"'+a.replace(/"/g,'""')+'"')}`,listeners:[e]};let h=await g[a].result;return e.onlisten&&e.onlisten(),{state:h.state,unlisten:i};async function i(){if(a in g!=!1&&(g[a].listeners=g[a].listeners.filter(a=>a!==e),!g[a].listeners.length))return delete g[a],f`unlisten ${f.unsafe('"'+a.replace(/"/g,'""')+'"')}`}}async function B(a,b){return await y`select pg_notify(${a}, ${""+b})`}async function D(){let a=_(),b=t.length?t.shift():await new Promise((a,b)=>{let c={reserve:a,reject:b};h.push(c),r.length&&N(r.shift(),c)});F(b,q),b.reserved=()=>a.length?b.execute(a.shift()):F(b,q),b.reserved.release=!0;let c=z(function(c){b.queue===v?a.push(c):b.execute(c)||F(b,v)});return c.release=()=>{b.reserved=null,P(b)},c}async function E(a,b){b||(b=a,a="");let c=_(),d=0,e,f=null;try{return await y.unsafe("begin "+a.replace(/[^a-z ]/ig,""),[],{onexecute:function(a){e=a,F(a,q),a.reserved=()=>c.length?a.execute(c.shift()):F(a,q)}}).execute(),await Promise.race([g(e,b),new Promise((a,b)=>e.onclose=b)])}catch(a){throw a}async function g(a,b,e){let h,i,j=z(function(b){b.catch(a=>h||(h=a)),a.queue===v?c.push(b):a.execute(b)||F(a,v)});j.savepoint=function b(c,e){return c&&Array.isArray(c.raw)?b(a=>a.apply(a,arguments)):(1==arguments.length&&(e=c,c=null),g(a,e,"s"+d+++(c?"_"+c:"")))},j.prepare=a=>f=a.replace(/[^a-z0-9$-_. ]/gi),e&&await j`savepoint ${j(e)}`;try{if(i=await new Promise((a,c)=>{let d=b(j);Promise.resolve(Array.isArray(d)?Promise.all(d):d).then(a,c)}),h)throw h}catch(a){throw await (e?j`rollback to ${j(e)}`:j`rollback`),a instanceof k&&"25P02"===a.code&&h||a}return e||(f?await j`prepare transaction '${j.unsafe(f)}'`:await j`commit`),i}}function F(a,b){return a.queue.remove(a),b.push(a),a.queue=b,b===t?a.idleTimer.start():a.idleTimer.cancel(),a}function H(a){return new o(a,3802)}function I(a,b){return a.execute(b)?F(a,u):F(a,v)}function J(a){return new Promise((b,d)=>{a.state?a.active?ad(c).cancel(a.state,b,d):a.cancelled={resolve:b,reject:d}:(h.remove(a),a.cancelled=!0,a.reject(l.generic("57014","canceling statement due to user request")),b())})}async function K({timeout:a=null}={}){let b;return g||(await 1,g=Promise.race([new Promise(c=>null!==a&&(b=setTimeout(M,1e3*a,c))),Promise.all(x.map(a=>a.end()).concat(A.sql?A.sql.end({timeout:0}):[],f.sql?f.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(b)))}async function L(){await Promise.all(x.map(a=>a.end()))}async function M(a){for(await Promise.all(x.map(a=>a.terminate()));h.length;)h.shift().reject(l.connection("CONNECTION_DESTROYED",c));a()}function N(a,b){return F(a,m),a.connect(b),a}function O(a){F(a,s)}function P(a){if(0===h.length)return F(a,t);let b=Math.ceil(h.length/(m.length+1)),c=!0;for(;c&&h.length&&b-- >0;){let b=h.shift();if(b.reserve)return b.reserve(a);c=a.execute(b)}c?F(a,u):F(a,v)}function Q(a,b){F(a,r),a.reserved=null,a.onclose&&(a.onclose(b),a.onclose=null),c.onclose&&c.onclose(a.id),h.length&&N(a,h.shift())}}function aw(a){return(.5+Math.random()/2)*Math.min(3**a/100,20)}function ax(){return 60*(30+30*Math.random())}},59061:(a,b,c)=>{function d(a){return a?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function e(a,b,c){let d="",e=0,f=0;for(let c of a)for(e=e<<8|c,f+=8;f>=6;)f-=6,d+=b[e>>f&63];if(f>0&&(d+=b[e<<6-f&63]),c){let a=(4-d.length%4)%4;d+="=".repeat(a)}return d}function f(a,b){let c=new Map;for(let a=0;a<b.length;a++)c.set(b[a],a);let d=[],e=0,f=0;for(let b of a){if("="===b)break;let a=c.get(b);if(void 0===a)throw Error(`Invalid Base64 character: ${b}`);e=e<<6|a,(f+=6)>=8&&(f-=8,d.push(e>>f&255))}return Uint8Array.from(d)}c.d(b,{K:()=>g,z:()=>h});let g={encode(a,b={}){let c=d(!1);return e("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){"string"!=typeof a&&(a=new TextDecoder().decode(a));let b=d(a.includes("-")||a.includes("_"));return f(a,b)}},h={encode(a,b={}){let c=d(!0);return e("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){let b=d(a.includes("-")||a.includes("_"));return f(a,b)}}},59659:(a,b,c)=>{function d(a){return void 0===a||void 0===a}function e(a){return"string"==typeof a}function f(a){return"number"==typeof a}function g(a){return"boolean"==typeof a}function h(a){return null===a}function i(a){return a instanceof Date}function j(a){return"bigint"==typeof a}function k(a){return"undefined"!=typeof Buffer&&Buffer.isBuffer(a)}function l(a){return"function"==typeof a}function m(a){return"object"==typeof a&&null!==a}function n(a){return Object.freeze(a)}function o(a){return p(a)?a:[a]}function p(a){return Array.isArray(a)}function q(a){return a}c.d(b,{$P:()=>i,CN:()=>n,Et:()=>f,Gv:()=>m,Kg:()=>e,Lm:()=>g,MH:()=>p,Pe:()=>k,Tn:()=>l,_j:()=>o,b0:()=>d,kZ:()=>h,lQ:()=>q,sI:()=>j}),Object.prototype.toString},59865:(a,b,c)=>{c.d(b,{W:()=>f});var d=c(49828);class e extends d.R{get adapter(){throw Error("this query cannot be compiled to SQL")}compileQuery(){throw Error("this query cannot be compiled to SQL")}provideConnection(){throw Error("this query cannot be executed")}withConnectionProvider(){throw Error("this query cannot have a connection provider")}withPlugin(a){return new e([...this.plugins,a])}withPlugins(a){return new e([...this.plugins,...a])}withPluginAtFront(a){return new e([a,...this.plugins])}withoutPlugins(){return new e([])}}let f=new e},60369:(a,b,c)=>{c.d(b,{D:()=>e});let d=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function e(a){let b="";for(let c=0;c<a;++c)b+=d[~~(Math.random()*d.length)];return b}},60949:(a,b,c)=>{c.d(b,{h:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"PrimitiveValueListNode"===a.kind,create:a=>(0,d.CN)({kind:"PrimitiveValueListNode",values:(0,d.CN)([...a])})})},61741:(a,b,c)=>{c.d(b,{q:()=>f});var d=c(70192);function e(a){switch(a){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${a}`)}}function f(...a){let b=a.map(e).join("");if(0===b.length)throw Error("No valid characters provided for random string generation.");let c=b.length;return(a,...f)=>{let g;if(a<=0)throw Error("Length must be a positive integer.");let h=b,i=c;f.length>0&&(i=(h=f.map(e).join("")).length);let j=Math.floor(256/i)*i,k=new Uint8Array(2*a),l=k.length,m="",n=l;for(;m.length<a;)n>=l&&((0,d.UY)(k),n=0),(g=k[n++])<j&&(m+=h[g%i]);return m}}},62020:(a,b,c)=>{c.d(b,{u:()=>e});let d=new Set;function e(a){d.has(a)||(d.add(a),console.log(a))}},63345:(a,b,c)=>{c.d(b,{fd:()=>e,rs:()=>d}),Symbol("ZodOutput"),Symbol("ZodInput");class d{constructor(){this._map=new Map,this._idmap=new Map}add(a,...b){let c=b[0];if(this._map.set(a,c),c&&"object"==typeof c&&"id"in c){if(this._idmap.has(c.id))throw Error(`ID ${c.id} already exists in the registry`);this._idmap.set(c.id,a)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(a){let b=this._map.get(a);return b&&"object"==typeof b&&"id"in b&&this._idmap.delete(b.id),this._map.delete(a),this}get(a){let b=a._zod.parent;if(b){let c={...this.get(b)??{}};delete c.id;let d={...c,...this._map.get(a)};return Object.keys(d).length?d:void 0}return this._map.get(a)}has(a){return this._map.has(a)}}let e=new d},63966:(a,b,c)=>{c.d(b,{l:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"BinaryOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"BinaryOperationNode",leftOperand:a,operator:b,rightOperand:c})})},65141:(a,b,c)=>{c.d(b,{iv:()=>p,pD:()=>o,pE:()=>m,sq:()=>n,gC:()=>v,ro:()=>u,DZ:()=>x,_k:()=>s,mm:()=>q,rl:()=>r,I$:()=>function a(b,c,d,g,h=a=>a){let i={};for(let[j,k]of g.entries())if(k.isJson){let e=c.relations[k.tsKey],g=d[j],l="string"==typeof g?JSON.parse(g):g;i[k.tsKey]=(0,f.is)(e,o)?l&&a(b,b[k.relationTableTsKey],l,k.selection,h):l.map(c=>a(b,b[k.relationTableTsKey],c,k.selection,h))}else{let a,b=h(d[j]),c=k.field;a=(0,f.is)(c,e.V)?c:(0,f.is)(c,l.Xs)?c.decoder:c.sql.decoder,i[k.tsKey]=null===b?null:a.mapFromDriverValue(b)}return i},W0:()=>w,K1:()=>t});var d=c(7762),e=c(98318),f=c(8575),g=c(9633);class h{static [f.i]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new i(a,this.columns,this.name)}}class i{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [f.i]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[g.mu.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}var j=c(52723),k=c(23921),l=c(98708);class m{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[d.XI.Symbol.Name]}static [f.i]="Relation";referencedTableName;fieldName}class n{constructor(a,b){this.table=a,this.config=b}static [f.i]="Relations"}class o extends m{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [f.i]="One";withFieldName(a){let b=new o(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class p extends m{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [f.i]="Many";withFieldName(a){let b=new p(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function q(){return{and:j.Uo,between:j.Tq,eq:j.eq,exists:j.t2,gt:j.gt,gte:j.RO,ilike:j.B3,inArray:j.RV,isNull:j.kZ,isNotNull:j.Pe,like:j.mj,lt:j.lt,lte:j.wJ,ne:j.ne,not:j.AU,notBetween:j.o8,notExists:j.KJ,notLike:j.RK,notIlike:j.q1,notInArray:j.KL,or:j.or,sql:l.ll}}function r(){return{sql:l.ll,asc:k.Y,desc:k.i}}function s(a,b){1===Object.keys(a).length&&"default"in a&&!(0,f.is)(a.default,d.XI)&&(a=a.default);let c={},e={},g={};for(let[i,j]of Object.entries(a))if((0,f.is)(j,d.XI)){let a=(0,d.Lf)(j),b=e[a];for(let e of(c[a]=i,g[i]={tsName:i,dbName:j[d.XI.Symbol.Name],schema:j[d.XI.Symbol.Schema],columns:j[d.XI.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(j[d.XI.Symbol.Columns])))e.primary&&g[i].primaryKey.push(e);let k=j[d.XI.Symbol.ExtraConfigBuilder]?.(j[d.XI.Symbol.ExtraConfigColumns]);if(k)for(let a of Object.values(k))(0,f.is)(a,h)&&g[i].primaryKey.push(...a.columns)}else if((0,f.is)(j,n)){let a,f=(0,d.Lf)(j.table),h=c[f];for(let[c,d]of Object.entries(j.config(b(j.table))))if(h){let b=g[h];b.relations[c]=d,a&&b.primaryKey.push(...a)}else f in e||(e[f]={relations:{},primaryKey:a}),e[f].relations[c]=d}return{tables:g,tableNamesMap:c}}function t(a,b){return new n(a,a=>Object.fromEntries(Object.entries(b(a)).map(([a,b])=>[a,b.withFieldName(a)])))}function u(a){return function(b,c){return new o(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)}}function v(a){return function(b,c){return new p(a,b,c)}}function w(a,b,c){if((0,f.is)(c,o)&&c.config)return{fields:c.config.fields,references:c.config.references};let e=b[(0,d.Lf)(c.referencedTable)];if(!e)throw Error(`Table "${c.referencedTable[d.XI.Symbol.Name]}" not found in schema`);let g=a[e];if(!g)throw Error(`Table "${e}" not found in schema`);let h=c.sourceTable,i=b[(0,d.Lf)(h)];if(!i)throw Error(`Table "${h[d.XI.Symbol.Name]}" not found in schema`);let j=[];for(let a of Object.values(g.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&j.push(a);if(j.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${e}"`):Error(`There are multiple relations between "${e}" and "${c.sourceTable[d.XI.Symbol.Name]}". Please specify relation name`);if(j[0]&&(0,f.is)(j[0],o)&&j[0].config)return{fields:j[0].config.references,references:j[0].config.fields};throw Error(`There is not enough information to infer relation "${i}.${c.fieldName}"`)}function x(a){return{one:u(a),many:v(a)}}},65505:(a,b,c)=>{c.d(b,{O:()=>K,A:()=>L});var d=c(28730),e=c(91054),f=c(15021),g=c(58077),h=c(70030),i=c(42522),j=c(34082),k=c(18634),l=c(36398),m=c(88202),n=c(221),o=c(59659);let p=(0,o.CN)({is:a=>"UnaryOperationNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"UnaryOperationNode",operator:a,operand:b})});var q=c(93806),r=c(59865),s=c(80548),t=c(4457),u=c(15539),v=c(44344),w=c(34144);let x=(0,o.CN)({is:a=>"JSONPathLegNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"JSONPathLegNode",type:a,value:b})});var y=c(42749),z=c(9055),A=c(23244),B=c(65968);class C{#H;constructor(a){this.#H=a}at(a){return this.#I("ArrayLocation",a)}key(a){return this.#I("Member",a)}#I(a,b){return new D(z.Q.is(this.#H)?z.Q.cloneWithTraversal(this.#H,y.c.is(this.#H.traversal)?y.c.cloneWithLeg(this.#H.traversal,x.create(a,b)):w.k.cloneWithValue(this.#H.traversal,B.q.createImmediate(b))):y.c.cloneWithLeg(this.#H,x.create(a,b)))}}class D extends C{#H;constructor(a){super(a),this.#H=a}get expressionType(){}as(a){return new E(this,a)}$castTo(){return new D(this.#H)}$notNull(){return new D(this.#H)}toOperationNode(){return this.#H}}class E{#J;#j;constructor(a,b){this.#J=a,this.#j=b}get expression(){return this.#J}get alias(){return this.#j}toOperationNode(){return u.N.create(this.#J.toOperationNode(),(0,A.N)(this.#j)?this.#j.toOperationNode():v.O.create(this.#j))}}var F=c(63966),G=c(58436);let H=(0,o.CN)({is:a=>"TupleNode"===a.kind,create:a=>(0,o.CN)({kind:"TupleNode",values:(0,o.CN)(a)})});var I=c(87686);let J=(0,o.CN)({is:a=>"CastNode"===a.kind,create:(a,b)=>(0,o.CN)({kind:"CastNode",expression:a,dataType:b})});function K(a=r.W){function b(a,b){return new m.Is(p.create(n.zX.create(a),(0,j.$O)(b)))}let c=Object.assign(function(a,b,c){return new m.Is((0,k.ds)(a,b,c))},{fn:void 0,eb:void 0,selectFrom:b=>(0,d.c)({queryId:(0,h.a)(),executor:a,queryNode:e.L.createFrom((0,f.JB)(b))}),case:a=>new s.OU({node:t.P.create((0,o.b0)(a)?void 0:(0,j.$O)(a))}),ref:(a,b)=>(0,o.b0)(b)?new m.Is((0,j.q5)(a)):new C((0,j.NF)(a,b)),jsonPath:()=>new C(y.c.create()),table:a=>new m.Is((0,f.M$)(a)),val:a=>new m.Is((0,q.$s)(a)),refTuple:(...a)=>new m.Is(H.create(a.map(j.$O))),tuple:(...a)=>new m.Is(H.create(a.map(q.$s))),lit:a=>new m.Is((0,q.dJ)(a)),unary:b,not:a=>b("not",a),exists:a=>b("exists",a),neg:a=>b("-",a),between:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),betweenSymmetric:(a,b,c)=>new m.Is(F.l.create((0,j.$O)(a),n.zX.create("between symmetric"),G.s.create((0,q.$s)(b),(0,q.$s)(c)))),and:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"and"):(0,k.Ve)(a,"and")),or:a=>new m.Is((0,o.MH)(a)?(0,k.KN)(a,"or"):(0,k.Ve)(a,"or")),parens(...a){let b=(0,k.GB)(a);return new m.Is(l.k.is(b)?b:l.k.create(b))},cast:(a,b)=>new m.Is(J.create((0,j.$O)(a),(0,I.Q)(b))),withSchema:b=>K(a.withPluginAtFront(new g.B(b)))});return c.fn=(0,i.t)(),c.eb=c,c}function L(a){return K()}},65968:(a,b,c)=>{c.d(b,{q:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"ValueNode"===a.kind,create:a=>(0,d.CN)({kind:"ValueNode",value:a}),createImmediate:a=>(0,d.CN)({kind:"ValueNode",value:a,immediate:!0})})},66555:(a,b,c)=>{c.d(b,{Rv:()=>f,jY:()=>g,n9:()=>e});var d=c(8575);class e extends Error{static [d.i]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class f extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,f),c&&(this.cause=c)}}class g extends e{static [d.i]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}},66626:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(57975);let e=a=>d.types.isKeyObject(a)},67423:(a,b,c)=>{c.d(b,{Z:()=>f});var d=c(59659),e=c(44344);let f=(0,d.CN)({is:a=>"ColumnNode"===a.kind,create:a=>(0,d.CN)({kind:"ColumnNode",column:e.O.create(a)})})},70030:(a,b,c)=>{c.d(b,{a:()=>e});var d=c(60369);function e(){return new f}class f{#K;get queryId(){return void 0===this.#K&&(this.#K=(0,d.D)(8)),this.#K}}},70192:(a,b,c)=>{c.d(b,{UY:()=>f,aK:()=>e});var d=c(77598);let e=d.webcrypto?.subtle||{},f=a=>d.webcrypto.getRandomValues(a)},70250:(a,b,c)=>{c.d(b,{a:()=>h,b:()=>i,e:()=>f,i:()=>j});let d=Object.create(null),e=a=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(a?d:globalThis),f=new Proxy(d,{get:(a,b)=>e()[b]??d[b],has:(a,b)=>b in e()||b in d,set:(a,b,c)=>(e(!0)[b]=c,!0),deleteProperty(a,b){if(!b)return!1;let c=e(!0);return delete c[b],!0},ownKeys:()=>Object.keys(e(!0))}),g="undefined"!=typeof process&&process.env&&"production"||"",h="production"===g,i="dev"===g||"development"===g,j="test"===g||function(a){return!!a&&"false"!==a}(f.TEST)},70659:(a,b,c)=>{c.d(b,{dL:()=>h,uR:()=>i});var d=c(8575),e=c(98708),f=c(10289);class g extends f.pe{static [d.i]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default((0,e.ll)`gen_random_uuid()`)}build(a){return new h(a,this.config)}}class h extends f.Kl{static [d.i]="PgUUID";getSQLType(){return"uuid"}}function i(a){return new g(a??"")}},71068:(a,b,c)=>{c.d(b,{a:()=>g,b:()=>j,c:()=>i,g:()=>h});var d=c(70250),e=c(22041);function f(a,b="/api/auth"){return!function(a){try{let b=new URL(a);return"/"!==b.pathname}catch(b){throw new e.B(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a)?(b=b.startsWith("/")?b:`/${b}`,`${a.replace(/\/+$/,"")}${b}`):a}function g(a,b,c){if(a)return f(a,b);let g=d.e.BETTER_AUTH_URL||d.e.NEXT_PUBLIC_BETTER_AUTH_URL||d.e.PUBLIC_BETTER_AUTH_URL||d.e.NUXT_PUBLIC_BETTER_AUTH_URL||d.e.NUXT_PUBLIC_AUTH_URL||("/"!==d.e.BASE_URL?d.e.BASE_URL:void 0);if(g)return f(g,b);let i=c?.headers.get("x-forwarded-host"),j=c?.headers.get("x-forwarded-proto");if(i&&j)return f(`${j}://${i}`,b);if(c){let a=h(c.url);if(!a)throw new e.B("Could not get origin from request. Please provide a valid base URL.");return f(a,b)}if("undefined"!=typeof window&&window.location)return f(window.location.origin,b)}function h(a){try{return new URL(a).origin}catch(a){return null}}function i(a){try{return new URL(a).protocol}catch(a){return null}}function j(a){try{return new URL(a).host}catch(b){return a}}},71763:(a,b,c)=>{c.d(b,{i:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"SetOperationNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"SetOperationNode",operator:a,expression:b,all:c})})},71767:(a,b,c)=>{c.d(b,{L:()=>o});var d=c(88565),e=c(91054),f=c(97733),g=c(94295),h=c(11182),i=c(59659);let j=(0,i.CN)({is:a=>"ReturningNode"===a.kind,create:a=>(0,i.CN)({kind:"ReturningNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})}),k=(0,i.CN)({is:a=>"ExplainNode"===a.kind,create:(a,b)=>(0,i.CN)({kind:"ExplainNode",format:a,options:b})});var l=c(79648);let m=(0,i.CN)({is:a=>"OutputNode"===a.kind,create:a=>(0,i.CN)({kind:"OutputNode",selections:(0,i.CN)(a)}),cloneWithSelections:(a,b)=>(0,i.CN)({...a,selections:a.selections?(0,i.CN)([...a.selections,...b]):(0,i.CN)(b)})});var n=c(22715);let o=(0,i.CN)({is:a=>e.L.is(a)||d.o.is(a)||f.U.is(a)||g.e.is(a)||l.r.is(a),cloneWithEndModifier:(a,b)=>(0,i.CN)({...a,endModifiers:a.endModifiers?(0,i.CN)([...a.endModifiers,b]):(0,i.CN)([b])}),cloneWithWhere:(a,b)=>(0,i.CN)({...a,where:a.where?h.o.cloneWithOperation(a.where,"And",b):h.o.create(b)}),cloneWithJoin:(a,b)=>(0,i.CN)({...a,joins:a.joins?(0,i.CN)([...a.joins,b]):(0,i.CN)([b])}),cloneWithReturning:(a,b)=>(0,i.CN)({...a,returning:a.returning?j.cloneWithSelections(a.returning,b):j.create(b)}),cloneWithoutReturning:a=>(0,i.CN)({...a,returning:void 0}),cloneWithoutWhere:a=>(0,i.CN)({...a,where:void 0}),cloneWithExplain:(a,b,c)=>(0,i.CN)({...a,explain:k.create(b,c?.toOperationNode())}),cloneWithTop:(a,b)=>(0,i.CN)({...a,top:b}),cloneWithOutput:(a,b)=>(0,i.CN)({...a,output:a.output?m.cloneWithSelections(a.output,b):m.create(b)}),cloneWithOrderByItems:(a,b)=>(0,i.CN)({...a,orderBy:a.orderBy?n.O.cloneWithItems(a.orderBy,b):n.O.create(b)}),cloneWithoutOrderBy:a=>(0,i.CN)({...a,orderBy:void 0})})},72354:(a,b,c)=>{c.d(b,{J:()=>f,n:()=>e});var d=c(8575);class e{static [d.i]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class f extends e{static [d.i]="WithSubquery"}},78215:(a,b,c)=>{c.d(b,{SS:()=>j,YK:()=>h,v0:()=>i});var d=c(9744),e=c(23244),f=c(65505),g=c(59659);function h(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid expression: ${JSON.stringify(a)}`)}function i(a){if((0,e.N)(a))return a.toOperationNode();if((0,g.Tn)(a))return a((0,f.A)()).toOperationNode();throw Error(`invalid aliased expression: ${JSON.stringify(a)}`)}function j(a){return(0,d.B)(a)||(0,d.q)(a)||(0,g.Tn)(a)}},78257:(a,b,c)=>{c.d(b,{A:()=>d});function d(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}},79288:(a,b,c)=>{c.d(b,{M3:()=>g,W2:()=>f,ll:()=>e,t9:()=>h});var d=c(78257);function e(a){return(0,d.A)(a)&&"string"==typeof a.kty}function f(a){return"oct"!==a.kty&&"string"==typeof a.d}function g(a){return"oct"!==a.kty&&void 0===a.d}function h(a){return e(a)&&"oct"===a.kty&&"string"==typeof a.k}},79609:(a,b,c)=>{c.d(b,{A:()=>e});let d=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,e=a=>{let b,c=d.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let e=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(e);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*e);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*e);break;case"day":case"days":case"d":b=Math.round(86400*e);break;case"week":case"weeks":case"w":b=Math.round(604800*e);break;default:b=Math.round(0x1e187e0*e)}return"-"===c[1]||"ago"===c[4]?-b:b}},79648:(a,b,c)=>{c.d(b,{r:()=>f});var d=c(59659),e=c(84793);let f=(0,d.CN)({is:a=>"MergeQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"MergeQueryNode",into:a,...b&&{with:b}}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:b}),cloneWithWhen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens,b]):(0,d.CN)([b])}),cloneWithThen:(a,b)=>(0,d.CN)({...a,whens:a.whens?(0,d.CN)([...a.whens.slice(0,-1),e.t.cloneWithResult(a.whens[a.whens.length-1],b)]):void 0})})},79841:(a,b,c)=>{c.d(b,{$4:()=>m,BT:()=>l,Dm:()=>k,Dp:()=>j,Rb:()=>g,T0:()=>h,Ye:()=>i,h2:()=>o,i4:()=>d,ie:()=>e,n:()=>f,xb:()=>n});class d extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class e extends d{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class f extends d{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class g extends d{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class h extends d{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class i extends d{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class j extends d{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class k extends d{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class l extends d{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(a="no applicable key found in the JSON Web Key Set",b){super(a,b)}}class m extends d{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class n extends d{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(a="request timed out",b){super(a,b)}}class o extends d{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}},80038:(a,b,c)=>{c.d(b,{bE:()=>o,xk:()=>p});var d=c(29995),e=c(9744),f=c(59659);let g=(0,f.CN)({is:a=>"OrderByItemNode"===a.kind,create:(a,b)=>(0,f.CN)({kind:"OrderByItemNode",orderBy:a,direction:b}),cloneWith:(a,b)=>(0,f.CN)({...a,...b})});var h=c(82493),i=c(44344);let j={create:a=>(0,f.CN)({kind:"CollateNode",collation:i.O.create(a)})};class k{#g;constructor(a){this.#g=(0,f.CN)(a)}desc(){return new k({node:g.cloneWith(this.#g.node,{direction:h.z.createWithSql("desc")})})}asc(){return new k({node:g.cloneWith(this.#g.node,{direction:h.z.createWithSql("asc")})})}nullsLast(){return new k({node:g.cloneWith(this.#g.node,{nulls:"last"})})}nullsFirst(){return new k({node:g.cloneWith(this.#g.node,{nulls:"first"})})}collate(a){return new k({node:g.cloneWith(this.#g.node,{collation:j.create(a)})})}toOperationNode(){return this.#g.node}}var l=c(62020),m=c(78215),n=c(34082);function o(a){return"asc"===a||"desc"===a}function p(a){if(2===a.length)return[q(a[0],a[1])];if(1===a.length){let[b]=a;return Array.isArray(b)?((0,l.u)("orderBy(array) is deprecated, use multiple orderBy calls instead."),b.map(a=>q(a))):[q(b)]}throw Error(`Invalid number of arguments at order by! expected 1-2, received ${a.length}`)}function q(a,b){let c=function(a){if((0,m.SS)(a))return(0,m.YK)(a);if((0,d.C)(a))return a.toOperationNode();let[b,c]=a.split(" ");return c?((0,l.u)("`orderBy('column asc')` is deprecated. Use `orderBy('column', 'asc')` instead."),r((0,n.q5)(b),c)):(0,n.q5)(a)}(a);if(g.is(c)){if(b)throw Error("Cannot specify direction twice!");return c}return r(c,b)}function r(a,b){if("string"==typeof b){if(!o(b))throw Error(`Invalid order by direction: ${b}`);return g.create(a,h.z.createWithSql(b))}if((0,e.B)(b))return(0,l.u)("`orderBy(..., expr)` is deprecated. Use `orderBy(..., 'asc')` or `orderBy(..., (ob) => ...)` instead."),g.create(a,b.toOperationNode());let c=g.create(a);return b?b(new k({node:c})).toOperationNode():c}},80548:(a,b,c)=>{c.d(b,{OU:()=>j});var d=c(88202),e=c(59659),f=c(4457),g=c(84793),h=c(18634),i=c(93806);class j{#g;constructor(a){this.#g=(0,e.CN)(a)}when(...a){return new k({...this.#g,node:f.P.cloneWithWhen(this.#g.node,g.t.create((0,h.GB)(a)))})}}class k{#g;constructor(a){this.#g=(0,e.CN)(a)}then(a){return new l({...this.#g,node:f.P.cloneWithThen(this.#g.node,(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a))})}}class l{#g;constructor(a){this.#g=(0,e.CN)(a)}when(...a){return new k({...this.#g,node:f.P.cloneWithWhen(this.#g.node,g.t.create((0,h.GB)(a)))})}else(a){return new m({...this.#g,node:f.P.cloneWith(this.#g.node,{else:(0,i.qH)(a)?(0,i.dJ)(a):(0,i.$s)(a)})})}end(){return new d.Is(f.P.cloneWith(this.#g.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#g.node,{isStatement:!0}))}}class m{#g;constructor(a){this.#g=(0,e.CN)(a)}end(){return new d.Is(f.P.cloneWith(this.#g.node,{isStatement:!1}))}endCase(){return new d.Is(f.P.cloneWith(this.#g.node,{isStatement:!0}))}}},82493:(a,b,c)=>{c.d(b,{z:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"RawNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"RawNode",sqlFragments:(0,d.CN)(a),parameters:(0,d.CN)(b)}),createWithSql:a=>e.create([a],[]),createWithChild:a=>e.create(["",""],[a]),createWithChildren:a=>e.create(Array(a.length+1).fill(""),a)})},82644:(a,b,c)=>{c.d(b,{E:()=>g});var d=c(82493),e=c(59659),f=c(70030);let g=(0,e.CN)({raw:(a,b=[])=>(0,e.CN)({sql:a,query:d.z.createWithSql(a),parameters:(0,e.CN)(b),queryId:(0,f.a)()})})},84246:(a,b,c)=>{c.d(b,{Pq:()=>h,iX:()=>g});var d=c(8575),e=c(10289);class f extends e.pe{static [d.i]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new g(a,this.config)}}class g extends e.Kl{static [d.i]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function h(a){return new f(a??"")}},84719:(a,b,c)=>{c.d(b,{a:()=>e});let d=new Map,e={decode:(a,b="utf-8")=>(d.has(b)||d.set(b,new TextDecoder(b)),d.get(b).decode(a)),encode:new TextEncoder().encode}},84793:(a,b,c)=>{c.d(b,{t:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"WhenNode"===a.kind,create:a=>(0,d.CN)({kind:"WhenNode",condition:a}),cloneWithResult:(a,b)=>(0,d.CN)({...a,result:b})})},86434:(a,b,c)=>{c.d(b,{A:()=>f,g:()=>g});var d=c(26407),e=c(66626);let f=a=>(0,e.A)(a)||(0,d.R)(a),g=["KeyObject"];(globalThis.CryptoKey||d.A?.CryptoKey)&&g.push("CryptoKey")},87197:(a,b,c)=>{c.d(b,{y:()=>f});var d=c(59659),e=c(44344);let f=(0,d.CN)({is:a=>"SchemableIdentifierNode"===a.kind,create:a=>(0,d.CN)({kind:"SchemableIdentifierNode",identifier:e.O.create(a)}),createWithSchema:(a,b)=>(0,d.CN)({kind:"SchemableIdentifierNode",schema:e.O.create(a),identifier:e.O.create(b)})})},87265:(a,b,c)=>{c.d(b,{JM:()=>i,Kd:()=>h,Wk:()=>j,a$:()=>g});var d=c(15017),e=c(58054);let f=(a,b)=>{a.name="$ZodError",Object.defineProperty(a,"_zod",{value:a._zod,enumerable:!1}),Object.defineProperty(a,"issues",{value:b,enumerable:!1}),a.message=JSON.stringify(b,e.k8,2),Object.defineProperty(a,"toString",{value:()=>a.message,enumerable:!1})},g=(0,d.xI)("$ZodError",f),h=(0,d.xI)("$ZodError",f,{Parent:Error});function i(a,b=a=>a.message){let c={},d=[];for(let e of a.issues)e.path.length>0?(c[e.path[0]]=c[e.path[0]]||[],c[e.path[0]].push(b(e))):d.push(b(e));return{formErrors:d,fieldErrors:c}}function j(a,b){let c=b||function(a){return a.message},d={_errors:[]},e=a=>{for(let b of a.issues)if("invalid_union"===b.code&&b.errors.length)b.errors.map(a=>e({issues:a}));else if("invalid_key"===b.code)e({issues:b.issues});else if("invalid_element"===b.code)e({issues:b.issues});else if(0===b.path.length)d._errors.push(c(b));else{let a=d,e=0;for(;e<b.path.length;){let d=b.path[e];e===b.path.length-1?(a[d]=a[d]||{_errors:[]},a[d]._errors.push(c(b))):a[d]=a[d]||{_errors:[]},a=a[d],e++}}};return e(a),d}},87686:(a,b,c)=>{c.d(b,{Q:()=>i});var d=c(59659);let e=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary","int4range","int4multirange","int8range","int8multirange","numrange","nummultirange","tsrange","tsmultirange","tstzrange","tstzmultirange","daterange","datemultirange"],f=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],g=(0,d.CN)({is:a=>"DataTypeNode"===a.kind,create:a=>(0,d.CN)({kind:"DataTypeNode",dataType:a})});var h=c(23244);function i(a){if((0,h.N)(a))return a.toOperationNode();if(e.includes(a)||f.some(b=>b.test(a)))return g.create(a);throw Error(`invalid column data type ${JSON.stringify(a)}`)}},88202:(a,b,c)=>{c.d(b,{Is:()=>k});var d=c(15539),e=c(58436),f=c(44344),g=c(23244),h=c(38070),i=c(36398),j=c(18634);class k{#H;constructor(a){this.#H=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#H,(0,j.GB)(a)))}and(...a){return new n(e.s.create(this.#H,(0,j.GB)(a)))}$castTo(){return new k(this.#H)}$notNull(){return new k(this.#H)}toOperationNode(){return this.#H}}class l{#L;#j;constructor(a,b){this.#L=a,this.#j=b}get expression(){return this.#L}get alias(){return this.#j}toOperationNode(){return d.N.create(this.#L.toOperationNode(),(0,g.N)(this.#j)?this.#j.toOperationNode():f.O.create(this.#j))}}class m{#H;constructor(a){this.#H=a}get expressionType(){}as(a){return new l(this,a)}or(...a){return new m(h.K.create(this.#H,(0,j.GB)(a)))}$castTo(){return new m(this.#H)}toOperationNode(){return i.k.create(this.#H)}}class n{#H;constructor(a){this.#H=a}get expressionType(){}as(a){return new l(this,a)}and(...a){return new n(e.s.create(this.#H,(0,j.GB)(a)))}$castTo(){return new n(this.#H)}toOperationNode(){return i.k.create(this.#H)}}},88565:(a,b,c)=>{c.d(b,{o:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"InsertQueryNode"===a.kind,create:(a,b,c)=>(0,d.CN)({kind:"InsertQueryNode",into:a,...b&&{with:b},replace:c}),createWithoutInto:()=>(0,d.CN)({kind:"InsertQueryNode"}),cloneWith:(a,b)=>(0,d.CN)({...a,...b})})},89100:(a,b,c)=>{c.d(b,{A:()=>e});var d=c(79841);let e=function(a,b,c,e,f){let g;if(void 0!==f.crit&&e?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!e||void 0===e.crit)return new Set;if(!Array.isArray(e.crit)||0===e.crit.length||e.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let h of(g=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,e.crit)){if(!g.has(h))throw new d.T0(`Extension Header Parameter "${h}" is not recognized`);if(void 0===f[h])throw new a(`Extension Header Parameter "${h}" is missing`);if(g.get(h)&&void 0===e[h])throw new a(`Extension Header Parameter "${h}" MUST be integrity protected`)}return new Set(e.crit)}},89915:(a,b,c)=>{c.d(b,{kQ:()=>e,sy:()=>f});var d=c(59659);let e="kysely_migration",f="kysely_migration_lock";(0,d.CN)({__noMigrations__:!0})},90593:(a,b,c)=>{c.d(b,{Z5:()=>h,sH:()=>m});var d=c(8575),e=c(37103),f=c(10289);class g extends f.pe{static [d.i]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new h(a,this.config)}}class h extends f.Kl{static [d.i]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class i extends f.pe{static [d.i]="PgNumericNumberBuilder";constructor(a,b,c){super(a,"number","PgNumericNumber"),this.config.precision=b,this.config.scale=c}build(a){return new j(a,this.config)}}class j extends f.Kl{static [d.i]="PgNumericNumber";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class k extends f.pe{static [d.i]="PgNumericBigIntBuilder";constructor(a,b,c){super(a,"bigint","PgNumericBigInt"),this.config.precision=b,this.config.scale=c}build(a){return new l(a,this.config)}}class l extends f.Kl{static [d.i]="PgNumericBigInt";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function m(a,b){let{name:c,config:d}=(0,e.Ll)(a,b),f=d?.mode;return"number"===f?new i(c,d?.precision,d?.scale):"bigint"===f?new k(c,d?.precision,d?.scale):new g(c,d?.precision,d?.scale)}},91054:(a,b,c)=>{c.d(b,{L:()=>k});var d=c(59659),e=c(49161);let f=(0,d.CN)({is:a=>"GroupByNode"===a.kind,create:a=>(0,d.CN)({kind:"GroupByNode",items:(0,d.CN)(a)}),cloneWithItems:(a,b)=>(0,d.CN)({...a,items:(0,d.CN)([...a.items,...b])})});var g=c(58436),h=c(38070);let i=(0,d.CN)({is:a=>"HavingNode"===a.kind,create:a=>(0,d.CN)({kind:"HavingNode",having:a}),cloneWithOperation:(a,b,c)=>(0,d.CN)({...a,having:"And"===b?g.s.create(a.having,c):h.K.create(a.having,c)})});var j=c(71767);let k=(0,d.CN)({is:a=>"SelectQueryNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectQueryNode",...a&&{with:a}}),createFrom:(a,b)=>(0,d.CN)({kind:"SelectQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithSelections:(a,b)=>(0,d.CN)({...a,selections:a.selections?(0,d.CN)([...a.selections,...b]):(0,d.CN)(b)}),cloneWithDistinctOn:(a,b)=>(0,d.CN)({...a,distinctOn:a.distinctOn?(0,d.CN)([...a.distinctOn,...b]):(0,d.CN)(b)}),cloneWithFrontModifier:(a,b)=>(0,d.CN)({...a,frontModifiers:a.frontModifiers?(0,d.CN)([...a.frontModifiers,b]):(0,d.CN)([b])}),cloneWithOrderByItems:(a,b)=>j.L.cloneWithOrderByItems(a,b),cloneWithGroupByItems:(a,b)=>(0,d.CN)({...a,groupBy:a.groupBy?f.cloneWithItems(a.groupBy,b):f.create(b)}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithOffset:(a,b)=>(0,d.CN)({...a,offset:b}),cloneWithFetch:(a,b)=>(0,d.CN)({...a,fetch:b}),cloneWithHaving:(a,b)=>(0,d.CN)({...a,having:a.having?i.cloneWithOperation(a.having,"And",b):i.create(b)}),cloneWithSetOperations:(a,b)=>(0,d.CN)({...a,setOperations:a.setOperations?(0,d.CN)([...a.setOperations,...b]):(0,d.CN)([...b])}),cloneWithoutSelections:a=>(0,d.CN)({...a,selections:[]}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithoutOffset:a=>(0,d.CN)({...a,offset:void 0}),cloneWithoutOrderBy:a=>j.L.cloneWithoutOrderBy(a),cloneWithoutGroupBy:a=>(0,d.CN)({...a,groupBy:void 0})})},91164:(a,b,c)=>{c.d(b,{J:()=>n,G:()=>function a(b){return(0,d.Tn)(b)?a(b((0,l.A)())):(0,d.MH)(b)?b.map(a=>m(a)):[m(b)]}});var d=c(59659),e=c(50952),f=c(3047);let g=(0,d.CN)({is:a=>"SelectionNode"===a.kind,create:a=>(0,d.CN)({kind:"SelectionNode",selection:a}),createSelectAll:()=>(0,d.CN)({kind:"SelectionNode",selection:f.U.create()}),createSelectAllFromTable:a=>(0,d.CN)({kind:"SelectionNode",selection:e.q.createSelectAll(a)})});var h=c(34082),i=c(29995),j=c(78215),k=c(15021),l=c(65505);function m(a){return(0,d.Kg)(a)?g.create((0,h.DT)(a)):(0,i.C)(a)?g.create(a.toOperationNode()):g.create((0,j.v0)(a))}function n(a){return a?Array.isArray(a)?a.map(o):[o(a)]:[g.createSelectAll()]}function o(a){if((0,d.Kg)(a))return g.createSelectAllFromTable((0,k.M$)(a));throw Error(`invalid value selectAll expression: ${JSON.stringify(a)}`)}},93330:(a,b,c)=>{c.d(b,{I:()=>j});var d=c(54983),e=c(86434),f=c(79288);let g=a=>a?.[Symbol.toStringTag],h=(a,b,c)=>{if(void 0!==b.use&&"sig"!==b.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==b.key_ops&&b.key_ops.includes?.(c)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${c}`);if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, when present its alg must be ${a}`);return!0};function i(a,b,c,i){b.startsWith("HS")||"dir"===b||b.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(b)?((a,b,c,i)=>{if(!(b instanceof Uint8Array)){if(i&&f.ll(b)){if(f.t9(b)&&h(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!(0,e.A)(b))throw TypeError((0,d.t)(a,b,...e.g,"Uint8Array",i?"JSON Web Key":null));if("secret"!==b.type)throw TypeError(`${g(b)} instances for symmetric algorithms must be of type "secret"`)}})(b,c,i,a):((a,b,c,i)=>{if(i&&f.ll(b))switch(c){case"sign":if(f.W2(b)&&h(a,b,c))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(f.M3(b)&&h(a,b,c))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!(0,e.A)(b))throw TypeError((0,d.t)(a,b,...e.g,i?"JSON Web Key":null));if("secret"===b.type)throw TypeError(`${g(b)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===c&&"public"===b.type)throw TypeError(`${g(b)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===c&&"public"===b.type)throw TypeError(`${g(b)} instances for asymmetric algorithm decryption must be of type "private"`);if(b.algorithm&&"verify"===c&&"private"===b.type)throw TypeError(`${g(b)} instances for asymmetric algorithm verifying must be of type "public"`);if(b.algorithm&&"encrypt"===c&&"private"===b.type)throw TypeError(`${g(b)} instances for asymmetric algorithm encryption must be of type "public"`)})(b,c,i,a)}i.bind(void 0,!1);let j=i.bind(void 0,!0)},93806:(a,b,c)=>{c.d(b,{$s:()=>j,U2:()=>i,dJ:()=>l,qH:()=>k});var d=c(60949),e=c(33385),f=c(65968),g=c(59659),h=c(78215);function i(a){var b;return(0,g.MH)(a)?(b=a).some(h.SS)?e.s.create(b.map(a=>j(a))):d.h.create(b):j(a)}function j(a){return(0,h.SS)(a)?(0,h.YK)(a):f.q.create(a)}function k(a){return(0,g.Et)(a)||(0,g.Lm)(a)||(0,g.kZ)(a)}function l(a){if(!k(a))throw Error(`unsafe immediate value ${JSON.stringify(a)}`);return f.q.createImmediate(a)}},94295:(a,b,c)=>{c.d(b,{e:()=>h});var d=c(59659),e=c(49161);let f=(0,d.CN)({is:a=>"UsingNode"===a.kind,create:a=>(0,d.CN)({kind:"UsingNode",tables:(0,d.CN)(a)}),cloneWithTables:(a,b)=>(0,d.CN)({...a,tables:(0,d.CN)([...a.tables,...b])})});var g=c(71767);let h=(0,d.CN)({is:a=>"DeleteQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"DeleteQueryNode",from:e.N.create(a),...b&&{with:b}}),cloneWithOrderByItems:(a,b)=>g.L.cloneWithOrderByItems(a,b),cloneWithoutOrderBy:a=>g.L.cloneWithoutOrderBy(a),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b}),cloneWithoutLimit:a=>(0,d.CN)({...a,limit:void 0}),cloneWithUsing:(a,b)=>(0,d.CN)({...a,using:void 0!==a.using?f.cloneWithTables(a.using,b):f.create(b)})})},94936:(a,b,c)=>{c.d(b,{li:()=>cg});var d=c(506),e=c(18093),f=c(42261),g=c(34698),h=c(39955),i=c(70250),j=c(44989);function k(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;if(i.i)return"127.0.0.1";let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let b="get"in c?c.get(a):c[a];if("string"==typeof b){var d;let a=b.split(",")[0].trim();if(d=a,/^(\d{1,3}\.){3}\d{1,3}$/.test(d)?d.split(".").map(Number).every(a=>a>=0&&a<=255):/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(d))return a}}return null}var l=c(32378);c(95856),c(59061);var m=c(22887);c(15247),c(22321),c(28945);var n=c(71068),o=c(22041);c(11673),c(84719);let p=new Map;async function q(a,b){if(!b.rateLimit.enabled)return;let c=new URL(a.url).pathname.replace(b.options.basePath||"/api/auth",""),d=b.rateLimit.window,f=b.rateLimit.max,g=k(a,b.options);if(!g)return void console.warn("No IP address found for rate limiting");let h=g+c,i=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(c));for(let a of(i&&(d=i.window,f=i.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(c));if(b){d=b.window,f=b.max;break}}if(b.rateLimit.customRules){let g=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?(0,e.x)(a)(c):a===c);if(g){let c=b.rateLimit.customRules[g],e="function"==typeof c?await c(a):c;e&&(d=e.window,f=e.max)}}let j=function(a){if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;if("secondary-storage"===a.rateLimit.storage)return{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?JSON.parse(c):void 0},set:async(b,c)=>{await a.options.secondaryStorage?.set?.(b,JSON.stringify(c))}};if("memory"===a.rateLimit.storage)return{get:async a=>p.get(a),async set(a,b,c){p.set(a,b)}};let b="rateLimit",c=a.adapter;return{get:async a=>{let d=(await c.findMany({model:b,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof d?.lastRequest&&(d.lastRequest=Number(d.lastRequest)),d},set:async(d,e,f)=>{try{f?await c.updateMany({model:b,where:[{field:"key",value:d}],update:{count:e.count,lastRequest:e.lastRequest}}):await c.create({model:b,data:{key:d,count:e.count,lastRequest:e.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}}}(b),l=await j.get(h),m=Date.now();if(l){var n,o,q,r;let a=m-l.lastRequest;if(n=f,o=d,q=l,Date.now()-q.lastRequest<1e3*o&&q.count>=n){return r=Math.ceil((l.lastRequest+1e3*d-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":r.toString()}})}a>1e3*d?await j.set(h,{...l,count:1,lastRequest:m},!0):await j.set(h,{...l,count:l.count+1,lastRequest:m},!0)}else await j.set(h,{key:h,count:1,lastRequest:m})}async function r(a,b){let c={};for(let d of b)if(d.matcher(a)){let b=await d.handler({...a,returnHeaders:!1});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=(0,l.Ay)(d,c);continue}return b}}return{context:c}}async function s(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(a=>{if(a instanceof d.LG)return{response:a,headers:a.headers?new Headers(a.headers):null};throw a});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}function t(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{}),j=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>b.middleware({...c,context:{...a,...c.context}});return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[];return{api:function(a,b){let c={};for(let[e,f]of Object.entries(a))c[e]=async a=>{let c=await b,e={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:f.path,headers:a?.headers?new Headers(a?.headers):void 0},{beforeHooks:g,afterHooks:h}=function(a){let b=a.options.plugins||[],c=[],d=[];a.options.hooks?.before&&c.push({matcher:()=>!0,handler:a.options.hooks.before}),a.options.hooks?.after&&d.push({matcher:()=>!0,handler:a.options.hooks.after});let e=b.map(a=>{if(a.hooks?.before)return a.hooks.before}).filter(a=>void 0!==a).flat(),f=b.map(a=>{if(a.hooks?.after)return a.hooks.after}).filter(a=>void 0!==a).flat();return e.length&&c.push(...e),f.length&&d.push(...f),{beforeHooks:c,afterHooks:d}}(c),i=await r(e,g);if("context"in i&&i.context&&"object"==typeof i.context){let{headers:a,...b}=i.context;a&&a.forEach((a,b)=>{e.headers.set(b,a)}),e=(0,l.Ay)(b,e)}else if(i)return i;e.asResponse=!1,e.returnHeaders=!0;let j=await f(e).catch(a=>{if(a instanceof d.LG)return{response:a,headers:a.headers?new Headers(a.headers):null};throw a});e.context.returned=j.response,e.context.responseHeaders=j.headers;let k=await s(e,h);if(k.response&&(j.response=k.response),j.response instanceof d.LG&&!a?.asResponse)throw j.response;return a?.asResponse?(0,d.Zr)(j.response,{headers:j.headers}):a?.returnHeaders?{headers:j.headers,response:j.response}:j.response},c[e].path=f.path,c[e].options=f.options;return c}({...{signInSocial:e.a1,callbackOAuth:e.a0,getSession:(0,e.m)(),signOut:e.$,signUpEmail:(0,e.j)("/sign-up/email",{method:"POST",body:f.g1(f.Yj(),f.bz()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new d.LG("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:j,email:k,password:l,image:m,callbackURL:n,rememberMe:o,...p}=c;if(!f.Rp().safeParse(k).success)throw new d.LG("BAD_REQUEST",{message:e.B.INVALID_EMAIL});let q=a.context.password.config.minPasswordLength;if(l.length<q)throw a.context.logger.error("Password is too short"),new d.LG("BAD_REQUEST",{message:e.B.PASSWORD_TOO_SHORT});let r=a.context.password.config.maxPasswordLength;if(l.length>r)throw a.context.logger.error("Password is too long"),new d.LG("BAD_REQUEST",{message:e.B.PASSWORD_TOO_LONG});let s=await a.context.internalAdapter.findUserByEmail(k);if(s?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${k}`),new d.LG("UNPROCESSABLE_ENTITY",{message:e.B.USER_ALREADY_EXISTS});let t=(0,h.f)(a.context.options,p),u=await a.context.password.hash(l);try{if(!(b=await a.context.internalAdapter.createUser({email:k.toLowerCase(),name:j,image:m,...t,emailVerified:!1},a)))throw new d.LG("BAD_REQUEST",{message:e.B.FAILED_TO_CREATE_USER})}catch(b){if(i.b&&a.context.logger.error("Failed to create user",b),b instanceof d.LG)throw b;throw new d.LG("UNPROCESSABLE_ENTITY",{message:e.B.FAILED_TO_CREATE_USER,details:b})}if(!b)throw new d.LG("UNPROCESSABLE_ENTITY",{message:e.B.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:u},a),a.context.options.emailVerification?.sendOnSignUp||a.context.options.emailAndPassword.requireEmailVerification){let d=await (0,e.w)(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),f=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${c.callbackURL||"/"}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:b,url:f,token:d},a.request)}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}});let v=await a.context.internalAdapter.createSession(b.id,a,!1===o);if(!v)throw new d.LG("BAD_REQUEST",{message:e.B.FAILED_TO_CREATE_SESSION});return await (0,g.$G)(a,{session:v,user:b},!1===o),a.json({token:v.token,user:{id:b.id,email:b.email,name:b.name,image:b.image,emailVerified:b.emailVerified,createdAt:b.createdAt,updatedAt:b.updatedAt}})}),signInEmail:e._,forgetPassword:e.Z,resetPassword:e.Y,verifyEmail:e.X,sendVerificationEmail:e.W,changeEmail:e.V,changePassword:e.U,setPassword:e.T,updateUser:(0,e.z)(),deleteUser:e.S,forgetPasswordCallback:e.R,requestPasswordReset:e.Q,requestPasswordResetCallback:e.P,listSessions:(0,e.y)(),revokeSession:e.O,revokeSessions:e.N,revokeOtherSessions:e.M,linkSocialAccount:e.L,listUserAccounts:e.K,deleteUserCallback:e.J,unlinkAccount:e.I,refreshToken:e.G,getAccessToken:e.F,accountInfo:e.E},...c,ok:e.D,error:e.C},a),middlewares:j}}var u=c(36846),v=c(98642),w=c(20493),x=c(91054),y=c(44344),z=c(82493);function A(a,b){return z.z.createWithChildren([z.z.createWithSql(`${a} `),y.O.create(b)])}var B=c(82644),C=c(59659),D=c(70030);class E{#M;#N=new G;#O;#P;constructor(a){this.#M=(0,C.CN)({...a})}async init(){this.#O=(0,C.Tn)(this.#M.database)?await this.#M.database():this.#M.database,this.#P=new F(this.#O),this.#M.onCreateConnection&&await this.#M.onCreateConnection(this.#P)}async acquireConnection(){return await this.#N.lock(),this.#P}async beginTransaction(a){await a.executeQuery(B.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(B.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(B.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(A("savepoint",b),(0,D.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(A("rollback to",b),(0,D.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(A("release",b),(0,D.a)()))}async releaseConnection(){this.#N.unlock()}async destroy(){this.#O?.close()}}class F{#O;constructor(a){this.#O=a}executeQuery(a){let{sql:b,parameters:c}=a,d=this.#O.prepare(b);if(d.reader)return Promise.resolve({rows:d.all(c)});let{changes:e,lastInsertRowid:f}=d.run(c);return Promise.resolve({numAffectedRows:null!=e?BigInt(e):void 0,insertId:null!=f?BigInt(f):void 0,rows:[]})}async *streamQuery(a,b){let{sql:c,parameters:d,query:e}=a,f=this.#O.prepare(c);if(x.L.is(e))for(let a of f.iterate(d))yield{rows:[a]};else throw Error("Sqlite driver only supports streaming of select queries")}}class G{#a;#b;async lock(){for(;this.#a;)await this.#a;this.#a=new Promise(a=>{this.#b=a})}unlock(){let a=this.#b;this.#a=void 0,this.#b=void 0,a?.()}}var H=c(26764);let I=/"/g;class J extends H.n{visitOrAction(a){this.append("or "),this.append(a.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(a){return a.replace(I,'""')}visitDefaultInsertValue(a){this.append("null")}}var K=c(89915),L=c(52094);class M{#O;constructor(a){this.#O=a}async getSchemas(){return[]}async getTables(a={withInternalKyselyTables:!1}){return await this.#Q(a)}async getMetadata(a){return{tables:await this.getTables(a)}}#R(a,b){let c=a.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return b.withInternalKyselyTables||(c=c.where("name","!=",K.kQ).where("name","!=",K.sy)),c}async #Q(a){let b=await this.#R(this.#O,a).execute(),c=await this.#O.with("table_list",b=>this.#R(b,a)).selectFrom(["table_list as tl",(0,L.l)`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),d={};for(let a of c)d[a.table]??=[],d[a.table].push(a);return b.map(({name:a,sql:b,type:c})=>{let e=b?.split(/[\(\),]/)?.find(a=>a.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),f=d[a]??[];if(!e){let a=f.filter(a=>a.pk>0);1===a.length&&"integer"===a[0].type.toLowerCase()&&(e=a[0].name)}return{name:a,isView:"view"===c,columns:f.map(a=>({name:a.name,dataType:a.type,isNullable:!a.notnull,isAutoIncrementing:a.name===e,hasDefaultValue:null!=a.dflt_value,comment:void 0}))}})}}class N{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class O extends N{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(a,b){}async releaseMigrationLock(a,b){}}class P{#M;constructor(a){this.#M=(0,C.CN)({...a})}createDriver(){return new E(this.#M)}createQueryCompiler(){return new J}createAdapter(){return new O}createIntrospector(a){return new M(a)}}function Q(a,b){var c;if(c=a,(0,C.Gv)(c)&&(0,C.Kg)(c.stack)&&b.stack){let c=b.stack.split("\n").slice(1).join("\n");a.stack+=`
${c}`}return a}let R=Symbol();class S{#M;#S=new WeakMap;#T;constructor(a){this.#M=(0,C.CN)({...a})}async init(){this.#T=(0,C.Tn)(this.#M.pool)?await this.#M.pool():this.#M.pool}async acquireConnection(){let a=await this.#U(),b=this.#S.get(a);return!b&&(b=new T(a),this.#S.set(a,b),this.#M?.onCreateConnection&&await this.#M.onCreateConnection(b)),this.#M?.onReserveConnection&&await this.#M.onReserveConnection(b),b}async #U(){return new Promise((a,b)=>{this.#T.getConnection(async(c,d)=>{c?b(c):a(d)})})}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c=[];b.isolationLevel&&c.push(`isolation level ${b.isolationLevel}`),b.accessMode&&c.push(b.accessMode);let d=`set transaction ${c.join(", ")}`;await a.executeQuery(B.E.raw(d))}await a.executeQuery(B.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(B.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(B.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(A("savepoint",b),(0,D.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(A("rollback to",b),(0,D.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(A("release savepoint",b),(0,D.a)()))}async releaseConnection(a){a[R]()}async destroy(){return new Promise((a,b)=>{this.#T.end(c=>{c?b(c):a()})})}}class T{#V;constructor(a){this.#V=a}async executeQuery(a){try{let b=await this.#W(a);if((0,C.Gv)(b)&&"insertId"in b&&"affectedRows"in b){let{insertId:a,affectedRows:c,changedRows:d}=b;return{insertId:null!=a&&"0"!==a.toString()?BigInt(a):void 0,numAffectedRows:null!=c?BigInt(c):void 0,numChangedRows:null!=d?BigInt(d):void 0,rows:[]}}if(Array.isArray(b))return{rows:b};return{rows:[]}}catch(a){throw Q(a,Error())}}#W(a){return new Promise((b,c)=>{this.#V.query(a.sql,a.parameters,(a,d)=>{a?c(a):b(d)})})}async *streamQuery(a,b){let c=this.#V.query(a.sql,a.parameters).stream({objectMode:!0});try{for await(let a of c)yield{rows:[a]}}catch(a){if(a&&"object"==typeof a&&"code"in a&&"ERR_STREAM_PREMATURE_CLOSE"===a.code)return;throw a}}[R](){this.#V.release()}}let U=/`/g;class V extends H.n{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(a){return a.replace(U,"``")}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.using&&(this.append(" using "),this.visitNode(a.using)),a.table&&(this.append(" on "),this.visitNode(a.table)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.where&&(this.append(" "),this.visitNode(a.where))}}class W{#O;constructor(a){this.#O=a}async getSchemas(){return(await this.#O.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(a=>({name:a.SCHEMA_NAME}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#O.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",a=>a.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",(0,L.l)`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();a.withInternalKyselyTables||(b=b.where("columns.TABLE_NAME","!=",K.kQ).where("columns.TABLE_NAME","!=",K.sy));let c=await b.execute();return this.#X(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#X(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.TABLE_NAME);return c||(c=(0,C.CN)({name:b.TABLE_NAME,isView:"VIEW"===b.TABLE_TYPE,schema:b.TABLE_SCHEMA,columns:[]}),a.push(c)),c.columns.push((0,C.CN)({name:b.COLUMN_NAME,dataType:b.DATA_TYPE,isNullable:"YES"===b.IS_NULLABLE,isAutoIncrementing:b.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==b.COLUMN_DEFAULT,comment:""===b.COLUMN_COMMENT?void 0:b.COLUMN_COMMENT})),a},[])}}let X="ea586330-2c93-47c8-908d-981d9d270f9d";class Y extends N{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(a,b){await (0,L.l)`select get_lock(${L.l.lit(X)}, ${L.l.lit(3600)})`.execute(a)}async releaseMigrationLock(a,b){await (0,L.l)`select release_lock(${L.l.lit(X)})`.execute(a)}}class Z{#M;constructor(a){this.#M=a}createDriver(){return new S(this.#M)}createQueryCompiler(){return new V}createAdapter(){return new Y}createIntrospector(a){return new W(a)}}let $=Symbol();class _{#M;#S=new WeakMap;#T;constructor(a){this.#M=(0,C.CN)({...a})}async init(){this.#T=(0,C.Tn)(this.#M.pool)?await this.#M.pool():this.#M.pool}async acquireConnection(){let a=await this.#T.connect(),b=this.#S.get(a);return!b&&(b=new aa(a,{cursor:this.#M.cursor??null}),this.#S.set(a,b),this.#M.onCreateConnection&&await this.#M.onCreateConnection(b)),this.#M.onReserveConnection&&await this.#M.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(B.E.raw(c))}else await a.executeQuery(B.E.raw("begin"))}async commitTransaction(a){await a.executeQuery(B.E.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(B.E.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(A("savepoint",b),(0,D.a)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(A("rollback to",b),(0,D.a)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(A("release",b),(0,D.a)()))}async releaseConnection(a){a[$]()}async destroy(){if(this.#T){let a=this.#T;this.#T=void 0,await a.end()}}}class aa{#Y;#Z;constructor(a,b){this.#Y=a,this.#Z=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#Y.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw Q(a,Error())}}async *streamQuery(a,b){if(!this.#Z.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#Y.query(new this.#Z.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[$](){this.#Y.release()}}class ab{#O;constructor(a){this.#O=a}async getSchemas(){return(await this.#O.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#O.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",(0,L.l)`col_description(a.attrelid, a.attnum)`.as("column_description"),(0,L.l)`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=",K.kQ).where("c.relname","!=",K.sy));let c=await b.execute();return this.#X(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#X(a){return a.reduce((a,b)=>{let c=a.find(a=>a.name===b.table&&a.schema===b.schema);return c||(c=(0,C.CN)({name:b.table,isView:"v"===b.table_type,schema:b.schema,columns:[]}),a.push(c)),c.columns.push((0,C.CN)({name:b.column,dataType:b.type,dataTypeSchema:b.type_schema,isNullable:!b.not_null,isAutoIncrementing:null!==b.auto_incrementing,hasDefaultValue:b.has_default,comment:b.column_description??void 0})),a},[])}}let ac=/"/g;class ad extends H.n{sanitizeIdentifier(a){return a.replace(ac,'""')}}let ae=BigInt("3853314791062309107");class af extends N{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await (0,L.l)`select pg_advisory_xact_lock(${L.l.lit(ae)})`.execute(a)}async releaseMigrationLock(a,b){}}class ag{#M;constructor(a){this.#M=a}createDriver(){return new _(this.#M)}createQueryCompiler(){return new ad}createAdapter(){return new af}createIntrospector(a){return new ab(a)}}class ah extends N{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(a){await (0,L.l)`exec sp_getapplock @DbPrincipal = ${L.l.lit("dbo")}, @Resource = ${L.l.lit(K.kQ)}, @LockMode = ${L.l.lit("Exclusive")}`.execute(a)}async releaseMigrationLock(){}}var ai=c(60369),aj=c(16151);let ak=Symbol(),al=Symbol(),am=Symbol();class an{#M;#T;constructor(a){this.#M=(0,C.CN)({...a});let{tarn:b,tedious:c,validateConnections:d}=this.#M,{validateConnections:e,...f}=b.options;this.#T=new b.Pool({...f,create:async()=>{let a=await c.connectionFactory();return await new ao(a,c).connect()},destroy:async a=>{await a[al]()},validate:!1===d||!1===e?void 0:a=>a[am]()})}async init(){}async acquireConnection(){return await this.#T.acquire().promise}async beginTransaction(a,b){await a.beginTransaction(b)}async commitTransaction(a){await a.commitTransaction()}async rollbackTransaction(a){await a.rollbackTransaction()}async savepoint(a,b){await a.savepoint(b)}async rollbackToSavepoint(a,b){await a.rollbackTransaction(b)}async releaseConnection(a){(this.#M.resetConnectionsOnRelease||this.#M.tedious.resetConnectionOnRelease)&&await a[ak](),this.#T.release(a)}async destroy(){await this.#T.destroy()}}class ao{#P;#$;#_;constructor(a,b){this.#P=a,this.#$=!1,this.#_=b}async beginTransaction(a){let{isolationLevel:b}=a;await new Promise((a,c)=>this.#P.beginTransaction(b=>{b?c(b):a(void 0)},b?(0,ai.D)(8):void 0,b?this.#aa(b):void 0))}async commitTransaction(){await new Promise((a,b)=>this.#P.commitTransaction(c=>{c?b(c):a(void 0)}))}async connect(){let{promise:a,reject:b,resolve:c}=new aj.c;function d(){b(Error("The connection ended without ever completing the connection"))}return this.#P.connect(a=>{if(a)return b(a);c()}),this.#P.on("error",a=>{a instanceof Error&&"code"in a&&"ESOCKET"===a.code&&(this.#$=!0),console.error(a),b(a)}),this.#P.once("end",d),await a,this.#P.off("end",d),this}async executeQuery(a){try{let b=new aj.c,c=new ap({compiledQuery:a,tedious:this.#_,onDone:b});this.#P.execSql(c.request);let{rowCount:d,rows:e}=await b.promise;return{numAffectedRows:void 0!==d?BigInt(d):void 0,rows:e}}catch(a){throw Q(a,Error())}}async rollbackTransaction(a){await new Promise((b,c)=>this.#P.rollbackTransaction(a=>{a?c(a):b(void 0)},a))}async savepoint(a){await new Promise((b,c)=>this.#P.saveTransaction(a=>{a?c(a):b(void 0)},a))}async *streamQuery(a,b){if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=new ap({compiledQuery:a,streamChunkSize:b,tedious:this.#_});this.#P.execSql(c.request);try{for(;;){let a=await c.readChunk();if(0===a.length||(yield{rows:a},a.length<b))break}}finally{await this.#ab(c)}}#aa(a){let{ISOLATION_LEVEL:b}=this.#_,c={"read committed":b.READ_COMMITTED,"read uncommitted":b.READ_UNCOMMITTED,"repeatable read":b.REPEATABLE_READ,serializable:b.SERIALIZABLE,snapshot:b.SNAPSHOT}[a];if(void 0===c)throw Error(`Unknown isolation level: ${a}`);return c}#ab(a){return new Promise(b=>{a.request.once("requestCompleted",b),this.#P.cancel()||(a.request.off("requestCompleted",b),b())})}[al](){return"closed"in this.#P&&this.#P.closed?Promise.resolve():new Promise(a=>{this.#P.once("end",a),this.#P.close()})}async [ak](){await new Promise((a,b)=>{this.#P.reset(c=>{if(c)return b(c);a()})})}async [am](){if(this.#$||this.#ac())return!1;try{let a=new aj.c,b=new ap({compiledQuery:B.E.raw("select 1"),onDone:a,tedious:this.#_});return this.#P.execSql(b.request),await a.promise,!0}catch{return!1}}#ac(){return"closed"in this.#P&&!!this.#P.closed}}class ap{#ad;#ae;#af;#ag;#_;#ah;constructor(a){let{compiledQuery:b,onDone:c,streamChunkSize:d,tedious:e}=a;if(this.#ae=[],this.#af=d,this.#ag={},this.#_=e,c){let a="onDone";this.#ag[a]=(b,d)=>{if("chunkReady"!==b){if(delete this.#ag[a],"error"===b)return c.reject(d);c.resolve({rowCount:this.#ah,rows:this.#ae})}}}this.#ad=new this.#_.Request(b.sql,(a,b)=>{if(a)return Object.values(this.#ag).forEach(b=>b("error",a instanceof AggregateError?a.errors:a));this.#ah=b}),this.#ai(b.parameters),this.#aj()}get request(){return this.#ad}readChunk(){let a=this.readChunk.name;return new Promise((b,c)=>{this.#ag[a]=(d,e)=>{if(delete this.#ag[a],"error"===d)return c(e);b(this.#ae.splice(0,this.#af))},this.#ad.resume()})}#ai(a){for(let b=0;b<a.length;b++){let c=a[b];this.#ad.addParameter(String(b+1),this.#ak(c),c)}}#aj(){let a=this.#af?()=>{this.#af<=this.#ae.length&&(this.#ad.pause(),Object.values(this.#ag).forEach(a=>a("chunkReady")))}:()=>{},b=b=>{let c={};for(let a of b)c[a.metadata.colName]=a.value;this.#ae.push(c),a()};this.#ad.on("row",b),this.#ad.once("requestCompleted",()=>{Object.values(this.#ag).forEach(a=>a("completed")),this.#ad.off("row",b)})}#ak(a){if((0,C.kZ)(a)||(0,C.b0)(a)||(0,C.Kg)(a))return this.#_.TYPES.NVarChar;if((0,C.sI)(a)||(0,C.Et)(a)&&a%1==0)if(a<-0x80000000||a>0x7fffffff)return this.#_.TYPES.BigInt;else return this.#_.TYPES.Int;return(0,C.Et)(a)?this.#_.TYPES.Float:(0,C.Lm)(a)?this.#_.TYPES.Bit:(0,C.$P)(a)?this.#_.TYPES.DateTime:(0,C.Pe)(a)?this.#_.TYPES.VarBinary:this.#_.TYPES.NVarChar}}class aq{#O;constructor(a){this.#O=a}async getSchemas(){return await this.#O.selectFrom("sys.schemas").select("name").execute()}async getTables(a={withInternalKyselyTables:!1}){let b=await this.#O.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!a.withInternalKyselyTables,a=>a.where("tables.name","!=",K.kQ).where("tables.name","!=",K.sy)).select(["tables.name as table_name",a=>a.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#O.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),c={};for(let a of b){let b=`${a.table_schema_name}.${a.table_name}`;(c[b]=c[b]||(0,C.CN)({columns:[],isView:"V "===a.table_type,name:a.table_name,schema:a.table_schema_name??void 0})).columns.push((0,C.CN)({dataType:a.type_name,dataTypeSchema:a.type_schema_name??void 0,hasDefaultValue:a.column_default_object_id>0||"NOT_APPLICABLE"!==a.column_generated_always_type||a.column_is_identity||a.column_is_computed||a.column_is_rowguidcol,isAutoIncrementing:a.column_is_identity,isNullable:a.column_is_nullable&&a.type_is_nullable,name:a.column_name,comment:a.column_comment??void 0}))}return Object.values(c)}async getMetadata(a){return{tables:await this.getTables(a)}}}let ar=/^[a-z0-9_]$/i;class as extends H.n{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(a){super.visitOffset(a),this.append(" rows")}compileColumnAlterations(a){let b={};for(let c of a)b[c.kind]||(b[c.kind]=[]),b[c.kind].push(c);let c=!0;b.AddColumnNode&&(this.append("add "),this.compileList(b.AddColumnNode),c=!1),b.AlterColumnNode&&(c||this.append(", "),this.compileList(b.AlterColumnNode)),b.DropColumnNode&&(c||this.append(", "),this.append("drop column "),this.compileList(b.DropColumnNode)),b.ModifyColumnNode&&(c||this.append(", "),this.compileList(b.ModifyColumnNode)),b.RenameColumnNode&&(c||this.append(", "),this.compileList(b.RenameColumnNode))}visitAddColumn(a){this.visitNode(a.column)}visitDropColumn(a){this.visitNode(a.column)}visitMergeQuery(a){super.visitMergeQuery(a),this.append(";")}visitCollate(a){this.append("collate ");let{name:b}=a.collation;for(let a of b)if(!ar.test(a))throw Error(`Invalid collation: ${b}`);this.append(b)}announcesNewColumnDataType(){return!1}}class at{#M;constructor(a){this.#M=a}createDriver(){return new an(this.#M)}createQueryCompiler(){return new as}createAdapter(){return new ah}createIntrospector(a){return new aq(a)}}let au=(0,C.CN)({is:a=>"AlterTableNode"===a.kind,create:a=>(0,C.CN)({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,b)=>(0,C.CN)({...a,...b}),cloneWithColumnAlteration:(a,b)=>(0,C.CN)({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,b]:[b]})}),av=(0,C.CN)({is:a=>"CreateIndexNode"===a.kind,create:a=>(0,C.CN)({kind:"CreateIndexNode",name:y.O.create(a)}),cloneWith:(a,b)=>(0,C.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,C.CN)({...a,columns:[...a.columns||[],...b]})}),aw=(0,C.CN)({is:a=>"CreateSchemaNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"CreateSchemaNode",schema:y.O.create(a),...b}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})});var ax=c(44674),ay=c(87197);let az=(0,C.CN)({is:a=>"DropIndexNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"DropIndexNode",name:ay.y.create(a),...b}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})}),aA=(0,C.CN)({is:a=>"DropSchemaNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"DropSchemaNode",schema:y.O.create(a),...b}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})}),aB=(0,C.CN)({is:a=>"DropTableNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"DropTableNode",table:a,...b}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})});var aC=c(15021);let aD=(0,C.CN)({is:a=>"AddColumnNode"===a.kind,create:a=>(0,C.CN)({kind:"AddColumnNode",column:a})});var aE=c(67423);let aF=(0,C.CN)({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"ColumnDefinitionNode",column:aE.Z.create(a),dataType:b}),cloneWithFrontModifier:(a,b)=>(0,C.CN)({...a,frontModifiers:a.frontModifiers?(0,C.CN)([...a.frontModifiers,b]):[b]}),cloneWithEndModifier:(a,b)=>(0,C.CN)({...a,endModifiers:a.endModifiers?(0,C.CN)([...a.endModifiers,b]):[b]}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})}),aG=(0,C.CN)({is:a=>"DropColumnNode"===a.kind,create:a=>(0,C.CN)({kind:"DropColumnNode",column:aE.Z.create(a)})}),aH=(0,C.CN)({is:a=>"RenameColumnNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"RenameColumnNode",column:aE.Z.create(a),renameTo:aE.Z.create(b)})}),aI=(0,C.CN)({is:a=>"CheckConstraintNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"CheckConstraintNode",expression:a,name:b?y.O.create(b):void 0})}),aJ=["no action","restrict","cascade","set null","set default"],aK=(0,C.CN)({is:a=>"ReferencesNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"ReferencesNode",table:a,columns:(0,C.CN)([...b])}),cloneWithOnDelete:(a,b)=>(0,C.CN)({...a,onDelete:b}),cloneWithOnUpdate:(a,b)=>(0,C.CN)({...a,onUpdate:b})});var aL=c(3047),aM=c(34082),aN=c(23244),aO=c(65968);function aP(a){return(0,aN.N)(a)?a.toOperationNode():aO.q.createImmediate(a)}let aQ=(0,C.CN)({is:a=>"GeneratedNode"===a.kind,create:a=>(0,C.CN)({kind:"GeneratedNode",...a}),createWithExpression:a=>(0,C.CN)({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})}),aR=(0,C.CN)({is:a=>"DefaultValueNode"===a.kind,create:a=>(0,C.CN)({kind:"DefaultValueNode",defaultValue:a})});function aS(a){if(aJ.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class aT{#H;constructor(a){this.#H=a}autoIncrement(){return new aT(aF.cloneWith(this.#H,{autoIncrement:!0}))}identity(){return new aT(aF.cloneWith(this.#H,{identity:!0}))}primaryKey(){return new aT(aF.cloneWith(this.#H,{primaryKey:!0}))}references(a){let b=(0,aM.q5)(a);if(!b.table||aL.U.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new aT(aF.cloneWith(this.#H,{references:aK.create(b.table,[b.column])}))}onDelete(a){if(!this.#H.references)throw Error("on delete constraint can only be added for foreign keys");return new aT(aF.cloneWith(this.#H,{references:aK.cloneWithOnDelete(this.#H.references,aS(a))}))}onUpdate(a){if(!this.#H.references)throw Error("on update constraint can only be added for foreign keys");return new aT(aF.cloneWith(this.#H,{references:aK.cloneWithOnUpdate(this.#H.references,aS(a))}))}unique(){return new aT(aF.cloneWith(this.#H,{unique:!0}))}notNull(){return new aT(aF.cloneWith(this.#H,{notNull:!0}))}unsigned(){return new aT(aF.cloneWith(this.#H,{unsigned:!0}))}defaultTo(a){return new aT(aF.cloneWith(this.#H,{defaultTo:aR.create(aP(a))}))}check(a){return new aT(aF.cloneWith(this.#H,{check:aI.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new aT(aF.cloneWith(this.#H,{generated:aQ.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new aT(aF.cloneWith(this.#H,{generated:aQ.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new aT(aF.cloneWith(this.#H,{generated:aQ.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#H.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new aT(aF.cloneWith(this.#H,{generated:aQ.cloneWith(this.#H.generated,{stored:!0})}))}modifyFront(a){return new aT(aF.cloneWithFrontModifier(this.#H,a.toOperationNode()))}nullsNotDistinct(){return new aT(aF.cloneWith(this.#H,{nullsNotDistinct:!0}))}ifNotExists(){return new aT(aF.cloneWith(this.#H,{ifNotExists:!0}))}modifyEnd(a){return new aT(aF.cloneWithEndModifier(this.#H,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#H}}let aU=(0,C.CN)({is:a=>"ModifyColumnNode"===a.kind,create:a=>(0,C.CN)({kind:"ModifyColumnNode",column:a})});var aV=c(87686);let aW=(0,C.CN)({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,b,c,d)=>(0,C.CN)({kind:"ForeignKeyConstraintNode",columns:a,references:aK.create(b,c),name:d?y.O.create(d):void 0}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})});class aX{#H;constructor(a){this.#H=a}onDelete(a){return new aX(aW.cloneWith(this.#H,{onDelete:aS(a)}))}onUpdate(a){return new aX(aW.cloneWith(this.#H,{onUpdate:aS(a)}))}deferrable(){return new aX(aW.cloneWith(this.#H,{deferrable:!0}))}notDeferrable(){return new aX(aW.cloneWith(this.#H,{deferrable:!1}))}initiallyDeferred(){return new aX(aW.cloneWith(this.#H,{initiallyDeferred:!0}))}initiallyImmediate(){return new aX(aW.cloneWith(this.#H,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#H}}let aY=(0,C.CN)({is:a=>"AddConstraintNode"===a.kind,create:a=>(0,C.CN)({kind:"AddConstraintNode",constraint:a})}),aZ=(0,C.CN)({is:a=>"UniqueConstraintNode"===a.kind,create:(a,b,c)=>(0,C.CN)({kind:"UniqueConstraintNode",columns:(0,C.CN)(a.map(aE.Z.create)),name:b?y.O.create(b):void 0,nullsNotDistinct:c}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})}),a$=(0,C.CN)({is:a=>"DropConstraintNode"===a.kind,create:a=>(0,C.CN)({kind:"DropConstraintNode",constraintName:y.O.create(a)}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})}),a_=(0,C.CN)({is:a=>"AlterColumnNode"===a.kind,create:(a,b,c)=>(0,C.CN)({kind:"AlterColumnNode",column:aE.Z.create(a),[b]:c})});class a0{#al;constructor(a){this.#al=a}setDataType(a){return new a1(a_.create(this.#al,"dataType",(0,aV.Q)(a)))}setDefault(a){return new a1(a_.create(this.#al,"setDefault",aP(a)))}dropDefault(){return new a1(a_.create(this.#al,"dropDefault",!0))}setNotNull(){return new a1(a_.create(this.#al,"setNotNull",!0))}dropNotNull(){return new a1(a_.create(this.#al,"dropNotNull",!0))}$call(a){return a(this)}}class a1{#am;constructor(a){this.#am=a}toOperationNode(){return this.#am}}class a2{#g;constructor(a){this.#g=(0,C.CN)(a)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class a3{#g;constructor(a){this.#g=(0,C.CN)(a)}onDelete(a){return new a3({...this.#g,constraintBuilder:this.#g.constraintBuilder.onDelete(a)})}onUpdate(a){return new a3({...this.#g,constraintBuilder:this.#g.constraintBuilder.onUpdate(a)})}deferrable(){return new a3({...this.#g,constraintBuilder:this.#g.constraintBuilder.deferrable()})}notDeferrable(){return new a3({...this.#g,constraintBuilder:this.#g.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new a3({...this.#g,constraintBuilder:this.#g.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new a3({...this.#g,constraintBuilder:this.#g.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(au.cloneWithTableProps(this.#g.node,{addConstraint:aY.create(this.#g.constraintBuilder.toOperationNode())}),this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class a4{#g;constructor(a){this.#g=(0,C.CN)(a)}ifExists(){return new a4({...this.#g,node:au.cloneWithTableProps(this.#g.node,{dropConstraint:a$.cloneWith(this.#g.node.dropConstraint,{ifExists:!0})})})}cascade(){return new a4({...this.#g,node:au.cloneWithTableProps(this.#g.node,{dropConstraint:a$.cloneWith(this.#g.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new a4({...this.#g,node:au.cloneWithTableProps(this.#g.node,{dropConstraint:a$.cloneWith(this.#g.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}let a5=(0,C.CN)({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"PrimaryKeyConstraintNode",columns:(0,C.CN)(a.map(aE.Z.create)),name:b?y.O.create(b):void 0}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})}),a6=(0,C.CN)({is:a=>"AddIndexNode"===a.kind,create:a=>(0,C.CN)({kind:"AddIndexNode",name:y.O.create(a)}),cloneWith:(a,b)=>(0,C.CN)({...a,...b}),cloneWithColumns:(a,b)=>(0,C.CN)({...a,columns:[...a.columns||[],...b]})});class a7{#g;constructor(a){this.#g=(0,C.CN)(a)}unique(){return new a7({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addIndex:a6.cloneWith(this.#g.node.addIndex,{unique:!0})})})}column(a){return new a7({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addIndex:a6.cloneWithColumns(this.#g.node.addIndex,[(0,aM.Ow)(a)])})})}columns(a){return new a7({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addIndex:a6.cloneWithColumns(this.#g.node.addIndex,a.map(aM.Ow))})})}expression(a){return new a7({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addIndex:a6.cloneWithColumns(this.#g.node.addIndex,[a.toOperationNode()])})})}using(a){return new a7({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addIndex:a6.cloneWith(this.#g.node.addIndex,{using:z.z.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class a8{#H;constructor(a){this.#H=a}nullsNotDistinct(){return new a8(aZ.cloneWith(this.#H,{nullsNotDistinct:!0}))}deferrable(){return new a8(aZ.cloneWith(this.#H,{deferrable:!0}))}notDeferrable(){return new a8(aZ.cloneWith(this.#H,{deferrable:!1}))}initiallyDeferred(){return new a8(aZ.cloneWith(this.#H,{initiallyDeferred:!0}))}initiallyImmediate(){return new a8(aZ.cloneWith(this.#H,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#H}}class a9{#H;constructor(a){this.#H=a}deferrable(){return new a9(a5.cloneWith(this.#H,{deferrable:!0}))}notDeferrable(){return new a9(a5.cloneWith(this.#H,{deferrable:!1}))}initiallyDeferred(){return new a9(a5.cloneWith(this.#H,{initiallyDeferred:!0}))}initiallyImmediate(){return new a9(a5.cloneWith(this.#H,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#H}}class ba{#H;constructor(a){this.#H=a}$call(a){return a(this)}toOperationNode(){return this.#H}}let bb=(0,C.CN)({is:a=>"RenameConstraintNode"===a.kind,create:(a,b)=>(0,C.CN)({kind:"RenameConstraintNode",oldName:y.O.create(a),newName:y.O.create(b)})});class bc{#g;constructor(a){this.#g=(0,C.CN)(a)}renameTo(a){return new a2({...this.#g,node:au.cloneWithTableProps(this.#g.node,{renameTo:(0,aC.M$)(a)})})}setSchema(a){return new a2({...this.#g,node:au.cloneWithTableProps(this.#g.node,{setSchema:y.O.create(a)})})}alterColumn(a,b){let c=b(new a0(a));return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,c.toOperationNode())})}dropColumn(a){return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aG.create(a))})}renameColumn(a,b){return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aH.create(a,b))})}addColumn(a,b,c=C.lQ){let d=c(new aT(aF.create(a,(0,aV.Q)(b))));return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aD.create(d.toOperationNode()))})}modifyColumn(a,b,c=C.lQ){let d=c(new aT(aF.create(a,(0,aV.Q)(b))));return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aU.create(d.toOperationNode()))})}addUniqueConstraint(a,b,c=C.lQ){let d=c(new a8(aZ.create(b,a)));return new a2({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addConstraint:aY.create(d.toOperationNode())})})}addCheckConstraint(a,b,c=C.lQ){let d=c(new ba(aI.create(b.toOperationNode(),a)));return new a2({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addConstraint:aY.create(d.toOperationNode())})})}addForeignKeyConstraint(a,b,c,d,e=C.lQ){let f=e(new aX(aW.create(b.map(aE.Z.create),(0,aC.M$)(c),d.map(aE.Z.create),a)));return new a3({...this.#g,constraintBuilder:f})}addPrimaryKeyConstraint(a,b,c=C.lQ){let d=c(new a9(a5.create(b,a)));return new a2({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addConstraint:aY.create(d.toOperationNode())})})}dropConstraint(a){return new a4({...this.#g,node:au.cloneWithTableProps(this.#g.node,{dropConstraint:a$.create(a)})})}renameConstraint(a,b){return new a4({...this.#g,node:au.cloneWithTableProps(this.#g.node,{renameConstraint:bb.create(a,b)})})}addIndex(a){return new a7({...this.#g,node:au.cloneWithTableProps(this.#g.node,{addIndex:a6.create(a)})})}dropIndex(a){return new a2({...this.#g,node:au.cloneWithTableProps(this.#g.node,{dropIndex:az.create(a)})})}$call(a){return a(this)}}class bd{#g;constructor(a){this.#g=(0,C.CN)(a)}alterColumn(a,b){let c=b(new a0(a));return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,c.toOperationNode())})}dropColumn(a){return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aG.create(a))})}renameColumn(a,b){return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aH.create(a,b))})}addColumn(a,b,c=C.lQ){let d=c(new aT(aF.create(a,(0,aV.Q)(b))));return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aD.create(d.toOperationNode()))})}modifyColumn(a,b,c=C.lQ){let d=c(new aT(aF.create(a,(0,aV.Q)(b))));return new bd({...this.#g,node:au.cloneWithColumnAlteration(this.#g.node,aU.create(d.toOperationNode()))})}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}var be=c(18634),bf=c(71767),bg=c(55298),bh=c(33385);class bi extends bg.V{transformPrimitiveValueList(a){return bh.s.create(a.values.map(aO.q.createImmediate))}transformValue(a){return aO.q.createImmediate(a.value)}}class bj{#g;constructor(a){this.#g=(0,C.CN)(a)}ifNotExists(){return new bj({...this.#g,node:av.cloneWith(this.#g.node,{ifNotExists:!0})})}unique(){return new bj({...this.#g,node:av.cloneWith(this.#g.node,{unique:!0})})}nullsNotDistinct(){return new bj({...this.#g,node:av.cloneWith(this.#g.node,{nullsNotDistinct:!0})})}on(a){return new bj({...this.#g,node:av.cloneWith(this.#g.node,{table:(0,aC.M$)(a)})})}column(a){return new bj({...this.#g,node:av.cloneWithColumns(this.#g.node,[(0,aM.Ow)(a)])})}columns(a){return new bj({...this.#g,node:av.cloneWithColumns(this.#g.node,a.map(aM.Ow))})}expression(a){return new bj({...this.#g,node:av.cloneWithColumns(this.#g.node,[a.toOperationNode()])})}using(a){return new bj({...this.#g,node:av.cloneWith(this.#g.node,{using:z.z.createWithSql(a)})})}where(...a){let b=new bi;return new bj({...this.#g,node:bf.L.cloneWithWhere(this.#g.node,b.transformNode((0,be.GB)(a),this.#g.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class bk{#g;constructor(a){this.#g=(0,C.CN)(a)}ifNotExists(){return new bk({...this.#g,node:aw.cloneWith(this.#g.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}var bl=c(78215);class bm{#g;constructor(a){this.#g=(0,C.CN)(a)}temporary(){return new bm({...this.#g,node:ax.B.cloneWith(this.#g.node,{temporary:!0})})}onCommit(a){return new bm({...this.#g,node:ax.B.cloneWith(this.#g.node,{onCommit:function(a){if(ax.o.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new bm({...this.#g,node:ax.B.cloneWith(this.#g.node,{ifNotExists:!0})})}addColumn(a,b,c=C.lQ){let d=c(new aT(aF.create(a,(0,aV.Q)(b))));return new bm({...this.#g,node:ax.B.cloneWithColumn(this.#g.node,d.toOperationNode())})}addPrimaryKeyConstraint(a,b,c=C.lQ){let d=c(new a9(a5.create(b,a)));return new bm({...this.#g,node:ax.B.cloneWithConstraint(this.#g.node,d.toOperationNode())})}addUniqueConstraint(a,b,c=C.lQ){let d=c(new a8(aZ.create(b,a)));return new bm({...this.#g,node:ax.B.cloneWithConstraint(this.#g.node,d.toOperationNode())})}addCheckConstraint(a,b,c=C.lQ){let d=c(new ba(aI.create(b.toOperationNode(),a)));return new bm({...this.#g,node:ax.B.cloneWithConstraint(this.#g.node,d.toOperationNode())})}addForeignKeyConstraint(a,b,c,d,e=C.lQ){let f=e(new aX(aW.create(b.map(aE.Z.create),(0,aC.M$)(c),d.map(aE.Z.create),a)));return new bm({...this.#g,node:ax.B.cloneWithConstraint(this.#g.node,f.toOperationNode())})}modifyFront(a){return new bm({...this.#g,node:ax.B.cloneWithFrontModifier(this.#g.node,a.toOperationNode())})}modifyEnd(a){return new bm({...this.#g,node:ax.B.cloneWithEndModifier(this.#g.node,a.toOperationNode())})}as(a){return new bm({...this.#g,node:ax.B.cloneWith(this.#g.node,{selectQuery:(0,bl.YK)(a)})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class bn{#g;constructor(a){this.#g=(0,C.CN)(a)}on(a){return new bn({...this.#g,node:az.cloneWith(this.#g.node,{table:(0,aC.M$)(a)})})}ifExists(){return new bn({...this.#g,node:az.cloneWith(this.#g.node,{ifExists:!0})})}cascade(){return new bn({...this.#g,node:az.cloneWith(this.#g.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class bo{#g;constructor(a){this.#g=(0,C.CN)(a)}ifExists(){return new bo({...this.#g,node:aA.cloneWith(this.#g.node,{ifExists:!0})})}cascade(){return new bo({...this.#g,node:aA.cloneWith(this.#g.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class bp{#g;constructor(a){this.#g=(0,C.CN)(a)}ifExists(){return new bp({...this.#g,node:aB.cloneWith(this.#g.node,{ifExists:!0})})}cascade(){return new bp({...this.#g,node:aB.cloneWith(this.#g.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}var bq=c(58077),br=c(46221);class bs{#G=new bi;transformQuery(a){return this.#G.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class bt{#g;constructor(a){this.#g=(0,C.CN)(a)}temporary(){return new bt({...this.#g,node:br.Y.cloneWith(this.#g.node,{temporary:!0})})}materialized(){return new bt({...this.#g,node:br.Y.cloneWith(this.#g.node,{materialized:!0})})}ifNotExists(){return new bt({...this.#g,node:br.Y.cloneWith(this.#g.node,{ifNotExists:!0})})}orReplace(){return new bt({...this.#g,node:br.Y.cloneWith(this.#g.node,{orReplace:!0})})}columns(a){return new bt({...this.#g,node:br.Y.cloneWith(this.#g.node,{columns:a.map(aM.RY)})})}as(a){let b=a.withPlugin(new bs).toOperationNode();return new bt({...this.#g,node:br.Y.cloneWith(this.#g.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}let bu=(0,C.CN)({is:a=>"DropViewNode"===a.kind,create:a=>(0,C.CN)({kind:"DropViewNode",name:ay.y.create(a)}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})});class bv{#g;constructor(a){this.#g=(0,C.CN)(a)}materialized(){return new bv({...this.#g,node:bu.cloneWith(this.#g.node,{materialized:!0})})}ifExists(){return new bv({...this.#g,node:bu.cloneWith(this.#g.node,{ifExists:!0})})}cascade(){return new bv({...this.#g,node:bu.cloneWith(this.#g.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}let bw=(0,C.CN)({is:a=>"CreateTypeNode"===a.kind,create:a=>(0,C.CN)({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,b)=>(0,C.CN)({...a,enum:bh.s.create(b.map(aO.q.createImmediate))})});class bx{#g;constructor(a){this.#g=(0,C.CN)(a)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}asEnum(a){return new bx({...this.#g,node:bw.cloneWithEnum(this.#g.node,a)})}$call(a){return a(this)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}let by=(0,C.CN)({is:a=>"DropTypeNode"===a.kind,create:a=>(0,C.CN)({kind:"DropTypeNode",name:a}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})});class bz{#g;constructor(a){this.#g=(0,C.CN)(a)}ifExists(){return new bz({...this.#g,node:by.cloneWith(this.#g.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}function bA(a){if(!a.includes("."))return ay.y.create(a);{let b=a.split(".").map(bB);if(2===b.length)return ay.y.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function bB(a){return a.trim()}let bC=(0,C.CN)({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>(0,C.CN)({kind:"RefreshMaterializedViewNode",name:ay.y.create(a)}),cloneWith:(a,b)=>(0,C.CN)({...a,...b})});class bD{#g;constructor(a){this.#g=(0,C.CN)(a)}concurrently(){return new bD({...this.#g,node:bC.cloneWith(this.#g.node,{concurrently:!0,withNoData:!1})})}withData(){return new bD({...this.#g,node:bC.cloneWith(this.#g.node,{withNoData:!1})})}withNoData(){return new bD({...this.#g,node:bC.cloneWith(this.#g.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#g.executor.transformQuery(this.#g.node,this.#g.queryId)}compile(){return this.#g.executor.compileQuery(this.toOperationNode(),this.#g.queryId)}async execute(){await this.#g.executor.executeQuery(this.compile())}}class bE{#an;constructor(a){this.#an=a}createTable(a){return new bm({queryId:(0,D.a)(),executor:this.#an,node:ax.B.create((0,aC.M$)(a))})}dropTable(a){return new bp({queryId:(0,D.a)(),executor:this.#an,node:aB.create((0,aC.M$)(a))})}createIndex(a){return new bj({queryId:(0,D.a)(),executor:this.#an,node:av.create(a)})}dropIndex(a){return new bn({queryId:(0,D.a)(),executor:this.#an,node:az.create(a)})}createSchema(a){return new bk({queryId:(0,D.a)(),executor:this.#an,node:aw.create(a)})}dropSchema(a){return new bo({queryId:(0,D.a)(),executor:this.#an,node:aA.create(a)})}alterTable(a){return new bc({queryId:(0,D.a)(),executor:this.#an,node:au.create((0,aC.M$)(a))})}createView(a){return new bt({queryId:(0,D.a)(),executor:this.#an,node:br.Y.create(a)})}refreshMaterializedView(a){return new bD({queryId:(0,D.a)(),executor:this.#an,node:bC.create(a)})}dropView(a){return new bv({queryId:(0,D.a)(),executor:this.#an,node:bu.create(a)})}createType(a){return new bx({queryId:(0,D.a)(),executor:this.#an,node:bw.create(bA(a))})}dropType(a){return new bz({queryId:(0,D.a)(),executor:this.#an,node:by.create(bA(a))})}withPlugin(a){return new bE(this.#an.withPlugin(a))}withoutPlugins(){return new bE(this.#an.withoutPlugins())}withSchema(a){return new bE(this.#an.withPluginAtFront(new bq.B(a)))}}var bF=c(29995),bG=c(46345);class bH{ref(a){return new bF.g(a)}table(a){return new bG.bj(a)}}class bI{#ao;constructor(a){this.#ao=a}async provideConnection(a){let b=await this.#ao.acquireConnection();try{return await a(b)}finally{await this.#ao.releaseConnection(b)}}}var bJ=c(35684),bK=c(49828);class bL extends bK.R{#ap;#aq;#ar;constructor(a,b,c,d=[]){super(d),this.#ap=a,this.#aq=b,this.#ar=c}get adapter(){return this.#aq}compileQuery(a,b){return this.#ap.compileQuery(a,b)}provideConnection(a){return this.#ar.provideConnection(a)}withPlugins(a){return new bL(this.#ap,this.#aq,this.#ar,[...this.plugins,...a])}withPlugin(a){return new bL(this.#ap,this.#aq,this.#ar,[...this.plugins,a])}withPluginAtFront(a){return new bL(this.#ap,this.#aq,this.#ar,[a,...this.plugins])}withConnectionProvider(a){return new bL(this.#ap,this.#aq,a,[...this.plugins])}withoutPlugins(){return new bL(this.#ap,this.#aq,this.#ar,[])}}function bM(){return"undefined"!=typeof performance&&(0,C.Tn)(performance.now)?performance.now():Date.now()}class bN{#ao;#as;#at;#au;#av;#S=new WeakSet;constructor(a,b){this.#au=!1,this.#ao=a,this.#as=b}async init(){if(this.#av)throw Error("driver has already been destroyed");this.#at||(this.#at=this.#ao.init().then(()=>{this.#au=!0}).catch(a=>(this.#at=void 0,Promise.reject(a)))),await this.#at}async acquireConnection(){if(this.#av)throw Error("driver has already been destroyed");this.#au||await this.init();let a=await this.#ao.acquireConnection();return this.#S.has(a)||(this.#aw()&&this.#ax(a),this.#S.add(a)),a}async releaseConnection(a){await this.#ao.releaseConnection(a)}beginTransaction(a,b){return this.#ao.beginTransaction(a,b)}commitTransaction(a){return this.#ao.commitTransaction(a)}rollbackTransaction(a){return this.#ao.rollbackTransaction(a)}savepoint(a,b,c){if(this.#ao.savepoint)return this.#ao.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#ao.rollbackToSavepoint)return this.#ao.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#ao.releaseSavepoint)return this.#ao.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#at&&(await this.#at,this.#av||(this.#av=this.#ao.destroy().catch(a=>(this.#av=void 0,Promise.reject(a)))),await this.#av)}#aw(){return this.#as.isLevelEnabled("query")||this.#as.isLevelEnabled("error")}#ax(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=bM();try{return await b.call(a,c)}catch(a){throw e=a,await d.#ay(a,c,f),a}finally{e||await d.#az(c,f)}},a.streamQuery=async function*(b,e){let f,g=bM();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#ay(a,b,g),a}finally{f||await d.#az(b,g,!0)}}}async #ay(a,b,c){await this.#as.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#aA(c)}))}async #az(a,b,c=!1){await this.#as.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#aA(b)}))}#aA(a){return bM()-a}}let bO=()=>{};class bP{#P;#aB;constructor(a){this.#P=a}async provideConnection(a){for(;this.#aB;)await this.#aB.catch(bO);return this.#aB=this.#aC(a).finally(()=>{this.#aB=void 0}),this.#aB}async #aC(a){return await a(this.#P)}}let bQ=["read only","read write"],bR=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function bS(a){if(a.accessMode&&!bQ.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!bR.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}var bT=c(42522);(0,C.CN)(["query","error"]);class bU{#aD;#aE;constructor(a){(0,C.Tn)(a)?(this.#aE=a,this.#aD=(0,C.CN)({query:!0,error:!0})):(this.#aE=bV,this.#aD=(0,C.CN)({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#aD[a]}async query(a){this.#aD.query&&await this.#aE(a())}async error(a){this.#aD.error&&await this.#aE(a())}}function bV(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}var bW=c(80548),bX=c(4457),bY=c(57727),bZ=c(62020);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class b$ extends bJ.n{#g;constructor(a){let b,c;if(function(a){return(0,C.Gv)(a)&&(0,C.Gv)(a.config)&&(0,C.Gv)(a.driver)&&(0,C.Gv)(a.executor)&&(0,C.Gv)(a.dialect)}(a))b={executor:a.executor},c={...a};else{let d=a.dialect,e=d.createDriver(),f=d.createQueryCompiler(),g=d.createAdapter(),h=new bN(e,new bU(a.log??[])),i=new bL(f,g,new bI(h),a.plugins??[]);b={executor:i},c={config:a,executor:i,dialect:d,driver:h}}super(b),this.#g=(0,C.CN)(c)}get schema(){return new bE(this.#g.executor)}get dynamic(){return new bH}get introspection(){return this.#g.dialect.createIntrospector(this.withoutPlugins())}case(a){return new bW.OU({node:bX.P.create((0,C.b0)(a)?void 0:(0,bl.YK)(a))})}get fn(){return(0,bT.t)()}transaction(){return new b1({...this.#g})}startTransaction(){return new b2({...this.#g})}connection(){return new b0({...this.#g})}withPlugin(a){return new b$({...this.#g,executor:this.#g.executor.withPlugin(a)})}withoutPlugins(){return new b$({...this.#g,executor:this.#g.executor.withoutPlugins()})}withSchema(a){return new b$({...this.#g,executor:this.#g.executor.withPluginAtFront(new bq.B(a))})}withTables(){return new b$({...this.#g})}async destroy(){await this.#g.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#g.executor}executeQuery(a,b){void 0!==b&&(0,bZ.u)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let c=(0,C.Gv)(a)&&(0,C.Tn)(a.compile)?a.compile():a;return this.getExecutor().executeQuery(c)}async [Symbol.asyncDispose](){await this.destroy()}}class b_ extends b${#g;constructor(a){super(a),this.#g=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new b_({...this.#g,executor:this.#g.executor.withPlugin(a)})}withoutPlugins(){return new b_({...this.#g,executor:this.#g.executor.withoutPlugins()})}withSchema(a){return new b_({...this.#g,executor:this.#g.executor.withPluginAtFront(new bq.B(a))})}withTables(){return new b_({...this.#g})}}class b0{#g;constructor(a){this.#g=(0,C.CN)(a)}async execute(a){return this.#g.executor.provideConnection(async b=>{let c=this.#g.executor.withConnectionProvider(new bP(b)),d=new b$({...this.#g,executor:c});return await a(d)})}}class b1{#g;constructor(a){this.#g=(0,C.CN)(a)}setAccessMode(a){return new b1({...this.#g,accessMode:a})}setIsolationLevel(a){return new b1({...this.#g,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#g,e={isolationLevel:b,accessMode:c};return bS(e),this.#g.executor.provideConnection(async b=>{let c=this.#g.executor.withConnectionProvider(new bP(b)),f=new b_({...d,executor:c});try{await this.#g.driver.beginTransaction(b,e);let c=await a(f);return await this.#g.driver.commitTransaction(b),c}catch(a){throw await this.#g.driver.rollbackTransaction(b),a}})}}class b2{#g;constructor(a){this.#g=(0,C.CN)(a)}setAccessMode(a){return new b2({...this.#g,accessMode:a})}setIsolationLevel(a){return new b2({...this.#g,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#g,d={isolationLevel:a,accessMode:b};bS(d);let e=await (0,bY.G)(this.#g.executor);return await this.#g.driver.beginTransaction(e.connection,d),new b3({...c,connection:e,executor:this.#g.executor.withConnectionProvider(new bP(e.connection))})}}class b3 extends b_{#g;#aF;#aG;constructor(a){let b={isCommitted:!1,isRolledBack:!1},{connection:c,...d}=a={...a,executor:new b6(a.executor,b)};super(d),this.#g=(0,C.CN)(a),this.#aG=b;let e=(0,D.a)();this.#aF=b=>a.executor.compileQuery(b,e)}get isCommitted(){return this.#aG.isCommitted}get isRolledBack(){return this.#aG.isRolledBack}commit(){return b5(this.#aG),new b4(async()=>{await this.#g.driver.commitTransaction(this.#g.connection.connection),this.#aG.isCommitted=!0,this.#g.connection.release()})}rollback(){return b5(this.#aG),new b4(async()=>{await this.#g.driver.rollbackTransaction(this.#g.connection.connection),this.#aG.isRolledBack=!0,this.#g.connection.release()})}savepoint(a){return b5(this.#aG),new b4(async()=>(await this.#g.driver.savepoint?.(this.#g.connection.connection,a,this.#aF),new b3({...this.#g})))}rollbackToSavepoint(a){return b5(this.#aG),new b4(async()=>(await this.#g.driver.rollbackToSavepoint?.(this.#g.connection.connection,a,this.#aF),new b3({...this.#g})))}releaseSavepoint(a){return b5(this.#aG),new b4(async()=>(await this.#g.driver.releaseSavepoint?.(this.#g.connection.connection,a,this.#aF),new b3({...this.#g})))}withPlugin(a){return new b3({...this.#g,executor:this.#g.executor.withPlugin(a)})}withoutPlugins(){return new b3({...this.#g,executor:this.#g.executor.withoutPlugins()})}withSchema(a){return new b3({...this.#g,executor:this.#g.executor.withPluginAtFront(new bq.B(a))})}withTables(){return new b3({...this.#g})}}class b4{#aH;constructor(a){this.#aH=a}async execute(){return await this.#aH()}}function b5(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class b6{#an;#aG;constructor(a,b){a instanceof b6?this.#an=a.#an:this.#an=a,this.#aG=b}get adapter(){return this.#an.adapter}get plugins(){return this.#an.plugins}transformQuery(a,b){return this.#an.transformQuery(a,b)}compileQuery(a,b){return this.#an.compileQuery(a,b)}provideConnection(a){return this.#an.provideConnection(a)}executeQuery(a){return b5(this.#aG),this.#an.executeQuery(a)}stream(a,b){return b5(this.#aG),this.#an.stream(a,b)}withConnectionProvider(a){return new b6(this.#an.withConnectionProvider(a),this.#aG)}withPlugin(a){return new b6(this.#an.withPlugin(a),this.#aG)}withPlugins(a){return new b6(this.#an.withPlugins(a),this.#aG)}withPluginAtFront(a){return new b6(this.#an.withPluginAtFront(a),this.#aG)}withoutPlugins(){return new b6(this.#an.withoutPlugins(),this.#aG)}}var b7=c(47609);let b8=async a=>{let b,d=a.database;if(!d)return{kysely:null,databaseType:null};if("db"in d)return{kysely:d.db,databaseType:d.type};if("dialect"in d)return{kysely:new b$({dialect:d.dialect}),databaseType:d.type};let e=function a(b){if(!b)return null;if("dialect"in b)return a(b.dialect);if("createDriver"in b){if(b instanceof P)return"sqlite";if(b instanceof Z)return"mysql";if(b instanceof ag)return"postgres";if(b instanceof at)return"mssql"}return"aggregate"in b?"sqlite":"getConnection"in b?"mysql":"connect"in b?"postgres":"fileControl"in b?"sqlite":null}(d);if("createDriver"in d&&(b=d),"aggregate"in d&&(b=new P({database:d})),"getConnection"in d&&(b=new Z(d)),"connect"in d&&(b=new ag({pool:d})),"fileControl"in d){let{BunSqliteDialect:a}=await c.e(66).then(c.bind(c,46066));b=new a({database:d})}return{kysely:b?new b$({dialect:b}):null,databaseType:e}},b9=(a,b)=>{let c=b.options,d=c.secondaryStorage,e=c.session?.expiresIn||604800,{createWithHooks:f,updateWithHooks:g,updateManyWithHooks:i}=function(a,b){let c=b.hooks;return{createWithHooks:async function(b,d,e,f){let g=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(g,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(g={...g,...a.data})}}let h=e?await e.fn(g):null,i=!e||e.executeMainFn?await a.create({model:d,data:g,forceAllowId:!0}):h;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(i,f)}return i},updateWithHooks:async function(b,d,e,f,g){let h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;h="object"==typeof a?a.data:a}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await a.update({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},updateManyWithHooks:async function(b,d,e,f,g){let h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;h="object"==typeof a?a.data:a}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await a.updateMany({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j}}}(a,b);return{createOAuthUser:async(a,b,c)=>{let d=await f({createdAt:new Date,updatedAt:new Date,...a},"user",void 0,c),e=await f({...b,userId:d.id||a.id,createdAt:new Date,updatedAt:new Date},"account",void 0,c);return{user:d,account:e}},createUser:async(a,b)=>await f({createdAt:new Date,updatedAt:new Date,emailVerified:!1,...a,email:a.email?.toLowerCase()},"user",void 0,b),createAccount:async(a,b)=>await f({createdAt:new Date,updatedAt:new Date,...a},"account",void 0,b),listSessions:async c=>{if(d){let a=await d.get(`active-sessions-${c}`);if(!a)return[];let e=(0,v.s)(a)||[],f=Date.now(),g=e.filter(a=>a.expiresAt>f),i=[];for(let a of g){let c=await d.get(a.token);if(c){let a=JSON.parse(c),d=(0,h.d)(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)});i.push(d)}}return i}return await a.findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e)=>await a.findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async b=>{let c=await a.count({model:"user",where:b});return"string"==typeof c?parseInt(c):c},deleteUser:async b=>{d&&await d.delete(`active-sessions-${b}`),(!d||c.session?.storeSessionInDatabase)&&await a.deleteMany({model:"session",where:[{field:"userId",value:b}]}),await a.deleteMany({model:"account",where:[{field:"userId",value:b}]}),await a.delete({model:"user",where:[{field:"id",value:b}]})},createSession:async(a,b,g,h,i)=>{let l=b.headers||b.request?.headers,{id:m,...n}=h||{},o={ipAddress:(b.request||b.headers)&&k(b.request||b.headers,b.context.options)||"",userAgent:l?.get("user-agent")||"",...n,expiresAt:g?(0,u.g)(86400,"sec"):(0,u.g)(e,"sec"),userId:a,token:(0,j.g)(32),createdAt:new Date,updatedAt:new Date,...i?n:{}};return await f(o,"session",d?{fn:async b=>{let c=await d.get(`active-sessions-${a}`),f=[],g=Date.now();return c&&(f=(f=(0,v.s)(c)||[]).filter(a=>a.expiresAt>g)),f.push({token:o.token,expiresAt:g+1e3*e}),await d.set(`active-sessions-${a}`,JSON.stringify(f),e),b},executeMainFn:c.session?.storeSessionInDatabase}:void 0,b)},findSession:async e=>{if(d){let a=await d.get(e);if(!a&&!c.session?.storeSessionInDatabase)return null;if(a){let c=JSON.parse(a);return{session:(0,h.d)(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:(0,h.b)(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}}}let f=await a.findOne({model:"session",where:[{value:e,field:"token"}]});if(!f)return null;let g=await a.findOne({model:"user",where:[{value:f.userId,field:"id"}]});return g?{session:(0,h.d)(b.options,f),user:(0,h.b)(b.options,g)}:null},findSessions:async b=>{if(d){let a=[];for(let c of b){let b=await d.get(c);if(b){let c=JSON.parse(b),d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}}return a}let c=await a.findMany({model:"session",where:[{field:"token",value:b,operator:"in"}]}),e=c.map(a=>a.userId);if(!e.length)return[];let f=await a.findMany({model:"user",where:[{field:"id",value:e,operator:"in"}]});return c.map(a=>{let b=f.find(b=>b.id===a.userId);return b?{session:a,user:b}:null})},updateSession:async(a,b,e)=>await g(b,[{field:"token",value:a}],"session",d?{async fn(b){let c=await d.get(a);return c?{...JSON.parse(c).session,...b}:null},executeMainFn:c.session?.storeSessionInDatabase}:void 0,e),deleteSession:async e=>{d&&(await d.delete(e),!c.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)||await a.delete({model:"session",where:[{field:"token",value:e}]})},deleteAccounts:async b=>{await a.deleteMany({model:"account",where:[{field:"userId",value:b}]})},deleteAccount:async b=>{await a.delete({model:"account",where:[{field:"id",value:b}]})},deleteSessions:async e=>{if(d){if("string"==typeof e){let a=await d.get(`active-sessions-${e}`),b=a?(0,v.s)(a):[];if(!b)return;for(let a of b)await d.delete(a.token)}else for(let a of e)await d.get(a)&&await d.delete(a);if(!c.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await a.deleteMany({model:"session",where:[{field:Array.isArray(e)?"token":"userId",value:e,operator:Array.isArray(e)?"in":void 0}]})},findOAuthUser:async(b,c,d)=>{let e=await a.findMany({model:"account",where:[{value:c,field:"accountId"}]}).then(a=>a.find(a=>a.providerId===d));if(e){let c=await a.findOne({model:"user",where:[{value:e.userId,field:"id"}]});if(c)return{user:c,accounts:[e]};{let c=await a.findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:[e]}:null}}{let c=await a.findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!c)return null;{let b=await a.findMany({model:"account",where:[{value:c.id,field:"userId"}]});return{user:c,accounts:b||[]}}}},findUserByEmail:async(b,c)=>{let d=await a.findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});if(!d)return null;if(c?.includeAccounts){let b=await a.findMany({model:"account",where:[{value:d.id,field:"userId"}]});return{user:d,accounts:b}}return{user:d,accounts:[]}},findUserById:async b=>await a.findOne({model:"user",where:[{field:"id",value:b}]}),linkAccount:async(a,b)=>await f({...a,createdAt:new Date,updatedAt:new Date},"account",void 0,b),updateUser:async(a,b,c)=>{let e=await g(b,[{field:"id",value:a}],"user",void 0,c);if(d&&e){let b=await d.get(`active-sessions-${a}`);if(b){let a=Date.now(),c=((0,v.s)(b)||[]).filter(b=>b.expiresAt>a);await Promise.all(c.map(async({token:b})=>{let c=await d.get(b);if(!c)return;let f=(0,v.s)(c);if(!f)return;let g=Math.max(Math.floor((new Date(f.session.expiresAt).getTime()-a)/1e3),0);await d.set(b,JSON.stringify({session:f.session,user:e}),g)}))}}return e},updateUserByEmail:async(a,b,c)=>await g(b,[{field:"email",value:a.toLowerCase()}],"user",void 0,c),updatePassword:async(a,b,c)=>{await i({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0,c)},findAccounts:async b=>await a.findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async b=>await a.findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c)=>await a.findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async b=>await a.findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b,c)=>await g(b,[{field:"id",value:a}],"account",void 0,c),createVerificationValue:async(a,b)=>await f({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0,b),findVerificationValue:async b=>{let d=await a.findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return c.verification?.disableCleanup||await a.deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),d[0]},deleteVerificationValue:async b=>{await a.delete({model:"verification",where:[{field:"id",value:b}]})},deleteVerificationByIdentifier:async b=>{await a.delete({model:"verification",where:[{field:"identifier",value:b}]})},updateVerificationValue:async(a,b,c)=>await g(b,[{field:"id",value:a}],"verification",void 0,c)}};async function ca(a){let b;if(!a.database){let b,c=Object.keys((0,w.g)(a)).reduce((a,b)=>(a[b]=[],a),{});return j.a.warn("No database configuration provided. Using memory adapter in development"),(0,b7.c)({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:b?.debugLogs||!1,customTransformInput:a=>a.options.advanced?.database?.useNumberId&&"id"===a.field&&"create"===a.action?c[a.model].length+1:a.data},adapter:({getFieldName:a,options:b,debugLog:d})=>{function e(a,b){let d=c[b];if(!d)throw j.a.error(`[MemoryAdapter] Model ${b} not found in the DB`,Object.keys(c)),Error(`Model ${b} not found`);return d.filter(b=>a.every(a=>{let{field:c,value:d,operator:e}=a;if("in"===e){if(!Array.isArray(d))throw Error("Value must be an array");return d.includes(b[c])}return"contains"===e?b[c].includes(d):"starts_with"===e?b[c].startsWith(d):"ends_with"===e?b[c].endsWith(d):b[c]===d}))}return{create:async({model:a,data:d})=>(b.advanced?.database?.useNumberId&&(d.id=c[a].length+1),c[a]||(c[a]=[]),c[a].push(d),d),findOne:async({model:a,where:b})=>e(b,a)[0]||null,findMany:async({model:b,where:d,sortBy:f,limit:g,offset:h})=>{let i=c[b];return d&&(i=e(d,b)),f&&(i=i.sort((c,d)=>{let e=a({model:b,field:f.field});return"asc"===f.direction?c[e]>d[e]?1:-1:c[e]<d[e]?1:-1})),void 0!==h&&(i=i.slice(h)),void 0!==g&&(i=i.slice(0,g)),i},count:async({model:a})=>c[a].length,update:async({model:a,where:b,update:c})=>{let d=e(b,a);return d.forEach(a=>{Object.assign(a,c)}),d[0]||null},delete:async({model:a,where:b})=>{let d=c[a],f=e(b,a);c[a]=d.filter(a=>!f.includes(a))},deleteMany:async({model:a,where:b})=>{let d=c[a],f=e(b,a),g=0;return c[a]=d.filter(a=>f.includes(a)?(g++,!1):!f.includes(a)),g},updateMany({model:a,where:b,update:c}){let d=e(b,a);return d.forEach(a=>{Object.assign(a,c)}),d[0]||null}}}})(a)}if("function"==typeof a.database)return a.database(a);let{kysely:c,databaseType:d}=await b8(a);if(!c)throw new o.B("Failed to initialize database adapter");return(b={type:d||"sqlite",debugLogs:"debugLogs"in a.database&&a.database.debugLogs},(0,b7.c)({config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:b?.usePlural,debugLogs:b?.debugLogs,supportsBooleans:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsDates:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsJSON:!1},adapter:({getFieldName:a,schema:d})=>{let e=async(d,e,f,g)=>{if(b?.type==="mysql"){await e.execute();let b=d.id?"id":g.length>0&&g[0].field?g[0].field:"id";if(!d.id&&0===g.length)return await c.selectFrom(f).selectAll().orderBy(a({model:f,field:b}),"desc").limit(1).executeTakeFirst();let h=d[b]||g[0].value;return await c.selectFrom(f).selectAll().orderBy(a({model:f,field:b}),"desc").where(a({model:f,field:b}),"=",h).limit(1).executeTakeFirst()}return b?.type==="mssql"?await e.outputAll("inserted").executeTakeFirst():await e.returningAll().executeTakeFirst()};function f(c,e){if(!e)return{and:null,or:null};let f=[],g=[];return e.forEach(e=>{let{field:h,value:i,operator:j="=",connector:k="AND"}=e,l=a({model:c,field:h});i=function(a,c,e){if("id"===e)return a;let{type:f="sqlite"}=b||{},g=d[c]?.fields[e];return(g||(g=Object.values(d).find(a=>a.modelName===c)),"boolean"===g.type&&("sqlite"===f||"mssql"===f)&&null!=a)?+!!a:"date"===g.type&&a&&a instanceof Date&&"sqlite"===f?a.toISOString():a}(i,c,h);let m=a=>"in"===j.toLowerCase()?a(l,"in",Array.isArray(i)?i:[i]):"contains"===j?a(l,"like",`%${i}%`):"starts_with"===j?a(l,"like",`${i}%`):"ends_with"===j?a(l,"like",`%${i}`):a(l,"eq"===j?"=":"ne"===j?"<>":"gt"===j?">":"gte"===j?">=":"lt"===j?"<":"lte"===j?"<=":j,i);"OR"===k?g.push(m):f.push(m)}),{and:f.length?f:null,or:g.length?g:null}}return{async create({data:a,model:b}){let d=c.insertInto(b).values(a);return await e(a,d,b,[])},async findOne({model:a,where:b,select:d}){let{and:e,or:g}=f(a,b),h=c.selectFrom(a).selectAll();e&&(h=h.where(a=>a.and(e.map(b=>b(a))))),g&&(h=h.where(a=>a.or(g.map(b=>b(a)))));let i=await h.executeTakeFirst();return i||null},async findMany({model:d,where:e,limit:g,offset:h,sortBy:i}){let{and:j,or:k}=f(d,e),l=c.selectFrom(d);j&&(l=l.where(a=>a.and(j.map(b=>b(a))))),k&&(l=l.where(a=>a.or(k.map(b=>b(a))))),b?.type==="mssql"?h||(l=l.top(g||100)):l=l.limit(g||100),i&&(l=l.orderBy(a({model:d,field:i.field}),i.direction)),h&&(b?.type==="mssql"?(i||(l=l.orderBy(a({model:d,field:"id"}))),l=l.offset(h).fetch(g||100)):l=l.offset(h));let m=await l.selectAll().execute();return m||[]},async update({model:a,where:b,update:d}){let{and:g,or:h}=f(a,b),i=c.updateTable(a).set(d);return g&&(i=i.where(a=>a.and(g.map(b=>b(a))))),h&&(i=i.where(a=>a.or(h.map(b=>b(a))))),await e(d,i,a,b)},async updateMany({model:a,where:b,update:d}){let{and:e,or:g}=f(a,b),h=c.updateTable(a).set(d);return e&&(h=h.where(a=>a.and(e.map(b=>b(a))))),g&&(h=h.where(a=>a.or(g.map(b=>b(a))))),(await h.execute()).length},async count({model:a,where:b}){let{and:d,or:e}=f(a,b),g=c.selectFrom(a).select(c.fn.count("id").as("count"));return d&&(g=g.where(a=>a.and(d.map(b=>b(a))))),e&&(g=g.where(a=>a.or(e.map(b=>b(a))))),(await g.execute())[0].count},async delete({model:a,where:b}){let{and:d,or:e}=f(a,b),g=c.deleteFrom(a);d&&(g=g.where(a=>a.and(d.map(b=>b(a))))),e&&(g=g.where(a=>a.or(e.map(b=>b(a))))),await g.execute()},async deleteMany({model:a,where:b}){let{and:d,or:e}=f(a,b),g=c.deleteFrom(a);return d&&(g=g.where(a=>a.and(d.map(b=>b(a))))),e&&(g=g.where(a=>a.or(e.map(b=>b(a))))),(await g.execute()).length},options:b}}}))(a)}let cb={postgres:{string:["character varying","varchar","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamp","date"]},mysql:{string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"]},mssql:{string:["text","varchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime","date"]}};async function cc(a){let b=function(a){let b=(0,w.g)(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}(a),c=(0,j.c)(a.logger),{kysely:d,databaseType:e}=await b8(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f=await d.introspection.getTables(),g=[],h=[];for(let[a,d]of Object.entries(b)){let b=f.find(b=>b.name===a);if(!b){let b=g.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=g.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?g.push(c):g[b].fields={...g[b].fields,...d.fields}:g.splice(e,0,c);continue}let i={};for(let[f,g]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===f);if(!d){i[f]=g;continue}!function(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=cb[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}(d.dataType,g.type,e)&&c.warn(`Field ${f} in table ${a} has a different type in the database. Expected ${g.type} but got ${d.dataType}.`)}Object.keys(i).length>0&&h.push({table:a,fields:i,order:d.order||1/0})}let i=[];function k(b,c){let d=b.type,f={string:{sqlite:"text",postgres:"text",mysql:b.unique?"varchar(255)":b.references?"varchar(36)":"text",mssql:b.unique||b.sortable?"varchar(255)":b.references?"varchar(36)":"text"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:b.bigint?"bigint":"integer",postgres:b.bigint?"bigint":"integer",mysql:b.bigint?"bigint":"integer",mssql:b.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamp",mysql:"datetime",mssql:"datetime"},id:{postgres:a.advanced?.database?.useNumberId?"serial":"text",mysql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:a.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:a.advanced?.database?.useNumberId?"integer":"text"}};return"id"===c||b.references?.field==="id"?f.id[e]:"sqlite"===e&&("string[]"===d||"number[]"===d)?"text":"string[]"===d||"number[]"===d?"jsonb":Array.isArray(d)?"text":f[d][e||"sqlite"]}if(h.length)for(let a of h)for(let[b,c]of Object.entries(a.fields)){let e=k(c,b),f=d.schema.alterTable(a.table).addColumn(b,e,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(`${c.references.model}.${c.references.field}`)),c.unique&&(a=a.unique()),a));i.push(f)}if(g.length)for(let b of g){let c=d.schema.createTable(b.table).addColumn("id",a.advanced?.database?.useNumberId?"postgres"===e?"serial":"integer":"mysql"===e||"mssql"===e?"varchar(36)":"text",b=>a.advanced?.database?.useNumberId?"postgres"===e?b.primaryKey().notNull():b.autoIncrement().primaryKey().notNull():b.primaryKey().notNull());for(let[a,d]of Object.entries(b.fields)){let b=k(d,a);c=c.addColumn(a,b,a=>(a=!1!==d.required?a.notNull():a,d.references&&(a=a.references(`${d.references.model}.${d.references.field}`)),d.unique&&(a=a.unique()),a))}i.push(c)}return{toBeCreated:g,toBeAdded:h,runMigrations:async function(){for(let a of i)await a.execute()},compileMigrations:async function(){return i.map(a=>a.compile().sql).join(";\n\n")+";"}}}async function cd(a,b){let c=await b.context.internalAdapter.findAccounts(a),e=c?.find(a=>"credential"===a.providerId),f=e?.password;if(!e||!f||!b.body.password)throw new d.LG("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:f,password:b.body.password}))throw new d.LG("BAD_REQUEST",{message:"Invalid password"});return!0}let ce="better-auth-secret-123456789",cf=async a=>{var b;let c=await ca(a),d=a.plugins||[],f=(b=a,b.advanced?.crossSubDomainCookies?.enabled,[]),h=(0,j.c)(a.logger),k=(0,n.a)(a.baseURL,a.basePath),p=a.secret||i.e.BETTER_AUTH_SECRET||i.e.AUTH_SECRET||ce;p===ce&&i.a&&h.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config."),a={...a,secret:p,baseURL:k?new URL(k).origin:"",basePath:a.basePath||"/api/auth",plugins:d.concat(f)};let q=(0,g.OR)(a),r=(0,w.g)(a),s=Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];if(!c||!1===c.enabled)return null;c.clientId||h.warn(`Social provider ${b} is missing clientId or clientSecret`);let d=e.t[b](c);return d.disableImplicitSignUp=c.disableImplicitSignUp,d}).filter(a=>null!==a),{context:t}=function(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c=a.init(d);if("object"==typeof c){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=(0,l.$Q)(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=b9(a.adapter,{options:b,hooks:e.filter(a=>void 0!==a),generateId:a.generateId}),d.options=b,{context:d}}({appName:a.appName||"Better Auth",socialProviders:s,options:a,tables:r,trustedOrigins:function(a){let b=(0,n.a)(a.baseURL,a.basePath);if(!b)return[];let c=[new URL(b).origin];a.trustedOrigins&&Array.isArray(a.trustedOrigins)&&c.push(...a.trustedOrigins);let d=i.e.BETTER_AUTH_TRUSTED_ORIGINS;if(d&&c.push(...d.split(",")),c.filter(a=>!a).length)throw new o.B("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return c}(a),baseURL:k||"",sessionConfig:{updateAge:a.session?.updateAge!==void 0?a.session.updateAge:86400,expiresIn:a.session?.expiresIn||604800,freshAge:a.session?.freshAge===void 0?86400:a.session.freshAge},secret:p,rateLimit:{...a.rateLimit,enabled:a.rateLimit?.enabled??i.a,window:a.rateLimit?.window||10,max:a.rateLimit?.max||100,storage:a.rateLimit?.storage||(a.secondaryStorage?"secondary-storage":"memory")},authCookies:q,logger:h,generateId:({model:b,size:c})=>"function"==typeof a.advanced?.generateId?a.advanced.generateId({model:b,size:c}):"function"==typeof a?.advanced?.database?.generateId?a.advanced.database.generateId({model:b,size:c}):(0,j.g)(c),session:null,secondaryStorage:a.secondaryStorage,password:{hash:a.emailAndPassword?.password?.hash||m.Er,verify:a.emailAndPassword?.password?.verify||m.BE,config:{minPasswordLength:a.emailAndPassword?.minPasswordLength||8,maxPasswordLength:a.emailAndPassword?.maxPasswordLength||128},checkPassword:cd},setNewSession(a){this.newSession=a},newSession:null,adapter:c,internalAdapter:b9(c,{options:a,hooks:a.databaseHooks?[a.databaseHooks]:[]}),createAuthCookie:(0,g.a6)(a),async runMigrations(){if(!a.database||"updateMany"in a.database)throw new o.B("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await cc(a);await b()}});return t},cg=a=>{let b=cf(a),{api:c}=t(b,a),f=a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{});return{handler:async c=>{let f=await b,g=f.options.basePath||"/api/auth";if(!f.options.baseURL){let a=(0,n.a)(void 0,g,c);if(a)f.baseURL=a,f.options.baseURL=(0,n.g)(f.baseURL)||void 0;else throw new o.B("Could not get base URL from request. Please provide a valid base URL.")}f.trustedOrigins=[...a.trustedOrigins?Array.isArray(a.trustedOrigins)?a.trustedOrigins:await a.trustedOrigins(c):[],f.options.baseURL];let{handler:h}=((a,b)=>{let{api:c,middlewares:f}=t(a,b),g=new URL(a.baseURL).pathname;return(0,d.aE)(c,{routerContext:a,openapi:{disabled:!0},basePath:g,routerMiddleware:[{path:"/**",middleware:e.A},...f],async onRequest(b){let c=a.options.disabledPaths||[],d=new URL(b.url).pathname.replace(g,"");if(c.includes(d))return new Response("Not Found",{status:404});for(let c of a.options.plugins||[])if(c.onRequest){let d=await c.onRequest(b,a);if(d&&"response"in d)return d.response}return q(b,a)},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof d.LG&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let e=b.logger?.level,f="error"===e||"warn"===e||"debug"===e?j.a:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof d.LG?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),f?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})})(f,a);return h(c)},api:c,options:a,$context:b,$Infer:{},$ERROR_CODES:{...f,...e.B}}}},95856:(a,b,c)=>{c.d(b,{n:()=>f});var d=c(70192),e=c(59061);function f(a,b){return{digest:async c=>{let f=new TextEncoder,g="string"==typeof c?f.encode(c):c,h=await d.aK.digest(a,g);return"hex"===b?Array.from(new Uint8Array(h)).map(a=>a.toString(16).padStart(2,"0")).join(""):"base64"===b||"base64url"===b||"base64urlnopad"===b?b.includes("url")?e.z.encode(h,{padding:"base64urlnopad"!==b}):e.K.encode(h):h}}}},96406:(a,b,c)=>{c.d(b,{KM:()=>i,vE:()=>l,xQ:()=>k});var d=c(8575),e=c(37103),f=c(10289),g=c(5);class h extends g.u{static [d.i]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new i(a,this.config)}}class i extends f.Kl{static [d.i]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=a=>new Date(this.withTimezone?a:a+"+0000");mapToDriverValue=a=>a.toISOString()}class j extends g.u{static [d.i]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new k(a,this.config)}}class k extends f.Kl{static [d.i]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}}function l(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return d?.mode==="string"?new j(c,d.withTimezone??!1,d.precision):new h(c,d?.withTimezone??!1,d?.precision)}},96508:(a,b,c)=>{c.d(b,{dw:()=>k,p6:()=>l,qw:()=>i});var d=c(8575),e=c(37103),f=c(10289),g=c(5);class h extends g.u{static [d.i]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new i(a,this.config)}}class i extends f.Kl{static [d.i]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return new Date(a)}mapToDriverValue(a){return a.toISOString()}}class j extends g.u{static [d.i]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new k(a,this.config)}}class k extends f.Kl{static [d.i]="PgDateString";getSQLType(){return"date"}}function l(a,b){let{name:c,config:d}=(0,e.Ll)(a,b);return d?.mode==="date"?new h(c):new j(c)}},97434:(a,b,c)=>{c.d(b,{GQ:()=>u,EQ:()=>v,bl:()=>t});var d=c(47581),e=c(59659),f=c(22715);let g=(0,e.CN)({is:a=>"PartitionByNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByNode",items:(0,e.CN)(a)}),cloneWithItems:(a,b)=>(0,e.CN)({...a,items:(0,e.CN)([...a.items,...b])})}),h=(0,e.CN)({is:a=>"OverNode"===a.kind,create:()=>(0,e.CN)({kind:"OverNode"}),cloneWithOrderByItems:(a,b)=>(0,e.CN)({...a,orderBy:a.orderBy?f.O.cloneWithItems(a.orderBy,b):f.O.create(b)}),cloneWithPartitionByItems:(a,b)=>(0,e.CN)({...a,partitionBy:a.partitionBy?g.cloneWithItems(a.partitionBy,b):g.create(b)})});var i=c(82493),j=c(18634);class k{#g;constructor(a){this.#g=(0,e.CN)(a)}on(...a){return new k({...this.#g,joinNode:d.b.cloneWithOn(this.#g.joinNode,(0,j.GB)(a))})}onRef(a,b,c){return new k({...this.#g,joinNode:d.b.cloneWithOn(this.#g.joinNode,(0,j.vC)(a,b,c))})}onTrue(){return new k({...this.#g,joinNode:d.b.cloneWithOn(this.#g.joinNode,i.z.createWithSql("true"))})}$call(a){return a(this)}toOperationNode(){return this.#g.joinNode}}var l=c(71767),m=c(80038);let n=(0,e.CN)({is:a=>"PartitionByItemNode"===a.kind,create:a=>(0,e.CN)({kind:"PartitionByItemNode",partitionBy:a})});var o=c(34082);class p{#g;constructor(a){this.#g=(0,e.CN)(a)}orderBy(...a){return new p({overNode:h.cloneWithOrderByItems(this.#g.overNode,(0,m.xk)(a))})}clearOrderBy(){return new p({overNode:l.L.cloneWithoutOrderBy(this.#g.overNode)})}partitionBy(a){return new p({overNode:h.cloneWithPartitionByItems(this.#g.overNode,(0,o.kU)(a).map(n.create))})}$call(a){return a(this)}toOperationNode(){return this.#g.overNode}}var q=c(35684),r=c(59865),s=c(15021);function t(){return new q.n({executor:r.W})}function u(a,b){return new k({joinNode:d.b.create(a,(0,s.uJ)(b))})}function v(){return new p({overNode:h.create()})}},97733:(a,b,c)=>{c.d(b,{U:()=>g});var d=c(59659),e=c(49161),f=c(42517);let g=(0,d.CN)({is:a=>"UpdateQueryNode"===a.kind,create:(a,b)=>(0,d.CN)({kind:"UpdateQueryNode",table:1===a.length?a[0]:f.v.create(a),...b&&{with:b}}),createWithoutTable:()=>(0,d.CN)({kind:"UpdateQueryNode"}),cloneWithFromItems:(a,b)=>(0,d.CN)({...a,from:a.from?e.N.cloneWithFroms(a.from,b):e.N.create(b)}),cloneWithUpdates:(a,b)=>(0,d.CN)({...a,updates:a.updates?(0,d.CN)([...a.updates,...b]):b}),cloneWithLimit:(a,b)=>(0,d.CN)({...a,limit:b})})},97949:(a,b,c)=>{c.d(b,{Xd:()=>i,kB:()=>j});var d=c(8575),e=c(37103),f=c(10289),g=c(5);class h extends g.u{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [d.i]="PgTimeBuilder";build(a){return new i(a,this.config)}}class i extends f.Kl{static [d.i]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}function j(a,b={}){let{name:c,config:d}=(0,e.Ll)(a,b);return new h(c,d.withTimezone??!1,d.precision)}},98238:(a,b,c)=>{c.d(b,{y:()=>j});var d=c(98708),e=c(23921),f=c(52723),g=c(44796),h=c(22041),i=c(47609);c(44989),c(506),c(95856),c(59061),c(15247),c(22321);let j=(a,b)=>(0,i.c)({config:{adapterId:"drizzle",adapterName:"Drizzle Adapter",usePlural:b.usePlural??!1,debugLogs:b.debugLogs??!1},adapter:({getFieldName:c,debugLog:i})=>{function j(c){let d=b.schema||a._.fullSchema;if(!d)throw new h.B("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");let e=d[c];if(!e)throw new h.B(`[# Drizzle Adapter]: The model "${c}" was not found in the schema object. Please pass the schema directly to the adapter options.`);return e}let k=async(c,g,i,k)=>{if("mysql"!==b.provider)return(await g.returning())[0];await g.execute();let m=j(c),n=g.config?.values;if(k?.length){let b=l(k,c);return(await a.select().from(m).where(...b))[0]}if(n&&n[0]?.id?.value){let b=n[0]?.id?.value;return b||(b=(await a.select({id:(0,d.ll)`LAST_INSERT_ID()`}).from(m).orderBy((0,e.i)(m.id)).limit(1))[0].id),(await a.select().from(m).where((0,f.eq)(m.id,b)).limit(1).execute())[0]}if(i.id)return(await a.select().from(m).where((0,f.eq)(m.id,i.id)).limit(1).execute())[0];if(!("id"in m))throw new h.B(`The model "${c}" does not have an "id" field. Please use the "id" field as your primary key.`);return(await a.select().from(m).orderBy((0,e.i)(m.id)).limit(1).execute())[0]};function l(a,b){let d=j(b);if(!a)return[];if(1===a.length){let e=a[0];if(!e)return[];let g=c({model:b,field:e.field});if(!d[g])throw new h.B(`The field "${e.field}" does not exist in the schema for the model "${b}". Please update your schema.`);if("in"===e.operator){if(!Array.isArray(e.value))throw new h.B(`The value for the field "${e.field}" must be an array when using the "in" operator.`);return[(0,f.RV)(d[g],e.value)]}return"contains"===e.operator?[(0,f.mj)(d[g],`%${e.value}%`)]:"starts_with"===e.operator?[(0,f.mj)(d[g],`${e.value}%`)]:"ends_with"===e.operator?[(0,f.mj)(d[g],`%${e.value}`)]:"lt"===e.operator?[(0,f.lt)(d[g],e.value)]:"lte"===e.operator?[(0,f.wJ)(d[g],e.value)]:"ne"===e.operator?[(0,f.ne)(d[g],e.value)]:"gt"===e.operator?[(0,f.gt)(d[g],e.value)]:"gte"===e.operator?[(0,f.RO)(d[g],e.value)]:[(0,f.eq)(d[g],e.value)]}let e=a.filter(a=>"AND"===a.connector||!a.connector),g=a.filter(a=>"OR"===a.connector),i=(0,f.Uo)(...e.map(a=>{let e=c({model:b,field:a.field});if("in"===a.operator){if(!Array.isArray(a.value))throw new h.B(`The value for the field "${a.field}" must be an array when using the "in" operator.`);return(0,f.RV)(d[e],a.value)}return(0,f.eq)(d[e],a.value)})),k=(0,f.or)(...g.map(a=>{let e=c({model:b,field:a.field});return(0,f.eq)(d[e],a.value)})),l=[];return e.length&&l.push(i),g.length&&l.push(k),l}return{async create({model:b,data:c}){let d=j(b);if(!d)throw new h.B("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");for(let a in c)if(!d[a])throw new h.B(`The field "${a}" does not exist in the "${b}" schema. Please update your drizzle schema or re-generate using "npx @better-auth/cli generate".`);let e=a.insert(d).values(c);return await k(b,e,c)},async findOne({model:b,where:c}){let d=j(b),e=l(c,b),f=await a.select().from(d).where(...e);return f.length?f[0]:null},async findMany({model:b,where:d,sortBy:f,limit:g,offset:h}){let i=j(b),k=d?l(d,b):[],m=f?.direction==="desc"?e.i:e.Y,n=a.select().from(i).limit(g||100).offset(h||0);return f?.field&&n.orderBy(m(i[c({model:b,field:f?.field})])),await n.where(...k)},async count({model:b,where:c}){let d=j(b),e=c?l(c,b):[];return(await a.select({count:(0,g.U9)()}).from(d).where(...e))[0].count},async update({model:b,where:c,update:d}){let e=j(b),f=l(c,b),g=a.update(e).set(d).where(...f);return await k(b,g,d,c)},async updateMany({model:b,where:c,update:d}){let e=j(b),f=l(c,b),g=a.update(e).set(d).where(...f);return await g},async delete({model:b,where:c}){let d=j(b),e=l(c,b),f=a.delete(d).where(...e);return await f},async deleteMany({model:b,where:c}){let d=j(b),e=l(c,b),f=a.delete(d).where(...e);return await f},options:b}}})},98318:(a,b,c)=>{c.d(b,{V:()=>e});var d=c(8575);class e{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [d.i]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}},98546:(a,b,c)=>{c.d(b,{a:()=>e});var d=c(59659);let e=(0,d.CN)({is:a=>"LimitNode"===a.kind,create:a=>(0,d.CN)({kind:"LimitNode",limit:a})})},98642:(a,b,c)=>{c.d(b,{s:()=>d});function d(a){try{return JSON.parse(a,function(a,b){if("string"==typeof b&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(b)){let a=new Date(b);if(!isNaN(a.getTime()))return a}return b})}catch{return null}}},98708:(a,b,c)=>{c.d(b,{OX:()=>p,SX:()=>t,Iw:()=>z,Or:()=>C,Xs:()=>s,DJ:()=>r,Ss:()=>G,Ct:()=>E,dm:()=>I,eG:()=>v,qt:()=>q,eg:()=>H,UU:()=>u,lJ:()=>w,xT:()=>x,mk:()=>y,uR:()=>A,qf:()=>D,ll:()=>B});var d=c(8575),e=c(10289);class f extends e.pe{static [d.i]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new g(a,this.config)}}class g extends e.Kl{static [d.i]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let h=Symbol.for("drizzle:isPgEnum");class i extends e.pe{static [d.i]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new j(a,this.config)}}class j extends e.Kl{static [d.i]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}var k=c(72354),l=c(25332),m=c(16155),n=c(98318),o=c(7762);class p{static [d.i]="FakePrimitiveParam"}function q(a){return null!=a&&"function"==typeof a.getSQL}class r{static [d.i]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new s([this])}}class s{constructor(a){for(let b of(this.queryChunks=a,a))if((0,d.is)(b,o.XI)){let a=b[o.XI.Symbol.Schema];this.usedTables.push(void 0===a?b[o.XI.Symbol.Name]:a+"."+b[o.XI.Symbol.Name])}}static [d.i]="SQL";decoder=w;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return l.k.startActiveSpan("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:e,escapeName:f,escapeParam:g,prepareTyping:i,inlineParams:j,paramStartIndex:l}=c;var p=a.map(a=>{if((0,d.is)(a,r))return{sql:a.value.join(""),params:[]};if((0,d.is)(a,t))return{sql:f(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new r("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new r(", "));return b.push(new r(")")),this.buildQueryFromSourceParams(b,c)}if((0,d.is)(a,s))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:j||a.shouldInlineParams});if((0,d.is)(a,o.XI)){let b=a[o.XI.Symbol.Schema],c=a[o.XI.Symbol.Name];return{sql:void 0===b||a[o.HE]?f(c):f(b)+"."+f(c),params:[]}}if((0,d.is)(a,n.V)){let c=e.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:f(c),params:[]};let d=a.table[o.XI.Symbol.Schema];return{sql:a.table[o.HE]||void 0===d?f(a.table[o.XI.Symbol.Name])+"."+f(c):f(d)+"."+f(a.table[o.XI.Symbol.Name])+"."+f(c),params:[]}}if((0,d.is)(a,G)){let b=a[m.n].schema,c=a[m.n].name;return{sql:void 0===b||a[m.n].isAlias?f(c):f(b)+"."+f(c),params:[]}}if((0,d.is)(a,z)){if((0,d.is)(a.value,C))return{sql:g(l.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if((0,d.is)(b,s))return this.buildQueryFromSourceParams([b],c);if(j)return{sql:this.mapInlineParam(b,c),params:[]};let e=["none"];return i&&(e=[i(a.encoder)]),{sql:g(l.value++,b),params:[b],typings:e}}return(0,d.is)(a,C)?{sql:g(l.value++,a),params:[a],typings:["none"]}:(0,d.is)(a,s.Aliased)&&void 0!==a.fieldAlias?{sql:f(a.fieldAlias),params:[]}:(0,d.is)(a,k.n)?a._.isWith?{sql:f(a._.alias),params:[]}:this.buildQueryFromSourceParams([new r("("),a._.sql,new r(") "),new t(a._.alias)],c):a&&"function"==typeof a&&h in a&&!0===a[h]?a.schema?{sql:f(a.schema)+"."+f(a.enumName),params:[]}:{sql:f(a.enumName),params:[]}:q(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new r("("),a.getSQL(),new r(")")],c):j?{sql:this.mapInlineParam(a,c),params:[]}:{sql:g(l.value++,a),params:[a],typings:["none"]}});let u={sql:"",params:[]};for(let a of p)u.sql+=a.sql,u.params.push(...a.params),a.typings?.length&&(u.typings||(u.typings=[]),u.typings.push(...a.typings));return u}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new s.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class t{constructor(a){this.value=a}static [d.i]="Name";brand;getSQL(){return new s([this])}}function u(a){return new t(a)}function v(a){return"object"==typeof a&&null!==a&&"mapToDriverValue"in a&&"function"==typeof a.mapToDriverValue}let w={mapFromDriverValue:a=>a},x={mapToDriverValue:a=>a},y={...w,...x};class z{constructor(a,b=x){this.value=a,this.encoder=b}static [d.i]="Param";brand;getSQL(){return new s([this])}}function A(a,b){return new z(a,b)}function B(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new r(a[0])),b.entries()))c.push(e,new r(a[d+1]));return new s(c)}(a=>{a.empty=function(){return new s([])},a.fromList=function(a){return new s(a)},a.raw=function(a){return new s([new r(a)])},a.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new s(c)},a.identifier=function(a){return new t(a)},a.placeholder=function(a){return new C(a)},a.param=function(a,b){return new z(a,b)}})(B||(B={})),(a=>{class b{constructor(a,b){this.sql=a,this.fieldAlias=b}static [d.i]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new b(this.sql,this.fieldAlias)}}a.Aliased=b})(s||(s={}));class C{constructor(a){this.name=a}static [d.i]="Placeholder";getSQL(){return new s([this])}}function D(a){return new C(a)}function E(a,b){return a.map(a=>{if((0,d.is)(a,C)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if((0,d.is)(a,z)&&(0,d.is)(a.value,C)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let F=Symbol.for("drizzle:IsDrizzleView");class G{static [d.i]="View";[m.n];[F]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[m.n]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new s([this])}}function H(a){return"object"==typeof a&&null!==a&&F in a}function I(a){return a[m.n].name}n.V.prototype.getSQL=function(){return new s([this])},o.XI.prototype.getSQL=function(){return new s([this])},k.n.prototype.getSQL=function(){return new s([this])}}};